<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Vidje - Musik Platform</title>
    <!-- PWA Manifest & Theme -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/assets/logo.png">
    <link rel="apple-touch-icon" href="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/assets/logo.png">
    <meta name="theme-color" content="#e50914">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Vidje">
    <!-- Prevent zoom on input focus (mobile) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
<!-- SELESAI BAGIAN 1! -->
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>
    <!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- Vidje Tracking System -->
<script src="vidje-tracking.js"></script>

    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --bg-black: #000000;
            --bg-dark: #121212;
            --bg-card: #181818;
            --bg-card-hover: #282828;
            --primary-red: #e50914;
            --primary-red-hover: #ff1f2c;
            --text-white: #ffffff;
            --text-gray: #b3b3b3;
            --border-color: #333;
            --player-height: 90px;
            --mobile-nav-height: 0px;
            --sidebar-width: 240px;
            --header-height: 64px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }


        /* --- BACK BUTTON STYLE --- */
        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            transition: color 0.2s ease;
            padding: 8px 8px;
            width: 44px;
            height: 44px;
        }
        
        .back-button:hover {
            color: var(--primary-red);
        }
        
        .back-button-text {
            display: none;
        }

                /* Mobile back button positioning */
        @media (max-width: 768px) {
            .back-button[style*="position: absolute"] {
                top: 20px !important;
            }
        }

        #play-screen-unified {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: #000 !important;
            z-index: 99999 !important;
            display: none !important;
        }

        #play-screen-unified.active {
            display: flex !important;
            flex-direction: column !important;
        }

        #play-screen-scroll {
            scroll-behavior: smooth;
        }

        #play-screen-scroll::-webkit-scrollbar {
            display: none;
        }

        /* Mobile: Simplified CSS - let scroll work naturally */
        @media (max-width: 768px) {
            #play-screen-cover {
                width: 300px !important;
                height: 300px !important;
                margin-bottom: 32px !important;
            }

            #play-screen-song-title {
                font-size: 24px !important;
            }

            #play-screen-song-artist {
                font-size: 14px !important;
            }

            #play-screen-lyrics-title {
                font-size: 20px !important;
            }
        }

        /* Desktop: Show play screen with side-by-side layout */
        @media (min-width: 769px) {
            #play-screen-unified {
                display: none !important;
            }

            #play-screen-unified.active {
                display: flex !important;
                flex-direction: row !important;
                z-index: 100000 !important;
            }

            #play-screen-scroll {
                position: relative !important;
                top: auto !important;
                left: auto !important;
                width: auto !important;
                height: 100vh !important;
                overflow-y: hidden !important;
                scroll-snap-type: none !important;
                display: flex !important;
                flex: 1;
                transition: all 0.4s ease !important;
            }

            /* Album view centered by default, shifts left when lyrics show */
            #play-screen-album {
                height: 100vh !important;
                width: 100% !important;
                padding: 40px 20px !important;
                display: flex !important;
                flex-direction: column !important;
                scroll-snap-align: unset !important;
                scroll-snap-stop: unset !important;
                transition: width 0.4s ease !important;
            }

            /* Desktop: Hide navigate to lyrics button (last child button in album) */
            #play-screen-album button:last-child {
                display: none !important;
                pointer-events: none !important;
            }

            /* When lyrics shown, album becomes 35% width */
            #play-screen-scroll.lyrics-visible #play-screen-album {
                width: 35% !important;
            }

            /* Lyrics panel */
            #play-screen-lyrics {
                width: 0 !important;
                height: 100vh !important;
                overflow-y: hidden !important;
                overflow-x: hidden !important;
                padding: 0 !important;
                scroll-snap-align: unset !important;
                scroll-snap-stop: unset !important;
                transition: width 0.4s ease !important;
                border-left: none !important;
                min-width: 0 !important;
                display: none !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                visibility: hidden !important;
            }

            /* Hide scrollbar in lyrics */
            #play-screen-lyrics::-webkit-scrollbar {
                display: none !important;
            }

            #play-screen-lyrics {
                -ms-overflow-style: none !important;
                scrollbar-width: none !important;
            }

            /* When shown, lyrics becomes 65% width */
            #play-screen-scroll.lyrics-visible #play-screen-lyrics {
                width: 65% !important;
                display: flex !important;
                visibility: visible !important;
            }

            /* Lyrics container centered */
            #play-screen-lyrics-container {
                width: 100% !important;
                text-align: center !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
            }

            /* Hide all divs (progress bar, controls) in lyrics except container */
            #play-screen-lyrics > div:not(#play-screen-lyrics-container) {
                display: none !important;
            }

            #play-screen-lyrics.show {
                display: flex !important;
            }

            /* Hide mobile nav buttons on desktop */
            .mobile-nav-btn {
                display: none !important;
            }

            /* Show desktop toggle button on desktop */
            .desktop-toggle-lyrics {
                display: flex !important;
            }

            /* Enlarge lyrics text on desktop (from index30) */
            .play-screen-lyric-line {
                font-size: 32px !important;
                margin: 16px 0 !important;
                line-height: 1.4 !important;
            }

            .play-screen-lyric-line.active {
                font-size: 38px !important;
            }

            /* Lyrics container centered visually with flex-start for scrolling */
            #play-screen-lyrics-container {
                width: 100% !important;
                max-height: 60vh !important;
                text-align: center !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: flex-start !important;
                padding: 40px 40px !important;
                overflow-y: auto !important;
                overflow-x: hidden !important;
            }

            /* Scale down album art when lyrics shown */
            #play-screen-scroll.lyrics-visible #play-screen-cover {
                width: 240px !important;
                height: 240px !important;
                margin-bottom: 24px !important;
            }

            /* Hide navigate button in lyrics on desktop */
            #play-screen-lyrics > button:first-child {
                display: none !important;
            }

            /* Hide song title in lyrics on desktop */
            #play-screen-lyrics > h2 {
                display: none !important;
            }
        }

        /* Desktop toggle lyrics button */
        .desktop-toggle-lyrics {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            transition: color 0.3s;
            display: none;
            z-index: 10;
        }

        .desktop-toggle-lyrics:hover {
            color: rgba(255,255,255,1);
        }

        @keyframes swipeBounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(6px); }
        }

        .play-screen-lyric-line {
            font-size: 18px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.3);
            text-align: center;
            margin: 20px 0;
            line-height: 1.6;
            transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
        }

        .play-screen-lyric-line.active {
            font-size: 20px;
            font-weight: 600;
            color: white;
            text-shadow: 0 0 16px rgba(255, 255, 255, 0.6);
            transform: scale(1.08);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @media (max-width: 768px) {
            #play-screen-cover {
                width: 300px !important;
                height: 300px !important;
                margin-bottom: 32px !important;
            }

            #play-screen-song-title {
                font-size: 24px !important;
            }

            #play-screen-song-artist {
                font-size: 14px !important;
            }

            #play-screen-lyrics-title {
                font-size: 20px !important;
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-black);
            color: var(--text-white);
            height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            padding-bottom: calc(var(--player-height) + var(--mobile-nav-height));
        }

        /* Desktop: Revert to hidden overflow */
        @media (min-width: 769px) {
            body {
                overflow: hidden;
            }
        }

        /* --- SCROLLBAR --- */
        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }

        /* Mobile: Hide scrollbar completely */
        @media (max-width: 768px) {
            ::-webkit-scrollbar {
                display: none;
                width: 0;
                height: 0;
            }
            
            * {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            
            *::-webkit-scrollbar {
                display: none;
            }
            
            /* Improve scroll performance on mobile */
            * {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Mobile bottom navigation (hidden by default) */
        /* Mobile bottom navigation (hidden by default) */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            left: 12px;
            right: 12px;
            bottom: calc(var(--player-height, 72px) + 18px);
            height: 56px;
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25));
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            z-index: 20010;
            align-items: center;
            justify-content: space-around;
            gap: 6px;
            padding: 6px 10px;
            backdrop-filter: blur(6px);
        }

        .mobile-bottom-nav .mb-nav-item {
            color: var(--text-gray);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            gap: 4px;
            width: 72px;
        }

        .mobile-bottom-nav .mb-nav-item i { font-size: 20px; }
        .mobile-bottom-nav .mb-nav-item.active { color: var(--primary-red); }

        /* --- LOADING SCREEN --- */
        #loading-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0000 25%, #330000 50%, #1a0000 75%, #000000 100%);
            background-size: 400% 400%;
            animation: gradient-shift 10s ease infinite;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.25s ease;
            will-change: opacity;
            overflow: hidden;
        }
        
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        #loading-screen::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(229, 9, 20, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: particles-float 20s linear infinite;
            opacity: 0.4;
        }
        
        @keyframes particles-float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        #loading-screen::after {
            content: '';
            position: absolute;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(229, 9, 20, 0.15) 0%, transparent 70%);
            animation: glow-pulse 4s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes glow-pulse {
            0%, 100% { transform: scale(0.8); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.6; }
        }
        
        .loader {
            display: none;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
            100% { transform: rotate(360deg); }
        }
        .loader-text { display: none; }

        @keyframes dots {
            0% { opacity: 0.18 }
            50% { opacity: 1 }
            100% { opacity: 0.18 }
        }

        @keyframes logo-pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.08) rotate(3deg); }
        }
        
        @keyframes logo-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(229, 9, 20, 0.4),
                            0 0 40px rgba(229, 9, 20, 0.2),
                            0 0 60px rgba(229, 9, 20, 0.1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(229, 9, 20, 0.6),
                            0 0 60px rgba(229, 9, 20, 0.4),
                            0 0 90px rgba(229, 9, 20, 0.2);
            }
        }
        
        @keyframes text-glow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(229, 9, 20, 0.5),
                            0 0 20px rgba(229, 9, 20, 0.3),
                            0 0 30px rgba(229, 9, 20, 0.1);
            }
            50% {
                text-shadow: 0 0 20px rgba(229, 9, 20, 0.8),
                            0 0 40px rgba(229, 9, 20, 0.5),
                            0 0 60px rgba(229, 9, 20, 0.3);
            }
        }

        .loading-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        .loading-center .logo { display:flex; align-items:center; justify-content:center; }
        .app-logo { display:inline-block; }
        
        .centered-logo { 
            width: 250px;
            height: 250px;
            border-radius: 50%;
            object-fit: cover;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            animation: logo-pulse 3s ease-in-out infinite;
        }
        
        
        @keyframes logo-pulse {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 10px rgba(229, 9, 20, 0.3));
            }
            50% { 
                transform: scale(1.08);
                filter: drop-shadow(0 0 30px rgba(229, 9, 20, 0.7));
            }
        }
        
        
        .centered-logo:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }
        
        .logo .app-logo { 
            width: 42px; 
            height: 42px; 
            margin-right:4px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .logo .app-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.8);
            filter: brightness(1.2);
        }
        
        .loading-center .loading-title { 
            font-size: 56px;
            font-weight: 900;
            color: #fff;
            letter-spacing: 8px;
            font-family: 'Montserrat', sans-serif;
            text-transform: uppercase;
            animation: text-glow 3s ease-in-out infinite, text-pulse 3s ease-in-out infinite;
            position: relative;
        }
        
        .loading-center .loading-title::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #e50914, transparent);
            animation: underline-pulse 2s ease-in-out infinite;
        }
        
        @keyframes underline-pulse {
            0%, 100% { opacity: 0.3; width: 60%; }
            50% { opacity: 1; width: 90%; }
        }
        
        @keyframes text-pulse {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.03);
            }
        }

        /* Offline Notice in Loading Screen */
        .loading-offline-notice {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 59, 48, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 59, 48, 0.5);
            padding: 16px 32px;
            border-radius: 12px;
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2;
            animation: notice-slide-up 0.5s ease;
        }

        .loading-offline-notice.show {
            display: flex;
        }

        @keyframes notice-slide-up {
            from { 
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .loading-offline-notice i {
            font-size: 24px;
            color: #ff3b30;
            animation: pulse-icon 2s ease-in-out infinite;
        }

        @keyframes pulse-icon {
            0%, 100% { 
                opacity: 0.7;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .loading-offline-notice .notice-text {
            color: white;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .loading-offline-notice .notice-text .notice-title {
            font-size: 16px;
            margin-bottom: 4px;
            color: #ff3b30;
        }

        .loading-offline-notice .notice-text .notice-subtitle {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }

        @media (max-width: 768px) {
            .loading-offline-notice {
                bottom: 40px;
                padding: 12px 24px;
                max-width: 90%;
            }
            
            .loading-offline-notice i {
                font-size: 20px;
            }
            
            .loading-offline-notice .notice-text .notice-title {
                font-size: 14px;
            }
            
            .loading-offline-notice .notice-text .notice-subtitle {
                font-size: 12px;
            }
        }
        
        @media (max-width: 768px) {
            .centered-logo {
                width: 220px;
                height: 220px;
                animation: logo-pulse 3s ease-in-out infinite;
            }
            
            .loading-center .loading-title {
                font-size: 52px;
                letter-spacing: 8px;
            }
        }

        /* --- AUTH VIEW --- */
        #auth-view {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
        }
        .auth-box {
            background-color: rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border: 1px solid #333;
        }
        .auth-logo { font-size: 48px; color: var(--primary-red); margin-bottom: 10px; }
        .auth-box h2 { margin-top: 10px; font-size: 32px; font-family: 'Montserrat', sans-serif; font-weight: 700; }
        .auth-box p { color: var(--text-gray); margin-bottom: 20px; }
        .auth-input {
            width: 100%; padding: 14px; margin: 8px 0;
            border-radius: 8px; border: 1px solid #444;
            background-color: #000; color: white;
            font-size: 16px; outline: none; transition: 0.3s;
        }
        .auth-input:focus { border-color: var(--primary-red); }
        .auth-btn {
            width: 100%; padding: 14px; margin-top: 20px;
            border-radius: 50px; border: none;
            background-color: var(--primary-red);
            color: white; font-weight: 700; font-size: 16px;
            cursor: pointer; transition: 0.2s;
        }
        .auth-btn:hover { background-color: var(--primary-red-hover); transform: scale(1.02); }
        .auth-switch { margin-top: 20px; font-size: 14px; color: var(--text-gray); }
        .auth-switch span { color: white; cursor: pointer; font-weight: 600; }
        .auth-switch span:hover { text-decoration: underline; }
        .error-msg { color: var(--primary-red); font-size: 13px; margin-top: 10px; display: none; }

        /* --- APP LAYOUT --- */
        .app-wrapper {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .container {
            display: flex;
            flex: 1;
            height: calc(100vh - var(--player-height));
            overflow: hidden;
            position: relative;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-black);
            display: flex;
            flex-direction: column;
            padding: 24px 12px;
            gap: 24px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
            z-index: 20000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 12px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .logo i { font-size: 32px; color: var(--primary-red); }
        .logo span { font-family: 'Montserrat', sans-serif; font-size: 24px; font-weight: 700; letter-spacing: -1px; }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 3px;
            padding: 6px 12px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        /* Hide language switcher on mobile */
        @media (max-width: 768px) {
            .language-switcher {
                display: none;
            }
        }
        
        .lang-btn {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid rgba(255,255,255,0.2);
            background: transparent;
            color: var(--text-gray);
            border-radius: 3px;
            cursor: pointer;
            font-weight: 600;
            font-size: 11px;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }
        .lang-btn:hover {
            color: var(--primary-red);
            border-color: var(--primary-red);
            background: rgba(229, 9, 20, 0.1);
        }
        .lang-btn.active {
            background: var(--primary-red);
            color: white;
            border-color: var(--primary-red);
            font-weight: 700;
        }

        .nav-links { list-style: none; display: flex; flex-direction: column; gap: 8px; }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 10px 16px;
            border-radius: 4px;
            color: var(--text-gray);
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s, background 0.3s;
            text-decoration: none;
        }
        .nav-item:hover, .nav-item.active { color: var(--text-white); background-color: var(--bg-card-hover); }
        .nav-item i { font-size: 24px; }
        .divider { height: 1px; background-color: #282828; margin: 0 12px; }

        .playlist-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 0 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .playlist-title { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-gray); margin-bottom: 12px; padding-left: 12px; }
        .playlist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-gray);
            padding: 8px 12px;
            font-size: 14px;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
            border-radius: 4px;
            position: relative;
            z-index: 10;
            min-width: 0; /* Enable text truncation in flex containers */
        }
        
        .playlist-item-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }
        
        .playlist-item:hover { color: var(--text-white); background-color: rgba(255,255,255,0.05); }
        .playlist-thumb {
            width: 48px; height: 48px;
            border-radius: 4px;
            background: #333;
            object-fit: cover;
            flex-shrink: 0;
        }
        .create-playlist-btn {
            color: var(--text-gray);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: 0.2s;
            border-radius: 4px;
            /* Make full-width and consistent spacing on wider screens */
            width: calc(100% - 24px);
            box-sizing: border-box;
        }
        .create-playlist-btn:hover { color: var(--text-white); background-color: rgba(255,255,255,0.05); }

        /* --- FRIENDS SECTION IN SIDEBAR --- */
        .friend-section {
            margin-top: 20px;
            border-top: 1px solid #282828;
            padding-top: 20px;
        }
        .friend-search-container { position: relative; padding: 0 12px 10px 12px; }
        .friend-search-input {
            width: 100%;
            background: #282828;
            border: 1px solid #333;
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            outline: none;
        }
        .friend-search-dropdown {
            position: absolute;
            top: 35px;
            left: 12px;
            right: 12px;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .friend-dropdown-item {
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border-bottom: 1px solid #444;
        }
        .friend-dropdown-item:last-child { border-bottom: none; }
        .friend-dropdown-item:hover { background: #444; }
        
        .friend-list-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.2s;
        }
        .friend-list-item:hover { background-color: rgba(255,255,255,0.1); }
        .friend-avatar-small {
            width: 32px; height: 32px; border-radius: 50%; object-fit: cover;
        }
        .friend-name { font-size: 13px; color: var(--text-white); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .request-actions {
            display: flex;
            gap: 5px;
            margin-left: auto;
        }
        .btn-icon-small {
            background: none; border: none; color: white; cursor: pointer;
            padding: 4px; border-radius: 4px;
        }
        .btn-accept { color: #1db954; }
        .btn-reject { color: var(--primary-red); }
        .btn-icon-small:hover { opacity: 0.8; }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            background: linear-gradient(180deg, #222222 0%, var(--bg-dark) 40%);
            overflow-y: auto;
            border-radius: 8px;
            margin: 8px 8px 0 0;
            position: relative;
            width: 100%;
            -webkit-overflow-scrolling: touch;
        }
        header {
            position: sticky;
            top: 0;
            background-color: rgba(18, 18, 18, 0.8);
            backdrop-filter: blur(10px);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .header-left { display: flex; align-items: center; gap: 10px; }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .mobile-menu-toggle:hover { background-color: rgba(255,255,255,0.1); }

        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 60000; /* sit above player bar and overlays */
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-overlay.active { display: block; opacity: 1; }

        .user-menu { background-color: rgba(0,0,0,0.7); padding: 4px; padding-right: 12px; border-radius: 20px; display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 700; font-size: 14px; transition: 0.2s; }
        .user-menu:hover { background-color: #282828; }
        .user-menu img { width: 28px; height: 28px; border-radius: 50%; }
        .content-padding { padding: 24px 32px; padding-bottom: 40px; }
        h2 { font-size: 24px; margin-bottom: 20px; margin-top: 10px; }

        /* --- VIEWS --- */
        .view-section { display: none; visibility: hidden; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; visibility: visible; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Components */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 24px; margin-bottom: 40px; }
        
        /* Show All Modal Grid - Responsive */
        #show-all-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 20px; 
        }
        
        @media (max-width: 768px) {
            #show-all-grid { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 16px;
            }
        }
        
        @media (max-width: 480px) {
            #show-all-grid { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 12px;
            }
        }
        
        .horizontal-scroll-grid {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding-bottom: 20px; 
            margin-bottom: 40px;
            scroll-behavior: smooth;
            -ms-overflow-style: none;  
            scrollbar-width: none; 
        }
        .horizontal-scroll-grid::-webkit-scrollbar { display: none; }
        .horizontal-scroll-grid .song-card { min-width: 180px; flex: 0 0 auto; }

        /* Show a thin visible horizontal scrollbar on laptop/desktop */
        @media (min-width: 769px) {
            /* Keep scrolling behavior but hide OS scrollbar on desktop */
            .horizontal-scroll-grid {
                -ms-overflow-style: none; /* IE */
                scrollbar-width: none; /* Firefox */
            }
            .horizontal-scroll-grid::-webkit-scrollbar { display: none; height: 0; }
        }

        .song-card { background-color: var(--bg-card); padding: 16px; border-radius: 6px; transition: all 0.3s ease; cursor: pointer; position: relative; }
        .song-card:hover { 
            background-color: var(--bg-card-hover); 
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.7);
        }
        
        /* Cards in Show All Modal */
        #show-all-grid .song-card {
            padding: 12px;
        }
        
        @media (max-width: 768px) {
            #show-all-grid .song-card {
                padding: 10px;
            }
        }
        
        /* Show All Button - OVERRIDE ALL */
        .card-grid .show-all-card,
        .show-all-card { 
            grid-column: 1 / -1 !important;
            background-color: transparent !important;
            background: transparent !important;
            border: none !important; 
            padding: 20px !important;
            height: 60px !important;
            width: 100% !important;
            min-width: unset !important;
            min-height: unset !important;
            border-radius: 0 !important;
            opacity: 1 !important; 
            transition: all 0.3s ease;
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            cursor: pointer;
            margin: 16px 0 !important;
        }
        .card-grid .show-all-card:hover,
        .show-all-card:hover { 
            opacity: 1 !important; 
            background-color: transparent !important;
            transform: scale(1.1);
        }
        .show-all-card .card-img-wrapper {
            display: none !important;
        }
        .show-all-card .card-title,
        .show-all-card .card-desc {
            display: none !important;
        }
        .show-all-content { 
            display: flex !important; 
            align-items: center !important; 
            justify-content: center !important; 
            gap: 0 !important; 
            transition: all 0.3s ease;
            width: 100%;
            height: 100%;
        }
        .show-all-content i { 
            font-size: 32px !important; 
            transition: transform 0.3s ease;
            color: var(--primary-red) !important;
            display: block !important;
        }
        .show-all-card.open .show-all-content i { 
            transform: rotate(180deg); 
        }
        
        /* Slide animation */
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                overflow: hidden;
            }
            to {
                opacity: 1;
                max-height: 1000px;
                overflow: visible;
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 1;
                max-height: 1000px;
                overflow: visible;
            }
            to {
                opacity: 0;
                max-height: 0;
                overflow: hidden;
            }
        }
        
        .show-all-extra-items {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            animation: slideDown 0.4s ease-out forwards;
        }
        
        .show-all-extra-items.hide {
            animation: slideUp 0.4s ease-out forwards;
        }
        
        .card-img-wrapper { 
            position: relative; 
            width: 100%; 
            aspect-ratio: 1/1; 
            margin-bottom: 16px; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.5); 
            border-radius: 4px; 
            overflow: hidden; 
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }
        .song-card:hover .card-img-wrapper {
            box-shadow: 0 16px 40px rgba(229, 9, 20, 0.4),
                        0 8px 16px rgba(0, 0, 0, 0.8);
        }
        .card-img-wrapper img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            object-position: center; 
            transition: all 0.3s ease;
        }
        .song-card:hover .card-img-wrapper img {
            filter: brightness(1.1);
        }
        
        .play-btn-overlay { position: absolute; bottom: 8px; right: 8px; width: 48px; height: 48px; border-radius: 50%; background-color: var(--primary-red); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 8px 8px rgba(0,0,0,0.3); opacity: 0; transform: translateY(8px); transition: all 0.3s ease; z-index: 5;}
        .song-card:hover .play-btn-overlay { opacity: 1; transform: translateY(0); }
        .card-title { font-weight: 700; font-size: 16px; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-desc { font-size: 14px; color: var(--text-gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* Responsive card text in modal */
        @media (max-width: 768px) {
            #show-all-grid .card-title { font-size: 14px; margin-bottom: 6px; }
            #show-all-grid .card-desc { font-size: 12px; }
            #show-all-grid .play-btn-overlay { width: 40px; height: 40px; font-size: 20px; }
        }

        /* FIXED ALIGNMENT FOR SONG LIST */
        .song-list-header { 
            display: grid; 
            grid-template-columns: 50px 4fr 3fr 1fr 120px; 
            padding: 10px 16px 10px 16px; 
            border-bottom: 1px solid var(--border-color); 
            color: var(--text-gray); 
            text-transform: uppercase; 
            font-size: 12px; 
            letter-spacing: 1px; 
            align-items: center; 
        }
        .song-row { 
            display: grid; 
            grid-template-columns: 50px 4fr 3fr 1fr 120px; 
            padding: 10px 16px; 
            border-radius: 4px; 
            align-items: center; 
            color: var(--text-gray); 
            font-size: 14px; 
            cursor: pointer;
            position: relative;
            overflow: visible;
        }
        .song-row:hover { background-color: rgba(255,255,255,0.1); }
        .song-row.playing { color: var(--primary-red); }
        /* Stronger visual cue for playing rows (used in profile and lists) */
        .song-row.playing {
            box-shadow: inset 4px 0 0 var(--primary-red);
            background: linear-gradient(90deg, rgba(229,9,20,0.04), transparent 60%);
        }
        .song-info { display: flex; align-items: center; gap: 12px; min-width: 0; flex: 1; }
        .song-info img { width: 40px; height: 40px; border-radius: 4px; flex-shrink: 0; }
        .song-info > div { display: flex; flex-direction: column; min-width: 0; flex: 1; }
        .song-title-text {
            color: var(--text-white);
            font-size: 16px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .song-artist {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ANIMATED EQUALIZER (FIXED FOR PAUSE) */
        .playing-icon-container {
            display: none; /* Hidden by default */
            gap: 2px;
            height: 16px;
            align-items: center;
        }
        
        /* Ensure visible when playing */
        .song-row.playing .playing-icon-container {
            display: flex;
        }
        
        .bar {
            width: 3px;
            background-color: var(--primary-red);
            animation: bounce 0.5s infinite ease-in-out;
        }
        .bar:nth-child(1) { animation-delay: 0.1s; height: 5px; }
        .bar:nth-child(2) { animation-delay: 0.2s; height: 10px; }
        .bar:nth-child(3) { animation-delay: 0.3s; height: 8px; }
        .bar:nth-child(4) { animation-delay: 0.0s; height: 12px; }
        
        @keyframes bounce {
            0%, 100% { height: 3px; }
            50% { height: 16px; }
        }
        
        /* Marquee/Running Text Animation for Long Titles */
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        @keyframes marquee-reverse {
            0% { transform: translateX(100%); }
            100% { transform: translateX(0); }
        }
        
        .song-actions { display: flex; justify-content: flex-end; gap: 12px; position: relative; z-index: 100; }
        .song-actions-menu { position: relative; z-index: 101; }
        .more-btn { background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 20px; transition: color 0.2s; }
        .more-btn:hover { color: white; }
        
        .list-like-btn { background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 20px; transition: color 0.2s; }
        .list-like-btn:hover { color: white; }
        .list-like-btn.liked { color: var(--primary-red); }

        .share-btn { background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 20px; transition: color 0.2s; }
        .share-btn:hover { color: white; }
        
        .queue-add-btn { background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 20px; transition: color 0.2s; }
        .queue-add-btn:hover { color: white; }

        /* Song Actions Menu Dropdown */
        .song-menu-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            font-size: 20px;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s, background 0.2s;
            border-radius: 4px;
        }

        .song-menu-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .song-menu-dropdown {
            position: absolute;
            top: auto;
            bottom: 100%;
            right: -16px;
            background: linear-gradient(135deg, #1f1f1f 0%, #2a2a2a 50%, #1f1f1f 100%);
            border: 1px solid rgba(229, 9, 20, 0.2);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 200px;
            z-index: 2000;
            overflow: hidden;
            margin-bottom: 12px;
            display: none;
            backdrop-filter: blur(10px);
        }

        .song-menu-dropdown:hover {
            border-color: rgba(229, 9, 20, 0.4);
            box-shadow: 0 12px 40px rgba(229, 9, 20, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        @media (max-width: 768px) {
            .song-menu-dropdown {
                position: absolute !important;
                top: auto !important;
                bottom: 100% !important;
                right: -16px !important;
                left: auto !important;
                width: auto !important;
                max-width: 220px !important;
                height: auto !important;
                border-radius: 12px !important;
                margin: 0 0 12px 0 !important;
                z-index: 9999 !important;
                background: linear-gradient(135deg, #1f1f1f 0%, #2a2a2a 50%, #1f1f1f 100%);
                border: 1px solid rgba(229, 9, 20, 0.25);
                box-shadow: 0 12px 40px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255, 255, 255, 0.1);
                transform: none !important;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                display: none !important;
                opacity: 1 !important;
                padding: 0 !important;
                min-width: 200px !important;
                backdrop-filter: blur(10px);
            }
            .song-menu-dropdown.active-slide {
                display: block !important;
                opacity: 1 !important;
                animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(8px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        }

        .menu-item {
            width: 100%;
            padding: 14px 18px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 1px solid rgba(229, 9, 20, 0.08);
            position: relative;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(180deg, rgba(229, 9, 20, 0.8), rgba(229, 9, 20, 0));
            opacity: 0;
            transition: opacity 0.2s;
        }

        .menu-item:hover {
            background: rgba(229, 9, 20, 0.08);
            padding-left: 22px;
        }

        .menu-item:hover::before {
            opacity: 1;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .song-menu-dropdown {
            position: absolute;
            top: auto;
            bottom: 100%;
            right: -16px;
            background: #1f1f1f;
            border: 1px solid rgba(229, 9, 20, 0.15);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
            transition: all 0.2s ease;
            min-width: 200px;
            z-index: 2000;
            overflow: hidden;
            margin-bottom: 8px;
            display: none;
        }

        .dropdown-cover {
    display: none !important;
}

.dropdown-cover-img {
    display: none !important;
}

        @media (max-width: 1024px) {
            .dropdown-cover {
                display: block !important;
                width: 100% !important;
                height: 140px !important;
                overflow: hidden !important;
            }
            .dropdown-cover-img {
                width: 100% !important;
                height: 100% !important;
                object-fit: cover !important;
            }
            .song-menu-dropdown {
                position: absolute !important;
                top: auto !important;
                bottom: 100% !important;
                right: -16px !important;
                left: auto !important;
                width: auto !important;
                max-width: 200px !important;
                height: auto !important;
                border-radius: 8px !important;
                margin: 0 0 8px 0 !important;
                z-index: 9999 !important;
                background: #1f1f1f;
                border: 1px solid rgba(229, 9, 20, 0.15);
                box-shadow: 0 8px 24px rgba(0,0,0,0.6);
                transform: none !important;
                transition: all 0.2s ease;
                display: none !important;
                opacity: 1 !important;
                padding: 0 !important;
                min-width: 180px !important;
            }
            .song-menu-dropdown.active-slide {
                display: block !important;
                opacity: 1 !important;
            }
            .dropdown-cover {
                display: block !important;
            }
        }

        .menu-item {
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(229, 9, 20, 0.08);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: rgba(229, 9, 20, 0.1);
        }

        .menu-emoji {
            display: inline-block;
            font-size: 18px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .menu-item i {
            font-size: 20px;
            flex-shrink: 0;
            color: var(--text-gray);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
            transition: color 0.2s ease;
        }

        .menu-item:hover i {
            color: var(--primary-red);
        }

        .menu-item span {
            flex: 1;
        }

            .icon-fallback {
                display: inline-block;
                min-width: 20px;
                min-height: 20px;
                text-align: center;
                font-size: 18px;
                line-height: 1.2;
                vertical-align: middle;
                color: var(--text-gray);
            }

        @media (max-width: 768px) {
            .song-menu-dropdown {
                min-width: 180px;
                left: 50%;
                right: auto;
                transform: translateX(-60%);
                bottom: 110%;
                margin-bottom: 12px;
            }

            .menu-emoji {
                font-size: 20px;
                width: 26px;
                height: 26px;
            }

            .menu-item {
                padding: 12px 14px;
                font-size: 14px;
                gap: 12px;
                min-height: 44px;
            }

            .menu-item i {
                font-size: 22px;
                width: 26px;
                height: 26px;
            }

            .menu-item span {
                flex: 1;
            }
        }

        .menu-item span {
            flex: 1;
        }

        /* Search */
        .search-container { max-width: 500px; margin: 0 auto 40px auto; position: relative; }
        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border-radius: 50px;
            border: none;
            background-color: #fff;
            color: #000;
            font-size: 16px;
            outline: none;
        }
        .search-icon-placeholder { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #121212; font-size: 20px; }
        
        /* --- OVERLAY PLAYER --- */
        #overlay-player {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000;
            z-index: 30000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            overflow: hidden;
            pointer-events: none; /* Tidak mengganggu saat tidak aktif */
        }
        #overlay-player.active { 
            opacity: 1; 
            visibility: visible;
            pointer-events: auto; /* Aktifkan interaksi saat overlay dibuka */
        }

        .overlay-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            filter: blur(60px) brightness(0.4) saturate(1.2);
            z-index: -1;
            transform: scale(1.3);
        }

        .overlay-content {
            width: 100%;
            height: 100%;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            text-align: left;
            position: relative;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(30px);
        }

        /* --- ART OVERLAY --- */
        #art-overlay-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 31000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0; visibility: hidden;
            transition: all 0.25s ease;
            overflow: hidden;
            background-color: #000000;
            pointer-events: none; /* Tidak mengganggu saat tidak aktif */
        }
        #art-overlay-container.active { 
            opacity: 1; 
            visibility: visible;
            pointer-events: auto; /* Aktifkan interaksi saat overlay dibuka */
        }

        .art-overlay-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(60px) brightness(0.4) saturate(1.2);
            z-index: -1;
            transform: scale(1.25);
        }

        /* Lyrics styling untuk overlay */
        .art-lyrics-wrapper .lyrics-line {
            font-size: 18px;
            font-weight: 400;
            color: rgba(255,255,255,0.85);
            transition: all 0.3s ease;
        }

        .art-lyrics-wrapper .lyrics-line.current-line {
            font-size: 24px;
            font-weight: 700;
            color: white;
            text-shadow: 0 0 30px rgba(255,255,255,0.6), 0 0 60px rgba(255,255,255,0.3);
        }

        /* Desktop art sizing */
        .art-main img {
            width: 52vw;
            max-width: 400px; /* target ~400px */
            height: auto;
            border-radius: 12px;
            box-shadow: 0 24px 64px rgba(0,0,0,0.5);
        }

        .art-overlay-content {
            width: 100%;
            max-width: 1100px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: stretch;
        }

        /* --- ART PLAYER BAR (Full-width bottom) --- */
        .art-player-bar {
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            padding: 12px 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(8px);
            z-index: 31010;
            box-shadow: 0 -8px 24px rgba(0,0,0,0.35);
        }
        .art-player-left { display:flex; align-items:center; min-width:180px; max-width:320px; color:#fff; }
        .art-player-left img { width:44px; height:44px; border-radius:6px; object-fit:cover; margin-right:12px; }
        .art-player-info .art-player-title { font-size:14px; font-weight:700; }
        .art-player-info .art-player-artist { font-size:12px; color: rgba(255,255,255,0.7); }
        .art-player-center { flex:1; display:flex; flex-direction:column; align-items:center; gap:8px; }
        .art-player-progress .overlay-progress-bar { width:100%; height:6px; }
        .art-player-right { display:flex; align-items:center; gap:8px; min-width:120px; justify-content:flex-end; }

        @media (max-width: 768px) {
            .art-player-left { min-width: 120px; }
            .art-player-left img { width:36px; height:36px; }
            .art-player-info .art-player-title { font-size:13px; }
            .art-player-progress .overlay-progress-bar { height:5px; }
            .art-player-bar { padding:10px 12px; }
        }

        .art-close-btn {
            position: absolute;
            top: 20px; right: 20px;
            background: rgba(255,255,255,0.06);
            border-radius: 50%;
            width: 44px; height: 44px;
            display:flex; align-items:center; justify-content:center;
            color: #fff; border: none;
        }

        /* Toggle control */
        .art-toggle-btn {
            background: rgba(255,255,255,0.04);
            color: rgba(255,255,255,0.9);
            border: 1px solid rgba(255,255,255,0.06);
            padding: 6px 10px; border-radius: 999px; cursor: pointer; font-weight:600;
            transition: all 0.18s ease;
        }
        .art-toggle-btn.active {
            background: rgba(255,255,255,0.12);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.35);
        }

        .art-lyrics-wrapper { opacity: 0; transform: translateY(8px); transition: all 0.24s ease; }
        .art-lyrics-wrapper.active { opacity: 1; transform: translateY(0); }
        .art-main { opacity: 1; transform: translateY(0); transition: all 0.24s ease; }
        .art-main.hidden { opacity: 0; transform: translateY(8px); pointer-events: none; }

        @media (max-width: 1024px) {
            .art-main img { width: 92vw !important; height: auto !important; max-width: 360px; border-radius: 12px; }
            .art-playlist-name { font-size: 12px !important; }
            .art-close-btn { top: 12px; right: 12px; width: 40px; height: 40px; }
        }

        /* === DESKTOP OVERLAY (1025px+) === */
        @media (min-width: 1025px) {
            .overlay-content {
                flex-direction: row;
                justify-content: flex-start;
                align-items: center;
                gap: 60px;
                padding: 60px 80px;
                height: 100%;
            }

            .overlay-desktop-album {
                display: flex !important;
                flex-direction: column;
                align-items: center;
                gap: 0;
                flex: 0 0 280px;
                width: 280px;
                justify-content: center;
                height: 100%;
            }

            .overlay-header-container {
                display: none !important;
            }

            .overlay-art-wrapper {
                width: 280px !important;
                height: 280px !important;
                border-radius: 20px !important;
                box-shadow: 0 24px 60px rgba(0,0,0,0.6) !important;
                margin-bottom: 24px !important;
                overflow: hidden !important;
            }

            /* Album title and artist */
            .overlay-desktop-album > div:nth-child(2) {
                text-align: center;
                width: 100%;
                margin-bottom: 32px;
            }

            .overlay-desktop-album h2 {
                font-size: 18px !important;
                font-weight: 700 !important;
                color: white !important;
                margin: 0 0 8px 0 !important;
                line-height: 1.2;
            }

            .overlay-desktop-album p {
                font-size: 14px !important;
                color: rgba(255,255,255,0.7) !important;
                margin: 0 !important;
            }

            /* Progress bar */
            #overlay-progress-container {
                width: 100%;
                margin-bottom: 20px !important;
                display: block !important;
                visibility: visible !important;
                height: auto !important;
                overflow: visible !important;
                opacity: 1 !important;
            }
            
            /* Hide progress bar in profile view - AGGRESSIVE HIDE */
            #view-profile.active #overlay-progress-container {
                display: none !important;
                visibility: hidden !important;
                height: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow: hidden !important;
                opacity: 0 !important;
                pointer-events: none !important;
            }

            .overlay-progress-bar {
                background: rgba(255,255,255,0.2);
                height: 4px;
                border-radius: 2px;
                overflow: hidden;
                cursor: pointer;
            }

            .overlay-progress-bar:hover {
                height: 6px;
                transition: height 0.2s ease;
            }

            .overlay-progress-fill {
                background: white;
                height: 100%;
                border-radius: 2px;
                transition: width 0.1s linear;
            }

            .overlay-time {
                display: flex !important;
                justify-content: space-between !important;
                font-size: 12px !important;
                color: rgba(255,255,255,0.6) !important;
                margin-top: 8px !important;
            }

            /* Controls */
            .overlay-controls {
                width: 100%;
                display: flex;
                justify-content: center;
                gap: 16px;
                align-items: center;
            }

            .overlay-controls button {
                background: none;
                border: none;
                color: white;
                font-size: 20px;
                cursor: pointer;
                padding: 6px;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0.7;
            }

            .overlay-controls button:hover {
                opacity: 1;
                transform: scale(1.1);
            }

            .overlay-play-btn {
                background: white !important;
                color: black !important;
                border-radius: 50%;
                width: 56px !important;
                height: 56px !important;
                font-size: 28px !important;
                opacity: 1 !important;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 16px rgba(0,0,0,0.2);
                margin: 0 8px;
            }

            .overlay-play-btn:hover {
                background: rgba(255,255,255,0.9) !important;
                transform: scale(1.05);
            }

            /* Lyrics section on right side */
            .overlay-lyrics-section {
                flex: 1;
                display: flex !important;
                flex-direction: column;
                min-width: 0;
                justify-content: center;
                align-items: center;
                height: 100%;
                overflow: visible !important;
                position: relative;
            }

            #overlay-lyrics-container {
                flex: 1;
                display: flex !important;
                align-items: center;
                justify-content: center;
                min-height: 400px;
                max-height: 70vh;
                width: 100%;
                position: relative;
                max-width: 1000px;
                overflow: hidden !important;
            }
            
            /* Fade gradient top */
            #overlay-lyrics-container::before {
                display: none;
            }
            
            /* Fade gradient bottom */
            #overlay-lyrics-container::after {
                display: none;
            }
            
            .lyrics-text {
                position: relative;
                z-index: 1;
            }

            /* Lyrics display - show only 4-5 lines */
            .lyrics-text {
                text-align: center;
                font-size: 48px !important;
                font-weight: 600 !important;
                line-height: 1.4 !important;
                color: rgba(255,255,255,0.4) !important;
                min-height: 300px;
                max-height: 70vh;
                overflow-y: auto !important;
                overflow-x: hidden !important;
                position: relative;
                scroll-behavior: smooth;
                padding: 120px 100px;
                margin: 0;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif !important;
                letter-spacing: -0.5px;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                width: 100%;
            }
            
            /* Hide scrollbar but keep functionality */
            .lyrics-text::-webkit-scrollbar {
                width: 0px;
                background: transparent;
                display: none;
            }
            
            .lyrics-text {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            /* Lyrics line styling */
            #overlay-lyrics-container .lyrics-line {
                padding: 12px 0;
                margin: 0;
                cursor: pointer;
                transition: all 0.3s ease;
                color: rgba(255,255,255,0.4) !important;
                font-weight: 400;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            #overlay-lyrics-container .lyrics-line:hover {
                color: rgba(255,255,255,0.6) !important;
            }

            /* Active/current lyric line styling with glow */
            #overlay-lyrics-container .lyrics-line.current-line,
            .lyrics-text .current-line {
                color: #ffffff !important;
                font-weight: 700 !important;
                font-size: 48px !important;
                text-shadow: 
                    0 0 20px rgba(255,255,255,0.8),
                    0 0 40px rgba(255,255,255,0.6),
                    0 0 60px rgba(255,255,255,0.4),
                    0 0 80px rgba(229,9,20,0.3);
                transition: all 0.3s ease;
                transform: scale(1.05);
            }
            
            /* Word-by-word highlighting */
            #overlay-lyrics-container .lyrics-word {
                display: inline;
                margin-right: 0.25em;
                transition: all 0.2s ease;
            }
            
            #overlay-lyrics-container .lyrics-word.active {
                color: #ffffff !important;
                font-weight: 700 !important;
                text-shadow: 
                    0 0 15px rgba(229,9,20,0.8),
                    0 0 30px rgba(229,9,20,0.5);
            }
        }

        /* === MOBILE OVERLAY (1024px) === */
        @media (max-width: 1024px) {
            .overlay-content {
                flex-direction: column;
                justify-content: flex-start;
                align-items: stretch;
                padding: 0;
                gap: 0;
            }

            .overlay-desktop-album {
                display: none !important;
            }

            .overlay-header-container {
                display: flex !important;
                justify-content: space-between;
                align-items: center;
                padding: 12px 16px;
                background: rgba(0,0,0,0.5);
                backdrop-filter: blur(20px);
                border-bottom: 1px solid rgba(255,255,255,0.1);
                order: -1;
            }

            .overlay-lyrics-section {
                flex: 1;
                display: flex;
                flex-direction: column;
                width: 100%;
                padding: 16px 0;
            }

            #overlay-lyrics-container {
                padding: 0 16px !important;
                margin-bottom: 16px;
                font-size: 15px !important;
                line-height: 1.8 !important;
            }

            #overlay-progress-container {
                padding: 0 16px;
            }

            .overlay-controls {
                padding: 0 16px;

            }

            .lyrics-text {
                text-align: center;
                font-size: 18px !important;
                font-weight: 400 !important;
                line-height: 1.6 !important;
                color: rgba(255,255,255,0.85) !important;
                min-height: 200px !important;
                max-height: 50vh !important;
                overflow-y: auto !important;
                padding: 20px 16px !important;
                display: block !important;
            }
            
            .lyrics-line {
                padding: 10px 0 !important;
                color: rgba(255,255,255,0.6) !important;
                transition: all 0.3s ease !important;
            }
            
            .lyrics-line.active,
            .lyrics-line.current-line {
                color: #ffffff !important;
                font-weight: 700 !important;
                font-size: 20px !important;
                text-shadow: 0 0 8px rgba(255,255,255,0.4) !important;
            }
        }

        .overlay-close-btn {
            position: relative;
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            padding: 8px;
            transition: all 0.2s ease;
        }

        .overlay-close-btn:hover {
            opacity: 0.8;
        }

        /* Overlay section for lyrics and controls */
        .overlay-lyrics-section {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 0;
            padding: 0 16px;
        }

        /* Desktop album section */
        .overlay-desktop-album {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            flex: 0 0 auto;
            width: 320px;
        }

        @media (min-width: 1025px) {
            .overlay-desktop-album {
                display: flex;
            }

            .overlay-header-container {
                display: none !important;
            }

            .overlay-close-btn[onclick*="toggleLyricsView"] {
                display: none !important;
            }

            .overlay-close-btn:nth-of-type(1) {
                display: none !important;
            }
        }

        @media (max-width: 1024px) {
            .overlay-desktop-album {
                display: none !important;
            }

            .overlay-header-container {
                display: flex !important;
            }
        }

        /* Lyrics page sections */
        .lyrics-desktop-section {
            display: none;
            flex: 0 0 50%;
            padding: 60px 40px;
            align-items: center;
            justify-content: center;
        }

        .lyrics-mobile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 16px;
            gap: 0;
            flex-shrink: 0;
        }

        @media (min-width: 1025px) {
            .lyrics-desktop-section {
                display: flex !important;
            }

            .lyrics-mobile-section {
                display: none !important;
            }

            .lyrics-header {
                display: none !important;
            }
        }

        @media (max-width: 1024px) {
            .lyrics-desktop-section {
                display: none !important;
            }

            .lyrics-mobile-section {
                display: flex !important;
            }

            .lyrics-header {
                display: flex !important;
            }
        }

        .overlay-content {
            width: 100%;
            height: 100%;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            text-align: left;
            position: relative;
            background: rgba(0,0,0,0.3);
        }

        .overlay-close-btn {
            position: absolute;
            top: 20px; left: 20px;
            background: none; border: none; color: white;
            font-size: 32px; cursor: pointer;
            z-index: 10;
        }

        .overlay-art-wrapper {
            width: 280px; height: 280px;
            flex-shrink: 0;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        .overlay-art-wrapper img { width: 100%; height: 100%; object-fit: cover; }

        .overlay-info {
            width: 100%;
            max-width: 500px;
            padding: 0 20px;
            overflow: hidden;
        }
        
        .overlay-info h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
            max-width: 100%;
        }
        
        .overlay-info h2.marquee {
            animation: marquee 20s linear infinite;
            width: max-content;
            text-overflow: clip;
            padding-left: 100%;
        }
        
        .overlay-info p {
            font-size: 18px;
            color: #b3b3b3;
            margin-bottom: 40px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
            max-width: 100%;
        }
        
        .overlay-info p.marquee {
            animation: marquee 25s linear infinite;
            width: max-content;
            text-overflow: clip;
            padding-left: 100%;
        }

        .overlay-controls {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }
            .overlay-controls button {
                background: none; border: none; color: white;
                font-size: 32px; cursor: pointer; transition: 0.2s;
            }

            .mobile-bottom-nav .mb-nav-item span { font-size: 11px; }
        .overlay-controls button.active { color: var(--primary-red); }
        .overlay-controls button:hover { transform: scale(1.1); color: var(--primary-red); }
        /* Hide overlay shuffle/repeat icons (remove these controls from overlay player) */
        #overlay-shuffle-icon, #overlay-repeat-icon { display: none !important; }
        .overlay-play-btn {
            width: 80px; height: 80px;
            background-color: white !important;
            color: black !important;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 36px !important;
        }
        .overlay-play-btn:hover { transform: scale(1.05) !important; background-color: #ddd !important; }

        .overlay-progress-container { width: 100%; margin-bottom: 20px; cursor: pointer; }
        .overlay-progress-bar { width: 100%; height: 4px; background: #555; border-radius: 2px; position: relative; }
        .overlay-progress-fill { height: 100%; background: white; border-radius: 2px; width: 0%; position: absolute; top: 0; left: 0; }
        .overlay-time { display: flex; justify-content: space-between; width: 100%; margin-top: 10px; font-size: 12px; color: #b3b3b3; }

        /* Mobile bottom navigation (hidden by default) */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            left: 12px;
            right: 12px;
            bottom: calc(var(--player-height, 72px) + 18px);
            height: 56px;
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25));
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            z-index: 20010;
            align-items: center;
            justify-content: space-around;
            gap: 6px;
            padding: 6px 10px;
            backdrop-filter: blur(6px);
        }

        .mobile-bottom-nav .mb-nav-item {
            color: var(--text-gray);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            gap: 4px;
            width: 72px;
        }

        .mobile-bottom-nav .mb-nav-item i { font-size: 20px; }
        .mobile-bottom-nav .mb-nav-item.active { color: var(--primary-red); }

        /* Search Results & History Areas */
        #search-results-wrapper {
            display: none; /* Hidden by default, shown on search */
            margin-bottom: 40px;
        }
        .results-section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            color: white;
        }
        
        #search-history-wrapper {
            display: block; /* Visible by default */
        }
        .history-section-title { 
            font-size: 16px; 
            font-weight: 700; 
            margin-bottom: 16px; 
            display: block; 
        }

        /* Playlist/Album View */
        .playlist-header-view { 
            display: flex; 
            flex-direction: column;
            align-items: flex-start; 
            gap: 24px; 
            padding: 60px 32px 32px 32px; 
            background: linear-gradient(180deg, #530000 0%, var(--bg-dark) 100%); 
            border-radius: 0;
            transition: background 0.5s ease;
            position: relative;
        }
        .playlist-cover-wrap {
            position: relative;
            width: fit-content;
            margin-bottom: 0;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .playlist-cover-big { 
            width: 232px; height: 232px; 
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5); 
            object-fit: cover; 
            flex-shrink: 0;
            display: block;
        }
        .edit-cover-btn {
            position: absolute;
            bottom: 8px; right: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: 0.2s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .playlist-cover-wrap:hover .edit-cover-btn { opacity: 1; }
        
        /* Play button di paling bawah dalam normal flow */
        .playlist-cover-wrap .action-play-btn {
            position: static;
            transform: none;
            align-self: flex-start;
            margin-top: 12px;
        }

        .playlist-info-big h1 { font-size: 3.5rem; font-weight: 900; line-height: 1.1; margin: 10px 0; letter-spacing: -1px; color: var(--text-white); }
        .playlist-info-big span { font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-gray); }
        .playlist-meta { display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text-gray); margin-top: 8px; }
        
        /* Button Container - Rapi dan sejajar */
        .playlist-buttons-container { display: flex; align-items: center; gap: 16px; margin-top: 20px; }
        
        .playlist-actions { display: flex; align-items: center; gap: 16px; padding: 20px 32px 24px 32px; border-top: 1px solid var(--border-color); }
        .action-play-btn { width: 56px; height: 56px; border-radius: 50%; background-color: var(--primary-red); color: white; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; box-shadow: 0 8px 16px rgba(229,9,20,0.3); border: none; }
        .action-play-btn:hover { transform: scale(1.08); background-color: var(--primary-red-hover); }
        .share-btn-album { width: 56px; height: 56px; border-radius: 50%; background-color: rgba(255,255,255,0.1); color: var(--text-gray); font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; border: 2px solid rgba(255,255,255,0.2); }
        .share-btn-album:hover { transform: scale(1.08); background-color: rgba(255,255,255,0.15); color: white; border-color: rgba(255,255,255,0.85); }

        /* --- PLAYER BAR --- */
        .player-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: var(--player-height);
            background-color: var(--bg-card);
            border-top: 1px solid #282828;
            padding: 0 16px;
            display: none; /* Hidden by default */
            justify-content: space-between;
            align-items: center;
            z-index: 20000;
        }
        
        /* Show player-bar when active */
        .player-bar.active {
            display: flex;
        }

        /* On larger screens keep player-bar to the right of the sidebar */
        @media (min-width: 769px) {
            .player-bar {
                left: var(--sidebar-width);
                width: calc(100% - var(--sidebar-width));
            }
        }

        /* Make import button align perfectly under create playlist */
        @media (min-width: 769px) {
            .create-playlist-btn, .import-music-btn {
                padding: 10px 14px;
                border-radius: 6px;
                margin-left: 6px;
                margin-right: 6px;
            }
            .import-music-btn { margin-top: 8px; }
        }
        
        .player-left { 
            display: flex; 
            align-items: center; 
            width: 30%; 
            gap: 14px; 
            overflow: hidden; /* Ensure text doesn't spill out */
        }
        .current-art { width: 56px; height: 56px; border-radius: 4px; background-color: #333; object-fit: cover; flex-shrink: 0; }
        .current-info { display: flex; flex-direction: column; justify-content: center; overflow: hidden; flex: 1; }
        .current-title { font-size: 14px; color: var(--text-white); font-weight: 600; cursor: pointer; white-space: nowrap; }
        .current-title:hover { text-decoration: underline; }
        .current-artist { font-size: 12px; color: var(--text-gray); cursor: pointer; white-space: nowrap; }
        .current-artist:hover { text-decoration: underline; color: var(--text-white); }

        /* === ARTIST PROFILE OVERLAY === */
        .artist-profile-overlay-container {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            width: calc(100% - var(--sidebar-width));
            height: 100%;
            background: var(--bg-dark);
            z-index: 10000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }

        .artist-profile-overlay-container.active {
            display: flex;
        }

        @media (max-width: 768px) {
            .artist-profile-overlay-container {
                left: 0;
                width: 100%;
            }
        }

        .artist-profile-header-top {
            padding: 24px 32px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(180deg, rgba(83, 0, 0, 0.3) 0%, transparent 100%);
            position: sticky;
            top: 0;
            z-index: 10001;
        }

        .artist-profile-back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            border-radius: 50%;
        }

        .artist-profile-back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--primary-red);
        }

        .artist-profile-content {
            padding: 32px;
            flex: 1;
        }

        .artist-profile-section-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Marquee Styles */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
        }
        .marquee-content {
            display: inline-block;
            white-space: nowrap;
            animation: marquee-scroll 15s linear infinite;
        }
        .marquee-content span {
            display: inline-block;
            padding-right: 50px;
        }
        @keyframes marquee-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .like-btn { 
            color: var(--text-gray); 
            background: none; 
            border: none; 
            cursor: pointer; 
            margin-left: 16px; 
            font-size: 20px; 
            transition: all 0.2s ease;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            outline: none;
            width: 24px;
            height: 24px;
        }
        
        .like-btn:hover { color: var(--text-white); transform: scale(1.1); }
        .like-btn.liked { color: var(--primary-red) !important; }
        .like-btn.liked:hover { color: #ff4d5a !important; }
        
        .player-center { display: flex; flex-direction: column; align-items: center; width: 40%; gap: 8px; }
        .player-controls { display: flex; align-items: center; gap: 20px; }
        .control-btn { background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 20px; transition: color 0.2s; display: flex; align-items: center; justify-content: center; }
        .control-btn:hover { color: var(--text-white); }
        .control-btn.active { color: var(--primary-red); }
        .play-pause-btn { width: 32px; height: 32px; background-color: var(--text-white); border-radius: 50%; color: black; font-size: 20px; transition: transform 0.2s; }
        .play-pause-btn:hover { transform: scale(1.1); color: black; }
        .playback-bar { width: 100%; display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--text-gray); }
        
        .progress-container { 
            flex: 1; 
            height: 4px; 
            background-color: #555; 
            border-radius: 2px; 
            position: relative; 
            cursor: pointer;
            transition: height 0.2s ease;
        }
        
        .progress-container:hover,
        .progress-container.dragging {
            height: 6px;
        }
        
        .progress-fill { 
            height: 100%; 
            background-color: var(--text-white); 
            border-radius: 2px; 
            width: 0%;
            transition: width 0.1s linear, background-color 0.2s ease;
            pointer-events: none;
        }
        
        .progress-container:hover .progress-fill,
        .progress-container.dragging .progress-fill { 
            background-color: var(--primary-red);
        }
        
        .progress-container.dragging .progress-fill {
            transition: none;
        }
        
        .progress-thumb {
            position: absolute;
            top: 50%;
            left: 0%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        
        .progress-container:hover .progress-thumb,
        .progress-container.dragging .progress-thumb {
            opacity: 1;
        }

        /* Fixed Progress Bar Wrapper (di atas playbar) */
        .player-progress-bar-wrapper {
            position: fixed;
            bottom: var(--player-height);
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255,255,255,0.15);
            cursor: pointer;
            z-index: 19999;
            transition: height 0.2s ease;
            display: none; /* Hidden by default */
        }
        
        
        /* Show progress bar when it has active class */
        .player-progress-bar-wrapper.active {
            display: block;
        }
        
        /*  HIDE progress bar when profile view is active */
        #view-profile.active ~ .player-progress-bar-wrapper,
        body.profile-view-active .player-progress-bar-wrapper {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            pointer-events: none !important;
        }

        /* Saat hover atau dragging, buat lebih visible */
        .player-progress-bar-wrapper:hover,
        .player-progress-bar-wrapper.dragging {
            height: 6px;
            background: rgba(255,255,255,0.25);
        }

        /* On larger screens align with player-bar */
        @media (min-width: 769px) {
            .player-progress-bar-wrapper {
                left: var(--sidebar-width);
                width: calc(100% - var(--sidebar-width));
            }
        }

        /* On mobile, ensure it spans full width and positions correctly */
        @media (max-width: 768px) {
            .player-progress-bar-wrapper {
                left: 0;
                right: 0;
                width: 100%;
                bottom: calc(var(--player-height) + var(--mobile-nav-height));
            }
        }

        .player-progress-fill {
            height: 100%;
            background: var(--primary-red);
            width: 0%;
            transition: width 0.1s linear;
            box-shadow: 0 0 0 rgba(229, 9, 20, 0.3);
        }

        .player-progress-bar-wrapper:hover .player-progress-fill,
        .player-progress-bar-wrapper.dragging .player-progress-fill {
            box-shadow: 0 0 8px rgba(229, 9, 20, 0.8);
        }

        /* Progress Time Tooltip */
        .progress-time-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.98);
            color: var(--primary-red);
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
            pointer-events: none;
            z-index: 20002;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary-red);
        }

        /* Fixed Progress Bar Wrapper (di bawah playbar) */
        .fixed-progress-wrapper {
            position: fixed;
            left: 0;
            right: 0;
            bottom: calc(var(--player-height) + var(--mobile-nav-height));
            height: 6px;
            background: transparent;
            z-index: 20001;
            display: flex;
            align-items: center;
            padding: 0;
        }

        .fixed-progress-wrapper .progress-container {
            width: 100%;
            height: 4px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 0;
            cursor: pointer;
            transition: height 0.2s ease;
        }

        .fixed-progress-wrapper .progress-container:hover {
            height: 6px;
        }

        .fixed-progress-wrapper .progress-fill {
            height: 100%;
            background-color: var(--primary-red);
            border-radius: 0;
            width: 0%;
            transition: width 0.1s linear;
        }
        .fixed-progress-wrapper .progress-fill {
            height: 100%;
            background-color: var(--primary-red);
            border-radius: 0;
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
        }

        /* Thumb indicator untuk progress bar */
        .fixed-progress-wrapper .progress-fill::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .fixed-progress-wrapper .progress-container:hover .progress-fill::after {
            opacity: 1;
        }

        /* Desktop: Progress bar tidak tembus sidebar */
        @media (min-width: 769px) {
            .fixed-progress-wrapper {
                left: var(--sidebar-width);
            }
        }

        .player-right { width: 30%; display: flex; justify-content: flex-end; align-items: center; gap: 12px; }
        .player-right { width: 30%; display: flex; justify-content: flex-end; align-items: center; gap: 12px; }
        .volume-bar-container { 
            width: 100px; 
            height: 4px; 
            background-color: #555; 
            border-radius: 2px; 
            cursor: pointer;
            transition: height 0.2s ease;
        }
        .volume-bar-container:hover {
            height: 6px;
        }
        .volume-fill { 
            width: 70%; 
            height: 100%; 
            background-color: var(--text-white); 
            border-radius: 2px;
            transition: width 0.1s ease;
        }
        .volume-bar-container:hover .volume-fill {
            background-color: var(--primary-red);
        }

        /* --- QUEUE OVERLAY (NEW) --- */
        #queue-overlay {
            position: fixed;
            top: 0; right: 0; bottom: 90px; /* Above player bar */
            width: 400px;
            background-color: var(--bg-black);
            z-index: 2900;
            display: none;
            flex-direction: column;
            border-left: 1px solid #333;
            box-shadow: -5px 0 20px rgba(0,0,0,0.8);
            animation: slideInRight 0.3s ease;
        }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }

        #queue-overlay.open { display: flex; }

        .queue-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .queue-title { font-weight: 700; font-size: 16px; }
        .queue-close-btn { background: none; border: none; color: #fff; cursor: pointer; font-size: 24px; }

        .queue-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .queue-item {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            gap: 12px;
            border-radius: 4px;
            cursor: grab;
            background: transparent;
        }
        .queue-item:active { cursor: grabbing; }
        .queue-item:hover { background-color: rgba(255,255,255,0.1); }
        .queue-item.dragging { opacity: 0.5; background: #333; }
        
        .queue-img { width: 40px; height: 40px; border-radius: 4px; object-fit: cover; }
        .queue-info { flex: 1; overflow: hidden; }
        .queue-title { font-size: 14px; font-weight: 600; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .queue-artist { font-size: 12px; color: #aaa; }
        .queue-remove { background: none; border: none; color: #aaa; cursor: pointer; font-size: 18px; padding: 5px; }
        .queue-remove:hover { color: var(--primary-red); }

        /* --- NEW PROFILE VIEW (SPOTIFY STYLE) --- */
        #view-profile {
            padding: 0; 
        }
        
        .profile-hero-section {
            display: flex;
            align-items: flex-end;
            gap: 24px;
            padding: 20px 32px;
            background: linear-gradient(180deg, #222 0%, var(--bg-dark) 100%);
            min-height: 300px;
            transition: background 0.5s ease;
        }

        .profile-avatar-lg {
            width: 230px;
            height: 230px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 60px rgba(0,0,0,0.5);
            border: 4px solid rgba(0,0,0,0.3);
        }

        .profile-hero-content {
            flex: 1;
            margin-bottom: 10px;
        }

        .profile-type-label {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .profile-name-large {
            font-size: 6rem; 
            font-weight: 900;
            line-height: 1;
            margin: 10px 0;
            letter-spacing: -2px;
            word-wrap: break-word;
        }

        .profile-bio-display {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            margin-top: 8px;
            max-width: 600px;
            line-height: 1.4;
        }

        /* User ID Display */
        .profile-userid-display {
            margin-top: 12px;
            background: rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: monospace;
            font-size: 16px;
            color: #fff;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .profile-userid-display:hover { background: rgba(255,255,255,0.2); }
        .copy-id-icon { font-size: 18px; color: var(--primary-red); }

        .profile-actions {
            padding: 24px 32px;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .btn-circle-blue {
            width: 48px; height: 48px; border-radius: 50%; background-color: #1db954; color: white; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s;
        }
        .btn-circle-blue:hover { transform: scale(1.05); background-color: #1ed760; }

        .btn-pill {
            padding: 8px 24px;
            border-radius: 20px;
            border: 1px solid #777;
            color: white;
            background: transparent;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.2s;
        }
        .btn-pill:hover { border-color: white; transform: scale(1.04); }

        /* Edit Panel (Slide Down) */
        .profile-edit-panel {
            background-color: #282828;
            margin: 0 32px 32px 32px;
            padding: 24px;
            border-radius: 8px;
            display: none;
            animation: slideDown 0.3s ease;
        }
        .profile-edit-panel.active { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .edit-grid {
            display: flex;
            gap: 24px;
            align-items: flex-start;
        }
        .edit-avatar-wrapper {
            width: 150px; height: 150px;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            background: #000;
        }
        .edit-avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .edit-avatar-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 50px;
            background: rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; transition: 0.2s;
        }
        .edit-avatar-wrapper:hover .edit-avatar-overlay { opacity: 1; }
        
        .edit-form { flex: 1; display: flex; flex-direction: column; gap: 16px; }
        .edit-input {
            width: 100%; padding: 12px; border-radius: 4px; border: none;
            background: #3e3e3e; color: white; font-family: 'Inter', sans-serif;
        }
        .edit-input:focus { outline: 2px solid #555; }
        
        .edit-actions-row { display: flex; justify-content: flex-end; gap: 12px; margin-top: 10px; }
        .btn-cancel { background: transparent; color: white; border: none; padding: 10px 24px; cursor: pointer; font-weight: 700; }
        .btn-save { background: var(--primary-red); color: white; border: none; padding: 10px 24px; border-radius: 20px; cursor: pointer; font-weight: 700; }
        .btn-save:hover { background: var(--primary-red-hover); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 30000; /* above player-bar */
            display: none;
            justify-content: center;
            align-items: center;
            pointer-events: none; /* Tidak mengganggu saat tidak aktif */
        }
        .modal-overlay.open { 
            display: flex;
            pointer-events: auto; /* Aktifkan interaksi saat modal dibuka */
        }
        .modal-content {
            background-color: #282828;
            width: 90%;
            max-width: 450px; 
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
            position: relative;
            max-height: calc(100vh - 160px); /* avoid being hidden behind UI */
            overflow-y: auto;
        }
        
        /* Show All Modal Specific - Mobile Responsive */
        #show-all-modal .modal-content {
            width: 95%;
            max-width: 95%;
            padding: 16px;
            max-height: 90vh;
        }
        
        #show-all-modal .modal-header {
            padding: 8px 0;
        }
        
        #show-all-modal .modal-title {
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            #show-all-modal .modal-content {
                width: 95%;
                max-width: 100%;
                padding: 12px;
                border-radius: 8px;
            }
            
            #show-all-modal .modal-header {
                margin-bottom: 12px;
                padding: 4px 0;
            }
            
            #show-all-modal .modal-title {
                font-size: 16px;
            }
        }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 20px; font-weight: 700; }
        .close-modal-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .modal-input {
            width: 100%; padding: 12px;
            margin-bottom: 15px;
            border-radius: 6px; border: 1px solid #444;
            background: #121212; color: white;
            outline: none;
        }
        .modal-input:focus { border-color: var(--primary-red); }
        .modal-btn { width: 100%; padding: 12px; background: var(--primary-red); color: white; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; }
        .modal-btn:hover { background: var(--primary-red-hover); }
        .playlist-select-list { max-height: 200px; overflow-y: auto; margin-bottom: 15px; }
        .playlist-select-item { padding: 10px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-radius: 6px; }
        .playlist-select-item:hover { background: #333; }

        .section-title-profile { font-size: 24px; font-weight: 700; margin: 32px 32px 20px 32px; }
        .playlist-modal-grid-profile { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 24px;
            padding: 0 32px 60px 32px;
        }

        /* --- CHAT SYSTEM OVERLAY --- */
        #chat-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-black);
            z-index: 100001; /* sit above all other app elements */
            display: none; /* Hidden by default */
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        #chat-overlay.active { display: flex; }

        .chat-header {
            padding: calc(12px + env(safe-area-inset-top, 0)) 16px 16px;
            background-color: #121212;
            border-bottom: 1px solid #282828;
            display: flex;
            align-items: center;
            gap: 12px;
            min-height: 56px;
            height: auto;
            box-sizing: border-box;
        }
        .chat-back-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .chat-friend-info { display: flex; align-items: center; gap: 12px; cursor: pointer; flex: 1; }
        .chat-friend-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .chat-friend-name {
            font-weight: 700;
            font-size: 16px;
            line-height: 1.1;
            white-space: normal;
            word-break: break-word;
            overflow: visible;
        }
        .chat-status { font-size: 12px; color: var(--text-gray); }

        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .msg-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 12px;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
            transition: transform 0.2s;
            user-select: none;
        }
        
        .msg-sent {
            align-self: flex-end;
            background-color: var(--primary-red);
            color: white;
            border-bottom-right-radius: 2px;
        }
        
        .msg-received {
            align-self: flex-start;
            background-color: #282828;
            color: white;
            border-bottom-left-radius: 2px;
        }

        .msg-time {
            font-size: 10px;
            margin-top: 5px;
            opacity: 0.7;
            text-align: right;
        }

        .msg-reply-indicator {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            border-left: 2px solid rgba(255,255,255,0.3);
            padding-left: 8px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Shared Content in Chat */
        .chat-shared-card {
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            padding: 8px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .chat-shared-card:hover { background: rgba(255,255,255,0.05); }
        .chat-shared-img { width: 40px; height: 40px; border-radius: 4px; object-fit: cover; }
        .chat-shared-info { display: flex; flex-direction: column; }
        .chat-shared-title { font-size: 13px; font-weight: 600; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-shared-sub { font-size: 11px; color: #ccc; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .chat-footer {
            padding: 15px;
            background-color: #121212;
            border-top: 1px solid #282828;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            background: #282828;
            border: none;
            border-radius: 20px;
            padding: 12px 20px;
            color: white;
            font-size: 14px;
            outline: none;
        }
        .chat-send-btn {
            background: var(--primary-red);
            color: white;
            border: none;
            width: 40px; 
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex; 
            justify-content: center; 
            align-items: center;
            font-size: 20px;
            flex-shrink: 0; 
            transition: background 0.2s; 
        }

        .chat-send-btn:hover {
            background: var(--primary-red-hover); 
            transform: scale(1.05);
        }

        .chat-send-btn:active {
            transform: scale(0.95); 
        }

        /* --- CONTEXT MENU --- */
        #context-menu {
            position: absolute;
            background: #282828;
            border: 1px solid #444;
            border-radius: 6px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 5000;
            display: none;
            flex-direction: column;
            min-width: 120px;
        }
        .ctx-item {
            padding: 10px 15px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s;
        }
        .ctx-item:hover { background: var(--primary-red); }
        .ctx-separator { height: 1px; background: #444; margin: 2px 0; }

        /* --- FRIEND PROFILE OVERLAY --- */
        #friend-profile-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-black);
            z-index: 100003;
            display: none;
            overflow-y: auto;
            padding-bottom: 100px;
        }
        #friend-profile-overlay.active { display: block; }

       @media (max-width: 768px) {
    .nav-arrows { display: none; }

    .sidebar {
        position: fixed;
        top: 0;
        left: -280px;
        height: 100vh;
        width: 280px;
        background-color: var(--bg-black);
        padding: 24px 12px;
        box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            z-index: 60010; /* ensure sidebar sits above overlay and player */
    }
    .sidebar.active { left: 0; }
    .mobile-menu-toggle { display: block; }

    .main-content {
        margin-left: 0;
        padding-bottom: 20px;
    }
    header { padding: 12px 16px; }
    .content-padding { padding: 16px; }

    /* Mobile Profile */
    .profile-hero-section { flex-direction: column; align-items: center; text-align: center; gap: 16px; padding-top: 40px; }
    .profile-avatar-lg { width: 180px; height: 180px; }
    .profile-name-large { font-size: 2.5rem; }
    .profile-actions { justify-content: center; }
    .edit-grid { flex-direction: column; align-items: center; }
    .edit-form { width: 100%; }

    .playlist-header-view { flex-direction: column; align-items: flex-start; background: linear-gradient(180deg, #530000 0%, var(--bg-dark) 100%); }
    .playlist-cover-big { width: 160px; height: 160px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    .playlist-info-big h1 { font-size: 2.5rem; line-height: 1.1; }
    .playlist-actions { padding: 0 0 20px 0; width: 100%; justify-content: flex-start; gap: 20px; }

    .song-list-header, .song-row { grid-template-columns: 40px 1fr 40px; padding: 12px 16px; }
    .song-list-header div:nth-child(3), .song-list-header div:nth-child(4), .song-row div:nth-child(3), .song-row div:nth-child(4) { display: none; }
    .song-index { display: flex; align-items: center; justify-content: center; }


/* === PERBAIKAN CSS PLAYER BAR MOBILE (REPLACE SEMUA MEDIA QUERY MOBILE ANDA) === */
/* --- PERBAIKAN PLAYER BAR MOBILE (FULL FITUR) --- */
@media (max-width: 768px) {
    /* Mobile Scroll Optimization */
    body, html {
        -webkit-overflow-scrolling: touch;
        overflow-x: hidden;
    }
    
    .main-content,
    .playlist-scroll,
    .friend-list-container,
    .new-lyrics-content,
    [style*="overflow-y: auto"],
    [style*="overflow: auto"] {
        -webkit-overflow-scrolling: touch !important;
    }
    
    /* --- SIDEBAR MOBILE STYLES --- */
    /* --- SIDEBAR MOBILE STYLES --- */
    .logo {
        justify-content: center;
        flex-direction: column;
        gap: 6px;
        padding: 20px 12px !important;
        margin-bottom: 16px;
        margin-top: 8px;
    }
    
    /* Mobile: Logo lebih besar */
    .logo .app-logo {
        width: 100px !important;
        height: 100px !important;
        margin-right: 0 !important;
        border-radius: 50% !important;
        transition: all 0.3s ease !important;
    }
    
    /* Mobile: Logo hover effect */
    .logo .app-logo:hover {
        transform: scale(1.1) !important;
        box-shadow: 0 0 25px rgba(229, 9, 20, 0.8) !important;
        filter: brightness(1.2) !important;
    }
    
    /* Mobile: Teks vidje lebih besar dan dekat */
    .logo span {
        font-size: 48px !important;
        margin-top: 12px !important;
        margin-left: 0 !important;
    }
    
    /* Mobile Language Dropdown */
    .language-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #1a1a1a;
        border: 1px solid var(--primary-red);
        border-radius: 8px;
        margin-top: 8px;
        z-index: 100;
    }
    
    .language-dropdown.active {
        display: flex;
        flex-direction: column;
    }
    
    .language-dropdown button {
        padding: 12px 16px;
        border: none;
        background: transparent;
        color: white;
        cursor: pointer;
        text-align: left;
        font-weight: 600;
        transition: 0.2s;
    }
    
    .language-dropdown button:hover {
        background: rgba(229, 9, 20, 0.2);
    }
    
    .language-dropdown button.active {
        color: var(--primary-red);
        background: rgba(229, 9, 20, 0.1);
    }
    
    /* Show mobile language section only on mobile */
    .mobile-language-section {
        display: block !important;
    }
    
    .logo .app-logo {
        display: none !important;
    }
    
    .logo span {
        font-size: 18px;
        margin-left: 0 !important;
    }

    /* Language Switcher Mobile */
    .language-switcher {
        padding: 5px 8px;
        margin-bottom: 12px;
        gap: 2px;
    }
    .lang-btn {
        padding: 5px 8px;
        font-size: 10px;
    }

    /* --- 1. ATURAN UMUM PLAYER BAR --- */
    .player-bar {
        height: 90px; /* Pastikan tinggi konsisten */
        padding: 0 10px; /* Kurangi padding horizontal biar muat banyak tombol */
    }

    /* --- 2. BAGIAN KIRI (Cover & Info) --- */
    .player-left {
        width: 35%; /* Perkecil jadi 35% */
        flex-shrink: 0; /* Jangan mengecilkan */
    }
    
    /* Sembunyikan Like Button di mobile biar judul tidak gepeng */
    .player-left .like-btn {
        display: none !important; 
    }

    /* Styling Judul Lagu agar rapi jika panjang */
    .current-title {
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
        margin-right: 5px;
    }
    
    .current-artist {
        font-size: 11px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }


    /* --- 3. BAGIAN TENGAH (Play/Pause only) --- */
    .player-center {
        width: 40%; /* Beri ruang lebih lebar */
        flex-shrink: 1;
    }

    /* Sembunyikan tombol Prev dan Next di mobile */
    .player-center .control-btn:nth-child(2), /* Prev */
    .player-center .control-btn:nth-child(4) { /* Next */
        display: none !important;
    }

    /* Styling khusus tombol Play/Pause agar lebih besar */
    /* Styling khusus tombol Play/Pause agar lebih besar */
    .player-center .play-pause-btn {
        width: 36px; /* Sedikit lebih besar */
        height: 36px;
        font-size: 20px;
        background-color: var(--text-white);
    }


    /* Sembunyikan Shuffle & Repeat di Mobile */
    .player-center .control-btn:nth-child(1), /* Shuffle */
    .player-center .control-btn:nth-child(5) { /* Repeat */
        display: none !important;
    }

    /* Desktop: Ensure all control buttons are visible */

    /* Desktop: Ensure prev/next buttons are visible */
    @media (min-width: 769px) {
        .player-center .control-btn:nth-child(2), /* Prev */
        .player-center .control-btn:nth-child(4) { /* Next */
            display: flex !important;
            color: white !important;
            font-size: 20px;
        }
    }

    /* Tandai jika sedang aktif */

    /* Tandai jika sedang aktif */
    .player-center .control-btn.active {
        color: var(--primary-red) !important;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
    }

    /* --- 4. BAGIAN KANAN (Queue, Listen Together, Volume) --- */
    .player-right {
        width: 25%; /* Sisa ruang */
        flex-shrink: 0;
        justify-content: flex-end;
        gap: 8px; /* Jarak antar tombol */
    }

    /* Munculkan tombol Queue (Atribut title Queue atau ikon list) */
    .player-right .control-btn[title="Queue"] {
        display: flex !important;
        font-size: 20px;
        padding: 6px;
    }

    /* Munculkan tombol Listen Together (Ikon users-three) */
    .player-right .control-btn[title="Dengar Bareng"] {
        display: flex !important;
        font-size: 20px;
        padding: 6px;
    }

    /* Sembunyikan tombol Mic (Lyric) */
    .player-right .control-btn[title="Lirik"] {
        display: none !important;
    }

    /* Sembunyikan Volume Slider */
    .player-right #volume-container {
        display: none !important;
    }

    /* --- 5. TAMBAHAN OVERLAY (Listen Together) --- */
    /* Pastikan Overlay tidak tertutup player bar saat muncul */
    #listen-together-overlay {
        z-index: 10000 !important; /* Sangat tinggi */
    }
    
    /* Responsive Container Mobile */
    .lt-container {
        width: 90% !important;
        padding: 30px 20px !important;
        max-height: 80vh; /* Batasi tinggi agar tombol bawah masih bisa diakses */
        overflow-y: auto; /* Scroll jika konten kepanjangan */
    }
    
    .lt-header h2 {
        font-size: 24px;
        margin-bottom: 10px;
    }

    .lt-btn, .lt-input {
        padding: 12px; /* Kurangi padding biar muat banyak tombol */
    }

    /* --- 6. TAMBAHAN OVERLAY QUEUE --- */
    /* Sesuaikan tinggi Queue agar tidak menutupi semua layar */
    #queue-overlay {
        bottom: 90px; /* Tepat di atas player bar */
        top: auto;
        height: 60vh; /* Tinggi 60% dari layar */
        border-left: none; /* Full width di mobile */
    }
}

    
/* === LISTEN TOGETHER OVERLAY === */
#listen-together-overlay {
    position: fixed;
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 999999;
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
}
#listen-together-overlay.active { 
    display: flex; 
}

/* Hide Listen Together on desktop - AGGRESSIVE */
@media (min-width: 769px) {
    #listen-together-overlay,
    #listen-together-overlay.active {
        display: none !important;
        visibility: hidden !important;
        pointer-events: none !important;
        position: fixed !important;
        width: 0 !important;
        height: 0 !important;
        opacity: 0 !important;
    }
    
    #btn-open-listen-together {
        display: none !important;
        visibility: hidden !important;
        pointer-events: none !important;
        width: 0 !important;
        height: 0 !important;
        opacity: 0 !important;
    }
}

.lt-container {
    background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
    padding: 30px;
    border-radius: 20px;
    width: 100%;
    max-width: 500px;
    border: 2px solid var(--primary-red);
    box-shadow: 0 20px 60px rgba(229,9,20,0.3);
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

@media (min-width: 769px) {
    .lt-container {
        max-width: 950px;
        padding: 40px;
    }
}

.lt-header {
    text-align: center;
    margin-bottom: 0;
}

.lt-header h2 {
    font-size: 28px;
    font-weight: 900;
    color: white;
    margin: 0 0 10px 0;
}

.lt-header p {
    color: #aaa;
    font-size: 13px;
    margin: 0;
}

#lt-mode-section,
#lt-host-section,
#lt-join-section {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
}

#lt-host-section.hidden,
#lt-join-section.hidden,
#lt-mode-section.hidden {
    display: none !important;
}

@media (min-width: 769px) {
    #lt-host-section {
        display: grid !important;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        align-items: start;
    }
}

.lt-mode-selector {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    width: 100%;
}

.lt-mode-btn {
    padding: 20px;
    border: 2px solid #333;
    border-radius: 12px;
    background: transparent;
    color: white;
    cursor: pointer;
    transition: 0.2s;
    font-weight: 700;
}

.lt-mode-btn:hover {
    border-color: var(--primary-red);
    background: rgba(229,9,20,0.1);
}

.lt-mode-btn.active {
    border-color: var(--primary-red);
    background: var(--primary-red);
}

.lt-session-code {
    background: #1a1a1a;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid #333;
    width: 100%;
    box-sizing: border-box;
}

.lt-code-display {
    font-size: 36px;
    font-weight: 900;
    color: var(--primary-red);
    letter-spacing: 8px;
    font-family: monospace;
    margin: 10px 0;
}

.lt-input {
    width: 100%;
    padding: 15px;
    background: #1a1a1a;
    border: 2px solid #333;
    border-radius: 12px;
    color: white;
    font-size: 24px;
    text-align: center;
    letter-spacing: 4px;
    font-weight: 700;
    text-transform: uppercase;
    box-sizing: border-box;
}

.lt-input:focus {
    outline: none;
    border-color: var(--primary-red);
}

.lt-btn {
    width: 100%;
    padding: 15px;
    background: var(--primary-red);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 900;
    font-size: 16px;
    cursor: pointer;
    transition: 0.2s;
    box-sizing: border-box;
}

@media (min-width: 769px) {
    #lt-host-section .lt-session-code {
        grid-column: 1;
        grid-row: 1;
        padding: 25px;
    }
    
    #lt-host-section > .lt-btn:nth-of-type(2) {
        grid-column: 1;
        grid-row: 2;
    }
    
    #lt-host-section .lt-participants {
        grid-column: 2;
        grid-row: 1 / 4;
    }
    
    #lt-host-section > .lt-btn:nth-of-type(3) {
        grid-column: 1;
        grid-row: 3;
    }
}

.lt-btn:hover {
    background: var(--primary-red-hover);
    transform: scale(1.02);
}

.lt-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: white;
    font-size: 32px;
    cursor: pointer;
}

/* Session Active Badge */
.session-badge {
    position: fixed;
    top: 80px;
    right: 20px;
    background: linear-gradient(135deg, var(--primary-red), #ff4d5a);
    padding: 12px 20px;
    border-radius: 50px;
    display: none;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    box-shadow: 0 4px 15px rgba(229,9,20,0.4);
    cursor: pointer;
    animation: pulse 2s infinite;
}

.session-badge.active { display: flex; }

/* Hide session badge on desktop */
@media (min-width: 769px) {
    .session-badge,
    .session-badge.active {
        display: none !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 4px 15px rgba(229,9,20,0.4); }
    50% { box-shadow: 0 4px 25px rgba(229,9,20,0.8); }
}

.session-badge-icon {
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* Participants List */
.lt-participants {
    background: #1a1a1a;
    padding: 15px;
    border-radius: 12px;
    max-height: 200px;
    overflow-y: auto;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    box-sizing: border-box;
    flex-direction: column;
    border: 1px solid #333;
}

@media (min-width: 769px) {
    .lt-participants {
        padding: 20px;
        min-height: 350px;
        border: 2px solid var(--primary-red);
        max-height: none;
        align-items: flex-start;
        justify-content: flex-start;
    }
}

.lt-participant {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    border-radius: 6px;
    width: 100%;
}

.lt-participant:hover {
    background: rgba(255,255,255,0.05);
}

.lt-participant img {
    width: 32px;
    height: 32px;
    border-radius: 50%;
}

.lt-host-badge {
    background: var(--primary-red);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 700;
    margin-left: auto;
    color: white;
}

.lt-participants p {
    color: #666;
    text-align: center;
    font-size: 13px;
    margin: 0;
}

#lt-join-section {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

@media (min-width: 769px) {
    #lt-join-section {
        max-width: 500px;
        margin: 0 auto;
    }
}

#lt-join-section p {
    color: #aaa;
    font-size: 12px;
    text-align: center;
    margin: 0;
}

#toast-container {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none;
}
.toast {
    background: rgba(40, 40, 40, 0.95);
    color: white;
    padding: 12px 24px;
    border-radius: 50px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideUp 0.3s ease;
    pointer-events: auto;
    border: 1px solid #444;
}
.toast.success { border-color: #1db954; }
.toast.error { border-color: #e91e63; }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

.import-music-btn {
    color: var(--text-gray);
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: 0.2s;
    border-radius: 4px;
    margin-top: 5px;
}
.import-music-btn:hover { 
    color: var(--text-white); 
    background-color: rgba(255,255,255,0.05); 
}

.import-form-grid {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.import-file-preview {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #1a1a1a;
    border-radius: 8px;
    border: 2px dashed #444;
}

.import-file-preview.active {
    border-color: var(--primary-red);
}

.import-cover-preview {
    width: 100px;
    height: 100px;
    border-radius: 8px;
    object-fit: cover;
    background: #333;
}

.import-file-info {
    flex: 1;
}

.import-file-name {
    font-weight: 600;
    color: white;
    margin-bottom: 5px;
}

.import-file-size {
    font-size: 12px;
    color: #888;
}

.file-upload-btn {
    padding: 12px 24px;
    background: var(--primary-red);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    transition: 0.2s;
}

.file-upload-btn:hover {
    background: var(--primary-red-hover);
}

.privacy-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px;
    background: #1a1a1a;
    border-radius: 8px;
}

.privacy-toggle label {
    flex: 1;
    font-weight: 600;
}

.toggle-switch {
    position: relative;
    width: 50px;
    height: 26px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #444;
    transition: 0.4s;
    border-radius: 34px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #1db954;
}

input:checked + .toggle-slider:before {
    transform: translateX(24px);
}

/* === ULTRA MOBILE: iPhone 12 Mini & Small Devices (max-width: 390px) === */
@media (max-width: 414px) {
    /* Root adjustments */
    :root {
        --sidebar-width: 240px;
        --header-height: 56px;
        --player-height: 64px;
        --mobile-nav-height: 60px;
    }

    /* Header adjustments */
    header {
        padding: 8px 12px;
        gap: 8px;
    }

    .logo i {
        font-size: 24px;
    }

    .header-search {
        padding: 8px 12px;
        font-size: 12px;
    }

    .search-icon {
        font-size: 16px;
    }

    /* Main content */
    .main-content {
        padding-bottom: calc(var(--player-height) + var(--mobile-nav-height));
    }

    .content-padding {
        padding: 12px;
    }

    /* --- MOBILE: Tidy images for albums, playlists, bands/artists --- */
    .playlist-cover-big {
        width: 64px !important;
        height: 64px !important;
        border-radius: 6px;
        box-shadow: none;
        object-fit: cover;
    }

    .playlist-thumb {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        object-fit: cover;
    }

    /* Cards used across home/profile (compact for very small devices) */
    .card-grid .card,
    .band-grid .band-card,
    .horizontal-list-mobile .card,
    .horizontal-list-mobile .band-card {
        width: 72px !important;
        height: 72px !important;
        flex: 0 0 72px !important;
    }

    .card-grid .card img,
    .band-card img,
    .horizontal-list-mobile .card img,
    .horizontal-list-mobile .band-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
    }

    /* Artist / band list thumbnails in lists */
    .playlist-item .playlist-thumb,
    .friend-avatar,
    .chat-shared-img {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        object-fit: cover;
    }

    /* Tighter grids on mobile: allow more columns with smaller cards */
    .card-grid { grid-template-columns: repeat(auto-fill, minmax(72px, 1fr)); gap: 8px; }
    .band-grid { grid-template-columns: repeat(4, 1fr); gap: 6px; }

    /* Compact album/playlist images on ultra-small screens */
    .playlist-cover-big {
        width: 96px !important;
        height: 96px !important;
        margin-bottom: 8px;
        box-shadow: none;
        object-fit: cover;
        border-radius: 8px;
    }

    .card-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
        margin-bottom: 24px;
    }

    .card-grid .card img,
    .band-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
    }

    .band-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 0 8px;
    }

    .playlist-actions .action-play-btn {
        width: 44px;
        height: 44px;
        font-size: 18px;
    }

    /* show mobile bottom nav on ultra-small screens */
    .mobile-bottom-nav { display: flex; }

    .mobile-bottom-nav .mb-nav-item span { font-size: 11px; }
    .mobile-bottom-nav { left: 8px; right: 8px; height: var(--mobile-nav-height); bottom: 0; }

    /* place player bar above mobile nav */
    .player-bar { bottom: var(--mobile-nav-height); }

    /* Compact the four "popular" horizontal lists (bands/artists, local & foreign)
       so thumbnails are smaller on ultra-small screens */
    #popular-bands-container .song-card,
    #popular-artists-container .song-card,
    #foreign-solo-container .song-card,
    #foreign-bands-container .song-card {
        min-width: 140px !important;
        flex: 0 0 140px !important;
        padding: 8px !important;
    }

    #popular-bands-container .card-img-wrapper,
    #popular-artists-container .card-img-wrapper,
    #foreign-solo-container .card-img-wrapper,
    #foreign-bands-container .card-img-wrapper {
        aspect-ratio: 1/1;
        margin-bottom: 8px;
        overflow: hidden;
    }

    #popular-bands-container .card-img-wrapper img,
    #popular-artists-container .card-img-wrapper img,
    #foreign-solo-container .card-img-wrapper img,
    #foreign-bands-container .card-img-wrapper img {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover;
        border-radius: 8px;
    }
    /* place chat footer above player bar */
        .chat-footer {
            position: fixed;
            left: 0;
            right: 0;
            bottom: calc(var(--player-height) + var(--mobile-nav-height) + 8px);
            z-index: 100002; /* ensure footer sits above player/nav when chat is open */
            padding: 12px 16px;
            backdrop-filter: blur(6px);
    }

        /* When the full-screen chat overlay is open, place the footer inside the overlay
           so users can type at the bottom of the chat content (not fixed to viewport). */
        #chat-overlay .chat-footer {
            position: relative !important;
            left: auto !important;
            right: auto !important;
            bottom: auto !important;
            width: 100%;
            z-index: 100002;
            background: transparent;
            padding: 12px 16px;
        }

        /* Add space at the end of the chat body so last messages are not hidden behind the footer */
        #chat-overlay .chat-body {
            padding-bottom: 84px !important;
        }

    /* Sidebar adjustments */
    .sidebar {
        width: 240px;
        padding: 16px 8px;
    }

    .nav-links {
        gap: 4px;
    }

    .nav-item {
        padding: 8px 12px;
        font-size: 13px;
    }

    .nav-item i {
        font-size: 18px;
    }

    .playlist-item {
        padding: 8px 12px;
        font-size: 12px;
    }

    /* Player bar ultra compact untuk iPhone 12 mini */
    .player-bar {
        height: var(--player-height);
        padding: 0 8px;
        gap: 6px;
        flex-wrap: nowrap;
    }

    /* Player left - minimal */
    .player-left {
        width: 28%;
        gap: 4px;
        flex-shrink: 0;
    }

    .player-left .current-art {
        width: 44px;
        height: 44px;
        border-radius: 4px;
        flex-shrink: 0;
    }

    .player-left .current-info {
        flex: 1;
        min-width: 0;
    }

    .current-title {
        font-size: 10px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin: 0;
        padding: 0;
    }

    .current-artist {
        font-size: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin: 0;
        padding: 0;
    }

    /* Hide like button on ultra-small screens */
    .player-left .like-btn {
        display: none !important;
    }

    /* Player center - controls only */
    .player-center {
        width: 50%;
        gap: 2px;
        flex-direction: row;
        flex-shrink: 1;
    }

    .player-controls {
        width: 100%;
        gap: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .player-controls .control-btn {
        padding: 2px;
        font-size: 14px;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    /* Make prev/next buttons larger and more prominent on mobile */
    .player-controls #prev-btn,
    .player-controls #next-btn {
        width: 32px;
        height: 32px;
        font-size: 18px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
    }

    /* Smaller shuffle and repeat on mobile */
    .player-controls #shuffle-btn,
    .player-controls #repeat-btn {
        width: 20px;
        height: 20px;
        font-size: 12px;
        opacity: 0.7;
    }

    .player-controls .play-pause-btn {
        width: 36px;
        height: 36px;
        font-size: 16px;
        flex-shrink: 0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--text-white);
        color: black;
        box-shadow: 0 3px 8px rgba(0,0,0,0.32);
    }

    /* Hide playback bar on ultra-small screens */
    .playback-bar {
        display: none !important;
    }

    /* Player right - minimal buttons */
    .player-right {
        width: 22%;
        gap: 2px;
        flex-shrink: 0;
    }

    .player-right .control-btn {
        padding: 2px;
        font-size: 14px;
        width: 22px;
        height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    /* Hide volume container and icon on ultra-small screens */
    #volume-container,
    #vol-icon {
        display: none !important;
    }

    /* Song list - 2 column grid */
    .song-list-header,
    .song-row {
        grid-template-columns: 30px 1fr 30px;
        padding: 8px 10px;
        gap: 6px;
        font-size: 10px;
    }

    .song-list-header {
        padding: 8px 10px;
    }

    .song-list-header div:nth-child(3),
    .song-list-header div:nth-child(4),
    .song-row div:nth-child(3),
    .song-row div:nth-child(4) {
        display: none !important;
    }

    .song-index {
        font-size: 10px;
        width: 30px;
        text-align: center;
    }

    .song-info {
        display: flex;
        gap: 6px;
        align-items: center;
        min-width: 0;
        flex: 1;
    }

    .song-info img {
        width: 36px;
        height: 36px;
        border-radius: 3px;
        flex-shrink: 0;
    }

    .song-info > div {
        display: flex;
        flex-direction: column;
        min-width: 0;
        flex: 1;
    }

    .song-title-text {
        font-size: 10px;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .song-artist {
        font-size: 8px;
        color: #999;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .song-duration {
        display: none;
    }

    .song-actions {
        width: 30px;
        display: flex;
        gap: 0;
        justify-content: center;
    }

    .song-actions button {
        padding: 2px;
        font-size: 12px;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Playlist cover adjustments */
    .playlist-cover-big {
        width: 120px;
        height: 120px;
        margin-bottom: 12px;
    }

    .playlist-info-big h1 {
        font-size: 1.5rem;
    }

    .playlist-actions {
        padding: 0;
        gap: 10px;
        width: 100%;
    }

    .action-play-btn {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }

    /* Album grid adjustments */
    .band-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 0 10px;
    }

    .band-card {
        border-radius: 6px;
    }

    .band-card img {
        border-radius: 6px;
    }

    /* Overlay adjustments */
    .lt-container {
        width: 94%;
        padding: 16px 12px;
        max-height: 70vh;
    }

    .lt-header h2 {
        font-size: 18px;
    }

    .lt-header p {
        font-size: 11px;
    }

    .lt-btn,
    .lt-input {
        padding: 8px;
        font-size: 11px;
    }

    #queue-overlay {
        width: 100% !important;
        height: 50vh;
        bottom: 72px;
        right: 0 !important;
        border-left: none;
    }

    .queue-header {
        padding: 12px 10px;
    }

    .queue-title {
        font-size: 14px;
    }

    .queue-item {
        padding: 8px 10px;
        font-size: 10px;
        gap: 8px;
    }

    .queue-item img {
        width: 36px;
        height: 36px;
    }

    /* Modal adjustments */
    .modal {
        padding: 16px 12px;
        border-radius: 8px;
    }

    .modal h2 {
        font-size: 18px;
    }

    .modal label {
        font-size: 11px;
    }

    .modal input,
    .modal textarea {
        font-size: 11px;
        padding: 6px;
    }

    .modal button {
        padding: 8px 12px;
        font-size: 11px;
    }

    /* Text adjustments for readability */
    h1 { font-size: 20px; }
    h2 { font-size: 16px; }
    h3 { font-size: 14px; }

    /* Reduce sidebar width for small screens */
    .sidebar {
        width: 200px;
        padding: 12px 6px;
    }

    .nav-item {
        padding: 6px 10px;
        font-size: 12px;
    }

    .playlist-item {
        padding: 6px 10px;
        font-size: 11px;
    }
}

    /* Additional profile & media adjustments for tablets */
    .profile-hero-section {
        padding-top: 30px;
        gap: 12px;
    }

    .profile-avatar-lg {
        width: 120px;
        height: 120px;
    }

    .profile-name-large {
        font-size: 2rem;
    }

    .profile-stats {
        gap: 12px;
    }

    .profile-stat {
        font-size: 11px;
    }

    /* Video section adjustments */
    .video-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 0 12px;
    }

    .video-card {
        border-radius: 6px;
    }

    .video-card img {
        border-radius: 6px;
    }

    .video-title {
        font-size: 11px;
        padding: 6px;
    }

    /* Friend list adjustments */
    .friend-list {
        gap: 8px;
        padding: 0 12px;
    }

    .friend-card {
        padding: 10px;
    }

    .friend-avatar {
        width: 44px;
        height: 44px;
    }

    .friend-name {
        font-size: 12px;
    }

    .friend-status {
        font-size: 10px;
    }

    /* Text adjustments for better readability */
    h1 { font-size: 24px; }
    h2 { font-size: 18px; }
    h3 { font-size: 16px; }
    p { font-size: 12px; }

    /* Reduce gap in containers */
    .grid-container {
        gap: 10px;
    }

    /* Adjust card styles */
    .card {
        border-radius: 8px;
        padding: 10px;
    }

    /* Reduce button sizes */
    button {
        padding: 8px 12px;
        font-size: 12px;
        min-height: 40px;
    }

    /* Scrollbar adjustments */
    ::-webkit-scrollbar {
        width: 6px;
    }

    ::-webkit-scrollbar-thumb {
        border-radius: 3px;
    }

    /* Safe area for notch devices */
    body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
    }
}

/* Tambahkan di bagian CSS, sekitar line 350-400 */

/* Unread Messages Badge */
.friend-list-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 4px;
    transition: 0.2s;
    position: relative; /* Untuk badge positioning */
}

.unread-badge {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--primary-red);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    animation: pulse-badge 2s infinite;
}

@keyframes pulse-badge {
    0%, 100% { transform: translateY(-50%) scale(1); }
    50% { transform: translateY(-50%) scale(1.1); }
}

/* REPLACE CSS yang ada untuk .playlist-modal-grid-profile dan #friend-public-playlists */
/* Sekitar line 450-550 */

/* Profile Public Playlists - UKURAN SAMA DENGAN HOME */
.playlist-modal-grid-profile {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 24px;
    padding: 0 32px 60px 32px;
}

.playlist-modal-grid-profile .song-card {
    background-color: var(--bg-card);
    padding: 16px;
    border-radius: 6px;
    transition: background-color 0.3s ease;
    cursor: pointer;
    position: relative;
}

.playlist-modal-grid-profile .song-card:hover {
    background-color: var(--bg-card-hover);
}

.playlist-modal-grid-profile .card-img-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* Force 1:1 aspect ratio */
    margin-bottom: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    border-radius: 4px;
    overflow: hidden;
    background-color: #222;
}

.playlist-modal-grid-profile .card-img-wrapper img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.playlist-modal-grid-profile .play-btn-overlay {
    position: absolute;
    bottom: 8px;
    right: 8px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: var(--primary-red);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 8px 8px rgba(0,0,0,0.3);
    opacity: 0;
    transform: translateY(8px);
    transition: all 0.3s ease;
    z-index: 5;
}

.playlist-modal-grid-profile .song-card:hover .play-btn-overlay {
    opacity: 1;
    transform: translateY(0);
}

.playlist-modal-grid-profile .card-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text-white);
}

.playlist-modal-grid-profile .card-desc {
    font-size: 14px;
    color: var(--text-gray);
}

/* Friend Profile Playlists - EXACT SAME SIZE AS HOME (180x180px forced) */
#friend-public-playlists {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 24px;
    padding: 0 32px 60px 32px;
}

#friend-public-playlists .song-card {
    background-color: var(--bg-card);
    padding: 16px;
    border-radius: 6px;
    transition: background-color 0.3s ease;
    cursor: pointer;
    position: relative;
    max-width: 212px; /* 180px content + 32px padding */
}

#friend-public-playlists .song-card:hover {
    background-color: var(--bg-card-hover);
}

/* CRITICAL FIX: Wrapper dengan padding-bottom 100% */
#friend-public-playlists .card-img-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 100%; /*  INI YANG PENTING: Paksa rasio 1:1 */
    margin-bottom: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    border-radius: 4px;
    overflow: hidden;
    background-color: #222;
}

/* Image di dalam wrapper: absolute positioning */
#friend-public-playlists .card-img-wrapper img {
    position: absolute !important;  /*  HARUS absolute */
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;   /*  Prevent distortion */
    transition: transform 0.3s ease;
}

#friend-public-playlists .play-btn-overlay {
    position: absolute;
    bottom: 8px;
    right: 8px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: var(--primary-red);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 8px 8px rgba(0,0,0,0.3);
    opacity: 0;
    transform: translateY(8px);
    transition: all 0.3s ease;
    z-index: 5;
}

#friend-public-playlists .song-card:hover .play-btn-overlay {
    opacity: 1;
    transform: translateY(0);
}

#friend-public-playlists .card-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text-white);
}

#friend-public-playlists .card-desc {
    font-size: 14px;
    color: var(--text-gray);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    #friend-public-playlists {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
        padding: 0 16px 60px 16px;
    }
    
    #friend-public-playlists .song-card {
        padding: 12px;
        max-width: 164px; /* 140px + 24px padding */
    }
    
    #friend-public-playlists .card-title {
        font-size: 14px;
    }
    
    #friend-public-playlists .card-desc {
        font-size: 12px;
    }
}

/* Mobile Responsive untuk Profile Playlists */
@media (max-width: 768px) {
    .playlist-modal-grid-profile,
    #friend-public-playlists {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
        padding: 0 16px 60px 16px;
    }
    
    .playlist-modal-grid-profile .song-card,
    #friend-public-playlists .song-card {
        padding: 12px;
    }
    
    .playlist-modal-grid-profile .card-title,
    #friend-public-playlists .card-title {
        font-size: 14px;
    }
    
    .playlist-modal-grid-profile .card-desc,
    #friend-public-playlists .card-desc {
        font-size: 12px;
    }
}

/* === ARTIST/BAND PROFILE OVERLAY (DESKTOP ONLY) === */
#artist-band-profile-overlay {
    position: fixed;
    top: 50%;
    left: calc(var(--sidebar-width) + 20px);
    transform: translateY(-50%) translateX(0);
    width: calc(100% - var(--sidebar-width) - 40px);
    max-width: 1000px;
    height: auto;
    max-height: 85vh;
    background: var(--bg-dark);
    z-index: 5000;
    display: none;
    flex-direction: column;
    overflow-y: auto;
    border-radius: 12px;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
}

#artist-band-profile-overlay.active {
    display: flex;
    opacity: 1;
    pointer-events: auto;
}

/* Backdrop semi-transparent */
#artist-band-profile-overlay::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: -1;
    cursor: pointer;
    border-radius: 0;
}

/* Only show on desktop (laptop) */
@media (max-width: 768px) {
    #artist-band-profile-overlay {
        left: 10px !important;
        right: 10px !important;
        width: calc(100% - 20px) !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        max-width: none !important;
    }
    
    #artist-band-profile-overlay::before {
        left: 0 !important;
        right: 0 !important;
    }
    
    /* Hide desktop language section on mobile */
    .desktop-language-section {
        display: none !important;
    }
    
    /* Show mobile language section on mobile */
    .mobile-language-section {
        display: block !important;
    }
}

/* Show desktop language section on desktop */
@media (min-width: 769px) {
    .desktop-language-section {
        display: block !important;
    }
    
    .mobile-language-section {
        display: none !important;
    }
}

.artist-band-overlay-header {
    display: flex;
    align-items: flex-end;
    padding: 20px 24px;
    background: linear-gradient(180deg, #530000 0%, var(--bg-dark) 100%);
    gap: 16px;
    border-bottom: none;
    flex-shrink: 0;
}

.artist-band-overlay-back {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.2s;
    border-radius: 50%;
    flex-shrink: 0;
}

.artist-band-overlay-back:hover {
    background: rgba(255, 255, 255, 0.2);
    color: var(--primary-red);
}

.artist-band-overlay-title {
    flex: 1;
    font-size: 24px;
    font-weight: 900;
    color: white;
}

.artist-band-overlay-content {
    flex: 1;
    overflow: hidden;
    padding: 0;
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 0;
    background: var(--bg-dark);
    max-height: calc(85vh - 100px);
}

.artist-band-overlay-left {
    padding: 24px;
    border-right: 1px solid var(--border-color);
    background: var(--bg-dark);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    overflow-y: auto;
    max-height: calc(85vh - 100px);
}

.artist-band-overlay-right {
    padding: 24px;
    background: var(--bg-dark);
    overflow-y: auto;
    max-height: calc(85vh - 100px);
}

.artist-band-overlay-cover {
    width: 100%;
    aspect-ratio: 1/1;
    border-radius: 8px;
    object-fit: cover;
    margin-bottom: 16px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
}

.artist-band-overlay-info h2 {
    font-size: 18px;
    font-weight: 900;
    margin-bottom: 8px;
    color: var(--text-white);
    word-break: break-word;
}

.artist-band-overlay-info p {
    font-size: 14px;
    color: var(--text-gray);
    margin-bottom: 8px;
}

.artist-band-overlay-stats {
    display: flex;
    gap: 16px;
    margin: 12px 0 0 0;
    padding-top: 12px;
    border-top: 1px solid var(--border-color);
}

.artist-band-overlay-stat {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.artist-band-overlay-stat-value {
    font-size: 14px;
    font-weight: 900;
    color: var(--text-white);
}

.artist-band-overlay-stat-label {
    font-size: 12px;
    color: var(--text-gray);
    margin-top: 4px;
}

.artist-band-overlay-songs-title {
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--text-gray);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.artist-band-overlay-songs {
    display: flex;
    flex-direction: column;
    gap: 0;
    max-height: 100%;
    overflow-y: auto;
}

.artist-band-song-item {
    display: grid;
    grid-template-columns: 45px 4fr 3fr 1fr 160px;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    align-items: center;
    color: var(--text-gray);
    font-size: 13px;
    transition: 0.2s;
}

.artist-band-song-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.artist-band-song-item:hover button {
    color: var(--text-white) !important;
}

.artist-band-song-item:hover .overlay-like-btn.liked {
    color: var(--primary-red) !important;
}

.artist-band-song-item.playing {
    color: var(--primary-red);
    box-shadow: inset 4px 0 0 var(--primary-red);
    background: linear-gradient(90deg, rgba(229, 9, 20, 0.04), transparent 60%);
}

/* Overlay Like Button */
.overlay-like-btn {
    color: var(--text-gray) !important;
    transition: 0.2s !important;
}

.overlay-like-btn.liked {
    color: var(--primary-red) !important;
}

.artist-band-song-index {
    font-size: 14px;
    color: var(--text-gray);
    min-width: 20px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
}

.artist-band-song-info {
    display: flex;
    align-items: center;
    gap: 12px;
    overflow: hidden;
}

.artist-band-song-cover {
    width: 36px;
    height: 36px;
    border-radius: 4px;
    object-fit: cover;
    flex-shrink: 0;
}

.artist-band-song-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-white);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.artist-band-song-artist {
    font-size: 11px;
    color: var(--text-gray);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.artist-band-song-album {
    font-size: 13px;
    color: var(--text-gray);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.artist-band-song-duration {
    font-size: 11px;
    color: #666;
    margin-top: 2px;
}

.artist-band-song-play {
    background: none;
    border: none;
    color: var(--primary-red);
    cursor: pointer;
    font-size: 16px;
    padding: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.artist-band-song-play:hover {
    color: #ff4d5a;
}

/* Toast Notification */
.toast {
    background: linear-gradient(135deg, rgba(229, 9, 20, 0.95), rgba(229, 9, 20, 0.85));
    color: white;
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(229, 9, 20, 0.4);
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    font-weight: 600;
    animation: slideInToast 0.3s ease-out forwards;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

@keyframes slideInToast {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutToast {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}

.toast.exit {
    animation: slideOutToast 0.3s ease-out forwards;
}

.toast-icon {
    font-size: 20px;
    flex-shrink: 0;
}

/* --- LYRICS OVERLAY --- */
#overlay-lyrics-container {
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;
}

#overlay-lyrics-container::-webkit-scrollbar {
    width: 6px;
}

#overlay-lyrics-container::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 3px;
}

#overlay-lyrics-container::-webkit-scrollbar-thumb {
    background: rgba(229,9,20,0.3);
    border-radius: 3px;
}

#overlay-lyrics-container::-webkit-scrollbar-thumb:hover {
    background: rgba(229,9,20,0.5);
}



    
    #overlay-lyrics-container {
        background: rgba(0, 255, 0, 0.1) !important; /* Green tint untuk debug */
        border: 2px solid green !important; /* Border hijau untuk debug */
        width: 100% !important;
        display: flex !important;
    }
    
    #overlay-lyrics-content {
        background: rgba(0, 0, 255, 0.1) !important; /* Blue tint untuk debug */
        border: 2px solid blue !important; /* Border biru untuk debug */
        width: 100% !important;
        padding: 20px !important;
        font-size: 32px !important;
        line-height: 1.5 !important;
        color: white !important;
    }
    
    .lyrics-line {
        color: rgba(255, 255, 255, 0.7) !important;
        margin: 10px 0 !important;
        font-size: 28px !important;
    }
    
    .lyrics-line.active,
    .lyrics-line.current-line {
        color: #ffffff !important;
        font-weight: 700 !important;
        font-size: 32px !important;
    }

    
    .overlay-lyrics-section {
        display: flex !important;
        flex: 1 !important;
        width: 100% !important;
        padding: 20px !important;
    }
    
    #overlay-lyrics-content {
        width: 100% !important;
        font-size: 18px !important;
        line-height: 1.6 !important;
        padding: 20px !important;
        text-align: center !important;
    }

.lyrics-overlay-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    z-index: 32000;
    display: none;
    overflow: hidden;
    flex-direction: column;
    pointer-events: none; /* Tidak mengganggu saat tidak aktif */
}

/* Hide lyrics overlay saat desktop play screen aktif */
.lyrics-overlay-container.hide-for-playscreen {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
    z-index: -10000 !important;
    opacity: 0 !important;
}

@media (min-width: 769px) {
    /* Ensure lyrics active overlay tidak overlay di atas play screen */
    .lyrics-overlay-container.active {
        z-index: 99998 !important;
    }
}

.lyrics-overlay-container::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: inherit;
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    filter: blur(60px) brightness(0.35) saturate(1.3);
    z-index: -1;
    transform: scale(1.3);
    pointer-events: none;
}

.lyrics-overlay-container.active {
    display: flex;
    pointer-events: auto; /* Aktifkan interaksi saat overlay dibuka */
}

/* === DESKTOP LYRICS PAGE (1025px+) === */
@media (min-width: 1025px) {
    .lyrics-overlay-container {
        flex-direction: row;
        align-items: stretch;
        justify-content: space-between;
    }

    .lyrics-header {
        display: none !important;
    }

    .lyrics-desktop-section {
        flex: 0 0 50%;
        display: flex !important;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 40px;
        gap: 24px;
    }

    .lyrics-mobile-section {
        display: none !important;
    }

    #lyrics-page-content {
        flex: 1;
        display: flex !important;
        flex-direction: column;
        padding: 60px 40px !important;
        margin: 0 !important;
        font-size: 18px !important;
        line-height: 2.2 !important;
    }

    #lyrics-page-art {
        width: 320px !important;
        height: 320px !important;
        border-radius: 20px !important;
        box-shadow: 0 30px 80px rgba(0,0,0,0.6) !important;
    }
}

/* === MOBILE LYRICS PAGE (1024px) === */
@media (max-width: 1024px) {
    .lyrics-overlay-container {
        flex-direction: column;
        justify-content: flex-start;
    }

    .lyrics-header {
        display: flex !important;
        order: -2;
    }

    .lyrics-desktop-section {
        display: none !important;
    }

    .lyrics-mobile-section {
        display: flex !important;
        flex-direction: column;
        align-items: center;
        padding: 20px 16px;
        gap: 0;
        flex-shrink: 0;
        order: -1;
    }

    #lyrics-page-art-mobile {
        width: 200px !important;
        height: 200px !important;
        border-radius: 12px !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4) !important;
    }

    #lyrics-page-content {
        flex: 1;
        display: flex !important;
        flex-direction: column;
        font-size: 15px !important;
        line-height: 1.8 !important;
        padding: 16px !important;
        margin: 0 !important;
        order: 1;
    }
}

.lyrics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 20px 16px 20px;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(30px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    z-index: 10;
}

@media (min-width: 1025px) {
    .lyrics-header {
        display: none;
    }
}

@media (max-width: 1024px) {
    .lyrics-header {
        display: flex;
    }
}

.lyrics-close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 4px;
}

.lyrics-title {
    font-size: 16px;
    font-weight: 600;
    color: white;
    margin: 0;
}

.lyrics-help-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 4px;
}

.lyrics-swipe-container {
    display: flex;
    flex: 1;
    overflow: hidden;
    position: relative;
}

.lyrics-view-image {
    flex-shrink: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    transition: transform 0.3s ease-out;
}

.lyrics-view-image.swiped {
    transform: translateX(-100%);
}

.lyrics-album-art {
    width: 280px;
    height: 280px;
    border-radius: 12px;
    object-fit: cover;
    margin-bottom: 30px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

.lyrics-album-info {
    text-align: center;
}

.lyrics-album-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin: 0 0 8px 0;
}

.lyrics-album-artist {
    font-size: 14px;
    color: var(--text-muted);
    margin: 0;
}

.lyrics-swipe-hint {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 20px;
    text-align: center;
}

.lyrics-view-text {
    flex-shrink: 0;
    width: 100%;
    padding: 40px 20px;
    overflow-y: auto;
    transform: translateX(100%);
    transition: transform 0.3s ease-out;
}

.lyrics-view-text.swiped {
    transform: translateX(0);
}

.lyrics-text {
    font-size: 16px;
    line-height: 1.8;
    color: var(--text);
}

.lyrics-line {
    padding: 12px 0;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 4px;
    color: var(--text-muted);
}

.lyrics-line:hover {
    color: var(--text);
    background: rgba(255, 255, 255, 0.05);
}

.lyrics-line.active {
    color: var(--primary);
    font-weight: 700;
    font-size: 18px;
    background: rgba(var(--primary-rgb), 0.1);
    padding: 16px 12px;
    margin: 0 -12px;
}

.lyrics-word {
    display: inline;
    margin-right: 0.2em;
    transition: all 0.2s ease;
}

.lyrics-word.active {
    color: var(--primary);
    font-weight: 700;
    text-shadow: 0 0 8px rgba(var(--primary-rgb), 0.5);
}

.lyrics-help-tooltip {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    max-width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    z-index: 30000;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    display: none;
}

.lyrics-help-tooltip.active {
    display: block;
}

.lyrics-help-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 29998;
    display: none;
}

.lyrics-help-overlay.active {
    display: block;
}

.lyrics-help-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin: 0 0 16px 0;
}

.lyrics-help-item {
    margin-bottom: 20px;
}

.lyrics-help-item-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin: 0 0 8px 0;
}

.lyrics-help-item-desc {
    font-size: 13px;
    color: var(--text-muted);
    margin: 0;
    line-height: 1.6;
}

.lyrics-help-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: none;
    border: none;
    color: var(--text);
    font-size: 24px;
    cursor: pointer;
    padding: 4px;
}

/* --- LYRICS SYNC CONTROLS --- */
.lyrics-sync-panel {
    padding: 16px;
    background: rgba(255, 255, 255, 0.05);
    border-bottom: 2px solid var(--primary);
    border-radius: 8px;
    margin-bottom: 16px;
}

.lyrics-sync-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 13px;
}

.lyrics-sync-title {
    font-weight: 600;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 6px;
}

.lyrics-offset-display {
    background: rgba(var(--primary-rgb), 0.2);
    border: 1px solid var(--primary);
    border-radius: 4px;
    padding: 4px 8px;
    color: var(--primary);
    font-weight: 600;
    font-size: 12px;
    min-width: 70px;
    text-align: center;
}

.lyrics-sync-button-group {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    margin-top: 12px;
}

.lyrics-sync-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid var(--border);
    color: var(--text);
    padding: 10px 8px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.lyrics-sync-btn:hover {
    background: rgba(var(--primary-rgb), 0.2);
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-2px);
}

.lyrics-sync-btn.reset {
    grid-column: 3;
}

.lyrics-sync-btn-value {
    font-size: 11px;
    opacity: 0.8;
}

.lyrics-sync-hint {
    text-align: center;
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 8px;
    line-height: 1.4;
}

.lyrics-sync-toggle {
    background: rgba(var(--primary-rgb), 0.15);
    border: 1px solid var(--primary);
    color: var(--primary);
    padding: 4px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 11px;
    font-weight: 600;
    transition: all 0.2s ease;
}

.lyrics-sync-toggle:hover {
    background: rgba(var(--primary-rgb), 0.25);
}


/* Tablet & Mobile */
@media (max-width: 1024px) {
    .overlay-desktop-album {
        display: none !important;
    }
    
    .overlay-lyrics-section {
        flex: 1 !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        padding: 20px !important;
    }
    
    #overlay-lyrics-container {
        width: 100% !important;
        background: rgba(0, 0, 0, 0.3) !important;
        backdrop-filter: blur(20px) !important;
        border-radius: 20px !important;
        padding: 0 !important;
    }
    
    #overlay-lyrics-content {
        padding: 40px 24px !important;
        font-size: 20px !important;
        line-height: 1.5 !important;
        max-height: 50vh !important;
    }
    
    #overlay-lyrics-content .lyrics-line {
        font-size: 20px !important;
        padding: 10px 0 !important;
    }
    
    #overlay-lyrics-content .lyrics-line.active,
    #overlay-lyrics-content .lyrics-line.current-line {
        font-size: 24px !important;
    }
}
    
/* ============================================ */
/* NEW CLEAN LYRICS OVERLAY - NO CONFLICTS     */
/* ============================================ */

/* Main overlay container */
#new-lyrics-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 60000;
    display: flex;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

#new-lyrics-overlay.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
}

/* Background blur */
.new-overlay-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    filter: blur(60px) brightness(0.3);
    z-index: -1;
    transform: scale(1.2);
}

/* Main content container - DESKTOP */
.new-overlay-content {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: row;
    gap: 60px;
    padding: 60px 80px;
    position: relative;
}

/* LEFT PANEL - 280px */
.new-left-panel {
    flex: 0 0 280px;
    width: 280px;
    display: none !important; /* Hidden by default */
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 24px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.new-left-panel.visible {
    display: flex !important;
    opacity: 1;
}

/* Album Art */
.new-album-art {
    width: 280px;
    height: 280px;
    border-radius: 20px;
    box-shadow: 0 24px 60px rgba(0,0,0,0.7);
    object-fit: cover;
    margin-bottom: 8px;
}

/* Song Info */
.new-song-info {
    text-align: center;
    width: 100%;
    margin-bottom: 16px;
}

.new-song-title {
    font-size: 18px;
    font-weight: 700;
    color: white;
    margin-bottom: 8px;
    line-height: 1.2;
}

.new-song-artist {
    font-size: 14px;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
}

.new-song-artist:hover {
    text-decoration: underline;
}

/* Progress Bar */
.new-progress-container {
    width: 100%;
    margin-bottom: 8px;
    display: none !important; /* Hidden by default - FORCED */
    opacity: 0 !important;
    transition: opacity 0.3s ease;
}

.new-progress-container.visible {
    display: block !important;
    opacity: 1 !important;
}

.new-progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.2);
    border-radius: 2px;
    cursor: pointer;
    overflow: hidden;
    transition: height 0.2s ease;
}

.new-progress-bar:hover {
    height: 6px;
}

.new-progress-bar:active {
    height: 8px;
}

.new-progress-bar.dragging {
    height: 8px;
}

.new-progress-fill {
    height: 100%;
    background: white;
    border-radius: 2px;
    width: 0%;
    transition: width 0.1s linear;
    pointer-events: none;
    position: relative;
}

.new-progress-bar.dragging .new-progress-fill {
    transition: none;
}

.new-progress-fill::after {
    content: '';
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.new-progress-bar:hover .new-progress-fill::after,
.new-progress-bar.dragging .new-progress-fill::after {
    opacity: 1;
}

.new-time-display {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: rgba(255,255,255,0.6);
    margin-top: 6px;
}

/* Controls */
.new-controls {
    width: 100%;
    display: none !important; /* Hidden by default - FORCED */
    justify-content: center;
    align-items: center;
    gap: 16px;
    opacity: 0 !important;
    transition: opacity 0.3s ease;
}

.new-controls.visible {
    display: flex !important;
    opacity: 1 !important;
}

.new-control-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 6px;
    opacity: 0.7;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.new-control-btn:hover {
    opacity: 1;
    transform: scale(1.1);
}

.new-control-btn.active {
    color: var(--primary-red);
    opacity: 1;
}

.new-play-btn {
    width: 56px;
    height: 56px;
    background: white;
    color: black;
    border-radius: 50%;
    font-size: 28px;
    opacity: 1 !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    margin: 0 8px;
}

.new-play-btn:hover {
    transform: scale(1.05);
}

.new-play-btn:active {
    transform: scale(0.95);
}

.new-play-btn i {
    transition: all 0.2s ease;
}

/* RIGHT PANEL - Lyrics */
.new-right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-width: 0;
    position: relative;
}

/* Lyrics Container */
.new-lyrics-container {
    width: 100%;
    max-width: 1000px;
    height: 70vh;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Fade gradients */
.new-lyrics-container::before {
    display: none;
}

.new-lyrics-container::after {
    display: none;
}

/* Lyrics scrollable content */
/* Lyrics scrollable content */
.new-lyrics-content {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;
    padding: 120px 100px;
    text-align: center;
    position: relative;
    z-index: 1;
    scrollbar-width: none;
    -ms-overflow-style: none;
    -webkit-overflow-scrolling: touch;
}

.new-lyrics-content::-webkit-scrollbar {
    display: none;
}

/* Lyrics line */
.new-lyrics-line {
    font-size: 48px;
    font-weight: 600;
    line-height: 1.4;
    color: rgba(255,255,255,0.85);
    padding: 12px 0;
    margin: 0;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    letter-spacing: -0.5px;
}

.new-lyrics-line:hover {
    color: rgba(255,255,255,0.95);
}

/* Current/Active line with GLOW */
.new-lyrics-line.current {
    color: #ffffff !important;
    font-weight: 700 !important;
    text-shadow: 
        0 0 20px rgba(255,255,255,0.8),
        0 0 40px rgba(255,255,255,0.6),
        0 0 60px rgba(255,255,255,0.4),
        0 0 80px rgba(229,9,20,0.3);
    transform: scale(1.05);
}

/* Close button */
.new-close-btn {
    position: absolute;
    top: 30px;
    right: 30px;
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    z-index: 100;
}

.new-close-btn:hover {
    background: rgba(255,255,255,0.2);
}

/* Mobile responsive */
@media (max-width: 1024px) {
    .new-overlay-content {
        flex-direction: column;
        gap: 40px;
        padding: 40px 20px;
    }
    
    .new-left-panel {
        flex: 0 0 auto;
        width: 100%;
        gap: 20px;
    }
    
    .new-album-art {
        width: 120px;
        height: 120px;
        margin-bottom: 12px;
    }
    
    .new-song-info {
        margin-bottom: 12px;
    }
    
    .new-song-title {
        font-size: 16px;
        margin-bottom: 4px;
    }
    
    .new-song-artist {
        font-size: 13px;
    }
    
    .new-lyrics-container {
        height: 60vh; /* Lebih tinggi karena album art lebih kecil */
    }
    
    .new-controls-panel {
        padding: 16px 20px;
    }
    
    .new-controls-panel button {
        width: 36px;
        height: 36px;
        font-size: 18px;
    }
    
    .new-play-btn {
        width: 48px !important;
        height: 48px !important;
        font-size: 24px !important;
    }
    
    .new-lyrics-content {
        padding: 60px 30px; /* Kurangi padding agar lebih banyak lirik terlihat */
    }
    
    .new-lyrics-line {
        font-size: 26px; /* Sedikit lebih kecil */
        margin-bottom: 20px; /* Kurangi jarak antar baris */
    }
    
    .new-lyrics-line.current {
        font-size: 30px; /* Sedikit lebih kecil */
    }
}

    
/* Lyrics button highlight when lyrics available */
.lyrics-available-indicator {
    position: relative;
}

.lyrics-available-indicator::after {
    content: '';
    position: absolute;
    top: -2px;
    right: -2px;
    width: 8px;
    height: 8px;
    background: #00ff00;
    border-radius: 50%;
    box-shadow: 0 0 6px #00ff00;
    animation: pulse-green 2s infinite;
}

@keyframes pulse-green {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

    
        /* Show share button on card hover */
        .song-card:hover .card-share-btn {
            display: flex !important;
        }
        
        .card-share-btn:hover {
            background: rgba(0,0,0,0.9) !important;
            transform: scale(1.1);
        }

        /* Offline Mode Indicator - Responsive */
        #offline-mode-indicator {
            display: none;
            position: fixed;
            top: 15px;
            right: 80px;
            background: rgba(255, 152, 0, 0.15);
            border: 1px solid rgba(255, 152, 0, 0.4);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 600;
            color: #ff9800;
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            gap: 6px;
        }
        
        @media (max-width: 768px) {
            #offline-mode-indicator {
                top: 10px;
                right: 60px;
                padding: 4px 10px;
                font-size: 11px;
            }
            
            #offline-mode-indicator span {
                display: none; /* Hide text on mobile, show icon only */
            }
        }
        
        /* Offline song dimming */
        .song-row.offline-unavailable {
            opacity: 0.4 !important;
            pointer-events: none !important;
            filter: grayscale(1) !important;
        }

</style>

    <script>

// ===== LYRICS DATA AND FUNCTIONS (Moved to top for proper loading order) =====
// ===== LYRICS DATA FOR PERUNGGU =====
const songLyrics = {
    31: {  // 33x
        title: "33x",
        artist: "Perunggu",
        lyrics: `[00:19.89] Risalah terikatnya
[00:24.56] Batin dan raga yang mengunci
[00:29.36] Diatas Sang Maha Daya
[00:33.24] Semua kendali terambil alih
[00:38.82] Jikalau kau keluhkan
[00:43.58] Dengung sumbang yang mengganggu
[00:48.31] Buka lagi visimu
[00:52.22] Kau tahu mana urutan satu
[00:58.95] Diantara pusaran nirfungsi
[01:06.54] Petakan semua lagi
[01:11.02] Titik tuju yang t'lah terpatri
[01:17.66] Melamban bukanlah hal yang tabu
[01:25.38] Kadang itu yang kau butuh
[01:30.34] Bersandar hibahkan bebanmu
[01:35.56] Rotasikan pandanganmu
[01:40.35] Ambil sudut yang terbaru
[01:45.19] Belum pernah kau coba
[01:48.83] Lihat semua bukan dari matamu
[01:54.67] Kelak kau kan mengingat
[01:59.37] Yang membawamu kesini
[02:04.16] Kami pernah disitu
[02:07.77] Di posisimu
[02:10.41] Helakan kesahmu
[02:19.48] Diantara pusaran nirfungsi
[02:27.04] Petakan semua lagi
[02:31.51] Titik tuju yang t'lah terpatri
[02:38.48] Melamban bukanlah hal yang tabu
[02:46.15] Kadang itu yang kau butuh
[02:50.63] Bersandar hibahkan bebanmu
[02:57.51] Tak perlu kau berhenti kurasi
[03:04.95] Ini hanya sementara
[03:09.61] Bukan ujung dari rencana
[03:16.37] Jalanmu kan sepanjang niatmu
[03:23.72] Simpan tegar dalam hati
[03:28.57] Dua sembilan kau terus mencari
[04:11.48] Sebutlah namaNya
[04:15.10] Tetap di jalanNya
[04:20.38] Kelak kau mengingat
[04:25.40] Kau akan teringat
[04:30.43] Sebutlah namaNya
[04:34.81] Tetap di jalanNya
[04:39.31] Kelak kau mengingat
[04:44.09] Kau akan teringat
[04:49.00] Sebutlah namaNya
[04:53.85] Tetap di jalanNya
[04:58.35] Kelak kau mengingat
[05:03.15] Kau akan teringat
[05:08.16] Sebutkanlah namaNya
[05:12.88] Resapilah jalanNya
[05:17.32] Kelak kau mengingat
[05:21.83] Kau akan teringat
[05:48.04] Terus berenang
[05:52.79] Lanjutlah mendaki
[06:06.74] Terus berenang
[06:11.81] Lanjutlah mendaki
[06:25.83] Terus berenang
[06:30.63] Lanjutlah mendaki
[06:44.98] Terus berenang
[06:49.48] Lanjutlah mendaki`
    },
    32: {  // Tapi
        title: "Tapi",
        artist: "Perunggu",
        lyrics: `[00:06.85] Besok lusa aku ke Jakarta
[00:14.10] Memulai lagi semuanya di sana
[00:20.18] Kakak bilang siap-siap saja
[00:27.17] Membatin, ku ingin semua batal juga
[00:46.19] Bandung masih memelukku erat
[00:53.15] Sementara ku masih ingin lewat Bubat
[00:59.19] Mungkin untuk terakhir kalinya
[01:06.32] Atau mungkin minggu depan ku pulang saja?
[01:14.15] Tapi
[01:17.86] Dunia boleh saja menahanku
[01:24.02] Atau perlahan bongkar mimpiku
[01:30.76] Dunia boleh saja menahanku
[01:37.26] Kupunya doa Ibu
[02:01.44] Rupanya susah memang yang kucari
[02:08.39] Tak bisa andalkan siapa-siapa lagi
[02:14.35] Selain akal dan hati nurani
[02:21.20] Selain sarapan porsi tukang gali
[02:29.33] Tapi
[02:33.15] Dunia boleh saja menahanku
[02:39.39] Atau perlahan bongkar mimpiku
[02:45.96] Dunia boleh saja melawanku
[02:52.34] Kupunya doa Ibu
[02:58.94] Dunia boleh saja menahanku
[03:05.48] Kupunya doa Ibu
[03:12.16] Dunia boleh saja menahanku
[03:18.45] Kupunya doa Ibu
[03:25.17] Dunia boleh saja melawanku
[03:31.73] Kupunya doa Ibu`
    },
    33: {  // Ini Abadi
        title: "Ini Abadi",
        artist: "Perunggu",
        lyrics: `[00:05.27] Dihentak sunyi
[00:08.73] Geram-gusarmu mulai
[00:14.31] Gerayangi kupingku
[00:19.81] Dibungkam lagi
[00:23.64] Janji yang sumbang itu
[00:29.06] Tak semenarik dulu
[00:34.42] Sejuk wangimu
[00:38.32] Tersisa di sela-sela
[00:44.13] Baju hangatku
[00:49.41] Terakhir kali
[00:53.07] Kita bicarakan semua
[00:58.52] Besok 'kan bagaimana?
[01:04.13] Lihatlah semua sudut itu
[01:11.54] Bandung 'kan selalu memelukmu
[01:18.98] Dinginnya hangatkanmu selalu
[01:26.35] Dilengkapi lapisan selimut
[01:31.99] Yang berupa dekapan nadi yang mengalir
[01:42.84] Menjadi seruan di hati
[01:50.29] Bermuarakan kabar baru
[01:57.87] Tentang mimpi berkecukupan
[02:05.08] Tanpa harus lembur lagi, ke Gambir lagi
[02:16.38] Senin pagi, dilanjut taksi, tenangkanlah
[02:27.30] Ini abadi
[02:34.84] Wo-oh-oh-uh
[02:44.17] Ho-oh-ho-uh (abadi)
[02:49.77] Oh-ho-oh-uh (abadi)
[02:54.46] (Abadi, abadi)
[03:00.72] (Abadi) ho-uh (abadi) ho-ho
[03:09.15] (Abadi, abadi)
[03:16.42] (Abadi) ho-uh (abadi) ho-ho
[03:23.87] (Abadi, abadi)`
    },
    35: {  // Pastikan Riuh Akhiri Malammu
        title: "Pastikan Riuh Akhiri Malammu",
        artist: "Perunggu",
        lyrics: `[00:01.08] Tumbuhlah mendaki
[00:09.65] Seribu upaya 'kan kau nikmati
[00:18.55] Besok hari Senin
[00:27.30] Kutemani senyummu seperti kemarin
[00:36.25] Silih berganti ruang kaupenuhi
[00:44.71] Ku perlu hadir di semua yang kau tangisi
[00:53.49] Panggil aku kapanpun kutemani
[01:02.05] Pastikan riuh akhiri malammu lagi
[01:11.32] Melantunlah semerdu mungkin (melantunlah)
[01:20.23] Merdumu yang buatku pulih (melantunlah)
[01:28.94] Genggam jariku seeratnya (melantunlah)
[01:37.69] Kubuat angin berpihak gerak searah
[02:20.94] Silih berganti ruang kaupenuhi
[02:29.39] Ku perlu hadir di semua yang kau tangisi
[02:38.05] Panggil aku kapanpun kutemani
[02:47.04] Pastikan riuh akhiri malammu lagi
[02:56.10] Melantunlah semerdu mungkin (melantunlah)
[03:05.09] Merdumu yang buatku pulih (melantunlah)
[03:13.46] Genggam jariku seeratnya (melantunlah)
[03:22.45] Kubuat angin berpihak gerak searah
[03:30.92] Melantunlah semerdu mungkin (melantunlah)
[03:39.63] Merdumu yang buatku pulih (melantunlah)
[03:48.66] Genggam jariku seeratnya (melantunlah)
[03:57.46] Kubuat angin berpihak gerak searah`
    },
    38: {  // Menyala
        title: "Menyala",
        artist: "Perunggu",
        lyrics: `[00:05.71] Peran yang tak berbatas benahi
[00:16.58] Rasa kalut mendalam mencabik
[00:25.84] Mulailah hela nafas tabrak titik terang
[00:32.55] Diam lantas lelah kau jadikan teman
[00:39.53] Menahan semua duka sendiri
[00:50.83] Berjabat tangan dengan sang perih
[00:59.47] Mulailah pelan gontai
[01:03.56] Berat langkah mulai
[01:06.17] Paksa bantai dobrak semua halangan
[01:12.12] Merah menyala
[01:17.82] Menyala
[01:20.55] Menyala
[01:23.54] Merah menjelma
[01:29.09] Benderang
[01:31.86] Sinarnya
[01:47.17] Semua yang tlah kau reka kembali
[01:58.52] Pastikan mereka juga mengerti
[02:07.32] Mulailah pelan gontai
[02:11.54] Berat langkah mulai
[02:14.24] Paksa bantai dobrak semua halangan
[02:19.80] Merah menyala
[02:25.42] Menyala
[02:28.33] Menyala
[02:31.24] Merah menjelma
[02:36.81] Benderang
[02:39.60] Sinarnya
[02:42.55] Merah menyala
[02:48.72] Menyala
[02:50.99] Menyala
[02:53.94] Merah menjelma
[02:59.32] Benderang
[03:02.11] Sinar`
    }
};

// Function to get lyrics for a song
window.getSongLyrics = function(songId) {
    console.log('[DEBUG] getSongLyrics called with:', songId, 'Type:', typeof songId);
    console.log('[DATA] Available song IDs:', Object.keys(songLyrics));
    
    // Try both as-is and as number
    let result = songLyrics[songId];
    if (!result && typeof songId === 'string') {
        result = songLyrics[parseInt(songId)];
    }
    
    console.log('[RESULT] Result:', result ? ' Found' : ' Not found');
    return result || null;
};

// Function to parse synced lyrics (LRC format)
function parseLyrics(lrcText) {
    const lines = lrcText.split('\n');
    const parsed = [];
    
    lines.forEach(line => {
        const match = line.match(/\[(\d{2}):(\d{2})\.(\d{2})\]\s*(.+)/);
        if (match) {
            const minutes = parseInt(match[1]);
            const seconds = parseInt(match[2]);
            const centiseconds = parseInt(match[3]);
            const time = minutes * 60 + seconds + centiseconds / 100;
            const text = match[4].trim();
            parsed.push({ time, text });
        }
    });
    
    return parsed.sort((a, b) => a.time - b.time);
}

// Update lyrics display when song changes
function updateLyricsDisplay(songId) {
    console.log('[MUSIC] updateLyricsDisplay called with songId:', songId, 'Type:', typeof songId);
    
    const lyricsData = window.getSongLyrics(songId);
    
    if (!lyricsData) {
        console.log(' No lyrics data found for song ID:', songId);
        // Clear stored lyrics
        window.currentParsedLyrics = null;
        window.currentPerungguLyrics = null;
        return;
    }
    
    console.log('[OK] Loading lyrics for:', lyricsData.title, 'by', lyricsData.artist);
    
    const parsedLyrics = parseLyrics(lyricsData.lyrics);
    
    // Store parsed lyrics for sync (in both formats)
    window.currentParsedLyrics = parsedLyrics;
    window.currentLyricsIndex = 0;
    
    // Also store in a format compatible with renderArtLyricsContent
    window.currentPerungguLyrics = {
        lines: parsedLyrics.map(line => ({
            text: line.text,
            time: line.time
        }))
    };
    
    console.log('[OK] Lyrics stored in memory:', parsedLyrics.length, 'lines');
    console.log('[CACHE] window.currentPerungguLyrics:', window.currentPerungguLyrics);
    
    // If art-lyrics-content exists (overlay is already open), render immediately
    const artLyricsContent = document.getElementById('art-lyrics-content');
    if (artLyricsContent) {
        console.log('[UI] art-lyrics-content found, rendering immediately');
        let html = '';
        parsedLyrics.forEach((line, index) => {
            html += `<div class="lyrics-line" data-time="${line.time}" data-index="${index}">${line.text}</div>`;
        });
        artLyricsContent.innerHTML = html;
    } else {
        console.log('[WAIT] art-lyrics-content not found yet, will render when overlay opens');
    }
}

// Sync lyrics with audio playback
function syncLyrics() {
    const audio = document.getElementById('audio-player');
    if (!window.currentParsedLyrics || !audio) return;
    
    const currentTime = audio.currentTime;
    const lyrics = window.currentParsedLyrics;
    
    // Find current line
    let currentIndex = 0;
    for (let i = 0; i < lyrics.length; i++) {
        if (currentTime >= lyrics[i].time) {
            currentIndex = i;
        } else {
            break;
        }
    }
    
    // Update only if index changed
    if (currentIndex !== window.currentLyricsIndex) {
        window.currentLyricsIndex = currentIndex;
        
        // Remove all current-line classes
        document.querySelectorAll('.lyrics-line.current-line').forEach(el => {
            el.classList.remove('current-line');
        });
        
        // Add current-line class to active line
        const currentLines = document.querySelectorAll(`.lyrics-line[data-index="${currentIndex}"]`);
        currentLines.forEach(line => {
            line.classList.add('current-line');
            
            // Auto scroll to current line
            if (line.parentElement) {
                const container = line.parentElement;
                const lineTop = line.offsetTop;
                const lineHeight = line.offsetHeight;
                const containerHeight = container.offsetHeight;
                const scrollTo = lineTop - (containerHeight / 2) + (lineHeight / 2);
                
                container.scrollTo({
                    top: scrollTo,
                    behavior: 'smooth'
                });
            }
        });
    }
}

// Initialize lyrics system
function initLyricsSystem() {
    // Listen to audio timeupdate for syncing
    const audio = document.getElementById('audio-player');
    if (audio) {
        audio.addEventListener('timeupdate', syncLyrics);
    }
    
    console.log('[OK] Lyrics system initialized for Perunggu songs');
}

// Call init when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLyricsSystem);
} else {
    initLyricsSystem();
}

console.log('[OK] Perunggu lyrics loaded:', Object.keys(songLyrics).length, 'songs');

// ===== END LYRICS SECTION =====

        // Dropdown mobile: selalu muncul di atas playbar, dan visible
        function adjustDropdownPosition(e) {
            var allMenus = document.querySelectorAll('.song-menu-dropdown');
            allMenus.forEach(function(menu) {
                menu.classList.remove('higher-mobile');
                if(window.innerWidth <= 600 && menu.style.display !== 'none') {
                    menu.style.display = 'block';
                    menu.style.opacity = '1';
                }
            });
            if(window.innerWidth <= 600 && e && e.target && e.target.closest && e.target.closest('.song-menu-btn')) {
                var btn = e.target.closest('.song-menu-btn');
                var rect = btn.getBoundingClientRect();
                if(rect.bottom > window.innerHeight - 220) {
                    setTimeout(function() {
                        var openMenu = btn.parentElement.querySelector('.song-menu-dropdown');
                        if(openMenu && openMenu.style.display !== 'none') {
                            openMenu.classList.add('higher-mobile');
                        }
                    }, 50);
                }
            }
        }
        document.addEventListener('click', adjustDropdownPosition, true);
        window.addEventListener('resize', function(){
            var allMenus = document.querySelectorAll('.song-menu-dropdown');
            allMenus.forEach(function(menu) {
                menu.classList.remove('higher-mobile');
                if(window.innerWidth <= 600 && menu.style.display !== 'none') {
                    menu.style.display = 'block';
                    menu.style.opacity = '1';
                }
            });
        });
    </script>

</head>
<body>
    <!-- Offline Mode Indicator -->
    <div id="offline-mode-indicator">
        <i class="ph-fill ph-wifi-slash"></i>
        <span>Offline Mode</span>
    </div>


    <!-- 1. LOADING SCREEN -->
    <div id="loading-screen">
        <div class="loading-center">
            <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/assets/logo.png" alt="VIDJE" class="app-logo centered-logo">
            <div class="loading-title">VIDJE</div>
        </div>
        
        <!-- Offline Notice -->
        <div class="loading-offline-notice" id="loading-offline-notice">
            <i class="ph-fill ph-wifi-slash"></i>
            <div class="notice-text">
                <div class="notice-title">Mode Offline</div>
                <div class="notice-subtitle">Koneksi tidak tersedia</div>
            </div>
        </div>
    </div>

    <!-- 2. AUTH VIEW -->
    <div id="auth-view" style="display: none;">
        <div class="auth-container">
            <div class="auth-box" id="login-box">
                <div class="auth-logo"><i class="ph-fill ph-play-circle"></i></div>
                <h2 data-i18n="login-title"></h2>
                <p data-i18n="login-subtitle"></p>
                <p class="error-msg" id="login-error" data-i18n="login-error-default"></p>
                <input type="email" id="login-email" class="auth-input" placeholder="Email">
                <input type="password" id="login-password" class="auth-input" placeholder="Password">
                <button class="auth-btn" onclick="window.handleLogin()" data-i18n="login-button"></button>
                <div class="auth-switch">
                    <span data-i18n="login-no-account"></span> <span onclick="window.toggleAuthMode('signup')" data-i18n="login-link"></span>
                </div>
            </div>

            <div class="auth-box" id="signup-box" style="display: none;">
                <div class="auth-logo"><i class="ph-fill ph-user-plus"></i></div>
                <h2 data-i18n="signup-title"></h2>
                <p data-i18n="signup-subtitle"></p>
                <p class="error-msg" id="signup-error" data-i18n="signup-error-default"></p>
                <input type="text" id="signup-name" class="auth-input" placeholder="Nama Lengkap" data-i18n-placeholder="signup-fullname">
                <input type="email" id="signup-email" class="auth-input" placeholder="Email">
                <input type="password" id="signup-password" class="auth-input" placeholder="Password">
                <button class="auth-btn" onclick="window.handleSignup()" data-i18n="signup-button"></button>
                <div class="auth-switch">
                    <span data-i18n="signup-have-account"></span> <span onclick="window.toggleAuthMode('login')" data-i18n="signup-link"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. APP WRAPPER -->
    <div class="app-wrapper" id="app-wrapper" style="display: none;">
        
        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="window.toggleSidebar()"></div>

        <div class="container">
            <!-- Sidebar -->
            <nav class="sidebar" id="sidebar">
                <div class="logo" onclick="window.switchView('home')">
                    <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/assets/logo.png" alt="VIDJE" class="app-logo">
                    <span style="font-family: 'Montserrat', sans-serif; font-weight:700; ">VIDJE</span>
                </div>
                
                <ul class="nav-links">
                    <li><a href="#" onclick="window.switchView('home')" id="nav-home" class="nav-item active"><i class="ph ph-house"></i><span data-i18n="nav-home">Home</span></a></li>
                    <li><a href="#" onclick="window.switchView('search')" id="nav-search" class="nav-item"><i class="ph ph-magnifying-glass"></i><span data-i18n="nav-search">Search</span></a></li>
                    <li><a href="#" onclick="window.switchView('liked')" id="nav-liked" class="nav-item"><i class="ph ph-heart"></i><span data-i18n="nav-liked">Liked Songs</span></a></li>
                </ul>

                <div class="divider"></div>

                <div class="playlist-scroll">
                    <div class="playlist-title" data-i18n="playlist-title">Your Playlists</div>
                    
                    <div class="create-playlist-btn" onclick="window.openCreatePlaylistModal()">
                        <i class="ph ph-plus-square" style="font-size: 24px;"></i>
                        <span data-i18n="create-playlist">Create Playlist</span>
                    </div> 

                    <div class="import-music-btn" onclick="window.openImportMusicModal()">
                        <i class="ph ph-upload-simple" style="font-size: 24px;"></i>
                        <span data-i18n="import-music">Import Music</span>
                    </div>



                    <div id="sidebar-playlists-container" style="margin-top: 10px;"></div>

                    <!-- --- FITUR PERTEMANAN (SIDEBAR) --- -->
                    <div class="friend-section">
                        <div class="playlist-title" data-i18n="sidebar-friends">Friends</div>
                        
                        <div class="friend-search-container">
                            <input type="text" id="friend-search-input" class="friend-search-input" data-i18n-placeholder="search-friends-placeholder" placeholder="Search friends (Name/User ID)..." autocomplete="off">
                            <div id="friend-search-dropdown" class="friend-search-dropdown"></div>
                        </div>

                        <div class="playlist-title" style="font-size: 10px; margin-top: 10px;" data-i18n="friend-requests"></div>
                        <div id="friend-requests-container" style="margin-bottom: 10px;"></div>

                        <div class="playlist-title" style="font-size: 10px; margin-top: 10px;" data-i18n="friend-list"></div>
                        <div id="friend-list-container"></div>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="main-content">
                <header>
                    <div class="header-left">
                        <button class="mobile-menu-toggle" onclick="window.toggleSidebar()">
                            <i class="ph ph-list"></i>
                        </button>
                    </div>
                    <div class="user-menu" onclick="window.switchView('profile')">
                        <img src="https://picsum.photos/seed/user123/50/50" alt="User Avatar" id="header-avatar">
                        <span id="header-username">Rizky</span>
                        <i class="ph ph-caret-down" style="font-size: 12px;"></i>
                    </div>
                </header>

                <div class="content-padding">
                    <!-- VIEW: BERANDA (HOME) -->
                    <div id="view-home" class="view-section active">


                        <!-- SEDANG TREN -->
                        <h2 data-i18n="my-playlists-section">Playlist Saya</h2>
                        <div class="card-grid" id="trending-container"></div>

                        <!-- BAND POPULER INDONESIA -->
                        <h2 data-i18n="popular-indonesian-bands">Band Populer Indonesia</h2>
                        <div class="card-grid" id="popular-bands-container"></div>
                        <div class="card-grid" id="indonesian-bands-extra" style="display:none;"></div>
                        <div class="card-grid" id="indonesian-bands-extra-container"></div>

                        <!-- PENYANYI POPULER INDONESIA -->
                        <h2 data-i18n="popular-indonesian-artists">Penyanyi Populer Indonesia</h2>
                        <div class="card-grid" id="popular-artists-container"></div>
                        <div class="card-grid" id="indonesian-artists-extra-container"></div>

                        <!-- NEW: PENYANYI ASING POPULER -->
                        <h2 data-i18n="popular-foreign-artists">Penyanyi Asing Populer</h2>
                        <div class="card-grid" id="foreign-solo-container"></div>
                        <div class="card-grid" id="foreign-solo-extra" style="display:none;"></div>
                        <div class="card-grid" id="foreign-solo-extra-container"></div>

                        <!-- NEW: BAND ASING POPULER -->
                        <h2 data-i18n="popular-foreign-bands">Band Asing Populer</h2>
                        <div class="card-grid" id="foreign-bands-container"></div>
                        <div class="card-grid" id="foreign-bands-extra" style="display:none;"></div>
                        <div class="card-grid" id="foreign-bands-extra-container"></div>

                        <br><br><br>
                    </div>

                   <!-- VIEW: CARI (SEARCH) -->
<div id="view-search" class="view-section">
    <div class="search-container">
        <i class="ph ph-magnifying-glass search-icon-placeholder"></i>
        <input type="text" class="search-input" id="search-input" placeholder="Search songs, artists, playlists..." data-i18n-placeholder="search" oninput="window.handleSearch(this.value)">
    </div>

    <!-- Search Results Wrapper (Hidden by default, shown when typing) -->
    <div id="search-results-wrapper">
        <h3 class="results-section-title" data-i18n="search-results">Hasil Pencarian</h3>
        <!-- Bands/Artists Grid -->
        <div id="search-bands-container" class="card-grid" style="margin-bottom: 30px;"></div>

        <!-- Public Playlists Grid -->
        <h3 id="search-playlists-title" style="display:none; margin-bottom: 10px; font-size: 18px; font-weight: 700;" data-i18n="public-playlists">Playlist Publik</h3>
        <div id="search-playlists-container" class="card-grid" style="margin-bottom: 30px;"></div>
        
        <!-- Songs List -->
        <div id="search-songs-container"></div>
    </div>

    <!-- History Wrapper (Visible by default, hidden when typing) -->
    <div id="search-history-wrapper">
        <h3 class="history-section-title" id="search-history-title" data-i18n="recently-played"></h3>
        <div id="search-history-container"></div>
    </div>
</div>




<div id="view-playlist" class="view-section">
    <div class="playlist-header-view" id="playlist-header-bg" style="position: relative;">
        <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
            <i class="ph ph-arrow-left"></i>
        </button>
        <div class="playlist-cover-wrap">
            <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=300&q=80" class="playlist-cover-big playlist-cover-filtered" id="playlist-cover-view" onerror="this.src='https://picsum.photos/seed/vidje/300/300'">
            <button class="edit-cover-btn" onclick="document.getElementById('playlist-cover-input').click()">
                <i class="ph-fill ph-camera"></i>
            </button>
            <input type="file" id="playlist-cover-input" style="display: none;" accept="image/*" onchange="window.handlePlaylistCoverUpload(this)">
        </div>
        <div class="playlist-info-big">
            <span>PLAYLIST</span>
            <h1 id="playlist-title-view">Playlist Saya</h1>
            <div class="playlist-meta">
                <span style="color: white;" id="playlist-owner-display">Owner</span>  <span id="playlist-count">0 lagu</span>
            </div>
            <div class="playlist-buttons-container">
                <button class="action-play-btn" onclick="window.playFirstSongOfPlaylist()" title="Mainkan">
                    <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                </button>
                <button class="share-btn-album" onclick="window.shareCurrentPlaylist()" title="Bagikan Playlist">
                    <i class="ph ph-share-network" style="font-size: 24px;"></i>
                </button>
                <!-- Download offline button removed -->
            </div>
        </div>
    </div>

    


<!-- Tambahkan Modal Pengaturan Playlist (sebelum closing body tag) -->
<div id="playlist-settings-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-i18n="playlist-settings">Pengaturan Playlist</div>
            <button class="close-modal-btn" onclick="window.closeModal('playlist-settings-modal')">
                <i class="ph ph-x"></i>
            </button>
        </div>
        
        <div style="margin-bottom: 20px; text-align: center;">
            <div style="position: relative; width: 150px; height: 150px; margin: 0 auto 15px auto; cursor: pointer;" onclick="document.getElementById('settings-cover-input').click()">
                <img id="settings-cover-preview" src="" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.6); padding: 8px; border-radius: 0 0 8px 8px; color: white; font-size: 12px;">
                    <i class="ph ph-camera"></i> Ubah Foto
                </div>
            </div>
            <input type="file" id="settings-cover-input" style="display: none;" accept="image/*" onchange="window.handleSettingsCoverUpload(this)">
        </div>
        
        <div style="margin-bottom: 15px;">
            <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase; display: block; margin-bottom: 8px;">Nama Playlist</label>
            <input type="text" id="settings-playlist-name" class="modal-input" placeholder="Nama Playlist">
        </div>
        
        <button class="modal-btn" onclick="window.savePlaylistSettings()">Simpan Perubahan</button>
    </div>
</div>

                        

                        <div style="padding: 0 32px;">
                            <div class="song-list-header">
                                <div>#</div>
                                <div>Judul</div>
                                <div>Album</div>
                                <div><i class="ph ph-clock"></i></div>
                                <div></div>
                            </div>
                            <div id="playlist-songs-container"></div>
                        </div>
                        <br><br><br>
                    </div>

                    <!-- --- LOCAL ALBUMS (GHANI, REVAN, HANUNG, RARA) --- -->

                    <!-- VIEW: DETAIL ALBUM (GHANI'S ALBUM) -->
                    <div id="view-ghani-album" class="view-section">
                        <div class="playlist-header-view" id="ghani-header-bg" style="position: relative;">
                            <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ghani.jpg" class="playlist-cover-big" id="ghani-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ALBUM</span>
                                <h1 id="ghani-title-view">Ghani's Album</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Vidje Originals</span>  <span id="ghani-count">10 lagu</span>
                                </div>
                                <div class="playlist-buttons-container">
                                    <button class="action-play-btn" onclick="window.playFirstSongOfGhani()" title="Mainkan">
                                        <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                                    </button>
                                    <button class="share-btn-album" onclick="window.shareAlbum('Ghani Album', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ghani.jpg')" title="Bagikan Album">
                                        <i class="ph ph-share-network" style="font-size: 24px;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div style="padding: 0 32px;">
                            <div class="song-list-header">
                                <div>#</div>
                                <div>Judul</div>
                                <div>Album</div>
                                <div><i class="ph ph-clock"></i></div>
                                <div></div>
                            </div>
                            <div id="ghani-songs-container"></div>
                        </div>
                        <br><br><br>
                    </div>

                    <!-- VIEW: DETAIL ALBUM (REVAN'S ALBUM) -->
                    <div id="view-revan-album" class="view-section">
                        <div class="playlist-header-view" id="revan-header-bg" style="position: relative;">
                            <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/revan.jpg" class="playlist-cover-big" id="revan-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ALBUM</span>
                                <h1 id="revan-title-view">Revan's Album</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Vidje Originals</span>  <span id="revan-count">10 lagu</span>
                                </div>
                                <div class="playlist-buttons-container">
                                    <button class="action-play-btn" onclick="window.playFirstSongOfRevan()" title="Mainkan">
                                        <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                                    </button>
                                    <button class="share-btn-album" onclick="window.shareAlbum('Revan Album', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/revan.jpg')" title="Bagikan Album">
                                        <i class="ph ph-share-network" style="font-size: 24px;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        
                        <div style="padding: 0 32px;">
                            <div class="song-list-header">
                                <div>#</div>
                                <div>Judul</div>
                                <div>Album</div>
                                <div><i class="ph ph-clock"></i></div>
                                <div></div>
                            </div>
                            <div id="revan-songs-container"></div>
                        </div>
                        <br><br><br>
                    </div>

                    <!-- 3. DEWA 19 -->
                    <div id="view-dewa-album" class="view-section">
                        <div class="playlist-header-view" id="dewa-header-bg" style="position: relative;">
                            <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            <div class="playlist-cover-wrap" style="position: relative;">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png" class="playlist-cover-big" id="dewa-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="dewa-title-view">Dewa 19</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Populer Indonesia</span>  <span id="dewa-count">12 lagu</span>
                                </div>
                                <div class="playlist-buttons-container">
                                    <button class="action-play-btn" onclick="window.playFirstSongOfDewa()" title="Mainkan">
                                        <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                                    </button>
                                    <button class="share-btn-album" onclick="window.shareAlbum('Dewa 19', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png')" title="Bagikan Album">
                                        <i class="ph ph-share-network" style="font-size: 24px;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="dewa-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Hanung & Rara -->
                    <div id="view-hanung-album" class="view-section">
                        <div class="playlist-header-view" id="hanung-header-bg" style="position: relative;">
                            <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hanung.jpg" class="playlist-cover-big" id="hanung-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ALBUM</span>
                                <h1 id="hanung-title-view">Hanung's Album</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Vidje Originals</span>  <span id="hanung-count">6 lagu</span>
                                </div>
                                <div class="playlist-buttons-container">
                                    <button class="action-play-btn" onclick="window.playFirstSongOfHanung()" title="Mainkan">
                                        <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                                    </button>
                                    <button class="share-btn-album" onclick="window.shareAlbum('Hanung Album', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hanung.jpg')" title="Bagikan Album">
                                        <i class="ph ph-share-network" style="font-size: 24px;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="padding: 0 32px;">
                            <div class="song-list-header">
                                <div>#</div>
                                <div>Judul</div>
                                <div>Album</div>
                                <div><i class="ph ph-clock"></i></div>
                                <div></div>
                            </div>
                            <div id="hanung-songs-container"></div>
                        </div>
                        <br><br><br>
                    </div>

                    <div id="view-rara-album" class="view-section">
                        <div class="playlist-header-view" id="rara-header-bg" style="position: relative;">
                            <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/rara.jpg" class="playlist-cover-big" id="rara-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ALBUM</span>
                                <h1 id="rara-title-view">Rara's Album</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Vidje Originals</span>  <span id="rara-count">5 lagu</span>
                                </div>
                                <div class="playlist-buttons-container">
                                    <button class="action-play-btn" onclick="window.playFirstSongOfRara()" title="Mainkan">
                                        <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                                    </button>
                                    <button class="share-btn-album" onclick="window.shareAlbum('Rara Album', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/rara.jpg')" title="Bagikan Album">
                                        <i class="ph ph-share-network" style="font-size: 24px;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="padding: 0 32px;">
                            <div class="song-list-header">
                                <div>#</div>
                                <div>Judul</div>
                                <div>Album</div>
                                <div><i class="ph ph-clock"></i></div>
                                <div></div>
                            </div>
                            <div id="rara-songs-container"></div>
                        </div>
                        <br><br><br>
                    </div>

                    <!-- Arctic Monkeys -->
                    <div id="view-arctic-album" class="view-section">
                        <div class="playlist-header-view" id="arctic-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/articmonkeys.jpg" class="playlist-cover-big" id="arctic-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="arctic-title-view">Arctic Monkeys</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="arctic-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="arctic-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Queen -->
                    <div id="view-queen-album" class="view-section">
                        <div class="playlist-header-view" id="queen-header-bg" style="position: relative;">
                            <button class="back-button" onclick="window.goBack()" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap" style="position: relative;"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/queen.jpg" class="playlist-cover-big" id="queen-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="queen-title-view">Queen</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="queen-count">10 lagu</span></div><div class="playlist-buttons-container"><button class="action-play-btn" onclick="window.playFirstSongOfQueen()" title="Mainkan"><i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i></button><button class="share-btn-album" onclick="window.shareAlbum('Queen', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/queen.jpg')" title="Bagikan Album"><i class="ph ph-share-network" style="font-size: 24px;"></i></button></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="queen-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- The Stone Roses -->
                    <div id="view-stoneroses-album" class="view-section">
                        <div class="playlist-header-view" id="stoneroses-header-bg" style="position: relative;">
                            <button class="back-button" onclick="window.goBack()" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap" style="position: relative;"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thestoneroses.jpg" class="playlist-cover-big" id="stoneroses-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="stoneroses-title-view">The Stone Roses</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="stoneroses-count">10 lagu</span></div><div class="playlist-buttons-container"><button class="action-play-btn" onclick="window.playFirstSongOfStoneRoses()" title="Mainkan"><i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i></button><button class="share-btn-album" onclick="window.shareAlbum('The Stone Roses', 'https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thestoneroses.jpg')" title="Bagikan Album"><i class="ph ph-share-network" style="font-size: 24px;"></i></button></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="stoneroses-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Neck Deep -->
                    <div id="view-neckdeep-album" class="view-section">
                        <div class="playlist-header-view" id="neckdeep-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/neckdeep.jpg" class="playlist-cover-big" id="neckdeep-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="neckdeep-title-view">Neck Deep</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="neckdeep-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="neckdeep-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- My Chemical Romance -->
                    <div id="view-mcr-album" class="view-section">
                        <div class="playlist-header-view" id="mcr-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/chemical.jpg" class="playlist-cover-big" id="mcr-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="mcr-title-view">My Chemical Romance</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="mcr-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="mcr-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Bob Marley -->
                    <div id="view-bobmarley-album" class="view-section">
                        <div class="playlist-header-view" id="bobmarley-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bob.jpg" class="playlist-cover-big" id="bobmarley-cover-view"></div>
                            <div class="playlist-info-big"><span>PENYANYI</span><h1 id="bobmarley-title-view">Bob Marley</h1><div class="playlist-meta"><span style="color: white;">Penyanyi Asing</span>  <span id="bobmarley-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="bobmarley-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Frank Ocean -->
                    <div id="view-frank-album" class="view-section">
                        <div class="playlist-header-view" id="frank-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/frank.jpg" class="playlist-cover-big" id="frank-cover-view"></div>
                            <div class="playlist-info-big"><span>PENYANYI</span><h1 id="frank-title-view">Frank Ocean</h1><div class="playlist-meta"><span style="color: white;">Penyanyi Asing</span>  <span id="frank-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="frank-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Drake -->
                    <div id="view-drake-album" class="view-section">
                        <div class="playlist-header-view" id="drake-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/drake.jpg" class="playlist-cover-big" id="drake-cover-view"></div>
                            <div class="playlist-info-big"><span>PENYANYI</span><h1 id="drake-title-view">Drake</h1><div class="playlist-meta"><span style="color: white;">Penyanyi Asing</span>  <span id="drake-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="drake-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Kendrick Lamar -->
                    <div id="view-kendrick-album" class="view-section">
                        <div class="playlist-header-view" id="kendrick-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kendrick.jpg" class="playlist-cover-big" id="kendrick-cover-view"></div>
                            <div class="playlist-info-big"><span>PENYANYI</span><h1 id="kendrick-title-view">Kendrick Lamar</h1><div class="playlist-meta"><span style="color: white;">Penyanyi Asing</span>  <span id="kendrick-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="kendrick-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- The Weeknd -->
                    <div id="view-weeknd-album" class="view-section">
                        <div class="playlist-header-view" id="weeknd-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/theweekend.jpg" class="playlist-cover-big" id="weeknd-cover-view"></div>
                            <div class="playlist-info-big"><span>PENYANYI</span><h1 id="weeknd-title-view">The Weeknd</h1><div class="playlist-meta"><span style="color: white;">Penyanyi Asing</span>  <span id="weeknd-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="weeknd-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- The 1975 -->
                    <div id="view-the1975-album" class="view-section">
                        <div class="playlist-header-view" id="the1975-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/the1975.jpg" class="playlist-cover-big" id="the1975-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="the1975-title-view">The 1975</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="the1975-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="the1975-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Olivia Rodrigo -->
                    <div id="view-olivia-album" class="view-section">
                        <div class="playlist-header-view" id="olivia-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/olivia.jpg" class="playlist-cover-big" id="olivia-cover-view"></div>
                            <div class="playlist-info-big"><span>PENYANYI</span><h1 id="olivia-title-view">Olivia Rodrigo</h1><div class="playlist-meta"><span style="color: white;">Penyanyi Asing</span>  <span id="olivia-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="olivia-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- The Chainsmokers -->
                    <div id="view-chainsmokers-album" class="view-section">
                        <div class="playlist-header-view" id="chainsmokers-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thechainsmokers.jpg" class="playlist-cover-big" id="chainsmokers-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="chainsmokers-title-view">The Chainsmokers</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="chainsmokers-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="chainsmokers-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Avenged Sevenfold -->
                    <div id="view-avenged-album" class="view-section">
                        <div class="playlist-header-view" id="avenged-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/avenged.jpg" class="playlist-cover-big" id="avenged-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="avenged-title-view">Avenged Sevenfold</h1><div class="playlist-meta"><span style="color: white;">Band Asing</span>  <span id="avenged-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="avenged-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Slank -->
                    <div id="view-slank-album" class="view-section">
                        <div class="playlist-header-view" id="slank-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/slank.jpg" class="playlist-cover-big" id="slank-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="slank-title-view">Slank</h1><div class="playlist-meta"><span style="color: white;">Band Indonesia</span>  <span id="slank-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="slank-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Reality Club -->
                    <div id="view-realityclub-album" class="view-section">
                        <div class="playlist-header-view" id="realityclub-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/realityclub.jpg" class="playlist-cover-big" id="realityclub-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="realityclub-title-view">Reality Club</h1><div class="playlist-meta"><span style="color: white;">Band Indonesia</span>  <span id="realityclub-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="realityclub-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Nidji -->
                    <div id="view-nidji-album" class="view-section">
                        <div class="playlist-header-view" id="nidji-header-bg">
                            <button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button>
                            <div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/nidji.jpg" class="playlist-cover-big" id="nidji-cover-view"></div>
                            <div class="playlist-info-big"><span>BAND</span><h1 id="nidji-title-view">Nidji</h1><div class="playlist-meta"><span style="color: white;">Band Indonesia</span>  <span id="nidji-count">10 lagu</span></div></div>
                        </div>
                        
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="nidji-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- NAYKILLA -->
                    <div id="view-naykilla-album" class="view-section">
                        <div class="playlist-header-view" id="naykilla-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg" class="playlist-cover-big" id="naykilla-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="naykilla-title-view">Naykilla</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="naykilla-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="naykilla-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- BERNADYA -->
                    <div id="view-bernadya-album" class="view-section">
                        <div class="playlist-header-view" id="bernadya-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg" class="playlist-cover-big" id="bernadya-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="bernadya-title-view">Bernadya</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="bernadya-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="bernadya-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- IWAN FALS -->
                    <div id="view-iwanfals-album" class="view-section">
                        <div class="playlist-header-view" id="iwanfals-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg" class="playlist-cover-big" id="iwanfals-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="iwanfals-title-view">Iwan Fals</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="iwanfals-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="iwanfals-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- PAMUNGKAS -->
                    <div id="view-pamungkas-album" class="view-section">
                        <div class="playlist-header-view" id="pamungkas-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg" class="playlist-cover-big" id="pamungkas-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="pamungkas-title-view">Pamungkas</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="pamungkas-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="pamungkas-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- K3BI -->
                    <div id="view-k3bi-album" class="view-section">
                        <div class="playlist-header-view" id="k3bi-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg" class="playlist-cover-big" id="k3bi-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="k3bi-title-view">K3bi</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="k3bi-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="k3bi-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- SAFA -->
                    <div id="view-safa-album" class="view-section">
                        <div class="playlist-header-view" id="safa-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg" class="playlist-cover-big" id="safa-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="safa-title-view">$afa</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="safa-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="safa-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- TUAN 13 -->
                    <div id="view-tuan13-album" class="view-section">
                        <div class="playlist-header-view" id="tuan13-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg" class="playlist-cover-big" id="tuan13-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="tuan13-title-view">Tuantigabelas</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="tuan13-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="tuan13-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- MAUDY -->
                    <div id="view-maudy-album" class="view-section">
                        <div class="playlist-header-view" id="maudy-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg" class="playlist-cover-big" id="maudy-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="maudy-title-view">Maudy Ayunda</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="maudy-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="maudy-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- GLENN -->
                    <div id="view-glenn-album" class="view-section">
                        <div class="playlist-header-view" id="glenn-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg" class="playlist-cover-big" id="glenn-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="glenn-title-view">Glenn Fredly</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="glenn-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="glenn-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- NADIN -->
                    <div id="view-nadin-album" class="view-section">
                        <div class="playlist-header-view" id="nadin-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg" class="playlist-cover-big" id="nadin-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="nadin-title-view">Nadin Amizah</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="nadin-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="nadin-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- SAL PRIADI -->
                    <div id="view-salpriadi-album" class="view-section">
                        <div class="playlist-header-view" id="salpriadi-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg" class="playlist-cover-big" id="salpriadi-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="salpriadi-title-view">Sal Priadi</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="salpriadi-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="salpriadi-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- JUAN REZA -->
                    <div id="view-juanreza-album" class="view-section">
                        <div class="playlist-header-view" id="juanreza-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg" class="playlist-cover-big" id="juanreza-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="juanreza-title-view">Juan Reza</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="juanreza-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="juanreza-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- NIKI -->
                    <div id="view-niki-album" class="view-section">
                        <div class="playlist-header-view" id="niki-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg" class="playlist-cover-big" id="niki-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="niki-title-view">NIKI</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="niki-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="niki-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- FEAST -->
                    <div id="view-feast-album" class="view-section">
                        <div class="playlist-header-view" id="feast-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg" class="playlist-cover-big" id="feast-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="feast-title-view">Feast</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="feast-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="feast-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- THE PANASDALAM BANK -->
                    <div id="view-panasdalam-album" class="view-section">
                        <div class="playlist-header-view" id="panasdalam-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg" class="playlist-cover-big" id="panasdalam-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="panasdalam-title-view">The Panasdalam Bank</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="panasdalam-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="panasdalam-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- LOMBA SIHIR -->
                    <div id="view-lombasihir-album" class="view-section">
                        <div class="playlist-header-view" id="lombasihir-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg" class="playlist-cover-big" id="lombasihir-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="lombasihir-title-view">Lomba Sihir</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="lombasihir-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="lombasihir-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- LAST CHILD -->
                    <div id="view-lastchild-album" class="view-section">
                        <div class="playlist-header-view" id="lastchild-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg" class="playlist-cover-big" id="lastchild-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="lastchild-title-view">Last Child</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="lastchild-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="lastchild-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- FOR REVENGE -->
                    <div id="view-forrevenge-album" class="view-section">
                        <div class="playlist-header-view" id="forrevenge-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg" class="playlist-cover-big" id="forrevenge-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="forrevenge-title-view">For Revenge</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="forrevenge-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="forrevenge-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- YOVIE & NUNO -->
                    <div id="view-yovie-album" class="view-section">
                        <div class="playlist-header-view" id="yovie-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg" class="playlist-cover-big" id="yovie-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="yovie-title-view">Yovie & Nuno</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="yovie-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="yovie-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- VIERRA -->
                    <div id="view-vierra-album" class="view-section">
                        <div class="playlist-header-view" id="vierra-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg" class="playlist-cover-big" id="vierra-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="vierra-title-view">Vierra</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="vierra-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="vierra-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- UTOPIA -->
                    <div id="view-utopia-album" class="view-section">
                        <div class="playlist-header-view" id="utopia-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg" class="playlist-cover-big" id="utopia-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="utopia-title-view">Utopia</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="utopia-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="utopia-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- JUICY LUCY -->
                    <div id="view-juicylucy-album" class="view-section">
                        <div class="playlist-header-view" id="juicylucy-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg" class="playlist-cover-big" id="juicylucy-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="juicylucy-title-view">Juicy Lucy</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="juicylucy-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="juicylucy-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- HIVI! -->
                    <div id="view-hivi-album" class="view-section">
                        <div class="playlist-header-view" id="hivi-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg" class="playlist-cover-big" id="hivi-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="hivi-title-view">HIVI!</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="hivi-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="hivi-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- THE LANTIS -->
                    <div id="view-thelantis-album" class="view-section">
                        <div class="playlist-header-view" id="thelantis-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg" class="playlist-cover-big" id="thelantis-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="thelantis-title-view">The Lantis</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="thelantis-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="thelantis-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- THE CHANGCUTERS -->
                    <div id="view-thechangcuters-album" class="view-section">
                        <div class="playlist-header-view" id="thechangcuters-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg" class="playlist-cover-big" id="thechangcuters-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="thechangcuters-title-view">The Changcuters</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="thechangcuters-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="thechangcuters-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- THE ADAMS -->
                    <div id="view-theadams-album" class="view-section">
                        <div class="playlist-header-view" id="theadams-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg" class="playlist-cover-big" id="theadams-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="theadams-title-view">The Adams</h1><div class="playlist-meta"><span style="color: white;">Indonesia</span>  <span id="theadams-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="theadams-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- AVICII -->
                    <div id="view-avicii-album" class="view-section">
                        <div class="playlist-header-view" id="avicii-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg" class="playlist-cover-big" id="avicii-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="avicii-title-view">Avicii</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="avicii-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="avicii-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- ADELE -->
                    <div id="view-adele-album" class="view-section">
                        <div class="playlist-header-view" id="adele-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg" class="playlist-cover-big" id="adele-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="adele-title-view">Adele</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="adele-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="adele-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- SHAWN MENDES -->
                    <div id="view-shawnmendes-album" class="view-section">
                        <div class="playlist-header-view" id="shawnmendes-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg" class="playlist-cover-big" id="shawnmendes-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="shawnmendes-title-view">Shawn Mendes</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="shawnmendes-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="shawnmendes-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- JAMES ARTHUR -->
                    <div id="view-jamesarthur-album" class="view-section">
                        <div class="playlist-header-view" id="jamesarthur-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg" class="playlist-cover-big" id="jamesarthur-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="jamesarthur-title-view">James Arthur</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="jamesarthur-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="jamesarthur-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- BILLIE EILISH -->
                    <div id="view-billieeilish-album" class="view-section">
                        <div class="playlist-header-view" id="billieeilish-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg" class="playlist-cover-big" id="billieeilish-cover-view"></div><div class="playlist-info-big"><span>PENYANYI</span><h1 id="billieeilish-title-view">Billie Eilish</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="billieeilish-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="billieeilish-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- THE BEATLES -->
                    <div id="view-beatles-album" class="view-section">
                        <div class="playlist-header-view" id="beatles-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg" class="playlist-cover-big" id="beatles-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="beatles-title-view">The Beatles</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="beatles-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="beatles-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- MAROON 5 -->
                    <div id="view-maroon5-album" class="view-section">
                        <div class="playlist-header-view" id="maroon5-header-bg"><button class="back-button" onclick="window.switchView('home')" style="position: absolute; left: 20px; top: 20px; z-index: 100;"><i class="ph ph-arrow-left"></i></button><div class="playlist-cover-wrap"><img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg" class="playlist-cover-big" id="maroon5-cover-view"></div><div class="playlist-info-big"><span>BAND</span><h1 id="maroon5-title-view">Maroon 5</h1><div class="playlist-meta"><span style="color: white;">Asing</span>  <span id="maroon5-count">5 lagu</span></div></div></div><div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="maroon5-songs-container"></div></div><br><br><br>
                    </div>

                    <!-- 1. PERUNGGU -->
                    <div id="view-perunggu-album" class="view-section">
                        <div class="playlist-header-view" id="perunggu-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/perunggu.jpg" class="playlist-cover-big" id="perunggu-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="perunggu-title-view">Perunggu</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Populer Indonesia</span>  <span id="perunggu-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="perunggu-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 2. NOAH / PETERPAN -->
                    <div id="view-noah-album" class="view-section">
                        <div class="playlist-header-view" id="noah-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/noah.jpg" class="playlist-cover-big" id="noah-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="noah-title-view">NOAH</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Populer Indonesia</span>  <span id="noah-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="noah-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 3. SHEILA ON 7 -->
                    <div id="view-sheila-album" class="view-section">
                        <div class="playlist-header-view" id="sheila-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/so7.jpg" class="playlist-cover-big" id="sheila-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="sheila-title-view">Sheila On 7</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Populer Indonesia</span>  <span id="sheila-count">12 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="sheila-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 4. KAHITNA -->
                    <div id="view-kahitna-album" class="view-section">
                        <div class="playlist-header-view" id="kahitna-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kahitna.jpeg" class="playlist-cover-big" id="kahitna-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="kahitna-title-view">Kahitna</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Populer Indonesia</span>  <span id="kahitna-count">12 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="kahitna-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 5. HINDIA -->
                    <div id="view-hindia-album" class="view-section">
                        <div class="playlist-header-view" id="hindia-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hindia.jpg" class="playlist-cover-big" id="hindia-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="hindia-title-view">Hindia</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Populer Indonesia</span>  <span id="hindia-count">11 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="hindia-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 6. ASTRID -->
                    <div id="view-astrid-album" class="view-section">
                        <div class="playlist-header-view" id="astrid-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/astrid.webp" class="playlist-cover-big" id="astrid-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="astrid-title-view">Astrid</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Populer Indonesia</span>  <span id="astrid-count">5 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="astrid-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 7. AFGAN -->
                    <div id="view-afgan-album" class="view-section">
                        <div class="playlist-header-view" id="afgan-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/afgan.png" class="playlist-cover-big" id="afgan-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="afgan-title-view">Afgan</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Populer Indonesia</span>  <span id="afgan-count">8 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="afgan-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 8. TULUS -->
                    <div id="view-tulus-album" class="view-section">
                        <div class="playlist-header-view" id="tulus-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tulus.jpg" class="playlist-cover-big" id="tulus-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="tulus-title-view">Tulus</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Populer Indonesia</span>  <span id="tulus-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="tulus-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 9. MAHALINI -->
                    <div id="view-mahalini-album" class="view-section">
                        <div class="playlist-header-view" id="mahalini-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/mahalini.jpg" class="playlist-cover-big" id="mahalini-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="mahalini-title-view">Mahalini</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Populer Indonesia</span>  <span id="mahalini-count">8 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="mahalini-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- 10. TENXI -->
                    <div id="view-tenxi-album" class="view-section">
                        <div class="playlist-header-view" id="tenxi-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tenxi.jpg" class="playlist-cover-big" id="tenxi-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="tenxi-title-view">Tenxi</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Populer Indonesia</span>  <span id="tenxi-count">5 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="tenxi-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Ed Sheeran -->
                    <div id="view-ed-album" class="view-section">
                        <div class="playlist-header-view" id="ed-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ed.jpg" class="playlist-cover-big" id="ed-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="ed-title-view">Ed Sheeran</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Penyanyi Asing Populer</span>  <span id="ed-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="ed-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Daniel Caesar -->
                    <div id="view-daniel-album" class="view-section">
                        <div class="playlist-header-view" id="daniel-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/daniel.jpg" class="playlist-cover-big" id="daniel-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="daniel-title-view">Daniel Caesar</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Penyanyi Asing Populer</span>  <span id="daniel-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="daniel-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Coldplay -->
                    <div id="view-coldplay-album" class="view-section">
                        <div class="playlist-header-view" id="coldplay-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/coldplay.jpg" class="playlist-cover-big" id="coldplay-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="coldplay-title-view">Coldplay</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Band Asing Populer</span>  <span id="coldplay-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="coldplay-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- One Direction -->
                    <div id="view-onedirection-album" class="view-section">
                        <div class="playlist-header-view" id="onedirection-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/onedirection.jpg" class="playlist-cover-big" id="onedirection-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="onedirection-title-view">One Direction</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Boy Band</span>  <span id="onedirection-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="onedirection-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Green Day -->
                    <div id="view-greenday-album" class="view-section">
                        <div class="playlist-header-view" id="greenday-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/greenday.jpg" class="playlist-cover-big" id="greenday-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="greenday-title-view">Green Day</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Punk Rock Band</span>  <span id="greenday-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="greenday-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Oasis -->
                    <div id="view-oasis-album" class="view-section">
                        <div class="playlist-header-view" id="oasis-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/oasis.jpg" class="playlist-cover-big" id="oasis-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="oasis-title-view">Oasis</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Britpop Band</span>  <span id="oasis-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="oasis-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Radiohead -->
                    <div id="view-radiohead-album" class="view-section">
                        <div class="playlist-header-view" id="radiohead-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/radiohead.jpg" class="playlist-cover-big" id="radiohead-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="radiohead-title-view">Radiohead</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Alternative Rock Band</span>  <span id="radiohead-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="radiohead-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Cigarettes After Sex -->
                    <div id="view-cas-album" class="view-section">
                        <div class="playlist-header-view" id="cas-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/cas.jpg" class="playlist-cover-big" id="cas-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="cas-title-view">Cigarettes After Sex</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Indie Rock Band</span>  <span id="cas-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="cas-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Rex Orange County -->
                    <div id="view-roc-album" class="view-section">
                        <div class="playlist-header-view" id="roc-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/roc.jpg" class="playlist-cover-big" id="roc-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="roc-title-view">Rex Orange County</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Indie Artist</span>  <span id="roc-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="roc-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- The Smiths -->
                    <div id="view-smiths-album" class="view-section">
                        <div class="playlist-header-view" id="smiths-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thesmith.jpg" class="playlist-cover-big" id="smiths-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>BAND</span>
                                <h1 id="smiths-title-view">The Smiths</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Indie Rock Band</span>  <span id="smiths-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="smiths-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Taylor Swift -->
                    <div id="view-taylor-album" class="view-section">
                        <div class="playlist-header-view" id="taylor-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/taylor.jpg" class="playlist-cover-big" id="taylor-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="taylor-title-view">Taylor Swift</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Penyanyi Asing Populer</span>  <span id="taylor-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="taylor-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Justin Bieber -->
                    <div id="view-justin-album" class="view-section">
                        <div class="playlist-header-view" id="justin-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/justin.jpg" class="playlist-cover-big" id="justin-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="justin-title-view">Justin Bieber</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Penyanyi Asing Populer</span>  <span id="justin-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="justin-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- Bruno Mars -->
                    <div id="view-bruno-album" class="view-section">
                        <div class="playlist-header-view" id="bruno-header-bg">
                            <div class="playlist-cover-wrap">
                                <img src="https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bruno.jpg" class="playlist-cover-big" id="bruno-cover-view">
                            </div>
                            <div class="playlist-info-big">
                                <span>ARTIS</span>
                                <h1 id="bruno-title-view">Bruno Mars</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;">Penyanyi Asing Populer</span>  <span id="bruno-count">10 lagu</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 0 32px;"><div class="song-list-header"><div>#</div><div>Judul</div><div>Album</div><div><i class="ph ph-clock"></i></div><div></div></div><div id="bruno-songs-container"></div></div>
                        <br><br><br>
                    </div>

                    <!-- VIEW: LIKED SONGS -->
                    <div id="view-liked" class="view-section">
                        <div class="playlist-header-view" id="liked-header-bg" style="position: relative;">
                            <button onclick="window.goBack()" class="back-button" title="Kembali" style="position: absolute; top: 20px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px;">
                                <i class="ph ph-arrow-left"></i>
                            </button>
                            <div class="playlist-cover-wrap">
                                <img src="https://picsum.photos/seed/liked/300/300" class="playlist-cover-big" id="liked-cover-view">
                                <button class="edit-cover-btn" onclick="document.getElementById('liked-cover-input').click()">
                                    <i class="ph-fill ph-camera"></i>
                                </button>
                                <input type="file" id="liked-cover-input" style="display: none;" accept="image/*" onchange="window.handleLikedCoverUpload(this)">
                            </div>
                            <div class="playlist-info-big">
                                <span data-i18n="liked-header">Liked</span>
                                <h1 id="liked-title-view" data-i18n="liked-header">Liked</h1>
                                <div class="playlist-meta">
                                    <span style="color: white;" data-i18n="song-collection">Song Collection</span>  <span id="liked-count">0 <span data-i18n="songs-label">songs</span></span>
                                </div>
                                <div class="playlist-buttons-container">
                                    <button class="action-play-btn" onclick="window.playFirstSongOfLiked()" title="Mainkan">
                                        <i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>
                                    </button>
                                    <button class="share-btn-album" onclick="window.shareAlbum('Liked Songs', 'https://picsum.photos/seed/likedsongs/300/300')" title="Bagikan Liked Songs">
                                        <i class="ph ph-share-network" style="font-size: 24px;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Song List for Liked -->
                        <div style="padding: 0 32px;">
                            <div class="song-list-header">
                                <div>#</div>
                                <div>Judul</div>
                                <div>Album</div>
                                <div><i class="ph ph-clock"></i></div>
                                <div></div>
                            </div>
                            <div id="liked-songs-container"></div>
                        </div>
                        <br><br><br>
                    </div>

                    <!-- VIEW: PROFILE -->
                    <div id="view-profile" class="view-section">
                        <div style="padding: 24px; position: relative;">
                            <div class="profile-hero-section" id="profile-hero-section" style="position: relative;">
                                <button onclick="window.goBack()" style="position: absolute; top: 12px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border: none; color: white; font-size: 20px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"><i class="ph ph-arrow-left"></i></button>
                                
                                <!-- Settings Menu Button (Top Right) -->
                                <div style="position: absolute; top: 12px; right: 12px; z-index: 10;">
                                    <button onclick="window.toggleProfileMenu()" style="background: rgba(0,0,0,0.5); border: none; color: white; font-size: 20px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"><i class="ph ph-gear"></i></button>
                                    <div id="profile-menu-dropdown" style="display: none; position: absolute; top: 50px; right: 0; background: linear-gradient(135deg, #1a1a1a, #222222); border: 1px solid rgba(229, 9, 20, 0.4); border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); min-width: 200px; z-index: 1000;">
                                        <button onclick="window.toggleProfileEdit(); window.toggleProfileMenu();" style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; width: 100%; border-radius: 10px 10px 0 0;" data-i18n="edit-profile">
                                            <i class="ph ph-pencil" style="margin-right: 12px;"></i> <span>Edit Profile</span>
                                        </button>
                                        <div style="height: 1px; background: rgba(229, 9, 20, 0.2);"></div>
                                        <button onclick="window.toggleOfflineMenuDropdown();" style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; width: 100%;">
                                            <span style="display: flex; align-items: center;"><i class="ph ph-wifi-slash" style="margin-right: 12px;"></i> <span>Offline Mode</span></span>
                                            <i class="ph ph-caret-down" style="margin-left: 8px;"></i>
                                        </button>
                                        <div id="profile-offline-submenu" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 8px; background: linear-gradient(135deg, #1a1a1a, #222222); border: 1px solid rgba(229, 9, 20, 0.4); border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); min-width: 220px; z-index: 1001;">
                                            <button onclick="window.showSetupPINDialog(); window.toggleProfileMenu();" style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; width: 100%; border-radius: 10px 10px 0 0;">
                                                <i class="ph ph-lock" style="margin-right: 12px;"></i> <span>Setup PIN</span>
                                            </button>
                                            <div style="height: 1px; background: rgba(229, 9, 20, 0.2);"></div>
                                            <button onclick="window.showOfflineStatus(); window.toggleProfileMenu();" style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; width: 100%; border-radius: 0 0 10px 10px;">
                                                <i class="ph ph-info" style="margin-right: 12px;"></i> <span>Status Offline</span>
                                            </button>
                                        </div>
                                        <div style="height: 1px; background: rgba(229, 9, 20, 0.2);"></div>
                                        <button onclick="window.toggleLanguageMenuDropdown(); " style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; width: 100%; border-radius: 0 0 10px 10px;" data-i18n="setting-language">
                                            <span style="display: flex; align-items: center;"><i class="ph ph-globe" style="margin-right: 12px;"></i> <span>Setting Language</span></span>
                                            <i class="ph ph-caret-down" style="margin-left: 8px;"></i>
                                        </button>
                                        <div id="profile-language-submenu" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 8px; background: linear-gradient(135deg, #1a1a1a, #222222); border: 1px solid rgba(229, 9, 20, 0.4); border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); min-width: 200px;">
                                            <button onclick="window.switchLanguage('id'); window.toggleProfileMenu();" class="active" id="profile-lang-id-btn" style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; width: 100%; border-radius: 10px 10px 0 0;">
                                                <i class="ph ph-check" style="margin-right: 12px; color: var(--primary-red); opacity: 1; transition: opacity 0.2s;"></i> <span>Bahasa Indonesia</span>
                                            </button>
                                            <div style="height: 1px; background: rgba(229, 9, 20, 0.2);"></div>
                                            <button onclick="window.switchLanguage('en'); window.toggleProfileMenu();" id="profile-lang-en-btn" style="padding: 14px 20px; border: none; background: transparent; color: white; cursor: pointer; text-align: left; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; width: 100%; border-radius: 0 0 10px 10px;">
                                                <i class="ph ph-check" style="margin-right: 12px; color: var(--primary-red); opacity: 0; transition: opacity 0.2s;"></i> <span>English</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <img src="https://picsum.photos/seed/user/120/120" alt="Profile Avatar" class="profile-avatar-lg" id="profile-avatar-display">
                                <div class="profile-hero-content">
                                    <div class="profile-type-label" data-i18n="my-profile-label">My Profile</div>
                                    <h1 class="profile-name-large" id="profile-name-display">User Name</h1>
                                    <!-- Profile ID Display -->
                                    <div class="profile-userid-display" onclick="window.copyUserId()" style="cursor:pointer;">
                                        <span id="profile-userid-text">User#0000</span>
                                        <i class="ph ph-copy copy-id-icon"></i>
                                    </div>
                                    <p class="profile-bio-display" id="profile-bio-display" data-i18n="profile-bio-placeholder">Bio text here</p>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Form Panel -->
                        <div class="profile-edit-panel" id="profile-edit-panel">
                            <div class="edit-grid">
                                <div class="edit-avatar-wrapper" onclick="document.getElementById('profile-avatar-input').click()">
                                    <img src="" id="edit-profile-img">
                                    <div class="edit-avatar-overlay">
                                        <i class="ph ph-camera" style="font-size: 24px; color: white;"></i>
                                    </div>
                                </div>
                                <input type="file" id="profile-avatar-input" style="display: none;" accept="image/*" onchange="window.handleProfileAvatarUpload(this)">
                                
                                <div class="edit-form">
                                    <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase;" data-i18n="profile-name-label">Name</label>
                                    <input type="text" id="edit-profile-name" class="edit-input" oninput="window.updateProfilePreview()">
                                    <small style="color: #aaa; font-size: 12px;" data-i18n="profile-id-note">User ID will automatically follow the new name.</small>
                                    
                                    <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase; margin-top: 16px;" data-i18n="profile-bio-label">Bio</label>
                                    <textarea id="edit-profile-bio" class="edit-input" rows="3" oninput="window.updateProfilePreview()"></textarea>
                                </div>
                            </div>
                            <div class="edit-actions-row">
                                <button class="btn-cancel" onclick="window.toggleProfileEdit()" data-i18n="cancel">Cancel</button>
                                <button class="btn-save" onclick="window.saveProfileChanges()" data-i18n="save">Save</button>
                            </div>
                        </div>

                        <div class="section-title-profile" data-i18n="public-playlists"></div>
                        <div class="playlist-modal-grid-profile" id="profile-public-playlists">
                            <!-- Playlists generated by JS -->
                        </div>
                        
                        <br><br><br>
                    </div>

                </div>
            </main>
        </div>

        <!-- ARTIST/BAND PROFILE OVERLAY (DESKTOP ONLY) -->
        <div id="artist-band-profile-overlay">
            <div class="artist-band-overlay-header">
                <button class="artist-band-overlay-back" onclick="window.closeArtistBandOverlay()">
                    <i class="ph ph-arrow-left"></i>
                </button>
                <div class="artist-band-overlay-title" id="artist-band-overlay-title">Band/Artist Name</div>
            </div>
            <div class="artist-band-overlay-content">
                <div class="artist-band-overlay-left">
                    <img src="" id="artist-band-overlay-cover" class="artist-band-overlay-cover" alt="Artist/Band Cover">
                    <div class="artist-band-overlay-info">
                        <h2 id="artist-band-overlay-name">Artist/Band</h2>
                        <p id="artist-band-overlay-category">Kategori</p>
                        <p id="artist-band-overlay-description" style="margin-top: 12px; color: #999;"></p>
                        <div class="artist-band-overlay-stats">
                            <div class="artist-band-overlay-stat">
                                <div class="artist-band-overlay-stat-value" id="artist-band-overlay-song-count">0</div>
                                <div class="artist-band-overlay-stat-label">Lagu</div>
                            </div>
                            <div class="artist-band-overlay-stat">
                                <div class="artist-band-overlay-stat-value" id="artist-band-overlay-followers">--</div>
                                <div class="artist-band-overlay-stat-label">Pendengar</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="artist-band-overlay-right">
                    <div class="artist-band-overlay-songs-title" data-i18n="popular-songs">Lagu Populer</div>
                    <div class="artist-band-overlay-songs" id="artist-band-overlay-songs">
                        <!-- Songs will be rendered here by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast-container" style="position: fixed; bottom: 110px; right: 20px; z-index: 5000; display: flex; flex-direction: column; gap: 10px; max-width: 320px;"></div>

        <!-- Progress Bar (above player-bar) -->
        <div class="player-progress-bar-wrapper" id="player-progress-bar-wrapper">
            <div class="player-progress-fill" id="player-progress-fill"></div>
            <div class="progress-time-tooltip" id="progress-time-tooltip" style="display: none;">00:00</div>
        </div>

        <!-- Player Bar -->
        <footer class="player-bar" >
            <div class="player-left">
                <img src="https://picsum.photos/seed/music/60/60" alt="Album Art" class="current-art" id="player-art">
                <div class="current-info">
                    <div class="current-title" id="player-title" data-i18n="select-song">Pilih Lagu</div>
                    <div class="current-artist" id="player-artist">...</div>
                </div>
                <button class="like-btn" id="like-btn" onclick="window.toggleCurrentSongLike()">
                    <i class="ph ph-heart"></i>
                </button>
            </div>

            <div class="player-center">
                <div class="player-controls">
                    <button class="control-btn" id="shuffle-btn" onclick="window.toggleShuffle()"><i class="ph ph-shuffle"></i></button>
                    <button class="control-btn" id="prev-btn" onclick="window.playPrevious()"><i class="ph ph-skip-back-fill"></i></button>
                    <button class="play-pause-btn" id="play-pause-btn"><i class="ph-fill ph-play"></i></button>
                    <button class="control-btn" id="next-btn" onclick="window.playNext()"><i class="ph ph-skip-forward-fill"></i></button>
                    <button class="control-btn" id="repeat-btn" onclick="window.toggleRepeat()"><i class="ph ph-repeat"></i></button>
                </div>
                <div class="playback-bar">
                    <span id="current-time">0:00</span>
                    <div class="progress-container" id="progress-container">
                        <div class="progress-fill" id="progress-fill"></div>
                        <div class="progress-thumb" id="progress-thumb"></div>
                    </div>
                    <span id="total-duration">0:00</span>
                </div>
            </div>

            <div class="player-right">
    <button class="control-btn" title="Full Screen Player" onclick="openPlayScreenUnified()" style="background: rgba(229,9,20,0.2); border-radius: 4px;"><i class="ph-fill ph-microphone-stage"></i></button>
    <button class="control-btn" title="Queue" onclick="window.toggleQueueOverlay()"><i class="ph ph-queue"></i></button>
    

    <button class="control-btn" id="vol-icon" title="Volume"><i class="ph ph-speaker-high"></i></button>
    <div class="volume-bar-container" id="volume-container">
        <div class="volume-fill" id="volume-fill"></div>
    </div>
</div>
        </footer>

        <!-- Mobile bottom navigation (visible on small screens) -->
        <!-- Mobile bottom navigation (visible on small screens) -->
        <nav class="mobile-bottom-nav" aria-label="Navigasi bawah">
            <a href="#" class="mb-nav-item" id="mb-nav-home" onclick="event.preventDefault(); window.switchView('home')">
                <i class="ph ph-house"></i>
                <span data-i18n="nav-home">Home</span>
            </a>
            <a href="#" class="mb-nav-item" id="mb-nav-search" onclick="event.preventDefault(); window.switchView('search')">
                <i class="ph ph-magnifying-glass"></i>
                <span data-i18n="nav-search">Search</span>
            </a>
            <a href="#" class="mb-nav-item" id="mb-nav-liked" onclick="event.preventDefault(); window.switchView('liked')">
                <i class="ph ph-heart"></i>
                <span data-i18n="nav-liked">Liked</span>
            </a>
        </nav>

        <!-- QUEUE OVERLAY -->
        <div id="queue-overlay">
            <div class="queue-header">
                <div class="queue-title" data-i18n="queue-title">Queue</div>
                <button class="queue-close-btn" onclick="window.toggleQueueOverlay()"><i class="ph ph-x"></i></button>
            </div>
            <div class="queue-list" id="queue-list-container">
                <!-- Queue items rendered here -->
                <div style="padding:20px; text-align:center; color:#666;" data-i18n="queue-empty">Queue is empty.</div>
            </div>
        </div>

    </div>

    <!-- OVERLAY PLAYER SCREEN WITH INTEGRATED LYRICS -->
    <div id="overlay-player">
        <div class="overlay-bg" id="overlay-bg"></div>
        <div class="overlay-content">
            <!-- DESKTOP: Album Art Section (Left) -->
            <div class="overlay-desktop-album">
                <div style="position: relative; margin-bottom: 24px;">
                    <div class="overlay-art-wrapper" id="overlay-art-swipeable" style="cursor: grab; touch-action: none; transform: translateX(0); transition: transform 0.3s ease-out;">
                        <img src="" id="overlay-art" alt="Album Art" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                </div>
                <div style="text-align: center; margin-bottom: 32px;">
                    <h2 id="overlay-title" style="font-size: 22px; font-weight: 700; color: white; margin: 0 0 8px 0;">Title</h2>
                    <p id="overlay-artist" onclick="window.openArtistProfileFromOverlay()" style="cursor: pointer; text-decoration: underline; font-size: 16px; color: rgba(255,255,255,0.7); margin: 0;">Artist</p>
                </div>

                <!-- PROGRESS BAR -->
                <div id="overlay-progress-container" style="margin-bottom: 32px; width: 100%;">
                    <div class="overlay-progress-bar">
                        <div class="overlay-progress-fill" id="overlay-progress-fill"></div>
                    </div>
                    <div class="overlay-time" style="font-size: 12px; margin-top: 4px;">
                        <span id="overlay-current-time">0:00</span>
                        <span id="overlay-total-duration">0:00</span>
                    </div>
                </div>

                <!-- CONTROLS -->
                <div class="overlay-controls" style="justify-content: center; width: 100%;">
                    <button onclick="openArtOverlay()" title="Art" style="color: white;"><i class="ph ph-arrows-out"></i></button>
                    <button onclick="window.toggleShuffle()" style="color: white;"><i class="ph ph-shuffle" id="overlay-shuffle-icon"></i></button>
                    <button onclick="window.playPrevious()" style="color: white;"><i class="ph-fill ph-skip-back"></i></button>
                    <button class="overlay-play-btn" id="overlay-play-pause-btn" onclick="document.getElementById('play-pause-btn').click()">
                        <i class="ph-fill ph-play"></i>
                    </button>
                    <button onclick="window.playNext()" style="color: white;"><i class="ph-fill ph-skip-forward"></i></button>
                    <button onclick="window.toggleRepeat()" style="color: white;"><i class="ph ph-repeat" id="overlay-repeat-icon"></i></button>
                </div>
            </div>

            <!-- MOBILE: Header -->
            <div class="overlay-header-container" style="display: none;">
                <button class="back-button" onclick="window.closeOverlayPlayer()" aria-label="Kembali" style="margin-left: -12px;">
                    <i class="ph ph-arrow-left"></i>
                </button>
                <h2 style="flex: 1; text-align: center; font-size: 14px; font-weight: 600; color: white; margin: 0;" id="overlay-header-title">Sekarang Diputar</h2>
                <button class="overlay-close-btn" onclick="window.toggleLyricsView()" style="margin-right: -12px; padding: 8px;" title="Lirik">
                    <i class="ph ph-microphone-stage" style="font-size: 20px;"></i>
                </button>
            </div>

            <!-- LYRICS REMOVED - Use microphone button to open new-lyrics-overlay instead -->
        </div>
        
        <!-- Close button for desktop -->
        <button class="overlay-close-btn" onclick="window.closeOverlayPlayer()" style="position: absolute; top: 20px; right: 20px; display: none;">
            <i class="ph ph-x"></i>
        </button>
    </div>


    <!-- ============================================ -->
    <!-- NEW CLEAN LYRICS OVERLAY                     -->
    <!-- ============================================ -->
    <div id="new-lyrics-overlay">
        <!-- Background -->
        <div class="new-overlay-bg" id="new-overlay-bg"></div>

        <!-- Close button -->
        <button class="new-close-btn" onclick="closeNewLyricsOverlay()">
            <i class="ph ph-x"></i>
        </button>

        <!-- Main Content -->
        <div class="new-overlay-content">
            <!-- LEFT PANEL (280px) -->
            <div class="new-left-panel">
                <!-- Album Art -->
                <img 
                    src="" 
                    alt="Album Art" 
                    class="new-album-art"
                    id="new-album-art"
                >

                <!-- Song Info -->
                <div class="new-song-info">
                    <div class="new-song-title" id="new-song-title">-</div>
                    <div class="new-song-artist" id="new-song-artist">-</div>
                </div>

                <!-- Progress Bar -->
                <div class="new-progress-container">
                    <div class="new-progress-bar" onclick="newSeekToPosition(event)">
                        <div class="new-progress-fill" id="new-progress-fill"></div>
                    </div>
                    <div class="new-time-display">
                        <span id="new-current-time">0:00</span>
                        <span id="new-total-time">0:00</span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="new-controls">
                    <button class="new-control-btn" onclick="window.toggleShuffle()" id="new-shuffle-btn">
                        <i class="ph ph-shuffle"></i>
                    </button>
                    <button class="new-control-btn" onclick="window.playPrevious()">
                        <i class="ph-fill ph-skip-back"></i>
                    </button>
                    <button class="new-control-btn new-play-btn" onclick="newTogglePlayPause()" id="new-play-btn">
                        <i class="ph-fill ph-play"></i>
                    </button>
                    <button class="new-control-btn" onclick="window.playNext()">
                        <i class="ph-fill ph-skip-forward"></i>
                    </button>
                    <button class="new-control-btn" onclick="window.toggleRepeat()" id="new-repeat-btn">
                        <i class="ph ph-repeat"></i>
                    </button>
                </div>
            </div>

            <!-- RIGHT PANEL (Lyrics) -->
            <div class="new-right-panel">
                <div class="new-lyrics-container">
                    <div class="new-lyrics-content" id="new-lyrics-content">
                        <!-- Lyrics will be rendered here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- UNIFIED PLAY SCREEN - MOBILE ONLY -->
    <div id="play-screen-unified" style="display: none;">
        <!-- Background blur from album -->
        <div id="play-screen-bg" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; filter: blur(80px) brightness(0.3); z-index: 0;"></div>

        <!-- Close button -->
        <button onclick="closePlayScreenUnified()" style="position: fixed; top: 32px; left: 16px; z-index: 2; background: rgba(0,0,0,0.4); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
            <i class="ph ph-x"></i>
        </button>

        <!-- Desktop Toggle Lyrics Button -->
        <button onclick="toggleDesktopLyrics()" style="position: absolute; right: 24px; top: 50%; transform: translateY(-50%); background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 8px; transition: color 0.3s; display: none;" class="desktop-toggle-lyrics" onmouseover="this.style.color='rgba(255,255,255,1)'" onmouseout="this.style.color='rgba(255,255,255,0.7)'" title="Show/Hide lyrics" id="lyrics-toggle-btn">
            <i class="ph-fill ph-caret-right" id="lyrics-toggle-icon"></i>
        </button>

        <!-- Scroll container -->
        <div id="play-screen-scroll" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow-y: scroll; z-index: 1; scroll-snap-type: y mandatory;">
            
            <!-- SCREEN 1: ALBUM VIEW -->
            <div id="play-screen-album" style="width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; scroll-snap-align: start; scroll-snap-stop: always;">
                <!-- Album Art -->
                <img id="play-screen-cover" src="" style="width: 360px; height: 360px; border-radius: 20px; object-fit: cover; box-shadow: 0 30px 80px rgba(0,0,0,0.95); margin-bottom: 40px;">
                
                <!-- Title & Artist -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 id="play-screen-song-title" style="font-size: 26px; font-weight: 700; color: white; margin: 0 0 8px 0;">Judul Lagu</h1>
                    <p id="play-screen-song-artist" style="font-size: 15px; color: rgba(255,255,255,0.7); margin: 0; font-weight: 500;">Artis</p>
                </div>

                <!-- Progress Bar -->
                <div style="width: 100%; max-width: 320px; margin-bottom: 28px;">
                    <div data-progress-bar onclick="playScreenSeek(event)" style="width: 100%; height: 2px; background: rgba(255,255,255,0.1); border-radius: 1px; cursor: pointer; overflow: hidden; margin-bottom: 8px;">
                        <div id="play-screen-progress" style="height: 100%; background: rgba(255,255,255,0.8); width: 0%; border-radius: 1px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: rgba(255,255,255,0.5); font-weight: 500;">
                        <span id="play-screen-time-current">0:00</span>
                        <span id="play-screen-time-total">0:00</span>
                    </div>
                </div>

                <!-- Controls (5 buttons) -->
                <div style="display: flex; justify-content: center; align-items: center; gap: 32px;">
                    <button onclick="window.toggleShuffle()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 22px; cursor: pointer; padding: 8px; transition: all 0.2s;" id="ps-shuffle">
                        <i class="ph ph-shuffle"></i>
                    </button>
                    <button onclick="window.playPrevious()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 22px; cursor: pointer; padding: 8px; transition: all 0.2s;">
                        <i class="ph-fill ph-skip-back"></i>
                    </button>
                    <button onclick="playScreenTogglePlay()" style="width: 60px; height: 60px; background: rgba(255,255,255,0.9); color: #000; border: none; border-radius: 50%; font-size: 26px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 8px 24px rgba(0,0,0,0.5);" id="ps-play">
                        <i class="ph-fill ph-play"></i>
                    </button>
                    <button onclick="window.playNext()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 22px; cursor: pointer; padding: 8px; transition: all 0.2s;">
                        <i class="ph-fill ph-skip-forward"></i>
                    </button>
                    <button onclick="window.toggleRepeat()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 22px; cursor: pointer; padding: 8px; transition: all 0.2s;" id="ps-repeat">
                        <i class="ph ph-repeat"></i>
                    </button>
                </div>

                <!-- Navigate to Lyrics Button -->
                <button onclick="document.getElementById('play-screen-scroll').scrollTo({top: document.getElementById('play-screen-scroll').scrollHeight, behavior: 'smooth'})" style="position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); background: none; border: none; color: rgba(255,255,255,0.6); font-size: 24px; cursor: pointer; padding: 8px; transition: all 0.3s; display: flex; flex-direction: column; align-items: center; gap: 6px; animation: swipeBounce 2s infinite;" onmouseover="this.style.color='rgba(255,255,255,0.9)'" onmouseout="this.style.color='rgba(255,255,255,0.6)'">
                    <i class="ph-fill ph-caret-down"></i>
                </button>
            </div>

            <!-- SCREEN 2: LYRICS VIEW -->
            <div id="play-screen-lyrics" style="width: 100%; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 40px 20px 60px 20px; scroll-snap-align: start; scroll-snap-stop: always;">
                <!-- Navigate to Album Button - Diatas persis judul lagu -->
                <button onclick="document.getElementById('play-screen-scroll').scrollTo({top: 0, behavior: 'smooth'})" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 8px; transition: color 0.3s; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;" onmouseover="this.style.color='rgba(255,255,255,1)'" onmouseout="this.style.color='rgba(255,255,255,0.7)'" title="Back to album">
                    <i class="ph-fill ph-caret-up"></i>
                </button>

                <!-- Song Title -->
                <h2 id="play-screen-lyrics-title" style="font-size: 22px; font-weight: 700; color: white; margin: 0 0 40px 0; text-align: center;">Judul Lagu</h2>

                <!-- Lyrics Container -->
                <div id="play-screen-lyrics-container" style="width: 100%; flex: 1; overflow-y: auto; max-height: 50vh;">
                    <!-- Lyrics rendered here -->
                </div>

                <!-- Progress Bar (below lyrics) -->
                <div style="width: 100%; max-width: 320px; margin-top: 40px; margin-bottom: 28px;">
                    <div data-progress-bar onclick="playScreenSeek(event)" style="width: 100%; height: 2px; background: rgba(255,255,255,0.1); border-radius: 1px; cursor: pointer; overflow: hidden; margin-bottom: 8px;">
                        <div id="play-screen-lyrics-progress" style="height: 100%; background: rgba(255,255,255,0.8); width: 0%; border-radius: 1px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: rgba(255,255,255,0.5); font-weight: 500;">
                        <span id="play-screen-lyrics-time-current">0:00</span>
                        <span id="play-screen-lyrics-time-total">0:00</span>
                    </div>
                </div>

                <!-- Controls (3 buttons only) -->
                <div style="display: flex; justify-content: center; align-items: center; gap: 32px;">
                    <button onclick="window.playPrevious()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 22px; cursor: pointer; padding: 8px; transition: all 0.2s;">
                        <i class="ph-fill ph-skip-back"></i>
                    </button>
                    <button onclick="playScreenTogglePlay()" style="width: 60px; height: 60px; background: rgba(255,255,255,0.9); color: #000; border: none; border-radius: 50%; font-size: 26px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 8px 24px rgba(0,0,0,0.5);" id="ps-play-lyrics">
                        <i class="ph-fill ph-play"></i>
                    </button>
                    <button onclick="window.playNext()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 22px; cursor: pointer; padding: 8px; transition: all 0.2s;">
                        <i class="ph-fill ph-skip-forward"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- FULLSCREEN LYRICS PAGE -->
    <div class="lyrics-overlay-container" id="lyrics-overlay-container">
        <!-- MOBILE: HEADER -->
        <div class="lyrics-header">
            <button class="lyrics-close-btn" onclick="window.goHome()" title="Kembali">
                <i class="ph ph-arrow-down"></i>
            </button>
            <h2 class="lyrics-title">Lirik</h2>
            <button class="lyrics-help-btn" onclick="window.openLyricsHelp()" title="Bantuan">
                <i class="ph ph-question"></i>
            </button>
        </div>

        <!-- DESKTOP: Album Art & Title Section (Left) -->
        <div class="lyrics-desktop-section">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; text-align: center;">
                <img id="lyrics-page-art" src="" alt="Album Art" style="width: 320px; height: 320px; border-radius: 20px; object-fit: cover; box-shadow: 0 30px 80px rgba(0,0,0,0.6);">
                <div>
                    <h2 id="lyrics-page-title" style="font-size: 24px; font-weight: 700; color: white; margin: 0 0 8px 0;">Title</h2>
                    <p id="lyrics-page-artist" style="font-size: 16px; color: rgba(255,255,255,0.7); margin: 0; cursor: pointer; text-decoration: underline;">Artist</p>
                </div>
            </div>
        </div>

        <!-- MOBILE: Album Art & Lyrics Section (Full) -->
        <div class="lyrics-mobile-section">
            <!-- ALBUM ART SMALL -->
            <div style="display: flex; justify-content: center; padding: 20px 16px 16px 16px; flex-shrink: 0;">
                <img id="lyrics-page-art-mobile" src="" alt="Album Art" style="width: 200px; height: 200px; border-radius: 12px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.4);">
            </div>

            <!-- SONG INFO -->
            <div style="text-align: center; padding: 0 16px; flex-shrink: 0; margin-bottom: 16px;">
                <h2 id="lyrics-page-title-mobile" style="font-size: 18px; font-weight: 700; color: white; margin: 0 0 4px 0;">Title</h2>
                <p id="lyrics-page-artist-mobile" style="font-size: 14px; color: rgba(255,255,255,0.7); margin: 0;">Artist</p>
            </div>
        </div>

        <!-- LYRICS TEXT (Both Mobile and Desktop) -->
        <div id="lyrics-page-content" style="flex: 1; overflow-y: auto; scroll-behavior: smooth;">
            <div class="lyrics-text" style="color: rgba(255,255,255,0.8); text-align: center;"></div>
        </div>

        <!-- PROGRESS BAR & CONTROLS (Bottom) -->
        <div style="flex-shrink: 0; padding: 16px 20px 20px 20px; background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.1);">
            <!-- PROGRESS BAR -->
            <div id="lyrics-progress-container" style="margin-bottom: 16px;">
                <div class="overlay-progress-bar">
                    <div class="overlay-progress-fill" id="lyrics-progress-fill"></div>
                </div>
                <div class="overlay-time" style="font-size: 12px; margin-top: 4px;">
                    <span id="lyrics-current-time">0:00</span>
                    <span id="lyrics-total-duration">0:00</span>
                </div>
            </div>

            <!-- CONTROLS -->
            <div class="overlay-controls" style="justify-content: center;">
                <button onclick="window.goHome()" title="Tutup" style="color: white; font-size: 20px; padding: 8px;"><i class="ph ph-arrow-down"></i></button>
                <button onclick="openArtOverlay()" title="Art" style="color: white;"><i class="ph ph-arrows-out"></i></button>
                <button onclick="window.toggleShuffle()" style="color: white;"><i class="ph ph-shuffle" id="lyrics-shuffle-icon"></i></button>
                <button onclick="window.playPrevious()" style="color: white;"><i class="ph-fill ph-skip-back"></i></button>
                <button class="overlay-play-btn" id="lyrics-play-pause-btn" onclick="document.getElementById('play-pause-btn').click()">
                    <i class="ph-fill ph-play"></i>
                </button>
                <button onclick="window.playNext()" style="color: white;"><i class="ph-fill ph-skip-forward"></i></button>
                <button onclick="window.toggleRepeat()" style="color: white;"><i class="ph ph-repeat" id="lyrics-repeat-icon"></i></button>
            </div>
        </div>

        <!-- Desktop Close Button -->
        <button class="overlay-close-btn" onclick="window.goHome()" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 50%; width: 44px; height: 44px; display: none; align-items: center; justify-content: center;">
            <i class="ph ph-x"></i>
        </button>
    </div>

    <!-- ART FULLSCREEN OVERLAY -->
    <div id="art-overlay-container" onclick="if(event.target === this) window.closeArtOverlay()">
        <div class="art-overlay-bg" id="art-overlay-bg"></div>
        <div class="art-overlay-content" style="display:flex; gap:20px; width:100%; height:100%; padding:0;">
            <button class="art-close-btn" onclick="event.stopPropagation(); window.closeArtOverlay();" aria-label="Kembali ke Home" style="position: absolute; top: 20px; left: 20px; z-index:10;"><i class="ph ph-arrow-left"></i></button>

            <!-- LEFT PANEL: Art + Controls -->
            <div style="width:280px; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px 20px; gap:30px; flex-shrink:0;">
                <!-- Album Art -->
                <img id="art-overlay-image" src="" alt="Album Art" style="width:280px; height:280px; border-radius:16px; object-fit:cover; box-shadow:0 20px 60px rgba(0,0,0,0.8);">
                
                <!-- Title & Artist -->
                <div style="text-align:center; width:100%;">
                    <h2 id="art-overlay-title" style="font-size:20px; font-weight:700; color:white; margin:0 0 6px 0; line-height:1.2;">Title</h2>
                    <p id="art-overlay-artist" style="font-size:14px; color:rgba(255,255,255,0.7); margin:0;">Artist</p>
                </div>

                <!-- Progress Bar -->
                <div style="width:100%;">
                    <div class="overlay-progress-bar" style="height:4px; border-radius:2px; background:rgba(255,255,255,0.1); margin-bottom:8px;">
                        <div class="overlay-progress-fill" id="art-progress-fill" style="height:100%; background:rgba(255,255,255,0.7); border-radius:2px; width:0%; transition:width 0.1s linear;"></div>
                    </div>
                    <div style="display:flex; justify-content:space-between; font-size:12px; color:rgba(255,255,255,0.7);">
                        <span id="art-current-time">0:00</span>
                        <span id="art-total-time">0:00</span>
                    </div>
                </div>

                <!-- Controls -->
                <div style="display:flex; gap:20px; justify-content:center; width:100%;">
                    <button onclick="window.toggleShuffle()" style="background:none; border:none; color:rgba(255,255,255,0.7); cursor:pointer; font-size:20px;"><i class="ph ph-shuffle"></i></button>
                    <button onclick="window.playPrevious()" style="background:none; border:none; color:rgba(255,255,255,0.7); cursor:pointer; font-size:20px;"><i class="ph-fill ph-skip-back"></i></button>
                    <button id="art-play-btn" onclick="document.getElementById('play-pause-btn').click()" style="background:rgba(255,255,255,0.2); border:none; color:white; cursor:pointer; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px;"><i class="ph-fill ph-play"></i></button>
                    <button onclick="window.playNext()" style="background:none; border:none; color:rgba(255,255,255,0.7); cursor:pointer; font-size:20px;"><i class="ph-fill ph-skip-forward"></i></button>
                    <button onclick="window.toggleRepeat()" style="background:none; border:none; color:rgba(255,255,255,0.7); cursor:pointer; font-size:20px;"><i class="ph ph-repeat"></i></button>
                </div>
            </div>

            <!-- RIGHT PANEL: Lyrics -->
            <div class="art-lyrics-wrapper" id="art-lyrics-wrapper" style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; overflow:hidden; padding:40px 20px; position:relative;">
                <!-- Fade top -->
                <div style="position:absolute; top:0; left:0; right:0; height:80px; background:linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%); z-index:2; pointer-events:none;"></div>
                
                <!-- Lyrics scroll container -->
                <div id="art-lyrics-scroll" style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; overflow-y:auto; width:100%; position:relative;">
                    <div id="art-lyrics-content" class="lyrics-text" style="color: rgba(255,255,255,0.6); text-align:center; display:flex; flex-direction:column; gap:20px;"></div>
                </div>

                <!-- Fade bottom -->
                <div style="position:absolute; bottom:0; left:0; right:0; height:80px; background:linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.8) 100%); z-index:2; pointer-events:none;"></div>
            </div>
        </div>
    </div>

    <!-- LYRICS HELP OVERLAY -->
    <div class="lyrics-help-overlay" id="lyrics-help-overlay" onclick="if(event.target === this) window.closeLyricsHelp()"></div>
    <div class="lyrics-help-tooltip" id="lyrics-help-tooltip">
        <button class="lyrics-help-close" onclick="window.closeLyricsHelp()"><i class="ph ph-x"></i></button>
        <h3 class="lyrics-help-title">Fitur Lirik</h3>
        <div class="lyrics-help-item">
            <p class="lyrics-help-item-title">1 Lirik Real-Time</p>
            <p class="lyrics-help-item-desc">Lirik bergerak otomatis mengikuti lagu. Baris aktif berubah tepat sesuai waktu musik (time-synced lyrics).</p>
        </div>
        <div class="lyrics-help-item">
            <p class="lyrics-help-item-title">2 Highlight Baris Aktif</p>
            <p class="lyrics-help-item-desc">Baris yang sedang dinyanyikan tampil lebih terang dan tebal. Fokus ke bagian lagu yang sedang diputar.</p>
        </div>
        <div class="lyrics-help-item">
            <p class="lyrics-help-item-title">3 Auto Scroll Halus</p>
            <p class="lyrics-help-item-desc">Lirik bergeser sendiri ke atas dengan smooth. Baris aktif biasanya berada di tengah layar.</p>
        </div>
        <div class="lyrics-help-item">
            <p class="lyrics-help-item-title">4 Tap Lirik  Lompat Waktu</p>
            <p class="lyrics-help-item-desc">Klik baris lirik untuk melompat ke bagian itu di lagu. Berguna untuk menemukan verse atau chorus tertentu.</p>
        </div>
        <div class="lyrics-help-item">
            <p class="lyrics-help-item-title"> Highlight Per Kata</p>
            <p class="lyrics-help-item-desc">Setiap kata disorot saat dinyanyikan, memberikan pengalaman seperti karaoke.</p>
        </div>
    </div>

    <!-- ARTIST PROFILE OVERLAY -->
    <div id="artist-profile-overlay" class="artist-profile-overlay-container">
        <div class="artist-profile-header-top">
            <button class="artist-profile-back-btn" onclick="window.closeArtistProfile()">
                <i class="ph ph-arrow-left"></i>
            </button>
        </div>
        <div class="playlist-header-view" id="artist-profile-header">
            <div class="playlist-cover-wrap">
                <img src="" class="playlist-cover-big" id="artist-profile-img">
            </div>
            <div class="playlist-info-big">
                <span>ARTIS</span>
                <h1 id="artist-profile-name">Nama Artis</h1>
                <div class="playlist-meta">
                    <span style="color: white;">Profil Artis</span>
                </div>
            </div>
        </div>
        <div class="artist-profile-content">
             <h3 class="artist-profile-section-title" data-i18n="popular-songs">Lagu Populer</h3>
             <div id="artist-profile-songs"></div>
        </div>
    </div>

    <!-- 4. MODALS -->

    <!-- Create Playlist Modal -->
    <div id="create-playlist-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Buat Playlist Baru</div>
                <button class="close-modal-btn" onclick="window.closeModal('create-playlist-modal')"><i class="ph ph-x"></i></button>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <p style="color: #b3b3b3; font-size: 14px;">Gambar cover default akan diberikan secara otomatis.</p>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase;" data-i18n="playlist-name-label"></label>
                <input type="text" id="new-playlist-name" class="modal-input" placeholder="Contoh: Lagu Santai" data-i18n-placeholder="playlist-name-example" style="margin-top: 8px;">
            </div>
            <button class="modal-btn" onclick="window.submitCreatePlaylist()" data-i18n="create-button"></button>
        </div>
    </div>

    <!-- IMPORT MUSIC MODAL -->
<div id="import-music-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <div class="modal-title" data-i18n="import-music">Import Music</div>
            <button class="close-modal-btn" onclick="window.closeModal('import-music-modal')">
                <i class="ph ph-x"></i>
            </button>
        </div>

        <div class="import-form-grid">
            <!-- File Preview -->
            <div class="import-file-preview" id="import-file-preview">
                <img src="https://picsum.photos/seed/default/100/100" 
                     class="import-cover-preview" 
                     id="import-cover-preview">
                <div class="import-file-info">
                    <div class="import-file-name" id="import-file-name" data-i18n="no-file-selected">
                        <span data-i18n="no-file-selected">No file selected</span>
                    </div>
                    <div class="import-file-size" id="import-file-size">
                        <span data-i18n="choose-mp3">Choose MP3 file</span>
                    </div>
                </div>
                <input type="file" 
                       id="import-music-file" 
                       accept="audio/mp3,audio/mpeg" 
                       style="display: none;" 
                       onchange="window.handleMusicFileSelect(this)">
                <button class="file-upload-btn" 
                        onclick="document.getElementById('import-music-file').click()">
                    <i class="ph ph-file-audio"></i> <span data-i18n="choose-mp3-btn">Choose MP3</span>
                </button>
            </div>

            <!-- Song Info -->
            <div>
                <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase;">
                    <span data-i18n="song-title-label">Song Title</span>
                </label>
                <input type="text" 
                       id="import-song-title" 
                       class="modal-input" 
                       data-i18n-placeholder="song-title-placeholder" 
                       placeholder="e.g. Beautiful Day">
            </div>

            <div>
                <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase;">
                    <span data-i18n="artist-label">Artist</span>
                </label>
                <input type="text" 
                       id="import-song-artist" 
                       class="modal-input" 
                       data-i18n-placeholder="artist-placeholder" 
                       placeholder="e.g. John Doe">
            </div>

            <div>
                <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase;">
                    <span data-i18n="album-label">Album</span>
                </label>
                <input type="text" 
                       id="import-song-album" 
                       class="modal-input" 
                       data-i18n-placeholder="album-placeholder" 
                       placeholder="e.g. Greatest Hits">
            </div>

            <!-- Cover Photo Upload -->
            <div>
                <label style="font-size: 12px; font-weight: 700; color: #fff; text-transform: uppercase;">
                    <span data-i18n="cover-label">Album Cover (Optional)</span>
                </label>
                <input type="file" 
                       id="import-cover-file" 
                       accept="image/*" 
                       style="display: none;" 
                       onchange="window.handleCoverFileSelect(this)">
                <button class="file-upload-btn" 
                        onclick="document.getElementById('import-cover-file').click()" 
                        style="width: 100%; margin-top: 8px;">
                    <i class="ph ph-image"></i> <span data-i18n="choose-photo">Choose Photo</span>
                </button>
            </div>

            <!-- Privacy Toggle -->
            <div class="privacy-toggle">
                <label>
                    <i class="ph ph-lock-key" id="privacy-icon" style="margin-right: 5px;"></i>
                    <span id="privacy-label">Privat</span>
                                        <span id="privacy-label" data-i18n="privacy-label">Private</span>
                    <p style="font-size: 11px; color: #888; margin-top: 3px;">
                        <span data-i18n="privacy-desc">Only you can listen</span>
                    </p>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" 
                           id="import-privacy-toggle" 
                           onchange="window.updatePrivacyLabel(this)">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- Submit Button -->
            <button class="modal-btn" onclick="window.submitImportMusic()">
                <i class="ph ph-upload-simple"></i> <span data-i18n="import-music">Import Music</span>
            </button>
        </div>
    </div>
</div>

    <!-- Add Song to Playlist Modal -->
    <div id="add-song-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" data-i18n="add-to-playlist">Add to Playlist</div>
                <button class="close-modal-btn" onclick="window.closeModal('add-song-modal')"><i class="ph ph-x"></i></button>
            </div>
            <div class="playlist-select-list" id="add-song-playlist-list"></div>
        </div>
    </div>

    <!-- Share to Friend Modal -->
    <div id="share-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" data-i18n="share-to-friends"></div>
                <button class="close-modal-btn" onclick="window.closeModal('share-modal')"><i class="ph ph-x"></i></button>
            </div>
            <div class="playlist-select-list" id="share-friend-list" style="max-height: 300px;"></div>
            <p id="share-loading" style="text-align:center; color: #888; display:none;"><span data-i18n="loading"></span></p>
        </div>
    </div>

    <!-- Show All Modal -->
    <div id="show-all-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <div class="modal-title" id="show-all-title">Tampilkan Semua</div>
                <button class="close-modal-btn" onclick="window.closeShowAllModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="card-grid" id="show-all-grid" style="padding: 20px;"></div>
        </div>
    </div>

    <!-- --- NEW OVERLAYS --- -->

    <!-- Full Screen Chat Overlay -->
    <div id="chat-overlay">
        <div class="chat-header">
            <button class="chat-back-btn" onclick="window.closeChat()"><i class="ph ph-arrow-left"></i></button>
            <div class="chat-friend-info" onclick="window.openFriendProfileFromChat()">
                <img src="" class="chat-friend-avatar" id="chat-friend-avatar-display">
                <div>
                    <div class="chat-friend-name" id="chat-friend-name-display" data-i18n="friend-name"></div>
                    <div class="chat-status">Online</div>
                </div>
            </div>
        </div>
        <div class="chat-body" id="chat-body">
            <!-- Messages injected here -->
        </div>
       <div class="chat-footer">
        <!-- Listen Together Button -->
        <button id="btn-open-listen-together" onclick="window.openListenTogether()" title="Dengar Bareng" style="background:none; border:none; color:#aaa; font-size:24px; cursor:pointer; margin-right:10px; display:flex; align-items:center; transition: color 0.2s;">
            <i class="ph ph-users-three"></i>
        </button>
    <input 
        type="text" 
        class="chat-input" 
        id="chat-input-box" 
        placeholder="Type a message..." 
        data-i18n-placeholder="chat-placeholder"
        onkeypress="if(event.key === 'Enter') window.sendChatMessage()"
        autocomplete="off"
    >
    <button 
    class="chat-send-btn" 
    onclick="window.sendChatMessage()" 
    title="Kirim Pesan"
    aria-label="Kirim Pesan"
>
    
</button>
</div>
    <!-- Friend Profile Overlay -->
    <div id="friend-profile-overlay">
        <div style="padding: 24px;">
            <button onclick="window.closeFriendProfile()" style="background:none; border:none; color:white; font-size:20px; cursor:pointer; margin-bottom:20px;"><i class="ph ph-arrow-left"></i> <span data-i18n="back">Back</span></button>
            <div class="profile-hero-section" id="friend-hero-section">
                <img src="" alt="Friend Avatar" class="profile-avatar-lg" id="friend-profile-avatar-display">
                <div class="profile-hero-content">
                    <div class="profile-type-label" data-i18n="friend-profile-label">Friend Profile</div>
                    <h1 class="profile-name-large" id="friend-profile-name-display">Friend Name</h1>
                    <!-- Friend ID Display -->
                    <div class="profile-userid-display" onclick="window.copyFriendUserId()" style="cursor:default;">
                        <span id="friend-profile-userid-text">Friend#0000</span>
                        <i class="ph ph-copy copy-id-icon"></i>
                    </div>
                    <p class="profile-bio-display" id="friend-profile-bio-display" data-i18n="friend-bio-placeholder"></p>
                </div>
            </div>
            <div class="section-title-profile" data-i18n="public-playlists">Public Playlists</div>
            <div class="playlist-modal-grid-profile" id="friend-public-playlists">
                <!-- Friend Playlists -->
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu">
        <div class="ctx-item" onclick="window.ctxAction('copy')">Salin</div>
            <div class="ctx-item" onclick="window.ctxAction('copy')" data-i18n="context-copy">Copy</div>
        <div class="ctx-item" onclick="window.ctxAction('reply')">Balas</div>
            <div class="ctx-item" onclick="window.ctxAction('reply')" data-i18n="context-reply">Reply</div>
        <div class="ctx-separator"></div>
        <div class="ctx-item" onclick="window.ctxAction('delete')" style="color: var(--primary-red);">Hapus</div>
        <div class="ctx-item" onclick="window.ctxAction('delete')" style="color: var(--primary-red);" data-i18n="context-delete">Delete</div>
    </div>

    <!-- Audio Player with Background Playback Support -->
    <audio id="audio-player" preload="auto"></audio>


    <!-- Listen Together Overlay (Moved to Body End) -->
    <div id="listen-together-overlay">
        <button class="lt-close" onclick="window.closeListenTogether()"><i class="ph ph-x"></i></button>
        <div class="lt-container">
            <div class="lt-header">
                <h2 data-i18n="listen-together-title"> Listen Together</h2>
                <p data-i18n="listen-together-desc">Enjoy music with friends in real-time</p>
            </div>
            <!-- Mode Selection -->
            <div id="lt-mode-section">
                <div class="lt-mode-selector">
                    <button class="lt-mode-btn" onclick="window.selectLTMode('host')">
                        <i class="ph ph-broadcast" style="font-size:32px; display:block; margin-bottom:10px;"></i>
                        <span data-i18n="listen-together-create">Create Session</span>
                    </button>
                    <button class="lt-mode-btn" onclick="window.selectLTMode('join')">
                        <i class="ph ph-sign-in" style="font-size:32px; display:block; margin-bottom:10px;"></i>
                        <span data-i18n="listen-together-join">Join Session</span>
                    </button>
                </div>
            </div>
            <!-- Host Section -->
            <div id="lt-host-section">
                <div class="lt-session-code">
                    <p style="color:#aaa; font-size:12px; margin:0 0 10px 0;" data-i18n="listen-together-your-code">Your Session Code:</p>
                    <div class="lt-code-display" id="lt-session-code">----</div>
                    <p style="color:#aaa; font-size:12px; margin:10px 0 0 0;" data-i18n="listen-together-share-code">Share this code with friends</p>
                </div>
                <button class="lt-btn" onclick="window.copySessionCode()">
                    <i class="ph ph-copy"></i> <span data-i18n="listen-together-copy">Copy Code</span>
                </button>
                <div class="lt-participants" id="lt-participants-list">
                    <p style="color:#666; text-align:center; font-size:13px; margin:0;" data-i18n="waiting-friends">Waiting for friends to join...</p>
                </div>
                <button class="lt-btn" style="background:#444;" onclick="window.endListenTogether()">
                    <span data-i18n="listen-together-end">End Session</span>
                </button>
            </div>
            <!-- Join Section -->
            <div id="lt-join-section">
                <input type="text" class="lt-input" id="lt-join-code" data-i18n-placeholder="listen-together-code-placeholder" placeholder="XXXX" maxlength="4">
                <button class="lt-btn" onclick="window.joinListenTogether()">
                    <i class="ph ph-arrow-right"></i> <span data-i18n="listen-together-join-btn">Join</span>
                </button>
                <p style="color:#aaa; font-size:12px; text-align:center; margin:0;" data-i18n="listen-together-join-desc">
                    Enter the 4-digit code from the host
                </p>
            </div>
        </div>
    </div>

    <!-- Active Session Badge -->
    <div class="session-badge" id="session-badge" style="z-index:999998;">
        <div class="session-badge-icon"></div>
        <span id="session-badge-text" data-i18n="listen-together-active">Listen Together Active</span>
    </div>

    <!-- FIREBASE & LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, onValue, push, update, remove, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";




        const firebaseConfig = {
            apiKey: "AIzaSyCEamepceiYZtcqlcRnRmFHe0smkGfu_A4",
            authDomain: "gochat-35172.firebaseapp.com",
            databaseURL: "https://gochat-35172-default-rtdb.asia-southeast1.firebasedatabase.app",
            id: "gochat-35172",
            storageBucket: "gochat-35172.firebasestorage.app",
            messagingSenderId: "206571646434",
            appId: "1:206571646434:web:c337d95ea3a6a121499dbb",
            measurementId: "G-XZ2K3PZ6ZK"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        const auth = getAuth(app);
        const db = getDatabase(app);
        // ===== SUPABASE CONFIGURATION =====
const SUPABASE_URL = 'https://qkruoywwqdpkdjlajbpl.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrcnVveXd3cWRwa2RqbGFqYnBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0NDY3OTcsImV4cCI6MjA4NTAyMjc5N30.6NQGI-d13SVih3VKOuSEvLYTeP5tf9QhEUyfi6mBEiA';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

console.log('[OK] Supabase initialized');


// ===================================================================
// VIDJE OFFLINE AUTH - INTEGRATION PATCH
// ===================================================================

// ============================================================
// 1. LOAD HYBRID AUTH SYSTEM
// ============================================================

(function loadHybridAuth() {
    const script = document.createElement('script');
    script.innerHTML = `
// ===================================================================
// VIDJE HYBRID AUTH - INLINE VERSION
// ===================================================================

(function() {
    'use strict';

    class VidjeHybridAuth {
        constructor() {
            this.STORAGE_KEY = 'vidje_offline_session';
            this.PIN_KEY = 'vidje_offline_pin';
            this.QUEUE_KEY = 'vidje_offline_queue';
        }

        // Save offline session saat login online
        async saveOfflineSession(firebaseUser, userDataFromDB) {
            try {
                const offlineSession = {
                    uid: firebaseUser.uid,
                    email: firebaseUser.email,
                    displayName: userDataFromDB?.displayName || firebaseUser.displayName || firebaseUser.email.split('@')[0],
                    photoURL: userDataFromDB?.photoURL || firebaseUser.photoURL || '',
                    userId: userDataFromDB?.userId || firebaseUser.email.split('@')[0],
                    
                    userData: {
                        playlists: userDataFromDB?.playlists || {},
                        likedSongs: userDataFromDB?.likedSongs || {},
                        likedCover: userDataFromDB?.likedCover || '',
                        bio: userDataFromDB?.bio || ''
                    },
                    
                    savedAt: Date.now(),
                    lastLogin: Date.now()
                };

                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(offlineSession));
                console.log('[OK] Offline session saved for:', firebaseUser.email);
                return true;
                
            } catch (error) {
                console.error('[ERROR] Failed to save offline session:', error);
                return false;
            }
        }

        // Setup PIN
        async setupPIN(pin) {
            if (!pin || pin.length !== 4 || !/^\\d{4}$/.test(pin)) {
                return { success: false, error: 'PIN harus 4 digit angka' };
            }

            const session = this.getOfflineSession();
            if (!session) {
                return { success: false, error: 'Belum ada session offline. Login online dulu!' };
            }

            try {
                const hashedPIN = await this.hashPIN(pin);
                
                const pinData = {
                    uid: session.uid,
                    pin: hashedPIN,
                    setupAt: Date.now()
                };
                
                localStorage.setItem(this.PIN_KEY, JSON.stringify(pinData));
                console.log('[OK] PIN setup berhasil');
                return { success: true };
                
            } catch (error) {
                console.error('[ERROR] PIN setup gagal:', error);
                return { success: false, error: 'Gagal setup PIN' };
            }
        }

        // Login offline
        async loginOffline(pin = null) {
            const session = this.getOfflineSession();
            
            if (!session) {
                return { 
                    success: false, 
                    error: 'Tidak ada session offline. Login online dulu untuk cache akun!' 
                };
            }

            const pinData = this.getPINData();
            if (pinData && pinData.pin) {
                if (!pin) {
                    return { success: false, error: 'PIN required', needPIN: true };
                }

                const hashedInputPIN = await this.hashPIN(pin);
                if (hashedInputPIN !== pinData.pin) {
                    return { success: false, error: 'PIN salah!' };
                }
            }

            const activeSession = {
                ...session,
                isOffline: true,
                offlineLoginAt: Date.now()
            };

            sessionStorage.setItem('vidje_active_session', JSON.stringify(activeSession));
            
            console.log('[OK] Offline login berhasil untuk:', session.email);
            
            window.dispatchEvent(new CustomEvent('offline-auth-success', {
                detail: { user: activeSession }
            }));

            return { success: true, user: activeSession };
        }

        // Auto-login saat offline
        async attemptAutoOfflineLogin() {
            if (navigator.onLine) {
                return { success: false, reason: 'online' };
            }

            const session = this.getOfflineSession();
            if (!session) {
                return { success: false, reason: 'no_session' };
            }

            const pinData = this.getPINData();
            if (pinData && pinData.pin) {
                return { success: false, reason: 'pin_required', needPIN: true };
            }

            return await this.loginOffline();
        }

        // Queue tracking untuk offline
        queueTrackingData(trackingData) {
            try {
                const queue = this.getTrackingQueue();
                queue.push({
                    ...trackingData,
                    queuedAt: Date.now()
                });
                
                localStorage.setItem(this.QUEUE_KEY, JSON.stringify(queue));
                console.log('[CACHE] Tracking queued for offline:', trackingData.song_name);
                return true;
            } catch (error) {
                console.error('[ERROR] Failed to queue tracking:', error);
                return false;
            }
        }

        // Sync tracking queue saat online
        async syncTrackingQueue() {
            const queue = this.getTrackingQueue();
            
            if (queue.length === 0) {
                console.log('[INFO] No tracking data to sync');
                return { success: true, synced: 0 };
            }

            console.log(\`[SYNC] Syncing \${queue.length} queued tracks...\`);
            
            let synced = 0;
            const failed = [];

            for (const item of queue) {
                try {
                    if (window.vidjeTracking && window.vidjeTracking.trackSongPlay) {
                        await window.vidjeTracking.trackSongPlay({
                            song_name: item.song_name,
                            artist_name: item.artist_name,
                            duration: item.duration,
                            cover_url: item.cover_url,
                            audio_url: item.audio_url
                        });
                        synced++;
                    }
                } catch (error) {
                    console.error('[ERROR] Failed to sync:', item.song_name, error);
                    failed.push(item);
                }
            }

            // Clear queue jika semua berhasil
            if (failed.length === 0) {
                localStorage.removeItem(this.QUEUE_KEY);
                console.log(\`[OK] All \${synced} tracks synced successfully!\`);
            } else {
                // Simpan yang gagal untuk retry nanti
                localStorage.setItem(this.QUEUE_KEY, JSON.stringify(failed));
                console.log(\`[WARN] \${synced} synced, \${failed.length} failed\`);
            }

            return { success: true, synced, failed: failed.length };
        }

        getOfflineSession() {
            const stored = localStorage.getItem(this.STORAGE_KEY);
            return stored ? JSON.parse(stored) : null;
        }

        getPINData() {
            const stored = localStorage.getItem(this.PIN_KEY);
            return stored ? JSON.parse(stored) : null;
        }

        getActiveSession() {
            const stored = sessionStorage.getItem('vidje_active_session');
            return stored ? JSON.parse(stored) : null;
        }

        getTrackingQueue() {
            const stored = localStorage.getItem(this.QUEUE_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        hasPIN() {
            const pinData = this.getPINData();
            return !!(pinData && pinData.pin);
        }

        hasOfflineSession() {
            return !!this.getOfflineSession();
        }

        async hashPIN(pin) {
            const encoder = new TextEncoder();
            const data = encoder.encode(pin + 'vidje-2025-salt');
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        clearOfflineSession() {
            localStorage.removeItem(this.STORAGE_KEY);
            localStorage.removeItem(this.PIN_KEY);
            sessionStorage.removeItem('vidje_active_session');
            console.log('[OK] Offline session cleared');
        }

        updateOfflineSession(updates) {
            const session = this.getOfflineSession();
            if (session) {
                const updated = { ...session, ...updates, savedAt: Date.now() };
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(updated));
                console.log('[OK] Offline session updated');
            }
        }
    }

    window.VidjeHybridAuth = new VidjeHybridAuth();
    console.log('[OK] Vidje Hybrid Auth System Loaded');

})();
    `;
    document.head.appendChild(script);
    console.log('[OK] Hybrid Auth injected');
})();

// ============================================================
// 2. MODIFY TRACKING TO SUPPORT OFFLINE QUEUE
// ============================================================

// Override trackSongPlay untuk support offline queue
(function overrideTracking() {
    const originalTrackSongPlay = window.vidjeTracking?.trackSongPlay;
    
    if (originalTrackSongPlay) {
        window.vidjeTracking.trackSongPlay = async function(songData) {
            // Jika offline, queue tracking
            if (!navigator.onLine) {
                console.log(' Offline - Queueing track:', songData.song_name);
                window.VidjeHybridAuth.queueTrackingData(songData);
                return { queued: true };
            }
            
            // Jika online, track normal
            return await originalTrackSongPlay.call(this, songData);
        };
        
        console.log('[OK] Tracking system modified for offline support');
    }
})();

// ============================================================
// 3. AUTO-SYNC SAAT KEMBALI ONLINE
// ============================================================

window.addEventListener('online', async () => {
    console.log('[ONLINE] Back online! Syncing queued data...');
    
    // Sync tracking queue
    const result = await window.VidjeHybridAuth.syncTrackingQueue();
    
    if (result.synced > 0) {
        // Show notification
        const toast = document.createElement('div');
        toast.innerHTML = `
            <div style="position: fixed; bottom: 120px; right: 20px; 
                        background: linear-gradient(135deg, #34C759 0%, #30B350 100%); 
                        color: white; padding: 16px 24px; border-radius: 12px; 
                        font-weight: 600; z-index: 99999; 
                        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
                        animation: slideIn 0.3s ease;">
                <strong>Synced!</strong> ${result.synced} lagu di-sync ke Wrapped!
            </div>
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => toast.remove(), 4000);
    }
});

// ============================================================


// ============================================================
//  VIDJE TRACKING INTEGRATION - ULTIMATE FIX
// ============================================================
// Kode ini mengakses langsung variabel global: songs & currentSongIndex
// ============================================================

console.log('[MUSIC] Initializing Vidje tracking integration (ULTIMATE FIX)...');

// Load vidje-tracking.js script if not already loaded
if (!window.vidjeTracking) {
    console.log(' Loading vidje-tracking.js...');
    const script = document.createElement('script');
    script.src = 'vidje-tracking.js';
    script.onload = function() {
        console.log('[OK] vidje-tracking.js loaded');
        initializeTracking();
    };
    script.onerror = function() {
        console.error('[ERROR] Failed to load vidje-tracking.js');
        console.error('Make sure vidje-tracking.js is in the same directory as index.html');
    };
    document.head.appendChild(script);
} else {
    console.log('[OK] vidje-tracking.js already loaded');
    initializeTracking();
}

function initializeTracking() {
    // ============================================================
    // METHOD 1: Akses langsung dari variabel global (MOST RELIABLE)
    // ============================================================
    
    function getCurrentSongFromGlobalVariable() {
        // Check if global variables exist
        if (typeof currentSongIndex !== 'undefined' && typeof songs !== 'undefined') {
            const song = songs[currentSongIndex];
            if (song && song.title && song.artist) {
                return {
                    title: song.title,
                    artist: song.artist,
                    duration: parseDuration(song.duration),
                    cover: song.cover
                };
            }
        }
        return null;
    }
    
    // ============================================================
    // METHOD 2: Akses dari DOM elements (FALLBACK)
    // ============================================================
    
    function getCurrentSongFromDOM() {
        const titleElement = document.getElementById('new-song-title') || 
                            document.querySelector('.current-song-title');
        
        const artistElement = document.getElementById('new-song-artist') ||
                             document.querySelector('.current-artist');
        
        const title = titleElement?.textContent?.trim();
        const artist = artistElement?.textContent?.trim();
        
        if (title && title !== '-' && title !== 'Unknown' && title !== '') {
            return {
                title,
                artist: artist || 'Unknown Artist'
            };
        }
        
        return null;
    }
    
    // ============================================================
    // COMBINED METHOD: Try global first, fallback to DOM
    // ============================================================
    
    function getCurrentSongInfo() {
        // Try Method 1 first (most reliable - gets full data)
        let songInfo = getCurrentSongFromGlobalVariable();
        
        if (songInfo) {
            console.log('[OK] Got song from global variable:', songInfo.title);
            return songInfo;
        }
        
        // Fallback to Method 2 (DOM)
        songInfo = getCurrentSongFromDOM();
        
        if (songInfo) {
            console.log(' Got song from DOM (fallback):', songInfo.title);
            return songInfo;
        }
        
        console.warn(' Could not get song info from any method');
        return null;
    }
    
    // ============================================================
    // HELPER: Parse duration string to seconds
    // ============================================================
    
    function parseDuration(durationStr) {
        if (!durationStr) return 210; // default 3.5 minutes
        
        if (typeof durationStr === 'number') return durationStr;
        
        // Format: "4:03" or "10:13"
        const parts = durationStr.split(':');
        if (parts.length === 2) {
            const minutes = parseInt(parts[0]) || 0;
            const seconds = parseInt(parts[1]) || 0;
            return (minutes * 60) + seconds;
        }
        
        return 210; // default
    }
    
    // ============================================================
    // AUTO-TRACK: Setup event listeners
    // ============================================================
    
    setTimeout(() => {
        const audio = document.getElementById('audio-player');
        
        if (audio) {
            console.log(' Audio player found, attaching tracker...');
            
            // Track when song starts playing
            audio.addEventListener('play', function() {
                // Small delay to ensure variables are updated
                setTimeout(() => {
                    const songInfo = getCurrentSongInfo();
                    
                    if (songInfo && window.vidjeTracking) {
                        const duration = songInfo.duration || audio.duration || 210;
                        
                        console.log('[MUSIC] Now playing:', songInfo.title, 'by', songInfo.artist);
                        console.log(' Duration:', duration, 'seconds');
                        
                        // Track the song play
                        window.vidjeTracking.trackSongPlay({
                            song_name: songInfo.title,
                            artist_name: songInfo.artist,
                            duration: duration,
                            cover_url: songInfo.cover || null,
                            audio_url: audio.src || null
                        }).then(result => {
                            if (result) {
                                console.log('[OK] Tracked successfully:', songInfo.title);
                            }
                        }).catch(error => {
                            console.error('[ERROR] Tracking failed:', error);
                        });
                    } else {
                        console.warn(' Could not track - song info or tracking system not available');
                    }
                }, 300); // Wait 300ms for variables to update
            });
            
            console.log('[OK] Auto-tracker activated!');
        } else {
            console.warn(' Audio element not found');
        }
    }, 2000); // Wait 2 seconds for page load
    
    // ============================================================
    // TESTING COMMANDS
    // ============================================================
    
    window.testTracking = async function() {
        console.log(' Testing tracking system...');
        
        const songInfo = getCurrentSongInfo();
        
        if (songInfo && window.vidjeTracking) {
            console.log(' Current song detected:', songInfo);
            
            const result = await window.vidjeTracking.trackSongPlay({
                song_name: songInfo.title,
                artist_name: songInfo.artist,
                duration: songInfo.duration || 180,
                cover_url: songInfo.cover || null,
                audio_url: null
            });
            
            console.log('[OK] Test result:', result);
        } else if (!songInfo) {
            console.log(' No song currently playing, using dummy data...');
            
            const result = await window.vidjeTracking.trackSongPlay({
                song_name: 'Test Song',
                artist_name: 'Test Artist',
                duration: 180,
                cover_url: null,
                audio_url: null
            });
            
            console.log('[OK] Test result:', result);
        } else {
            console.error('[ERROR] Tracking system not loaded');
        }
    };
    
    window.viewMyStats = async function() {
        if (!window.vidjeTracking) {
            console.error('[ERROR] Tracking not loaded');
            return;
        }
        
        console.log(' Fetching your statistics...');
        
        const stats = await window.vidjeTracking.getListeningStats();
        const topSongs = await window.vidjeTracking.getTopSongs(10);
        const topArtists = await window.vidjeTracking.getTopArtists(5);
        
        console.log(' Your Stats:');
        console.log('  - Total Plays:', stats.totalPlays);
        console.log('  - Total Minutes:', stats.totalMinutes);
        console.log('  - Unique Songs:', stats.uniqueSongs);
        console.log('  - Unique Artists:', stats.uniqueArtists);
        console.log('');
        console.log('[MUSIC] Your Top 10 Songs:');
        console.table(topSongs);
        console.log(' Your Top 5 Artists:');
        console.table(topArtists);
        
        return { stats, topSongs, topArtists };
    };
    
    window.getCurrentSongInfo = getCurrentSongInfo;
    
    window.debugSongInfo = function() {
        console.log('[DEBUG] Debugging song info...');
        console.log('');
        
        // Check global variables
        console.log('Global Variables:');
        console.log('  - typeof currentSongIndex:', typeof currentSongIndex);
        console.log('  - typeof songs:', typeof songs);
        
        if (typeof currentSongIndex !== 'undefined' && typeof songs !== 'undefined') {
            console.log('  - currentSongIndex value:', currentSongIndex);
            console.log('  - songs.length:', songs.length);
            console.log('  - current song:', songs[currentSongIndex]);
        }
        console.log('');
        
        // Check DOM elements
        console.log('DOM Elements:');
        const titleEl = document.getElementById('new-song-title');
        const artistEl = document.getElementById('new-song-artist');
        console.log('  - #new-song-title:', titleEl?.textContent);
        console.log('  - #new-song-artist:', artistEl?.textContent);
        console.log('');
        
        // Get song info
        console.log('Song Info Methods:');
        console.log('  - From Global Variable:', getCurrentSongFromGlobalVariable());
        console.log('  - From DOM:', getCurrentSongFromDOM());
        console.log('  - Combined:', getCurrentSongInfo());
    };
    
    console.log('[OK] Vidje tracking integration ready!');
    console.log(' Available commands:');
    console.log('  - testTracking()       - Test tracking with current song');
    console.log('  - viewMyStats()        - View your listening statistics');
    console.log('  - getCurrentSongInfo() - Check what song is detected');
    console.log('  - debugSongInfo()      - Debug song detection (shows all methods)');
}

// ============================================================
// END OF TRACKING INTEGRATION (ULTIMATE FIX)
// ============================================================


// ============================================================
//  VIDJE LISTENING HISTORY AUTO-TRACKER (FIXED VERSION)
// ============================================================
console.log('[MUSIC] Initializing Vidje listening tracker (FIXED)...');

// STEP 1: Function untuk log ke database
async function logSong(songName, artistName, duration, coverUrl) {
    try {
        // Cek user login
        if (!auth.currentUser) {
            console.log(' User not logged in, skipping log');
            return;
        }

        // Validasi data
        if (!songName || songName === 'Unknown' || songName === '-') {
            console.log(' Invalid song name, skipping log');
            return;
        }

        // Insert ke Supabase
        const { data, error } = await supabase
            .from('listening_history')
            .insert([{
                user_id: auth.currentUser.uid,
                song_name: songName,
                artist_name: artistName || 'Unknown Artist',
                duration_minutes: duration / 60, // convert detik ke menit
                cover_url: coverUrl || null, //  TAMBAHKAN COVER URL
                played_at: new Date().toISOString()
            }]);

        if (error) {
            console.error('[ERROR] Error logging to Supabase:', error);
        } else {
            console.log('[OK] Logged:', songName, 'by', artistName, '| Cover:', coverUrl ? '' : '');
        }
    } catch (error) {
        console.error('[ERROR] Unexpected error:', error);
    }
}

// STEP 2: Function untuk ambil info lagu saat ini
function getCurrentSongInfo() {
    // Method 1: Dari DOM elements yang sudah di-update
    const titleElement = document.getElementById('new-song-title') || 
                        document.querySelector('.current-song-title') ||
                        document.querySelector('.song-title-text');
    
    const artistElement = document.getElementById('new-song-artist') ||
                         document.querySelector('.current-artist') ||
                         document.querySelector('.artist-name-text');
    
    const title = titleElement?.textContent?.trim();
    const artist = artistElement?.textContent?.trim();
    
    // Method 2: Dari global variables (untuk mendapatkan cover)
    let cover = null;
    if (typeof currentSongIndex !== 'undefined' && typeof songs !== 'undefined') {
        const song = songs[currentSongIndex];
        if (song) {
            cover = song.cover;
            // Jika title/artist tidak ada dari DOM, ambil dari song object
            if (!title || title === '-') {
                return { title: song.title, artist: song.artist, cover: song.cover };
            }
        }
    }
    
    // Validasi
    if (title && title !== '-' && title !== 'Unknown') {
        return { title, artist: artist || 'Unknown Artist', cover };
    }
    
    console.warn(' Could not get song info');
    return null;
}

// STEP 3: Auto-track saat lagu diputar
setTimeout(() => {
    const audio = document.getElementById('audio-player');
    
    if (audio) {
        console.log(' Audio player found, attaching tracker...');
        
        // Track saat lagu mulai play
        audio.addEventListener('play', function() {
            // Tunggu sebentar agar DOM ter-update
            setTimeout(() => {
                const songInfo = getCurrentSongInfo();
                
                if (songInfo) {
                    const duration = audio.duration || 210; // default 3.5 menit
                    console.log('[MUSIC] Now playing:', songInfo.title, 'by', songInfo.artist);
                    logSong(songInfo.title, songInfo.artist, duration, songInfo.cover);
                } else {
                    console.log(' Could not detect song info');
                }
            }, 500); // Tunggu 500ms untuk DOM update
        });
        
        console.log('[OK] Auto-tracker activated!');
    } else {
        console.warn(' Audio element not found');
    }
}, 2000); // Tunggu 2 detik supaya semua element loaded

// STEP 4: Alternative tracking via window event (backup method)
window.addEventListener('songChanged', function(event) {
    if (event.detail && event.detail.song) {
        const song = event.detail.song;
        console.log('[MUSIC] Song changed event:', song.title);
        logSong(song.title, song.artist, song.duration || 210, song.cover);
    }
});

// BONUS: Testing commands
window.testLog = function() {
    logSong('Test Song', 'Test Artist', 180, 'https://example.com/cover.jpg');
    console.log('[OK] Test log sent! Check Supabase dashboard.');
};

window.myStats = async function() {
    if (!auth.currentUser) {
        console.log(' Please login first');
        return;
    }
    
    try {
        const { data, error } = await supabase
            .from('listening_history')
            .select('*')
            .eq('user_id', auth.currentUser.uid)
            .order('played_at', { ascending: false })
            .limit(10);
        
        if (error) {
            console.error('[ERROR] Error:', error);
            return;
        }
        
        console.log('[MUSIC] Your last 10 songs:');
        console.table(data);
        return data;
    } catch (error) {
        console.error('[ERROR] Error:', error);
    }
};

window.getCurrentSong = function() {
    const info = getCurrentSongInfo();
    console.log('[MUSIC] Current song:', info);
    return info;
};

console.log('[OK] Vidje tracker ready! (FIXED VERSION)');
console.log(' Commands:');
console.log('   testLog()        - Test logging');
console.log('   myStats()        - See your last 10 songs');
console.log('   getCurrentSong() - Check what song is detected');

// ============================================================
// END OF VIDJE TRACKER (FIXED)
// ============================================================



        // --- BASE SONGS (Original 1-20) ---
        const baseSongs = [
            { id: 1, title: "Sedia Aku Sebelum Hujan", artist: "Idgitaf", album: "Single", duration: "4:03", cover: "https://picsum.photos/seed/idgitaf/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/idgitaf/sediaakusebelumhujan.mp3" },
            { id: 2, title: "All Too Well (10 Minute Version)", artist: "Taylor Swift", album: "Red (Taylor's Version)", duration: "10:13", cover: "https://picsum.photos/seed/taylor/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/taylorswift/alltoowell(10minuteversion).mp3" },
            { id: 3, title: "Di Sarankan Di Bandung", artist: "Dongker, Jason Ranti", album: "Single", duration: "3:45", cover: "https://picsum.photos/seed/dongker/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/dongker,jasonranti/disarankandibandung.mp3" },
            { id: 4, title: "Jatuh Suka", artist: "Tulus", album: "Manusia", duration: "3:50", cover: "https://picsum.photos/seed/tulus/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tulus/jatuhsuka.mp3" },
            { id: 5, title: "I Love You, I'm Sorry", artist: "Gracie Abrams", album: "The Secret of Us", duration: "3:08", cover: "https://picsum.photos/seed/gracie/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/gracieabrams/iloveyou,i'msorry.mp3" },
            { id: 6, title: "Die On This Hill", artist: "Sienna Spiro", album: "Single", duration: "3:12", cover: "https://picsum.photos/seed/sienna/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/siennaspiro/dieonthishill.mp3" },
            { id: 7, title: "33x", artist: "Perunggu", album: "Single", duration: "4:00", cover: "https://picsum.photos/seed/perunggu1/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/perunggu/33x.mp3" },
            { id: 8, title: "Gemilang", artist: "Perunggu", album: "Single", duration: "3:30", cover: "https://picsum.photos/seed/perunggu2/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/perunggu/gemilang.mp3" },
            { id: 9, title: "My Love", artist: "Westlife", album: "Coast to Coast", duration: "3:52", cover: "https://picsum.photos/seed/westlife/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/westlife/mylove.mp3" },
            { id: 10, title: "The Winner Takes It All", artist: "Abba", album: "Super Trouper", duration: "4:54", cover: "https://picsum.photos/seed/abba/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/abba/thewinnertakesitall.mp3" },
            { id: 11, title: "Kengkuz Music", artist: "Biggy Do", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/biggydo/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/biggydo/kengkuzmusic.mp3" },
            { id: 12, title: "Man I Need", artist: "Olivia Dean", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/oliviadean/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/oliviadean/manineed.mp3" },
            { id: 13, title: "Berubah", artist: "Tenxi", album: "Single", duration: "3:21", cover: "https://picsum.photos/seed/tenxi/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tenxi/berubah.mp3" },
            { id: 14, title: "Mawar Merah", artist: "Slank", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/slank/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/slank/mawarmerah.mp3" },
            { id: 15, title: "Danza Kuduro", artist: "Don Omar", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/donomar/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/donomar/danzakuduro.mp3" },
            { id: 16, title: "Raindance", artist: "Dave", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/dave/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/dave/raindance.mp3" },
            { id: 17, title: "Mimosa 2000", artist: "Kobr", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/kobr/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/kobr/mimosa2000.mp3" },
            { id: 18, title: "Snooze", artist: "SZA", album: "SOS", duration: "3:00", cover: "https://picsum.photos/seed/sza/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/sza/snooze.mp3" },
            { id: 19, title: "Me & U", artist: "Tems", album: "For Broken Ears", duration: "3:00", cover: "https://picsum.photos/seed/tems/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tems/me&u.mp3" },
            { id: 20, title: "Jangan Calling", artist: "Ova Libeno", album: "Single", duration: "3:00", cover: "https://picsum.photos/seed/ovalibeno/300/300", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/ovalibeno/jangancalling.mp3" }
        ];

        // --- MAIN LIST (ID 30-256) ---
        let mainListId = 30;


        const mainBandSongs = [];

        // 1. PERUNGGU
        const perungguRaw = [
            { title: "Kalibata 2012", src: "kalibata2012.mp3" },
            { title: "33x", src: "33x.mp3" },
            { title: "Tapi", src: "tapi.mp3" },
            { title: "Ini Abadi", src: "iniabadi.mp3" },
            { title: "Pastikan Riuh Akhiri Malammu", src: "pastikanriuhakhirimalammu.mp3" },
            { title: "Amalan Baik", src: "amalanbaik.mp3" },
            { title: "Gemilang", src: "gemilang.mp3" },
            { title: "Menyala", src: "menyala.mp3" }
        ];
        perungguRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 30 + i,
                title: item.title,
                artist: "Perunggu",
                album: "Single",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/perunggu.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/perunggu/${item.src}`
            });
        });

        // 2. NOAH
        const noahRaw = [
            { title: "Separuh Aku", src: "separuhaku.mp3" },
            { title: "Yang Terdalam", src: "yangterdalam.mp3" },
            { title: "Tak Bisakah", src: "takbisakah.mp3" },
            { title: "Menghapus Jejakmu", src: "menghapusjejakmu.mp3" },
            { title: "Semua Tentang Kita", src: "semuatentangkita.mp3" },
            { title: "Mungkin Nanti", src: "mungkinnanti.mp3" },
            { title: "Ada Apa Denganmu", src: "adaapadenganmu.mp3" },
            { title: "Bintang di Surga", src: "bintangdisurga.mp3" },
            { title: "Walau Habis Terang", src: "walauhabisterang.mp3" },
            { title: "Hidup Untukmu, Mati Tanpamu", src: "hidupuntukmu,matitanpamu.mp3" }
        ];
        noahRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 42 + i,
                title: item.title,
                artist: "NOAH",
                album: "Best of",
                duration: "4:10",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/noah.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/noah/${item.src}`
            });
        });

        // 3. DEWA 19
        const dewaRaw = [
            { title: "Kangen", src: "kangen.mp3" },
            { title: "Separuh Nafas", src: "separuhnafas.mp3" },
            { title: "Risalah Hati", src: "risalahhati.mp3" },
            { title: "Pupus", src: "pupus.mp3" },
            { title: "Cinta Kan Membawamu Kembali", src: "cintakanmembawamukembali.mp3" },
            { title: "Aku Milikmu (Malam Ini)", src: "akumilikmumalamini.mp3" },
            { title: "Roman Picisan", src: "romanpicisan.mp3" },
            { title: "Dewi", src: "dewi.mp3" },
            { title: "Arjuna", src: "arjuna.mp3" },
            { title: "Kamulah Satu-Satunya", src: "kamulahsatu-satunya.mp3" },
            { title: "Cukup Siti Nurbaya", src: "cukupsitinurbaya.mp3" },
            { title: "Takkan Ada Cinta Yang Lain", src: "takkanadacintayanglain.mp3" },
            { title: "Mistikus Cinta", src: "mistikuscinta.mp3" }
        ];
        dewaRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 57 + i,
                title: item.title,
                artist: "Dewa 19",
                album: "Legends",
                duration: "4:20",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/dewa19/${item.src}`
            });
        });

        // 4. SHEILA ON 7
        const sheilaRaw = [
            { title: "Dan", src: "dan.mp3" },
            { title: "Sephia", src: "sephia.mp3" },
            { title: "Melompat Lebih Tinggi", src: "melompatlebihtinggi.mp3" },
            { title: "Film Favorit", src: "filmfavorit.mp3" },
            { title: "Sahabat Sejati", src: "sahabatsejati.mp3" },
            { title: "Betapa", src: "betapa.mp3" },
            { title: "J.A.P", src: "j.a.p.mp3" },
            { title: "Hari Bersamanya", src: "haribersamanya.mp3" },
            { title: "Bila Kau Tak di Sampingku", src: "bilakautakdisampingku.mp3" },
            { title: "Pemuja Rahasia", src: "pemujarahasia.mp3" }
        ];
        sheilaRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 72 + i,
                title: item.title,
                artist: "Sheila On 7",
                album: "Classic",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/so7.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/sheilaon7/${item.src}`
            });
        });

        // 5. KAHITNA
        const kahitnaRaw = [
            { title: "Cantik", src: "cantik.mp3" },
            { title: "Cerita Cinta", src: "ceritacinta.mp3" },
            { title: "Titik Nadir", src: "titiknadir.mp3" },
            { title: "Soulmate", src: "soulmate.mp3" },
            { title: "Mantan Terindah", src: "mantanterindah.mp3" },
            { title: "Seribu Bulan", src: "seribubulan.mp3" },
            { title: "Aku, Dirimu, Dirinya", src: "aku,dirimu,dirinya.mp3" },
            { title: "Engga Ngerti", src: "enggangerti.mp3" },
            { title: "Untukku", src: "untukku.mp3" },
            { title: "Sampai Nanti", src: "sampainanti.mp3" },
            { title: "Rahasia Cinta", src: "rahasiacinta.mp3" }
        ];
        kahitnaRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 87 + i,
                title: item.title,
                artist: "Kahitna",
                album: "Romance",
                duration: "4:05",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kahitna.jpeg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/kahitna/${item.src}`
            });
        });

        // 6. HINDIA
        const hindiaRaw = [
            { title: "Secukupnya", src: "secukupnya.mp3" },
            { title: "Evaluasi", src: "evaluasi.mp3" },
            { title: "Rumah Ke Rumah", src: "rumahkerumah.mp3" },
            { title: "Besok Mungkin Kita Sampai", src: "besokmungkinkitasampai.mp3" },
            { title: "Dehidrasi", src: "dehidrasi.mp3" },
            { title: "Membasuh", src: "membasuh.mp3" },
            { title: "Apapun Yang Terjadi", src: "apapunyangterjadi.mp3" },
            { title: "Untuk Apa / Untuk Apa?", src: "untukapauntukapa.mp3" },
            { title: "Jam Makan Siang", src: "jammakansiang.mp3" },
            { title: "Mata Air", src: "mataair.mp3" },
            { title: "Cincin", src: "cincin.mp3" },
            { title: "Everything You Are", src: "everythingyouare.mp3" },
            { title: "Nabi Palsu", src: "nabipalsu.mp3" },
            { title: "Semua Lagu Cinta Terdengar Sama", src: "semualagucintaterdengarsama.mp3" },
            { title: "Ramai Sepi Bersama", src: "ramaisepibersama.mp3" },
            { title: "Loved By You", src: "lovedbyyou.mp3" },
            { title: "Betty", src: "betty.mp3" },
            { title: "Bayangkan Kita Tidak Menyerah", src: "bayangkanjikakitatidakmenyerah.mp3" },
        ];
        hindiaRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 100 + i,
                title: item.title,
                artist: "Hindia",
                album: "Menari Dengan Bayangan",
                duration: "4:30",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hindia.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/hindia/${item.src}`
            });
        });

        // 7. ASTRID
        const astridRaw = [
            { title: "Mendua", src: "mendua.mp3" },
            { title: "Tentang Rasa", src: "tentangrasa.mp3" },
            { title: "Jadikan Aku Yang Kedua", src: "jadikanakuyangkedua.mp3" },
            { title: "Aku Bisa Apa", src: "akubisaapa.mp3" },
            { title: "Tak Ingin Dicintai", src: "takingindicintai.mp3" }
        ];
        astridRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 118 + i,
                title: item.title,
                artist: "Astrid",
                album: "Single",
                duration: "3:55",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/astrid.webp",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/astrid/${item.src}`
            });
        });

        // 8. AFGAN
        const afganRaw = [
            { title: "Terima Kasih Cinta", src: "terimakasihcinta.mp3" },
            { title: "Sadis", src: "sadis.mp3" },
            { title: "Bukan Cinta Biasa", src: "bukancintabiasa.mp3" },
            { title: "Jodoh Pasti Bertemu", src: "jodohpastibertemu.mp3" },
            { title: "Cinta Tanpa Syarat", src: "cintatanpasyarat.mp3" },
            { title: "Kamu Yang Kutunggu", src: "kamuyangkutunggu.mp3" },
            { title: "Bawalah Cintaku", src: "bawalahcintaku.mp3" },
            { title: "Kacamata", src: "kacamata.mp3" }
        ];
        afganRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 123 + i,
                title: item.title,
                artist: "Afgan",
                album: "Single",
                duration: "4:00",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/afgan.png",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/afgan/${item.src}`
            });
        });

        // 9. TULUS
        const tulusRaw = [
            { title: "Sepatu", src: "sepatu.mp3" },
            { title: "Monokrom", src: "monokrom.mp3" },
            { title: "Teman Hidup", src: "temanhidup.mp3" },
            { title: "Pamit", src: "pamit.mp3" },
            { title: "1000 Tahun Lamanya", src: "1000tahunlamanya.mp3" },
            { title: "Diri", src: "diri.mp3" },
            { title: "Hati-Hati di Jalan", src: "hati-hatidijalan.mp3" },
            { title: "Interaksi", src: "interaksi.mp3" },
            { title: "Jatuh Suka", src: "jatuhsuka.mp3" },
            { title: "Tujuh Belas", src: "tujuhbelas.mp3" }
        ];
        tulusRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 131 + i,
                title: item.title,
                artist: "Tulus",
                album: "Single",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tulus.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tulus/${item.src}`
            });
        });

        // 10. MAHALINI
        const mahaliniRaw = [
            { title: "Melawan Restu", src: "melawanrestu.mp3" },
            { title: "Sial", src: "sial.mp3" },
            { title: "Kisah Sempurna", src: "kisahsempurna.mp3" },
            { title: "Sisa Rasa", src: "sisarasa.mp3" },
            { title: "Mati-matian", src: "mati-matian.mp3" },
            { title: "Bawa Dia Kembali", src: "bawadiakembali.mp3" },
            { title: "Sampai Menutup Mata", src: "sampaimenutupmata.mp3" },
            { title: "Mencintaimu", src: "mencintaimu.mp3" }
        ];
        mahaliniRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 141 + i,
                title: item.title,
                artist: "Mahalini",
                album: "Single",
                duration: "4:15",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/mahalini.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/mahalini/${item.src}`
            });
        });

        // 11. TENXI
        const tenxiRaw = [
            { title: "Mejikuhibiniu", src: "mejikuhibiniu.mp3" },
            { title: "Kasih Aba Aba", src: "kasihabaaba.mp3" },
            { title: "Bintang 5", src: "bintang5.mp3" },
            { title: "Garam & Madu (Sakit Dadaku)", src: "garam&madu(sakitdadaku).mp3" },
            { title: "Berubah", src: "berubah.mp3" }
        ];
        tenxiRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 149 + i,
                title: item.title,
                artist: "Tenxi",
                album: "Single",
                duration: "3:21",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tenxi.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tenxi/${item.src}`
            });
        });

        // 12. TAYLOR SWIFT
        const taylorRaw = [
            { title: "Love Story", src: "lovestory.mp3" },
            { title: "You Belong With Me", src: "youbelongwithme.mp3" },
            { title: "Blank Space", src: "blankspace.mp3" },
            { title: "Shake It Off", src: "shakeitoff.mp3" },
            { title: "Bad Blood", src: "badblood.mp3" },
            { title: "Delicate", src: "delicate.mp3" },
            { title: "Anti-Hero", src: "anti-hero.mp3" },
            { title: "Cruel Summer", src: "cruelsummer.mp3" }
        ];
        taylorRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 154 + i,
                title: item.title,
                artist: "Taylor Swift",
                album: "Studio Albums",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/taylor.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/taylorswift/${item.src}`
            });
        });

        // 13. JUSTIN BIEBER
        const justinRaw = [
            { title: "Baby", src: "baby.mp3" },
            { title: "One Time", src: "onetime.mp3" },
            { title: "Sorry", src: "sorry.mp3" },
            { title: "Love Yourself", src: "loveyourself.mp3" },
            { title: "What Do You Mean?", src: "whatdoyoumean.mp3" },
            { title: "Boyfriend", src: "boyfriend.mp3" },
            { title: "Peaches", src: "peaches.mp3" },
            { title: "Stay", src: "stay.mp3" },
            { title: "Yummy", src: "yummy.mp3" },
            { title: "Never Say Never", src: "neversaynever.mp3" }
        ];
        justinRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 162 + i,
                title: item.title,
                artist: "Justin Bieber",
                album: "Studio Albums",
                duration: "3:30",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/justin.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/justinbieber/${item.src}`
            });
        });

        // 14. ED SHEERAN
        const edRaw = [
            { title: "Shape of You", src: "shapeofyou.mp3" },
            { title: "Perfect", src: "perfect.mp3" },
            { title: "Thinking Out Loud", src: "thinkingoutloud.mp3" },
            { title: "Photograph", src: "photograph.mp3" },
            { title: "Castle on the Hill", src: "castleonthehill.mp3" },
            { title: "Bad Habits", src: "badhabits.mp3" },
            { title: "Galway Girl", src: "galwaygirl.mp3" },
            { title: "Shivers", src: "shivers.mp3" },
            { title: "The A Team", src: "theateam.mp3" },
            { title: "Happier", src: "happier.mp3" }
        ];
        edRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 172 + i,
                title: item.title,
                artist: "Ed Sheeran",
                album: "Studio Albums",
                duration: "4:00",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ed.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/edsheeran/${item.src}`
            });
        });

        // 15. BRUNO MARS
        const brunoRaw = [
            { title: "Just the Way You Are", src: "justthewayyouare.mp3" },
            { title: "Grenade", src: "grenade.mp3" },
            { title: "Talking to the Moon", src: "talkingtothemoon.mp3" },
            { title: "Locked Out of Heaven", src: "lockedoutofheaven.mp3" },
            { title: "When I Was Your Man", src: "wheniwasyourman.mp3" },
            { title: "Thats what I like", src: "that'swhatilike.mp3" },
            { title: "Die With A Smile", src: "diewithasmile.mp3" },
            { title: "It Will Rain", src: "itwillrain.mp3" },
            { title: "Versace on the Floor", src: "versaceonthefloor.mp3" },
            { title: "Leave the Door Open", src: "leavethedooropen.mp3" }
        ];
        brunoRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 182 + i,
                title: item.title,
                artist: "Bruno Mars",
                album: "Studio Albums",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bruno.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/brunomars/${item.src}`
            });
        });

        // 16. DANIEL CAESAR
        const danielRaw = [
            { title: "Best Part", src: "bestpart.mp3" },
            { title: "Get You", src: "getyou.mp3" },
            { title: "Japanese Denim", src: "japanesedenim.mp3" },
            { title: "Cyanide", src: "cyanide.mp3" },
            { title: "Love Again", src: "loveagain.mp3" },
            { title: "Streetcar", src: "streetcar.mp3" },
            { title: "Who Hurt You?", src: "whohurtyou.mp3" },
            { title: "Who Knows", src: "whoknows.mp3" },
            { title: "Blessed", src: "blessed.mp3" },
            { title: "Always", src: "always.mp3" } 
        ];
        danielRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 192 + i,
                title: item.title,
                artist: "Daniel Caesar",
                album: "Studio Albums",
                duration: "3:40",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/daniel.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/danielcaesar/${item.src}`
            });
        });

        // 17. COLDPLAY
        const coldplayRaw = [
            { title: "Yellow", src: "yellow.mp3" },
            { title: "Fix You", src: "fixyou.mp3" },
            { title: "Viva La Vida", src: "vivalavida.mp3" },
            { title: "The Scientist", src: "thescientist.mp3" },
            { title: "Paradise", src: "paradise.mp3" },
            { title: "Clocks", src: "clocks.mp3" },
            { title: "A Sky Full of Stars", src: "askyfullofstars.mp3" },
            { title: "Hymn for the Weekend", src: "hymnfortheweekend.mp3" },
            { title: "Sparks", src: "sparks.mp3" },
            { title: "Adventure of a Lifetime", src: "adventureofalifetime.mp3" }
        ];
        coldplayRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 202 + i,
                title: item.title,
                artist: "Coldplay",
                album: "Studio Albums",
                duration: "4:10",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/coldplay.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/coldplay/${item.src}`
            });
        });

        // 18. ONE DIRECTION
        const onedirectionRaw = [
            { title: "What Makes You Beautiful", src: "whatmakesyoubeautiful.mp3" },
            { title: "Story of My Life", src: "storyofmylife.mp3" },
            { title: "One Thing", src: "onething.mp3" },
            { title: "Night Changes", src: "nightchanges.mp3" },
            { title: "Best Song Ever", src: "bestsongever.mp3" },
            { title: "Kiss You", src: "kissyou.mp3" },
            { title: "Drag Me Down", src: "dragmedown.mp3" },
            { title: "Steal My Girl", src: "stealmygirl.mp3" },
            { title: "Little Things", src: "littlethings.mp3" },
            { title: "Live While Were Young", src: "livewhilewereyoung.mp3" }
        ];
        onedirectionRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 212 + i,
                title: item.title,
                artist: "One Direction",
                album: "Studio Albums",
                duration: "3:20",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/onedirection.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/onedirection/${item.src}`
            });
        });

        // 19. GREEN DAY
        const greendayRaw = [
            { title: "American Idiot", src: "americanidiot.mp3" },
            { title: "Boulevard of Broken Dreams", src: "boulevardofbrokendreams.mp3" },
            { title: "Wake Me Up When September Ends", src: "wakemeupwhenseptemberends.mp3" },
            { title: "Holiday", src: "holiday.mp3" },
            { title: "21 Guns", src: "21guns.mp3" },
            { title: "Basket Case", src: "basketcase.mp3" },
            { title: "Good Riddance (Time of Your Life)", src: "goodriddancetimeofyourlife.mp3" },
            { title: "When I Come Around", src: "whenicomearound.mp3" },
            { title: "Know Your Enemy", src: "knowyourenemy.mp3" },
            { title: "Jesus of Suburbia", src: "jesusofsuburbia.mp3" }
        ];
        greendayRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 222 + i,
                title: item.title,
                artist: "Green Day",
                album: "Studio Albums",
                duration: "3:00",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/greenday.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/greenday/${item.src}`
            });
        });

        // 20. OASIS
        const oasisRaw = [
            { title: "Wonderwall", src: "wonderwall.mp3" },
            { title: "Dont Look Back in Anger", src: "dontlookbackinanger.mp3" },
            { title: "Champagne Supernova", src: "champagnesupernova.mp3" },
            { title: "Live Forever", src: "liveforever.mp3" },
            { title: "Stop Crying Your Heart Out", src: "stopcryingyourheartout.mp3" },
            { title: "Supersonic", src: "supersonic.mp3" },
            { title: "Stand by Me", src: "standbyme.mp3" },
            { title: "Whatever", src: "whatever.mp3" },
            { title: "Don't Go Away", src: "dontgoaway.mp3" },
            { title: "All Around The World", src: "allaroundtheworld.mp3" }
        ];
        oasisRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 232 + i,
                title: item.title,
                artist: "Oasis",
                album: "Studio Albums",
                duration: "4:15",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/oasis.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/oasis/${item.src}`
            });
        });

        // 21. RADIOHEAD
        const radioheadRaw = [
            { title: "Creep", src: "creep.mp3" },
            { title: "No Surprises", src: "nosurprises.mp3" },
            { title: "Karma Police", src: "karmapolice.mp3" },
            { title: "High and Dry", src: "highanddry.mp3" },
            { title: "Fake Plastic Trees", src: "fakeplastictrees.mp3" },
            { title: "Paranoid Android", src: "paranoidandroid.mp3" },
            { title: "Exit Music (For a Film)", src: "exitmusic(forafilm).mp3" },
            { title: "Lotus Flower", src: "lotusflower.mp3" },
            { title: "Street Spirit (Fade Out)", src: "streetspirit(fadeout).mp3" },
            { title: "Let Down", src: "letdown.mp3" }
        ];
        radioheadRaw.forEach((item, i) => {
            mainBandSongs.push({
                id: 242 + i,
                title: item.title,
                artist: "Radiohead",
                album: "Studio Albums",
                duration: "4:20",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/radiohead.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/radiohead/${item.src}`
            });
        });


        // --- HANUNG & RARA LOGIC (PRESERVED) ---
        let hanungId = 300;
        const hanungRawData = [
            { title: "Sedia Aku Sebelum Hujan", artist: "Idgitaf", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/idgitaf/sediaakusebelumhujan.mp3" },
            { title: "Titik Nadir", artist: "Kahitna", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/kahitna/titiknadir.mp3" },
            { title: "Disarankan Di Bandung", artist: "Dongker, Jason Ranti", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/dongker,jasonranti/disarankandibandung.mp3" },
            { title: "Firasat", artist: "Marcell", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/marcell/firasat.mp3" },
            { title: "33x", artist: "Perunggu", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/perunggu/33x.mp3" },
            { title: "Kota Ini Tak Sama Tanpamu", artist: "Nadhif Basalamah", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nadhifbasalamah/kotainitaksamatanpamu.mp3" }
        ];
        const hanungSongs = [];
        hanungRawData.forEach((item, index) => {
            hanungSongs.push({
                id: hanungId++,
                title: item.title,
                artist: item.artist,
                album: "Single",
                duration: "3:30",
                cover: `https://picsum.photos/seed/hanung${index + 100}/300/300`,
                src: item.src
            });
        });

        let raraId = 306;
        const raraRawData = [
            { title: "It's You", artist: "Ali Gatie", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/aligatie/itsyou.mp3" },
            { title: "P.S. I Love You", artist: "Paul Partohap", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/paulpartohap/p.s.iloveyou.mp3" },
            { title: "Can't Take My Eyes Off You", artist: "Frankie Valli", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/frankievalli/canttakesmyeyesoffyou.mp3" },
            { title: "You're Still The One", artist: "Shania Twain", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/shaniatwain/yourestilltheone.mp3" },
            { title: "Soulmate", artist: "Kahitna", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/kahitna/soulmate.mp3" }
        ];
        const raraSongs = [];
        raraRawData.forEach((item, index) => {
            raraSongs.push({
                id: raraId++,
                title: item.title,
                artist: item.artist,
                album: "Single",
                duration: "3:30",
                cover: `https://picsum.photos/seed/rara${index + 200}/300/300`,
                src: item.src
            });
        });

        // --- NEW ARTISTS STARTING FROM ID 400 ---
        // 1. Cigarettes After Sex
        const casRaw = [
            { title: "Apocalypse", src: "apocalypse.mp3" },
            { title: "K.", src: "k..mp3" },
            { title: "Nothing's Gonna Hurt You Baby", src: "nothingsgonnahurtyoubaby.mp3" },
            { title: "Sunsetz", src: "sunsetz.mp3" },
            { title: "Heavenly", src: "heavenly.mp3" },
            { title: "Sweet", src: "sweet.mp3" },
            { title: "Cry", src: "cry.mp3" },
            { title: "Pistol", src: "pistol.mp3" },
            { title: "Tejano Blue", src: "tejanoblue.mp3" },
            { title: "Bubblegum", src: "bubblegum.mp3" }
        ];
        let casId = 400;
        const casSongs = [];
        casRaw.forEach((item, i) => {
            casSongs.push({
                id: casId++,
                title: item.title,
                artist: "Cigarettes After Sex",
                album: "Singles",
                duration: "4:00",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/cas.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/cigarettesaftersex/${item.src}`
            });
        });

        // 2. Rex Orange County
        const rocRaw = [
            { title: "Loving Is Easy", src: "lovingiseasy.mp3" },
            { title: "Best Friend", src: "bestfriend.mp3" },
            { title: "Sunflower", src: "sunflower.mp3" },
            { title: "Amazing", src: "amazing.mp3" },
            { title: "Television So Far So Good", src: "televisionsofarsogood.mp3" },
            { title: "Keep It Up", src: "keepitup.mp3" },
            { title: "Corduroy Dreams", src: "corduroydreams.mp3" },
            { title: "Pluto Projector", src: "plutoprojector.mp3" },
            { title: "The Shade", src: "theshade.mp3" },
            { title: "Happiness", src: "happiness.mp3" }
        ];
        let rocId = 410;
        const rocSongs = [];
        rocRaw.forEach((item, i) => {
            rocSongs.push({
                id: rocId++,
                title: item.title,
                artist: "Rex Orange County",
                album: "Singles",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/roc.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/rexorangecounty/${item.src}`
            });
        });

        // 3. The Smiths
        const smithsRaw = [
            { title: "There Is a Light That Never Goes Out", src: "thereisalightthatnevergoesout.mp3" },
            { title: "This Charming Man", src: "thischarmingman.mp3" },
            { title: "How Soon Is Now?", src: "howsoonisnow.mp3" },
            { title: "Please, Please, Please, Let Me Get What I Want", src: "please,please,please,letmegetwhatiwant.mp3" },
            { title: "Heaven Knows I'm Miserable Now", src: "heavenknowsimmiserablenow.mp3" },
            { title: "Bigmouth Strikes Again", src: "bigmouthstrikesagain.mp3" },
            { title: "Panic", src: "panic.mp3" },
            { title: "The Boy with the Thorn in His Side", src: "theboywiththethorninhisside.mp3" },
            { title: "Ask", src: "ask.mp3" },
            { title: "Stop Me If You Think You've Heard This One Before", src: "stopmeifyouthinkyouveheardthisonebefore.mp3" }
        ];
        let smithsId = 420;
        const smithsSongs = [];
        smithsRaw.forEach((item, i) => {
            smithsSongs.push({
                id: smithsId++,
                title: item.title,
                artist: "The Smiths",
                album: "Singles",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thesmith.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thesmiths/${item.src}`
            });
        });

        // 4. Arctic Monkeys
        const arcticRaw = [
            { title: "Do I Wanna Know?", src: "doiwannaknow.mp3" },
            { title: "R U Mine?", src: "rumine.mp3" },
            { title: "505", src: "505.mp3" },
            { title: "Why'd You Only Call Me When You're High?", src: "whydyouonlycallmewhenyourehigh.mp3" },
            { title: "Fluorescent Adolescent", src: "fluorescentadolescent.mp3" },
            { title: "I Bet You Look Good on the Dancefloor", src: "ibetyoulookgoodonthedancefloor.mp3" },
            { title: "Arabella", src: "arabella.mp3" },
            { title: "Crying Lightning", src: "cryinglightning.mp3" },
            { title: "Snap Out of It", src: "snapoutofit.mp3" },
            { title: "Mardy Bum", src: "mardybum.mp3" }
        ];
        let arcticId = 430;
        const arcticSongs = [];
        arcticRaw.forEach((item, i) => {
            arcticSongs.push({
                id: arcticId++,
                title: item.title,
                artist: "Arctic Monkeys",
                album: "Singles",
                duration: "3:30",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/articmonkeys.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/arcticmonkeys/${item.src}`
            });
        });

        // 5. Queen
        const queenRaw = [
            { title: "Bohemian Rhapsody", src: "bohemianrhapsody.mp3" },
            { title: "Don't Stop Me Now", src: "don'tstopmenow.mp3" },
            { title: "We Will Rock You", src: "wewillrockyou.mp3" },
            { title: "We Are the Champions", src: "wearethechampions.mp3" },
            { title: "Another One Bites the Dust", src: "anotheronebitesthedust.mp3" },
            { title: "Killer Queen", src: "killerqueen.mp3" },
            { title: "Under Pressure", src: "underpressure.mp3" },
            { title: "Somebody to Love", src: "somebodytolove.mp3" },
            { title: "Radio Ga Ga", src: "radiogaga.mp3" },
            { title: "Love of My Life", src: "loveofmylife.mp3" }
        ];
        let queenId = 440;
        const queenSongs = [];
        queenRaw.forEach((item, i) => {
            queenSongs.push({
                id: queenId++,
                title: item.title,
                artist: "Queen",
                album: "Singles",
                duration: "3:55",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/queen.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/queen/${item.src}`
            });
        });

        // 6. The Stone Roses
        const stonerosesRaw = [
            { title: "I Wanna Be Adored", src: "iwannabeadored.mp3" },
            { title: "She Bangs the Drums", src: "shebangsthedrums.mp3" },
            { title: "Waterfall", src: "waterfall.mp3" },
            { title: "Fools Gold", src: "foolsgold.mp3" },
            { title: "I Am the Resurrection", src: "iamtheresurrection.mp3" },
            { title: "Made of Stone", src: "madeofstone.mp3" },
            { title: "Love Spreads", src: "lovespreads.mp3" },
            { title: "Ten Storey Love Song", src: "tenstoreylovesong.mp3" },
            { title: "Sally Cinnamon", src: "sallycinnamon.mp3" },
            { title: "This Is the One", src: "thisistheone.mp3" }
        ];
        let stonerosesId = 450;
        const stonerosesSongs = [];
        stonerosesRaw.forEach((item, i) => {
            stonerosesSongs.push({
                id: stonerosesId++,
                title: item.title,
                artist: "The Stone Roses",
                album: "Singles",
                duration: "4:10",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thestoneroses.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thestoneroses/${item.src}`
            });
        });

        // 7. Neck Deep
        const neckdeepRaw = [
            { title: "December", src: "december.mp3" },
            { title: "A Part of Me", src: "apartofme.mp3" },
            { title: "Wish You Were Here", src: "wishyouwerehere.mp3" },
            { title: "In Bloom", src: "inbloom.mp3" },
            { title: "Gold Steps", src: "goldsteps.mp3" },
            { title: "Kali Ma", src: "kalima.mp3" },
            { title: "Motion Sickness", src: "motionsickness.mp3" },
            { title: "Smooth Seas Don't Make Good Sailors", src: "smoothseasdontmakegoodsailors.mp3" },
            { title: "Dumbstruck Dumbfuck ", src: "dumbstruckdumbfuck.mp3" },
            { title: "We Need More Bricks", src: "weneedmorebricks.mp3" }
        ];
        let neckdeepId = 460;
        const neckdeepSongs = [];
        neckdeepRaw.forEach((item, i) => {
            neckdeepSongs.push({
                id: neckdeepId++,
                title: item.title,
                artist: "Neck Deep",
                album: "Singles",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/neckdeep.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/neckdeep/${item.src}`
            });
        });

        // 8. My Chemical Romance
        const mcrRaw = [
            { title: "Welcome to the Black Parade", src: "welcometotheblackparade.mp3" },
            { title: "Helena", src: "helena.mp3" },
            { title: "I'm Not Okay (I Promise)", src: "imnotokayipromise.mp3" },
            { title: "Teenagers", src: "teenagers.mp3" },
            { title: "Famous Last Words", src: "famouslastwords.mp3" },
            { title: "The Ghost of You", src: "theghostofyou.mp3" },
            { title: "Na Na Na", src: "nanana.mp3" },
            { title: "Cancer", src: "cancer.mp3" },
            { title: "Disenchanted", src: "disenchanted.mp3" },
            { title: "The Foundations of Decay", src: "thefoundationsofdecay.mp3" }
        ];
        let mcrId = 470;
        const mcrSongs = [];
        mcrRaw.forEach((item, i) => {
            mcrSongs.push({
                id: mcrId++,
                title: item.title,
                artist: "My Chemical Romance",
                album: "Singles",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/chemical.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/mychemicalromance/${item.src}`
            });
        });

        // 9. Bob Marley
        const bobmarleyRaw = [
            { title: "Three Little Birds", src: "threelittlebirds.mp3" },
            { title: "No Woman, No Cry", src: "nowomannocry.mp3" },
            { title: "One Love ", src: "onelove.mp3" },
            { title: "Redemption Song", src: "redemptionsong.mp3" },
            { title: "Is This Love", src: "isthislove.mp3" },
            { title: "Jamming", src: "jamming.mp3" },
            { title: "Could You Be Loved", src: "couldyoubeloved.mp3" },
            { title: "Buffalo Soldier", src: "buffalosoldier.mp3" },
            { title: "Get Up, Stand Up", src: "getupstandup.mp3" },
            { title: "Waiting in Vain", src: "waitinginvain.mp3" }
        ];
        let bobmarleyId = 480;
        const bobmarleySongs = [];
        bobmarleyRaw.forEach((item, i) => {
            bobmarleySongs.push({
                id: bobmarleyId++,
                title: item.title,
                artist: "Bob Marley",
                album: "Singles",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bob.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/bobmarley/${item.src}`
            });
        });

        // 10. Frank Ocean
        const frankRaw = [
            { title: "Pink + White", src: "pink+white.mp3" },
            { title: "Thinkin Bout You", src: "thinkinboutyou.mp3" },
            { title: "Nights", src: "nights.mp3" },
            { title: "Ivy", src: "ivy.mp3" },
            { title: "Pyramids", src: "pyramids.mp3" },
            { title: "Lost", src: "lost.mp3" },
            { title: "Chanel", src: "chanel.mp3" },
            { title: "Self Control", src: "selfcontrol.mp3" },
            { title: "Godspeed", src: "godspeed.mp3" },
            { title: "American Wedding", src: "americanwedding.mp3" }

        ];
        let frankId = 490;
        const frankSongs = [];
        frankRaw.forEach((item, i) => {
            frankSongs.push({
                id: frankId++,
                title: item.title,
                artist: "Frank Ocean",
                album: "Singles",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/frank.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/frankocean/${item.src}`
            });
        });

        // 11. Drake
        const drakeRaw = [
            { title: "God's Plan", src: "godsplan.mp3" },
            { title: "Hotline Bling", src: "hotlinebling.mp3" },
            { title: "One Dance", src: "onedance.mp3" },
            { title: "Passionfruit", src: "passionfruit.mp3" },
            { title: "Nice For What", src: "niceforwhat.mp3" },
            { title: "In My Feelings", src: "inmyfeelings.mp3" },
            { title: "Hold On, We're Going Home", src: "holdonweregoinghome.mp3" },
            { title: "Laugh Now Cry Later", src: "laughnowcrylater.mp3" },
            { title: "First Person Shooter", src: "firstpersonshooter.mp3" },
            { title: "Marvins Room", src: "marvinsroom.mp3" }
        ];
        let drakeId = 500;
        const drakeSongs = [];
        drakeRaw.forEach((item, i) => {
            drakeSongs.push({
                id: drakeId++,
                title: item.title,
                artist: "Drake",
                album: "Singles",
                duration: "3:40",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/drake.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/drake/${item.src}`
            });
        });

        // 12. Kendrick Lamar
        const kendrickRaw = [
            { title: "HUMBLE.", src: "humble..mp3" },
            { title: "Alright", src: "alright.mp3" },
            { title: "DNA.", src: "dna..mp3" },
            { title: "Money Trees", src: "moneytrees.mp3" },
            { title: "King Kunta", src: "kingkunta.mp3" },
            { title: "Swimming Pools (Drank)", src: "swimmingpoolsdrank.mp3" },
            { title: "m.A.A.d city", src: "m.a.a.dcity.mp3" },
            { title: "LOYALTY.", src: "loyalty..mp3" },
            { title: "Not Like Us", src: "notlikeus.mp3" },
            { title: "Bitch, Don't Kill My Vibe", src: "bitchdontkillmyvibe.mp3" }
        ];
        let kendrickId = 510;
        const kendrickSongs = [];
        kendrickRaw.forEach((item, i) => {
            kendrickSongs.push({
                id: kendrickId++,
                title: item.title,
                artist: "Kendrick Lamar",
                album: "Singles",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kendrick.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/kendricklamar/${item.src}`
            });
        });

        // 13. The Weeknd
        const weekndRaw = [
    { title: "Blinding Lights", src: "blindinglights.mp3" },
    { title: "Starboy", src: "starboy.mp3" },
    { title: "The Hills", src: "thehills.mp3" },
    { title: "Save Your Tears", src: "saveyourtears.mp3" },
    { title: "Can't Feel My Face", src: "cantfeelmyface.mp3" },
    { title: "Die For You", src: "dieforyou.mp3" },
    { title: "I Feel It Coming", src: "ifeelitcoming.mp3" },
    { title: "Call Out My Name", src: "calloutmyname.mp3" },
    { title: "Earned It", src: "earnedit.mp3" },
    { title: "Creepin' (Metro Boomin feat. The Weeknd)", src: "creepinmetroboominfeattheweeknd.mp3" }
];
        let weekndId = 520;
        const weekndSongs = [];
        weekndRaw.forEach((item, i) => {
            weekndSongs.push({
                id: weekndId++,
                title: item.title,
                artist: "The Weeknd",
                album: "Singles",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/theweekend.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/theweeknd/${item.src}`
            });
        });

        // 14. The 1975
        const the1975Raw = [
            { title: "Somebody Else", src: "somebodyelse.mp3" },
            { title: "Chocolate", src: "chocolate.mp3" },
            { title: "About You", src: "aboutyou.mp3" },
            { title: "Robbers", src: "robbers.mp3" },
            { title: "The Sound", src: "thesound.mp3" },
            { title: "It's Not Living (If It's Not With You)", src: "itsnotlivinifitsnotwithyou.mp3" },
            { title: "Love It If We Made It", src: "loveitifwemadeit.mp3" },
            { title: "Happiness", src: "happiness.mp3" },
            { title: "Girls", src: "girls.mp3" },
            { title: "I'm In Love With You", src: "iminlovewithyou.mp3" }
        ];
        let the1975Id = 530;
        const the1975Songs = [];
        the1975Raw.forEach((item, i) => {
            the1975Songs.push({
                id: the1975Id++,
                title: item.title,
                artist: "The 1975",
                album: "Singles",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/the1975.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/the1975/${item.src}`
            });
        });

        // 15. Olivia Rodrigo
        const oliviaRaw = [
            { title: "drivers license", src: "driverslicense.mp3" },
            { title: "good 4 u", src: "good4u.mp3" },
            { title: "vampire", src: "vampire.mp3" },
            { title: "traitor", src: "traitor.mp3" },
            { title: "deja vu", src: "dejavu.mp3" },
            { title: "brutal", src: "brutal.mp3" },
            { title: "bad idea right", src: "badidearight.mp3" },
            { title: "get him back", src: "gethimback.mp3" },
            { title: "happier", src: "happier.mp3" },
            { title: "all-american bitch", src: "all-americanbitch.mp3" }
        ];
        let oliviaId = 540;
        const oliviaSongs = [];
        oliviaRaw.forEach((item, i) => {
            oliviaSongs.push({
                id: oliviaId++,
                title: item.title,
                artist: "Olivia Rodrigo",
                album: "Singles",
                duration: "3:30",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/olivia.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/oliviarodrigo/${item.src}`
            });
        });

        // 16. The Chainsmokers
        const chainsmokersRaw = [
            { title: "Closer", src: "closer.mp3" },
            { title: "Something Just Like This", src: "somethingjustlikethis.mp3" },
            { title: "Don't Let Me Down", src: "dontletmedown.mp3" },
            { title: "Roses", src: "roses.mp3" },
            { title: "Paris", src: "paris.mp3" },
            { title: "Selfie", src: "selfie.mp3" },
            { title: "Takeaway", src: "takeaway.mp3" },
            { title: "Side Effects", src: "sideeffects.mp3" },
            { title: "All We Know", src: "allweknow.mp3" },
            { title: "High", src: "high.mp3" }
        ];
        let chainsmokersId = 550;
        const chainsmokersSongs = [];
        chainsmokersRaw.forEach((item, i) => {
            chainsmokersSongs.push({
                id: chainsmokersId++,
                title: item.title,
                artist: "The Chainsmokers",
                album: "Singles",
                duration: "3:40",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thechainmokers.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thechainsmokers/${item.src}`
            });
        });

        // 17. Avenged Sevenfold
        const avengedRaw = [
            { title: "Dear God", src: "deargod.mp3" },
            { title: "A Little Piece of Heaven", src: "alittlepieceofheaven.mp3" },
            { title: "Afterlife", src: "afterlife.mp3" },
            { title: "Nightmare", src: "nightmare.mp3" },
            { title: "Hail to the King", src: "hailtotheking.mp3" },
            { title: "So Far Away", src: "sofaraway.mp3" },
            { title: "Bat Country", src: "batcountry.mp3" },
            { title: "Unholy Confessions", src: "unholyconfessions.mp3" },
            { title: "The Stage", src: "thestage.mp3" },
            { title: "Buried Alive", src: "buriedalive.mp3" }
        ];
        let avengedId = 560;
        const avengedSongs = [];
        avengedRaw.forEach((item, i) => {
            avengedSongs.push({
                id: avengedId++,
                title: item.title,
                artist: "Avenged Sevenfold",
                album: "Singles",
                duration: "3:55",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/avenged.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/avengedsevenfold/${item.src}`
            });
        });

        // 18. Slank (INDONESIA)
        const slankRaw = [
            { title: "Ku Tak Bisa", src: "kutakbisa.mp3" },
            { title: "Terlalu Manis", src: "terlalumanis.mp3" },
            { title: "Balikin", src: "balikin.mp3" },
            { title: "I Miss U But I Hate U", src: "imissubutihateu.mp3" },
            { title: "Virus", src: "virus.mp3" },
            { title: "Kamu Harus Pulang", src: "kamuharuspulang.mp3" },
            { title: "Orkes Sakit Hati", src: "orkessakithati.mp3" },
            { title: "Mawar Merah", src: "mawarmerah.mp3" },
            { title: "Pandangan Pertama", src: "pandanganpertama.mp3" },
            { title: "Seperti Para Koruptor", src: "sepertiparakoruptor.mp3" }
        ];
        let slankId = 570;
        const slankSongs = [];
        slankRaw.forEach((item, i) => {
            slankSongs.push({
                id: slankId++,
                title: item.title,
                artist: "Slank",
                album: "Singles",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/slank.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/slank/${item.src}`
            });
        });

        // 19. Reality Club (INDONESIA)
        const realityclubRaw = [
            { title: "Anything You Want", src: "anythingyouwant.mp3" },
            { title: "Is It the Answer", src: "isittheanswer.mp3" },
            { title: "Alexandra", src: "alexandra.mp3" },
            { title: "2112", src: "2112.mp3" },
            { title: "Elastic Hearts", src: "elastichearts.mp3" },
            { title: "Telenovia", src: "telenovia.mp3" },
            { title: "Love Epiphany", src: "loveepiphany.mp3" },
            { title: "Am I Bothering You", src: "amibotheringyou.mp3" },
            { title: "Does It Happen", src: "doesithappen.mp3" },
            { title: "Desire", src: "desire.mp3" }
        ];
        let realityclubId = 580;
        const realityclubSongs = [];
        realityclubRaw.forEach((item, i) => {
            realityclubSongs.push({
                id: realityclubId++,
                title: item.title,
                artist: "Reality Club",
                album: "Singles",
                duration: "3:50",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/realityclub.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/realityclub/${item.src}`
            });
        });

        // 20. Nidji (INDONESIA)
        const nidjiRaw = [
            { title: "Laskar Pelangi", src: "laskarpelangi.mp3" },
            { title: "Hapus Aku", src: "hapusaku.mp3" },
            { title: "Sudah", src: "sudah.mp3" },
            { title: "Biarlah", src: "biarlah.mp3" },
            { title: "Sang Mantan", src: "sangmantan.mp3" },
            { title: "Disco Lazy Time", src: "discolazytime.mp3" },
            { title: "Arti Sahabat", src: "artisahabat.mp3" },
            { title: "Diatas Awan", src: "diatasawan.mp3" },
            { title: "Sumpah dan Cinta Matiku", src: "sumpahdancintamatiku.mp3" },
            { title: "Dosakah Aku", src: "dosakahaku.mp3" }
        ];
        let nidjiId = 590;
        const nidjiSongs = [];
        nidjiRaw.forEach((item, i) => {
            nidjiSongs.push({
                id: nidjiId++,
                title: item.title,
                artist: "Nidji",
                album: "Singles",
                duration: "3:45",
                cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/nidji.jpg",
                src: `https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nidji/${item.src}`
            });
        });

        // ===== 33 NEW ARTISTS =====
        // 1. Naykilla (600-604)
        const naykillaNewSongs = [
            { id: 600, title: "SO ASU", artist: "Naykilla", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/naykilla/soasu.mp3" },
            { id: 601, title: "You", artist: "Naykilla", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/naykilla/you.mp3" },
            { id: 602, title: "Honey & Lemon", artist: "Naykilla", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/naykilla/honey&lemon.mp3" },
            { id: 603, title: "2nd", artist: "Naykilla", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/naykilla/2nd.mp3" },
            { id: 604, title: "Believe", artist: "Naykilla", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/naykilla/believe.mp3" }
        ];
        // 2. Bernadya (605-609)
        const bernardyaNewSongs = [
            { id: 605, title: "Apa Mungkin", artist: "Bernadya", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/bernadya/apamungkin.mp3" },
            { id: 606, title: "Satu Bulan", artist: "Bernadya", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/bernadya/satubulan.mp3" },
            { id: 607, title: "Kini Mereka Tahu", artist: "Bernadya", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/bernadya/kinimerekatahu.mp3" },
            { id: 608, title: "Kata Mereka Ini Berlebihan", artist: "Bernadya", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/bernadya/katamerekainiberlebihan.mp3" },
            { id: 609, title: "Untungnya, Hidup Harus Tetap Berjalan", artist: "Bernadya", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/bernadya/untungnyahidupharustetapberjalan.mp3" }
        ];
        // 3. Iwan Fals (610-614)
        const iwanfalsNewSongs = [
            { id: 610, title: "Ibu", artist: "Iwan Fals", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/iwanfals/ibu.mp3" },
            { id: 611, title: "Bento", artist: "Iwan Fals", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/iwanfals/bento.mp3" },
            { id: 612, title: "Yang Terlupakan", artist: "Iwan Fals", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/iwanfals/yangterlupakan.mp3" },
            { id: 613, title: "Bongkar", artist: "Iwan Fals", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/iwanfals/bongkar.mp3" },
            { id: 614, title: "Pesawat Tempurku", artist: "Iwan Fals", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/iwanfals/pesawattempur.mp3" }
        ];
        // 4. Pamungkas (615-619)
        const pamungkasNewSongs = [
            { id: 615, title: "To the Bone", artist: "Pamungkas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/pamungkas/totthebone.mp3" },
            { id: 616, title: "One Only", artist: "Pamungkas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/pamungkas/oneonly.mp3" },
            { id: 617, title: "Monolog", artist: "Pamungkas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/pamungkas/monolog.mp3" },
            { id: 618, title: "Kenangan Manis", artist: "Pamungkas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/pamungkas/kenanganmanis.mp3" },
            { id: 619, title: "I Love You but I'm Letting Go", artist: "Pamungkas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/pamungkas/iloveyoubutimlettinggo.mp3" }
        ];
        // 5. K3bi (620-624)
        const kebiNewSongs = [
            { id: 620, title: "3 Pagi", artist: "K3bi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/k3bi/3pagi.mp3" },
            { id: 621, title: "Doa", artist: "K3bi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/k3bi/doa.mp3" },
            { id: 622, title: "Oke", artist: "K3bi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/k3bi/oke.mp3" },
            { id: 623, title: "Arah Timur", artist: "K3bi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/k3bi/arahtimur.mp3" },
            { id: 624, title: "Gucci with Nike", artist: "K3bi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/k3bi/gucciwithnike.mp3" }
        ];
        // 6. $afa (625-629)
        const safaNewSongs = [
            { id: 625, title: "Lokasi", artist: "$afa", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/$afa/lokasi.mp3" },
            { id: 626, title: "Pretty Nona", artist: "$afa", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/$afa/prettynona.mp3" },
            { id: 627, title: "Forza", artist: "$afa", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/$afa/forza.mp3" },
            { id: 628, title: "Sementara", artist: "$afa", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/$afa/sementara.mp3" },
            { id: 629, title: "Best Ex", artist: "$afa", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/$afa/bestex.mp3" }
        ];
        // 7. Tuantigabelas (630-634)
        const tuan13NewSongs = [
            { id: 630, title: "Move", artist: "Tuantigabelas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tuantigabelas/move.mp3" },
            { id: 631, title: "Westside", artist: "Tuantigabelas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tuantigabelas/westside.mp3" },
            { id: 632, title: "Lancang", artist: "Tuantigabelas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tuantigabelas/lancang.mp3" },
            { id: 633, title: "Rumah", artist: "Tuantigabelas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tuantigabelas/rumah.mp3" },
            { id: 634, title: "School Of Hard Knock", artist: "Tuantigabelas", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/tuantigabelas/schoolofhardknock.mp3" }
        ];
        // 8. Maudy Ayunda (635-639)
        const maudyNewSongs = [
            { id: 635, title: "Perahu Kertas", artist: "Maudy Ayunda", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maudyayunda/perahukertas.mp3" },
            { id: 636, title: "Untuk Apa", artist: "Maudy Ayunda", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maudyayunda/untukapa.mp3" },
            { id: 637, title: "Cinta Datang Terlambat", artist: "Maudy Ayunda", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maudyayunda/cintadatangterlambat.mp3" },
            { id: 638, title: "Tahu Diri", artist: "Maudy Ayunda", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maudyayunda/tahudiri.mp3" },
            { id: 639, title: "Jakarta Ramai", artist: "Maudy Ayunda", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maudyayunda/jakartaramai.mp3" }
        ];
        // 9. Glenn Fredly (640-644)
        const glennNewSongs = [
            { id: 640, title: "Januari", artist: "Glenn Fredly", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/glennfredly/januari.mp3" },
            { id: 641, title: "Sekali Ini Saja", artist: "Glenn Fredly", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/glennfredly/sekaliiinisaja.mp3" },
            { id: 642, title: "Akhir Cerita Cinta", artist: "Glenn Fredly", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/glennfredly/akhirceritacinta.mp3" },
            { id: 643, title: "Kasih Putih", artist: "Glenn Fredly", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/glennfredly/kasihputih.mp3" },
            { id: 644, title: "Terserah", artist: "Glenn Fredly", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/glennfredly/terserah.mp3" }
        ];
        // 10. Nadin Amizah (645-649)
        const nadinNewSongs = [
            { id: 645, title: "Bertaut", artist: "Nadin Amizah", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nadinamizah/bertaut.mp3" },
            { id: 646, title: "Rayuan Perempuan Gila", artist: "Nadin Amizah", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nadinamizah/rayuanperempuangila.mp3" },
            { id: 647, title: "Semua Aku Dirayakan", artist: "Nadin Amizah", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nadinamizah/semuaakudirayakan.mp3" },
            { id: 648, title: "Sorai", artist: "Nadin Amizah", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nadinamizah/sorai.mp3" },
            { id: 649, title: "Amin Paling Serius", artist: "Nadin Amizah", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/nadinamizah/aminpalingserius.mp3" }
        ];
        // 11. Sal Priadi (650-654)
        const salpriadiNewSongs = [
            { id: 650, title: "Gala Bunga Matahari", artist: "Sal Priadi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/salpriadi/galabungamatahari.mp3" },
            { id: 651, title: "Kita Usahakan Rumah Itu", artist: "Sal Priadi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/salpriadi/kitausahakanrumahitu.mp3" },
            { id: 652, title: "Mesra-mesraannya Kecil-kecilan Dulu", artist: "Sal Priadi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/salpriadi/mesra-mesraannyakecil-kecilandulu.mp3" },
            { id: 653, title: "Dari Planet Lain", artist: "Sal Priadi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/salpriadi/dariplanetlain.mp3" },
            { id: 654, title: "Semua lagu cinta", artist: "Sal Priadi", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/salpriadi/semualagucinta.mp3" }
        ];
        // 12. Juan Reza (655-659)
        const juanNewSongs = [
            { id: 655, title: "Ubur-Ubur Ikan Lele", artist: "Juan Reza", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juanreza/ubururikanlele.mp3" },
            { id: 656, title: "Orang Baru Lebe Gacor", artist: "Juan Reza", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juanreza/orangbarulebegacor.mp3" },
            { id: 657, title: "Pica Pica", artist: "Juan Reza", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juanreza/picapica.mp3" },
            { id: 658, title: "BADANSA", artist: "Juan Reza", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juanreza/badansa.mp3" },
            { id: 659, title: "Tabola Bale", artist: "Juan Reza", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juanreza/tabolabale.mp3" }
        ];
        // 13. NIKI (660-664)
        const nikiNewSongs = [
            { id: 660, title: "Lowkey", artist: "NIKI", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/niki/lowkey.mp3" },
            { id: 661, title: "Every Summertime", artist: "NIKI", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/niki/everysummertime.mp3" },
            { id: 662, title: "High School in Jakarta", artist: "NIKI", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/niki/highschoolinjakarta.mp3" },
            { id: 663, title: "Backburner", artist: "NIKI", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/niki/backburner.mp3" },
            { id: 664, title: "You'll Be in My Heart", artist: "NIKI", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/niki/you'llbeinmyheart.mp3" }
        ];
        // 14. Feast (665-669)
        const feastNewSongs = [
            { id: 665, title: "Peradaban", artist: "Feast", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/feast/peradaban.mp3" },
            { id: 666, title: "Nina", artist: "Feast", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/feast/nina.mp3" },
            { id: 667, title: "Kami Belum Tentu", artist: "Feast", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/feast/kamibelumtentu.mp3" },
            { id: 668, title: "Tarot", artist: "Feast", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/feast/tarot.mp3" },
            { id: 669, title: "Arteri", artist: "Feast", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/feast/arteri.mp3" }
        ];
        // 15. Panasdalam Bank (670-674)
        const panasdDataNewSongs = [
            { id: 670, title: "Barang siapa", artist: "The Panasdalam Bank", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thepanasdalambank/barangsiapa.mp3" },
            { id: 671, title: "Dulu Kita Masih Remaja", artist: "The Panasdalam Bank", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thepanasdalambank/dulukitamasihremaja.mp3" },
            { id: 672, title: "Berpisah", artist: "The Panasdalam Bank", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thepanasdalambank/berpisah.mp3" },
            { id: 673, title: "Kau Ada", artist: "The Panasdalam Bank", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thepanasdalambank/kauada.mp3" },
            { id: 674, title: "Dan Bandung", artist: "The Panasdalam Bank", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thepanasdalambank/danbandung.mp3" }
        ];
        // 16. Lomba Sihir (675-679)
        const lombaNewSongs = [
            { id: 675, title: "Hati dan Paru-Paru", artist: "Lomba Sihir", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lombasihir/hatidanparu-paru.mp3" },
            { id: 676, title: "Ribuan Memori", artist: "Lomba Sihir", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lombasihir/ribuanmemori.mp3" },
            { id: 677, title: "Mungkin Takut Perubahan", artist: "Lomba Sihir", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lombasihir/munkintakutperubahan.mp3" },
            { id: 678, title: "Nirrlaba", artist: "Lomba Sihir", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lombasihir/nirrlaba.mp3" },
            { id: 679, title: "Semua Orang Pernah Sakit Hati", artist: "Lomba Sihir", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lombasihir/semuaorangpernahsakithati.mp3" }
        ];
        // 17. Last Child (680-684)
        const lastchildNewSongs = [
            { id: 680, title: "Diary Depresiku", artist: "Last Child", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lastchild/diarydepresiku.mp3" },
            { id: 681, title: "Pedih", artist: "Last Child", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lastchild/pedih.mp3" },
            { id: 682, title: "Seluruh Nafas Ini", artist: "Last Child", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lastchild/seluruhnafasini.mp3" },
            { id: 683, title: "Duka", artist: "Last Child", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lastchild/duka.mp3" },
            { id: 684, title: "Tak Pernah Ternilai", artist: "Last Child", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/lastchild/takpernahternilai.mp3" }
        ];
        // 18. For Revenge (685-689)
        const forRevengeNewSongs = [
            { id: 685, title: "Serana", artist: "For Revenge", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/forrevenge/serana.mp3" },
            { id: 686, title: "Jakarta Hari Ini", artist: "For Revenge", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/forrevenge/jakartaharini.mp3" },
            { id: 687, title: "Penyangkalan", artist: "For Revenge", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/forrevenge/penyangkalan.mp3" },
            { id: 688, title: "Ada Selamanya", artist: "For Revenge", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/forrevenge/adaselamanya.mp3" },
            { id: 689, title: "Sadrah", artist: "For Revenge", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/forrevenge/sadrah.mp3" }
        ];
        // 19. Yovie & Nuno (690-694)
        const yovieNewSongs = [
            { id: 690, title: "Janji Suci", artist: "Yovie & Nuno", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/yovie&nuno/janjisuci.mp3" },
            { id: 691, title: "Tanpa Cinta", artist: "Yovie & Nuno", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/yovie&nuno/tanpacinta.mp3" },
            { id: 692, title: "Merindu Lagi", artist: "Yovie & Nuno", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/yovie&nuno/merindulagi.mp3" },
            { id: 693, title: "Manusia Biasa", artist: "Yovie & Nuno", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/yovie&nuno/manusiabiasa.mp3" },
            { id: 694, title: "Sampai Akhir Waktu", artist: "Yovie & Nuno", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/yovie&nuno/sampaiakhirwaktu.mp3" }
        ];
        // 20. Vierra (695-699)
        const vierraNewSongs = [
            { id: 695, title: "Seandainya", artist: "Vierra", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/vierra/seandainya.mp3" },
            { id: 696, title: "Rasa Ini", artist: "Vierra", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/vierra/rasaini.mp3" },
            { id: 697, title: "Kesepian", artist: "Vierra", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/vierra/kesepian.mp3" },
            { id: 698, title: "Dengarkan Curhatku", artist: "Vierra", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/vierra/dengarkancurhatku.mp3" },
            { id: 699, title: "Takut", artist: "Vierra", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/vierra/takut.mp3" }
        ];
        // 21. Utopia (700-704)
        const utopiaNewSongs = [
            { id: 700, title: "Serpihan Hati", artist: "Utopia", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/utopia/serpihanhati.mp3" },
            { id: 701, title: "Hujan", artist: "Utopia", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/utopia/hujan.mp3" },
            { id: 702, title: "Mencintaimu Sampai Mati", artist: "Utopia", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/utopia/mencintaimusampaimati.mp3" },
            { id: 703, title: "Antara Ada dan Tiada", artist: "Utopia", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/utopia/antaraadadantiada.mp3" },
            { id: 704, title: "Lelah", artist: "Utopia", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/utopia/lelah.mp3" }
        ];
        // 22. Juicy Lucy (705-709)
        const juicyNewSongs = [
            { id: 705, title: "Lantas", artist: "Juicy Lucy", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juicylucy/lantas.mp3" },
            { id: 706, title: "Tampar", artist: "Juicy Lucy", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juicylucy/tampar.mp3" },
            { id: 707, title: "Sialan", artist: "Juicy Lucy", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juicylucy/sialan.mp3" },
            { id: 708, title: "Tanpa Tergesa", artist: "Juicy Lucy", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juicylucy/tanpatergesa.mp3" },
            { id: 709, title: "Mawar Jingga", artist: "Juicy Lucy", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/juicylucy/mawarjingga.mp3" }
        ];
        // 23. HIVI! (710-714)
        const hiviNewSongs = [
            { id: 710, title: "Remaja", artist: "HIVI!", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/hivi/remaja.mp3" },
            { id: 711, title: "Siapkah Kau 'Tuk Jatuh Cinta Lagi", artist: "HIVI!", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/hivi/siapkahkautuktukjatuhcintalagi.mp3" },
            { id: 712, title: "Pelangi", artist: "HIVI!", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/hivi/pelangi.mp3" },
            { id: 713, title: "Orang Ke 3", artist: "HIVI!", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/hivi/orangke3.mp3" },
            { id: 714, title: "Satu-Satunya", artist: "HIVI!", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/hivi/satu-satunya.mp3" }
        ];
        // 24. The Lantis (715-719)
        const thelantisNewSongs = [
            { id: 715, title: "Lampu Merah", artist: "The Lantis", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thelantis/lampumerah.mp3" },
            { id: 716, title: "Pilot", artist: "The Lantis", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thelantis/pilot.mp3" },
            { id: 717, title: "Bunga Maaf", artist: "The Lantis", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thelantis/bungamaaf.mp3" },
            { id: 718, title: "Nirwana", artist: "The Lantis", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thelantis/nirwana.mp3" },
            { id: 719, title: "Gemuruh", artist: "The Lantis", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thelantis/gemuruh.mp3" }
        ];
        // 25. The Changcuters (720-724)
        const thechangcutersNewSongs = [
            { id: 720, title: "I Love U Bibeh", artist: "The Changcuters", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thechangcuters/iloveubibeh.mp3" },
            { id: 721, title: "Racun Dunia", artist: "The Changcuters", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thechangcuters/racundunia.mp3" },
            { id: 722, title: "Main Serong", artist: "The Changcuters", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thechangcuters/mainserong.mp3" },
            { id: 723, title: "Hijrah ke London", artist: "The Changcuters", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thechangcuters/hijrahkelondon.mp3" },
            { id: 724, title: "Gila-Gilaan", artist: "The Changcuters", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thechangcuters/gila-gilaan.mp3" }
        ];
        // 26. The Adams (725-729)
        const theadamsNewSongs = [
            { id: 725, title: "Konservatif", artist: "The Adams", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/theadams/konservatif.mp3" },
            { id: 726, title: "Timur", artist: "The Adams", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/theadams/timur.mp3" },
            { id: 727, title: "Hanya Kau", artist: "The Adams", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/theadams/hanyakau.mp3" },
            { id: 728, title: "Masa-Masa", artist: "The Adams", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/theadams/masa-masa.mp3" },
            { id: 729, title: "Pelantur", artist: "The Adams", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/theadams/pelantur.mp3" }
        ];
        // 27. Avicii (730-734)
        const aviciiNewSongs = [
            { id: 730, title: "Wake Me Up", artist: "Avicii", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/avicii/wakemeup.mp3" },
            { id: 731, title: "The Nights", artist: "Avicii", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/avicii/thenights.mp3" },
            { id: 732, title: "Levels", artist: "Avicii", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/avicii/levels.mp3" },
            { id: 733, title: "Waiting for Love", artist: "Avicii", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/avicii/waitingforlove.mp3" },
            { id: 734, title: "Hey Brother", artist: "Avicii", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/avicii/heybrother.mp3" }
        ];
        // 28. Adele (735-739)
        const adeleNewSongs = [
            { id: 735, title: "Someone Like You", artist: "Adele", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/adele/someonelikeyou.mp3" },
            { id: 736, title: "Rolling in the Deep", artist: "Adele", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/adele/rollinginthedeep.mp3" },
            { id: 737, title: "Don't You Remember", artist: "Adele", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/adele/dontyouremember.mp3" },
            { id: 738, title: "Easy on Me", artist: "Adele", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/adele/easyonme.mp3" },
            { id: 739, title: "Skyfall", artist: "Adele", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/adele/skyfall.mp3" }
        ];
        // 29. Shawn Mendes (740-744)
        const shawnmendesNewSongs = [
            { id: 740, title: "Stitches", artist: "Shawn Mendes", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/shawnmendes/stitches.mp3" },
            { id: 741, title: "Treat You Better", artist: "Shawn Mendes", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/shawnmendes/treatyoubetter.mp3" },
            { id: 742, title: "There's Nothing Holdin' Me Back", artist: "Shawn Mendes", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/shawnmendes/theresnothing.mp3" },
            { id: 743, title: "Senorita", artist: "Shawn Mendes", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/shawnmendes/senorita.mp3" },
            { id: 744, title: "Mercy", artist: "Shawn Mendes", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/shawnmendes/mercy.mp3" }
        ];
        // 30. James Arthur (745-749)
        const jamesarthurNewSongs = [
            { id: 745, title: "Say You Won't Let Go", artist: "James Arthur", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/jamesarthur/sayyouwontletgo.mp3" },
            { id: 746, title: "Impossible", artist: "James Arthur", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/jamesarthur/impossible.mp3" },
            { id: 747, title: "Train Wreck", artist: "James Arthur", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/jamesarthur/trainwreck.mp3" },
            { id: 748, title: "Car's Outside", artist: "James Arthur", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/jamesarthur/carsoutside.mp3" },
            { id: 749, title: "Rewrite the Stars", artist: "James Arthur", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/jamesarthur/rewritethestars.mp3" }
        ];
        // 31. Billie Eilish (750-754)
        const billieeilishNewSongs = [
            { id: 750, title: "Bad Guy", artist: "Billie Eilish", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/billieeilish/badguy.mp3" },
            { id: 751, title: "Happier Than Ever", artist: "Billie Eilish", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/billieeilish/happierthanever.mp3" },
            { id: 752, title: "Lovely", artist: "Billie Eilish", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/billieeilish/lovely.mp3" },
            { id: 753, title: "Ocean Eyes", artist: "Billie Eilish", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/billieeilish/oceaneyes.mp3" },
            { id: 754, title: "Birds of a Feather", artist: "Billie Eilish", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/billieeilish/birdsofeather.mp3" }
        ];
        // 32. The Beatles (755-759)
        const beatlesNewSongs = [
            { id: 755, title: "Hey Jude", artist: "The Beatles", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thebeatles/heyjude.mp3" },
            { id: 756, title: "Let It Be", artist: "The Beatles", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thebeatles/letitbe.mp3" },
            { id: 757, title: "Yesterday", artist: "The Beatles", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thebeatles/yesterday.mp3" },
            { id: 758, title: "Here Comes the Sun", artist: "The Beatles", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thebeatles/herecomesthesun.mp3" },
            { id: 759, title: "Come Together", artist: "The Beatles", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/thebeatles/cometogether.mp3" }
        ];
        // 33. Maroon 5 (760-764)
        const maroon5NewSongs = [
            { id: 760, title: "Sugar", artist: "Maroon 5", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maroon5/sugar.mp3" },
            { id: 761, title: "Girls Like You", artist: "Maroon 5", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maroon5/girlslikeyou.mp3" },
            { id: 762, title: "Memories", artist: "Maroon 5", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maroon5/memories.mp3" },
            { id: 763, title: "She Will Be Loved", artist: "Maroon 5", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maroon5/shewillbeloved.mp3" },
            { id: 764, title: "Payphone", artist: "Maroon 5", album: "Album", duration: "3:00", cover: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", src: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/maroon5/payphone.mp3" }
        ];

        const songs = [
            ...baseSongs, ...mainBandSongs, ...hanungSongs, ...raraSongs, ...casSongs, 
            ...rocSongs, ...smithsSongs, ...arcticSongs, ...queenSongs, ...stonerosesSongs, 
            ...neckdeepSongs, ...mcrSongs, ...bobmarleySongs, ...frankSongs, ...drakeSongs, 
            ...kendrickSongs, ...weekndSongs, ...the1975Songs, ...oliviaSongs, ...chainsmokersSongs, 
            ...avengedSongs, ...slankSongs, ...realityclubSongs, ...nidjiSongs, 
            ...naykillaNewSongs, ...bernardyaNewSongs, ...iwanfalsNewSongs, ...pamungkasNewSongs, 
            ...kebiNewSongs, ...safaNewSongs, ...tuan13NewSongs, ...maudyNewSongs, 
            ...glennNewSongs, ...nadinNewSongs, ...salpriadiNewSongs, ...juanNewSongs, 
            ...nikiNewSongs, ...feastNewSongs, ...panasdDataNewSongs, ...lombaNewSongs, 
            ...lastchildNewSongs, ...forRevengeNewSongs, ...yovieNewSongs, ...vierraNewSongs, 
            ...utopiaNewSongs, ...juicyNewSongs, ...hiviNewSongs, ...thelantisNewSongs, 
            ...thechangcutersNewSongs, ...theadamsNewSongs, ...aviciiNewSongs, ...adeleNewSongs, 
            ...shawnmendesNewSongs, ...jamesarthurNewSongs, ...billieeilishNewSongs, 
            ...beatlesNewSongs, ...maroon5NewSongs
        ];

        // Initialize global songs array for offline download and other features
        window.allSongs = songs;

// DISABLED:         // Restore previously played song if it exists
// DISABLED:         const savedSongId = localStorage.getItem('currentSongId');
// DISABLED:         if (savedSongId) {
// DISABLED:             const songToRestore = songs.find(s => s.id === parseInt(savedSongId));
// DISABLED:             if (songToRestore) {
// DISABLED:                 // Set playbar visibility and prepare to load song (will load after loadSong function is defined)
// DISABLED:                 window.songToRestoreOnLoad = songToRestore;
// DISABLED:             }
// DISABLED:         }

        // --- GLOBAL STATE ---
        let likedSongs = [];
        let currentSongIndex = 0;
        let isPlaying = false;
        let currentUserData = null;
        let currentPlaylistId = null;
        let searchTimeout; 
        let allPublicPlaylists = []; // Store all public playlists for search
        
        // --- QUEUE & HISTORY SYSTEM ---
        let songQueue = [];
        let playHistory = [];
        let isShuffle = false;
        let repeatMode = 0; // 0: Off, 1: All, 2: One
        
        // --- SAVE/RESTORE PLAYBACK STATE ---
        function savePlaybackState() {
            if (songs && songs[currentSongIndex]) {
                const currentSong = songs[currentSongIndex];
                const state = {
                    songIndex: currentSongIndex,
                    songId: currentSong.id,
                    songTitle: currentSong.title,
                    songArtist: currentSong.artist,
                    songAlbum: currentSong.album,
                    songCover: currentSong.cover,
                    songUrl: currentSong.url,
                    currentTime: audio ? audio.currentTime : 0,
                    isPlaying: isPlaying,
                    timestamp: Date.now()
                };
                localStorage.setItem('vidjePlaybackState', JSON.stringify(state));
                
                // CRITICAL: Simpan juga audio source secara terpisah untuk recovery cepat
                if (audio && audio.src) {
                    localStorage.setItem('vidjeAudioSource', audio.src);
                }
                
                console.log(' Saved playback state with audio source:', state);
            }
        }
        
        function restorePlaybackState() {
            try {
                // First try to restore from vidjePlaybackState (comprehensive state)
                const saved = localStorage.getItem('vidjePlaybackState');
                if (saved) {
                    const state = JSON.parse(saved);
                    console.log(' Restoring playback state from vidjePlaybackState:', state);
                    
                    // Find song by ID or title
                    let foundIndex = -1;
                    if (songs && songs.length > 0) {
                        // Try by ID first
                        foundIndex = songs.findIndex(s => s.id === state.songId);
                        // If not found, try by title
                        if (foundIndex === -1) {
                            foundIndex = songs.findIndex(s => s.title === state.songTitle);
                        }
                    }
                    
                    if (foundIndex >= 0) {
                        currentSongIndex = foundIndex;
                        console.log('[OK] Restored to song index:', currentSongIndex, songs[currentSongIndex].title);
                        return true;
                    }
                }
                
                // Fallback: try to restore from currentSongId (simple ID storage)
                const savedSongId = localStorage.getItem('currentSongId');
                if (savedSongId && songs && songs.length > 0) {
                    console.log(' Restoring from currentSongId:', savedSongId);
                    const foundIndex = songs.findIndex(s => s.id === parseInt(savedSongId));
                    
                    if (foundIndex >= 0) {
                        currentSongIndex = foundIndex;
                        console.log('[OK] Restored to song index:', currentSongIndex, songs[currentSongIndex].title);
                        return true;
                    }
                }
                
                console.log(' Could not find restored song, will use first song');
                currentSongIndex = 0;
                return false;
            } catch (error) {
                console.error('[ERROR] Error restoring playback state:', error);
                currentSongIndex = 0;
                return false;
            }
        }
        
        // --- HISTORY / RECENTLY PLAYED ---
        let recentlyPlayed = []; // Stores {type: 'song'|'playlist', data: object, timestamp}
        
        // --- LYRICS DATABASE ---
        const lyricsDatabase = {
            "Sedia Aku Sebelum Hujan": {
                lines: [
                    { text: "Jadi waktu itu dingin", time: 21.23, words: ["Jadi", "waktu", "itu", "dingin"] },
                    { text: "Kuberi kau hangat", time: 24.65, words: ["Kuberi", "kau", "hangat"] },
                    { text: "Walaupun ku juga beku", time: 27.70, words: ["Walaupun", "ku", "juga", "beku"] },
                    { text: "Tapi ku aman saat kau nyaman", time: 30.21, words: ["Tapi", "ku", "aman", "saat", "kau", "nyaman"] },
                    { text: "Jadi waktu itu panas", time: 34.55, words: ["Jadi", "waktu", "itu", "panas"] },
                    { text: "Kuberi kau angin", time: 37.90, words: ["Kuberi", "kau", "angin"] },
                    { text: "Walaupun ku juga gerah", time: 41.04, words: ["Walaupun", "ku", "juga", "gerah"] },
                    { text: "Tapi ku penuh saat kau teduh", time: 43.62, words: ["Tapi", "ku", "penuh", "saat", "kau", "teduh"] },
                    { text: "Sudah paham 'kan sejauh ini?", time: 46.77, words: ["Sudah", "paham", "'kan", "sejauh", "ini?"] },
                    { text: "Ku yang lama di sini", time: 54.51, words: ["Ku", "yang", "lama", "di", "sini"] },
                    { text: "Menjagamu tak patah hati", time: 56.83, words: ["Menjagamu", "tak", "patah", "hati"] },
                    { text: "Sedia aku sebelum hujan", time: 60.22, words: ["Sedia", "aku", "sebelum", "hujan"] },
                    { text: "Apa yang kau butuh, kuberikan", time: 63.43, words: ["Apa", "yang", "kau", "butuh,", "kuberikan"] },
                    { text: "Ke mana pun tak akan kau temukan", time: 66.81, words: ["Ke", "mana", "pun", "tak", "akan", "kau", "temukan"] },
                    { text: "Yang siapkan bekalmu di peperangan", time: 70.25, words: ["Yang", "siapkan", "bekalmu", "di", "peperangan"] },
                    { text: "Jika tak setara, kumaafkan", time: 73.68, words: ["Jika", "tak", "setara,", "kumaafkan"] },
                    { text: "Memang sebegitunya aku", time: 76.81, words: ["Memang", "sebegitunya", "aku"] },
                    { text: "Ku tak punya pilihan", time: 87.68, words: ["Ku", "tak", "punya", "pilihan"] },
                    { text: "Yang dikendali pikiran", time: 91.08, words: ["Yang", "dikendali", "pikiran"] },
                    { text: "Ada namamu disebutkan", time: 94.35, words: ["Ada", "namamu", "disebutkan"] },
                    { text: "Ke situlah arahku berjalan", time: 96.94, words: ["Ke", "situlah", "arahku", "berjalan"] },
                    { text: "Sudah paham 'kan sejauh ini?", time: 100.29, words: ["Sudah", "paham", "'kan", "sejauh", "ini?"] },
                    { text: "Ku yang lama di sini", time: 107.84, words: ["Ku", "yang", "lama", "di", "sini"] },
                    { text: "Menjagamu tak patah hati", time: 110.11, words: ["Menjagamu", "tak", "patah", "hati"] },
                    { text: "Sedia aku sebelum hujan", time: 113.59, words: ["Sedia", "aku", "sebelum", "hujan"] },
                    { text: "Apa yang kau butuh, kuberikan", time: 116.95, words: ["Apa", "yang", "kau", "butuh,", "kuberikan"] },
                    { text: "Ke mana pun tak akan kau temukan", time: 120.22, words: ["Ke", "mana", "pun", "tak", "akan", "kau", "temukan"] },
                    { text: "Yang siapkan bekalmu di peperangan", time: 123.52, words: ["Yang", "siapkan", "bekalmu", "di", "peperangan"] },
                    { text: "Jika tak setara, kumaafkan", time: 126.84, words: ["Jika", "tak", "setara,", "kumaafkan"] },
                    { text: "Memang sebegitunya aku", time: 130.28, words: ["Memang", "sebegitunya", "aku"] },
                    { text: "Soal cinta, aku jatuh, yeah-hey", time: 133.54, words: ["Soal", "cinta,", "aku", "jatuh,", "yeah-hey"] },
                    { text: "Ini janjiku", time: 139.78, words: ["Ini", "janjiku"] },
                    { text: "Untuk hadir dan mencintaimu", time: 144.74, words: ["Untuk", "hadir", "dan", "mencintaimu"] },
                    { text: "Di hari baikmu", time: 155.24, words: ["Di", "hari", "baikmu"] },
                    { text: "Dan di hari burukmu", time: 158.59, words: ["Dan", "di", "hari", "burukmu"] },
                    { text: "Sedia aku sebelum hujan", time: 161.89, words: ["Sedia", "aku", "sebelum", "hujan"] },
                    { text: "Apa yang kau butuh, kuberikan", time: 165.25, words: ["Apa", "yang", "kau", "butuh,", "kuberikan"] },
                    { text: "Ku yang lama di sini", time: 169.54, words: ["Ku", "yang", "lama", "di", "sini"] },
                    { text: "Menjagamu tak patah hati", time: 171.91, words: ["Menjagamu", "tak", "patah", "hati"] },
                    { text: "Sedia aku sebelum hujan", time: 175.13, words: ["Sedia", "aku", "sebelum", "hujan"] },
                    { text: "Apa yang kau butuh, kuberikan", time: 178.56, words: ["Apa", "yang", "kau", "butuh,", "kuberikan"] },
                    { text: "Ke mana pun tak akan kau temukan", time: 181.75, words: ["Ke", "mana", "pun", "tak", "akan", "kau", "temukan"] },
                    { text: "Yang siapkan bekalmu di peperangan", time: 185.15, words: ["Yang", "siapkan", "bekalmu", "di", "peperangan"] },
                    { text: "(Jika tak setara) kumaafkan", time: 188.60, words: ["(Jika", "tak", "setara)", "kumaafkan"] },
                    { text: "Memang sebegitunya aku", time: 191.86, words: ["Memang", "sebegitunya", "aku"] },
                    { text: "Soal cinta, aku jatuh, hey", time: 195.20, words: ["Soal", "cinta,", "aku", "jatuh,", "hey"] },
                    { text: "(Ku yang lama di sini)", time: 199.69, words: ["(Ku", "yang", "lama", "di", "sini)"] },
                    { text: "(Menjagamu tak patah hati)", time: 201.86, words: ["(Menjagamu", "tak", "patah", "hati)"] },
                    { text: "(Sedia aku sebelum hujan)", time: 205.18, words: ["(Sedia", "aku", "sebelum", "hujan)"] },
                    { text: "(Apa yang kau butuh, kuberikan)", time: 208.77, words: ["(Apa", "yang", "kau", "butuh,", "kuberikan)"] },
                    { text: "(Ke mana pun tak akan kau temukan) sedia aku sebelum hujan", time: 211.82, words: ["(Ke", "mana", "pun", "tak", "akan", "kau", "temukan)", "sedia", "aku", "sebelum", "hujan"] },
                    { text: "(Yang siapkan bekalmu di peperangan)", time: 215.22, words: ["(Yang", "siapkan", "bekalmu", "di", "peperangan)"] },
                    { text: "Sedia aku sebelum hujan", time: 219.67, words: ["Sedia", "aku", "sebelum", "hujan"] }
                ]
            },
            "Me & U": {
                lines: [
                    { text: "You", time: 0.09 },
                    { text: "", time: 2.63 },
                    { text: "You", time: 8.63 },
                    { text: "Hmm, yeah", time: 10.38 },
                    { text: "", time: 13.05 },
                    { text: "This is my decision, decision", time: 16.26 },
                    { text: "This is my decision", time: 20.52 },
                    { text: "I don't think you listen, you listen", time: 24.71 },
                    { text: "I don't think you listen", time: 29.22 },
                    { text: "For me to come out, it must mean I'm at the door", time: 32.79 },
                    { text: "It must mean I'm not the same", time: 36.77 },
                    { text: "It must mean I'm on your case", time: 38.85 },
                    { text: "For me to come out, it means that I'm at the door", time: 41.74 },
                    { text: "I want to show you my world", time: 45.51 },
                    { text: "Give me one break, I need faith", time: 49.35 },
                    { text: "Faith to believe you, faith to receive you", time: 52.60 },
                    { text: "", time: 55.03 },
                    { text: "Give me something I'm lacking", time: 58.48 },
                    { text: "I don't need nothing", time: 61.26 },
                    { text: "You are my everything", time: 63.58 },
                    { text: "Only me and you, only me and you (you)", time: 67.04 },
                    { text: "Only me and you, only me and you", time: 71.58 },
                    { text: "Only me, only you", time: 75.62 },
                    { text: "Only me and you (you)", time: 77.76 },
                    { text: "Only me and you", time: 80.06 },
                    { text: "Only me and you, only me and you", time: 82.11 },
                    { text: "Make me your matter", time: 84.85 },
                    { text: "Make me your matter", time: 86.65 },
                    { text: "Make me your matter", time: 88.83 },
                    { text: "Show me your substance", time: 93.28 },
                    { text: "Make me your person", time: 95.64 },
                    { text: "Make me your person", time: 97.69 },
                    { text: "Give me one break, I need faith", time: 100.72 },
                    { text: "Faith to believe you, faith to receive you", time: 104.24 },
                    { text: "Give me something I'm lacking", time: 112.75 },
                    { text: "I don't need nothing", time: 114.73 },
                    { text: "You are my everything", time: 118.53 },
                    { text: "Only me and you, only me and you (you)", time: 122.53 },
                    { text: "Only me and you, only me and you", time: 126.78 },
                    { text: "Only me, only you", time: 131.15 },
                    { text: "Only me and you (you)", time: 133.25 },
                    { text: "Only me and you", time: 135.47 },
                    { text: "Only me and you, only me and you", time: 137.42 },
                    { text: "All I want, only me and you", time: 142.11 },
                    { text: "All I want, only me and you", time: 146.12 },
                    { text: "All I want, only me and you", time: 150.45 },
                    { text: "All I want, only me and you", time: 154.67 },
                    { text: "Only me and you, me and you (me and you)", time: 156.72 },
                    { text: "Only me and you (me and you)", time: 160.02 },
                    { text: "Only me and you", time: 162.33 },
                    { text: "Only me and, me and, and you (me and you)", time: 164.12 },
                    { text: "", time: 166.57 },
                    { text: "Only me and you (me and you)", time: 168.67 },
                    { text: "Only me and you", time: 171.02 },
                    { text: "Only me and, me and, and you", time: 173.03 },
                    { text: "Me and you (me and you)", time: 175.63 },
                    { text: "Only me and you (me and you)", time: 177.28 },
                    { text: "Only me and you", time: 179.35 },
                    { text: "Only me and, me and, yeah, you", time: 181.59 },
                    { text: "Only me and you (me and you)", time: 185.84 },
                    { text: "Only me and you", time: 188.10 },
                    { text: "Only me and you", time: 191.18 },
                    { text: "", time: 191.70 }
                ]
            },
            "Kalibata 2012": {
                lines: [
                    { text: "Peranmu selesai", time: 38.07 },
                    { text: "Bebas semua tugas namun kuingat", time: 42.76 },
                    { text: "Kan slalu kuingat", time: 50.01 },
                    { text: "Temani tumbuhku", time: 55.84 },
                    { text: "Kembangkan tingkahku", time: 60.52 },
                    { text: "Semua kuingat", time: 63.77 },
                    { text: "Dalam dan lekat", time: 68.11 },
                    { text: "Diantara takbir", time: 70.55 },
                    { text: "Pejam mataku sebutkan namamu hadir", time: 74.99 },
                    { text: "Muncul rangkaian ribuan cerita penting", time: 83.83 },
                    { text: "Yang kuinginkan kau ada dalam abadi", time: 92.59 },
                    { text: "Semua jalur hidupku berubah dini hari itu", time: 100.35 },
                    { text: "Sebatang pertama", time: 109.26 },
                    { text: "Juga ulah lainnya", time: 113.91 },
                    { text: "Semua kuingat", time: 117.09 },
                    { text: "Dalam dan lekat", time: 121.28 },
                    { text: "Selera musikmu", time: 127.29 },
                    { text: "Membuka kelambu telah membentuk", time: 131.61 },
                    { text: "Oh padat telingaku", time: 138.61 },
                    { text: "Bolehkah kugunakan nama depanmu kelak?", time: 144.93 },
                    { text: "Pasti kan kusematkan biar menular", time: 153.70 },
                    { text: "Hingga saat ini tiap langkah ku tlah", time: 162.77 },
                    { text: "Jauhi beragam tepi", time: 168.22 },
                    { text: "Terpujilah mandiri di hati", time: 175.04 },
                    { text: "Sgala hikmah dari kesalahan lama", time: 180.55 },
                    { text: "Kini tak lagi bebani", time: 186.00 },
                    { text: "Terangi kesendirian lagi", time: 192.62 },
                    { text: "Rentan lamban ringkih terasa seperti", time: 198.35 },
                    { text: "Dia tak berpihak lagi", time: 204.10 },
                    { text: "Kerap pedih datang trus temani", time: 210.44 },
                    { text: "Kurasa batinku takkan pernah siap", time: 216.13 },
                    { text: "Terima salam pamitmu", time: 221.67 },
                    { text: "Kau tahu kau yang tlah mengubahku", time: 228.11 },
                    { text: "", time: 238.34 }
                ]
            }
        };
        
        // --- MASTER SEARCH INDEX FOR BANDS & ARTISTS ---
        const searchIndexArtists = [
            // Original Albums
            { name: "Ghani's Album", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ghani.jpg", fn: "window.openGhaniAlbum()" },
            { name: "Revan's Album", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/revan.jpg", fn: "window.openRevanAlbum()" },
            { name: "Hanung's Album", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/pras.jpg", fn: "window.openHanungAlbum()" },
            { name: "Rara's Album", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/rara.jpg", fn: "window.openRaraAlbum()" },
            // Indonesian Bands
            { name: "Perunggu", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/perunggu.jpg", fn: "window.openPerungguAlbum()" },
            { name: "NOAH", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/noah.jpg", fn: "window.openNoahAlbum()" },
            { name: "Dewa 19", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png", fn: "window.openDewaAlbum()" },
            { name: "Sheila On 7", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/so7.jpg", fn: "window.openSheilaAlbum()" },
            { name: "Kahitna", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kahitna.jpeg", fn: "window.openKahitnaAlbum()" },
            { name: "Hindia", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hindia.jpg", fn: "window.openHindiaAlbum()" },
            { name: "Slank", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/slank.jpg", fn: "window.openSlankAlbum()" },
            { name: "Reality Club", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/realityclub.jpg", fn: "window.openRealityClubAlbum()" },
            { name: "Nidji", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/nidji.jpg", fn: "window.openNidjiAlbum()" },
            { name: "Feast", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", fn: "window.openFeastAlbum()" },
            { name: "The Panasdalam Bank", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", fn: "window.openPanasdalamAlbum()" },
            { name: "Lomba Sihir", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", fn: "window.openLombaSihirAlbum()" },
            { name: "Last Child", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", fn: "window.openLastChildAlbum()" },
            { name: "For Revenge", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", fn: "window.openForRevengeAlbum()" },
            { name: "Yovie & Nuno", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", fn: "window.openYovieAlbum()" },
            { name: "Vierra", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", fn: "window.openVierraAlbum()" },
            { name: "Utopia", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", fn: "window.openUtopiaAlbum()" },
            { name: "Juicy Lucy", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", fn: "window.openJuicyLucyAlbum()" },
            { name: "HIVI!", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", fn: "window.openHiviAlbum()" },
            { name: "The Lantis", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", fn: "window.openTheLantisAlbum()" },
            { name: "The Changcuters", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", fn: "window.openTheChangcutersAlbum()" },
            { name: "The Adams", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", fn: "window.openTheAdamsAlbum()" },
            // Indonesian Singers
            { name: "Naykilla", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", fn: "window.openNaykillaAlbum()" },
            { name: "Bernadya", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", fn: "window.openBernardyaAlbum()" },
            { name: "Iwan Fals", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", fn: "window.openIwanFalsAlbum()" },
            { name: "Pamungkas", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", fn: "window.openPamungkasAlbum()" },
            { name: "K3bi", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", fn: "window.openK3biAlbum()" },
            { name: "$afa", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", fn: "window.openSafaAlbum()" },
            { name: "Tuantigabelas", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", fn: "window.openTuan13Album()" },
            { name: "Maudy Ayunda", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", fn: "window.openMaudyAlbum()" },
            { name: "Glenn Fredly", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", fn: "window.openGlennAlbum()" },
            { name: "Nadin Amizah", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", fn: "window.openNadinAlbum()" },
            { name: "Sal Priadi", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", fn: "window.openSalPriadiAlbum()" },
            { name: "Juan Reza", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", fn: "window.openJuanRezaAlbum()" },
            { name: "NIKI", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", fn: "window.openNIKIAlbum()" },
            // Foreign Singers
            { name: "Avicii", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", fn: "window.openAviciiAlbum()" },
            { name: "Adele", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", fn: "window.openAdeleAlbum()" },
            { name: "Shawn Mendes", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", fn: "window.openShawnMendesAlbum()" },
            { name: "James Arthur", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", fn: "window.openJamesArthurAlbum()" },
            { name: "Billie Eilish", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", fn: "window.openBillieEilishAlbum()" },
            // Foreign Bands
            { name: "The Beatles", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", fn: "window.openBeatlesAlbum()" },
            { name: "Maroon 5", img: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", fn: "window.openMaroon5Album()" }
        ];

        const audio = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playPauseIcon = playPauseBtn.querySelector('i');
        const playerArt = document.getElementById('player-art');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const likeBtn = document.getElementById('like-btn');

        // --- CHAT & FRIENDS STATE ---
        let activeChatFriendUid = null;
        let activeChatFriendData = null;
        let activeChatId = null;
        let replyingToMsgId = null;

        // --- HELPER: EXTRACT DOMINANT COLOR ---
        window.applyCardColor = function(img) {
            try {
                // Ensure image is loaded
                if (!img.complete || img.naturalWidth === 0) return;
                
                const rgb = getAverageRGB(img);
                const card = img.closest('.song-card');
                
                if (card) {
                    // Create a subtle gradient from the dominant color to the card background
                    // Use low opacity (0.15) to keep it subtle and text readable
                    const colorStart = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.3)`;
                    const colorEnd = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.05)`;
                    
                    // Apply gradient background
                    card.style.background = `linear-gradient(180deg, ${colorStart} 0%, var(--bg-card) 100%)`;
                    
                    // Optional: Add a subtle border or glow
                    card.style.border = `1px solid rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.2)`;
                    
                    // Ensure transition for smooth effect
                    card.style.transition = 'background 0.5s ease, border 0.5s ease';
                }
            } catch(e) {
                console.log("Color extraction skipped", e);
            }
        };

        function getAverageRGB(imgEl) {
            var blockSize = 5, defaultRGB = {r:0,g:0,b:0}, canvas = document.createElement('canvas'), context = canvas.getContext && canvas.getContext('2d'), data, width, height, i = -4, length, rgb = {r:0,g:0,b:0}, count = 0;
            if (!context) return defaultRGB;
            height = canvas.height = imgEl.naturalHeight || imgEl.offsetHeight || imgEl.height;
            width = canvas.width = imgEl.naturalWidth || imgEl.offsetWidth || imgEl.width;
            context.drawImage(imgEl, 0, 0);
            try { data = context.getImageData(0, 0, width, height); } catch(e) { return defaultRGB; }
            length = data.data.length;
            while ( (i += blockSize * 4) < length ) { ++count; rgb.r += data.data[i]; rgb.g += data.data[i+1]; rgb.b += data.data[i+2]; }
            rgb.r = ~~(rgb.r/count); rgb.g = ~~(rgb.g/count); rgb.b = ~~(rgb.b/count);
            return rgb;
        }

        // --- AUTH LOGIC ---
        function toggleAuthMode(mode) {
            if(mode === 'signup') {
                document.getElementById('login-box').style.display = 'none';
                document.getElementById('signup-box').style.display = 'block';
            } else {
                document.getElementById('signup-box').style.display = 'none';
                document.getElementById('login-box').style.display = 'block';
            }
        }

       async function handleSignup() {
    const name = document.getElementById('signup-name').value.trim();
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    const errorMsg = document.getElementById('signup-error');

    if (!name || !email || !password) {
        errorMsg.innerText = window.t('fill-all-fields');
        errorMsg.style.display = 'block';
        return;
    }

    try {
        // Generate User ID: Name_1234 (GANTI # dengan _)
        const cleanName = name.replace(/\s+/g, '');
        const randomNum = Math.floor(1000 + Math.random() * 9000);
        const userId = `${cleanName}_${randomNum}`; //  UBAH DARI # ke _

        // Create user in Firebase Auth
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        console.log("User created in Auth:", user.uid);
        
        // Store Username Index for Search
        await set(ref(db, 'usernames/' + userId), user.uid);
        console.log("Username index saved");
        
        // Store User Data
        await set(ref(db, 'users/' + user.uid), {
            username: name,
            userId: userId,
            userIdSuffix: randomNum,
            email: email,
            bio: "Musisi sejati.",
            profile_picture: "https://picsum.photos/seed/" + name + "/200/200",
            likedCover: "https://picsum.photos/seed/liked/300/300",
            playlists: {}
        });
        
        console.log("User data saved to /users/" + user.uid);
        alert(" Akun berhasil dibuat! Silakan login.");
        
        toggleAuthMode('login');
        
    } catch (error) {
        console.error("Signup error:", error);
        errorMsg.innerText = "Error: " + error.message;
        errorMsg.style.display = 'block';
    }
}

  


        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorMsg = document.getElementById('login-error');

            signInWithEmailAndPassword(auth, email, password)
                .then(() => {})
                .catch((error) => {
                    errorMsg.innerText = window.t('email-password-wrong');
                    errorMsg.style.display = 'block';
                });
        }

        function handleLogout() { signOut(auth); }

        // Export to Window for HTML onclick
        window.toggleAuthMode = toggleAuthMode;
        window.handleSignup = handleSignup;
        window.handleLogin = handleLogin;
        window.handleLogout = handleLogout;

        function loadPublicPlaylists() {
            // Fetch all users to find public playlists
            get(ref(db, 'users')).then(snapshot => {
                const users = snapshot.val() || {};
                allPublicPlaylists = []; // Reset global var
                
                Object.values(users).forEach(user => {
                    if (user.playlists) {
                        Object.keys(user.playlists).forEach(plId => {
                            const pl = user.playlists[plId];
                            if (pl.isPublic) {
                                allPublicPlaylists.push({
                                    id: plId,
                                    ...pl,
                                    ownerName: user.username,
                                    ownerId: user.userId
                                });
                            }
                        });
                    }
                });
                console.log("Public playlists loaded:", allPublicPlaylists.length);
            });
        }

       onAuthStateChanged(auth, (user) => {
    const loadingScreen = document.getElementById('loading-screen');
    const authView = document.getElementById('auth-view');
    const appWrapper = document.getElementById('app-wrapper');

    if (user) {
        loadingScreen.style.display = 'flex';
        authView.style.display = 'none';
        appWrapper.style.display = 'none';

        // Load Public Playlists for Search
        loadPublicPlaylists();

        const userRef = ref(db, 'users/' + user.uid);
        onValue(userRef, async (snapshot) => {
            const data = snapshot.val(); //  Ambil data dari snapshot
            if (data) {
                currentUserData = data;
                        document.getElementById('header-username').innerText = data.username;
                        document.getElementById('header-avatar').src = data.profile_picture || "https://picsum.photos/50/50";
                        
                        renderSidebarPlaylists(data.playlists || {});
                        renderTrending(); // Update Trending Section
                        setupFriendListeners(); // Start friend listeners
                        
                        const savedLiked = localStorage.getItem('likedSongs');
                        if (savedLiked) likedSongs = JSON.parse(savedLiked);

                        const savedHistory = localStorage.getItem('recentlyPlayed');
                        if (savedHistory) recentlyPlayed = JSON.parse(savedHistory);

                        // Mulai memuat lagu secara background tanpa menahan UI
                        const songsPromise = loadSongsFromSupabase();
                        const importedPromise = loadImportedSongs();

                        // Jika ada cache lagu, coba render segera untuk UX yang lebih cepat
                        try {
                            const cached = localStorage.getItem('cachedSongs');
                            if (cached) {
                                window._cachedSongs = JSON.parse(cached);
                                // Panggil render minimal agar tampilan terlihat responsif
                                renderTrending();
                                renderPopularBands();
                            }
                        } catch (e) {
                            console.warn('Unable to parse cachedSongs', e);
                        }

                        // Tampilkan app segera, sembunyikan loading overlay
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            appWrapper.style.display = 'flex';
                            switchView('home');
                        }, 10);

                        // Setelah data lagu selesai dimuat, lakukan full re-render
                        Promise.all([songsPromise, importedPromise]).then(() => {
                            console.log('Songs and imports loaded, re-rendering full UI');
                            try {
                                // Optional: simpan cache untuk akses cepat berikutnya
                                if (window.allSongs && Array.isArray(window.allSongs)) {
                                    try { localStorage.setItem('cachedSongs', JSON.stringify(window.allSongs)); } catch (e) {}
                                }
                            } catch (e) {}

                            renderTrending();
                            renderPopularBands();
                            renderPopularArtists();
                            renderForeignSoloArtists();
                            renderForeignBands();

                            // Defer any non-critical re-renders
                            if (window.requestIdleCallback) {
                                requestIdleCallback(() => {
                                    const homeView = document.getElementById('view-home');
                                    if (homeView && homeView.classList.contains('active')) {
                                        renderTrending();
                                        renderPopularBands();
                                    }
                                });
                            }
                        }).catch(err => console.error('Error loading songs:', err));
                    }
                });
            } else {
                currentUserData = null;
                loadingScreen.style.display = 'none';
                authView.style.display = 'flex';
                appWrapper.style.display = 'none';
            }
        });

        // --- SIDEBAR LOGIC ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        window.toggleSidebar = toggleSidebar;

        function renderSidebarPlaylists(playlists) {
            const container = document.getElementById('sidebar-playlists-container');
            let html = '';
            const playlistArray = Object.keys(playlists).map(key => ({
                id: key,
                ...playlists[key]
            }));
            
            if(playlistArray.length === 0) {
                container.innerHTML = '<div style="padding: 10px 12px; color: #666; font-size: 13px;">' + window.t('no-playlists') + '</div>';
                return;
            }

            playlistArray.forEach(pl => {
                const isPublic = pl.isPublic || false;
                const privacyIcon = isPublic ? '<i class="ph ph-globe" style="color:#1db954" title="Publik"></i>' : '<i class="ph ph-lock-key" style="color:#b3b3b3" title="Privat"></i>';
                
                html += `
                    <div class="playlist-item" onclick="window.openPlaylist('${pl.id}')">
                        <img src="${pl.cover}" class="playlist-thumb" alt="${pl.name}">
                        <span style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${pl.name}</span>
                        <button class="btn-icon-small" onclick="event.stopPropagation(); window.togglePlaylistPrivacy('${pl.id}')" style="font-size:16px; padding:5px;">${privacyIcon}</button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function openCreatePlaylistModal() {
            document.getElementById('create-playlist-modal').classList.add('open');
            document.getElementById('new-playlist-name').value = '';
        }

        function submitCreatePlaylist() {
            const name = document.getElementById('new-playlist-name').value;
            if(!name) {
                alert("Nama playlist tidak boleh kosong!");
                return;
            }
            
            const userId = auth.currentUser.uid;
            const newPlaylistRef = push(ref(db, 'users/' + userId + '/playlists'));
            const playlistId = newPlaylistRef.key;

            const seed = name.replace(/\s/g, '') + Math.floor(Math.random() * 1000);
            const defaultCover = `https://picsum.photos/seed/${seed}/300/300`;

            set(newPlaylistRef, {
                name: name,
                cover: defaultCover,
                songs: {},
                isPublic: false // Default Private
            });

            closeModal('create-playlist-modal');
        }

        window.openCreatePlaylistModal = openCreatePlaylistModal;
        window.submitCreatePlaylist = submitCreatePlaylist;

        // --- FRIENDSHIP & CHAT LOGIC ---
        
        let unreadMessages = {}; // { friendUid: count }

function setupFriendListeners() {
    if(!auth.currentUser) return;
    const myUid = auth.currentUser.uid;

    // Listen Friend Requests
    onValue(ref(db, `users/${myUid}/friendRequests`), (snap) => {
        const reqs = snap.val() || {};
        const container = document.getElementById('friend-requests-container');
        let html = '';
        Object.keys(reqs).forEach(senderUid => {
            const r = reqs[senderUid];
            html += `
                <div class="friend-list-item">
                    <img src="${r.senderPic}" class="friend-avatar-small">
                    <span class="friend-name">${r.senderName}</span>
                    <div class="request-actions">
                        <button class="btn-icon-small btn-accept" onclick="window.respondFriendRequest('${senderUid}', true)"><i class="ph-fill ph-check"></i></button>
                        <button class="btn-icon-small btn-reject" onclick="window.respondFriendRequest('${senderUid}', false)"><i class="ph-fill ph-x"></i></button>
                    </div>
                </div>
            `;
        });
        if(!html) html = '<div style="padding:10px; color:#666; font-size:12px;">' + window.t('no-requests') + '</div>';
        container.innerHTML = html;
    });

    // Listen Friends
    onValue(ref(db, `users/${myUid}/friends`), (snap) => {
        const friends = snap.val() || {};
        const container = document.getElementById('friend-list-container');
        let html = '';
        
        Object.keys(friends).forEach(friendUid => {
            // Setup unread listener for each friend
            setupUnreadListener(friendUid);
            
            html += `
                <div class="friend-list-item" onclick="window.openChat('${friendUid}')" id="friend-item-${friendUid}">
                    <img src="https://picsum.photos/seed/${friendUid}/50/50" id="friend-img-${friendUid}" class="friend-avatar-small">
                    <span class="friend-name" id="friend-name-${friendUid}">Loading...</span>
                    <span class="unread-badge" id="unread-${friendUid}" style="display:none;">0</span>
                </div>
            `;
        });
        
        if(!html) html = `<div style="padding:10px; color:#666; font-size:12px;">${window.t('no-friends-message')}</div>`;
        container.innerHTML = html;
        
        // Fetch friend details
        Object.keys(friends).forEach(friendUid => {
           get(ref(db, `users/${friendUid}`)).then(uSnap => {
               const u = uSnap.val();
               if(u) {
                   const nameEl = document.getElementById(`friend-name-${friendUid}`);
                   const imgEl = document.getElementById(`friend-img-${friendUid}`);
                   if(nameEl) nameEl.innerText = u.username;
                   if(imgEl) imgEl.src = u.profile_picture;
               }
           });
        });
    });
}
       // GANTI KODE SEARCH INI DENGAN KODE YANG SUDAH DIPERBAIKI DI BAWAH
        document.getElementById('friend-search-input').addEventListener('input', (e) => {
            const query = e.target.value.trim().toLowerCase();
            const resContainer = document.getElementById('friend-search-dropdown');
            
            // Clear timeout sebelumnya untuk debouncing
            clearTimeout(searchTimeout);
            
            if(!query) {
                resContainer.style.display = 'none';
                resContainer.innerHTML = '';
                return;
            }

            // Tampilkan loading state
            resContainer.innerHTML = '<div style="padding:10px; text-align:center; color:#888;">' + window.t('searching') + '</div>';
            resContainer.style.display = 'block';

            // Debouncing: tunggu 500ms setelah user berhenti mengetik
            searchTimeout = setTimeout(() => {
                performFriendSearch(query, resContainer);
            }, 500);
        });

        // === SETUP UNREAD MESSAGE LISTENER ===
function setupUnreadListener(friendUid) {
    const myUid = auth.currentUser.uid;
    const chatId = getChatId(myUid, friendUid);
    
    onValue(ref(db, `chats/${chatId}/messages`), (snap) => {
        const msgs = snap.val() || {};
        
        // Count unread messages (messages from friend that we haven't read)
        let unreadCount = 0;
        
        Object.values(msgs).forEach(msg => {
            // If message is from friend and we haven't marked as read
            if (msg.sender === friendUid && !msg.readBy?.[myUid]) {
                unreadCount++;
            }
        });
        
        unreadMessages[friendUid] = unreadCount;
        updateUnreadBadge(friendUid, unreadCount);
    });
}

// === UPDATE UNREAD BADGE ===
function updateUnreadBadge(friendUid, count) {
    const badge = document.getElementById(`unread-${friendUid}`);
    if (!badge) return;
    
    if (count > 0) {
        badge.innerText = count > 99 ? '99+' : count;
        badge.style.display = 'block';
    } else {
        badge.style.display = 'none';
    }
}

// === MARK MESSAGES AS READ ===
function markMessagesAsRead(friendUid) {
    const myUid = auth.currentUser.uid;
    const chatId = getChatId(myUid, friendUid);
    
    get(ref(db, `chats/${chatId}/messages`)).then(snap => {
        const msgs = snap.val() || {};
        
        Object.keys(msgs).forEach(msgId => {
            const msg = msgs[msgId];
            // Mark message as read if it's from the friend
            if (msg.sender === friendUid) {
                update(ref(db, `chats/${chatId}/messages/${msgId}/readBy`), {
                    [myUid]: true
                });
            }
        });
    });
    
    // Reset unread count
    unreadMessages[friendUid] = 0;
    updateUnreadBadge(friendUid, 0);
}


// Export to window
window.openChat = openChat;

        // Update selectFriendResult untuk menampilkan info lebih jelas
        function selectFriendResult(uid, username, pic) {
            document.getElementById('friend-search-dropdown').style.display = 'none';
            document.getElementById('friend-search-input').value = '';
            
            // Tampilkan konfirmasi atau info (opsional)
            // Bisa langsung kirim request atau tampilkan profil
            console.log(`Selected: ${username} (${uid})`);
        }

        // Update sendFriendRequest dengan error handling
        async function sendFriendRequest(targetUid) {
            try {
                const myUid = auth.currentUser.uid;
                const myData = currentUserData;
                
                // Check if already friends
                const friendSnap = await get(ref(db, `users/${myUid}/friends/${targetUid}`));
                if(friendSnap.exists()) { 
                    showToast(window.t('already-friends'), "error"); 
                    return; 
                }
                
                // Check if request already sent
                const reqSnap = await get(ref(db, `users/${targetUid}/friendRequests/${myUid}`));
                if(reqSnap.exists()) { 
                    showToast(window.t('request-already-sent'), "error"); 
                    return; 
                }

                // Send Request
                await set(ref(db, `users/${targetUid}/friendRequests/${myUid}`), {
                    senderName: myData.username,
                    senderPic: myData.profile_picture,
                    timestamp: Date.now()
                });
                
                // Record sent request
                await set(ref(db, `users/${myUid}/sentRequests/${targetUid}`), true);
                
                showToast(" " + window.t('friend-request-sent'));
                
                // Clear search
                document.getElementById('friend-search-dropdown').style.display = 'none';
                document.getElementById('friend-search-input').value = '';
                
            } catch (error) {
                console.error('Error sending friend request:', error);
                showToast(" Gagal mengirim permintaan. Coba lagi.", "error");
            }
        }

        async function respondFriendRequest(senderUid, accept) {
    const myUid = auth.currentUser.uid;
    if(accept) {
        //  GUNAKAN set() UNTUK NILAI BOOLEAN
        await set(ref(db, `users/${myUid}/friends/${senderUid}`), true);
        await set(ref(db, `users/${senderUid}/friends/${myUid}`), true);
        showToast(window.t('friend-added'), "success");
    } else {
        showToast(window.t('request-declined'), "error");
    }
    // Remove request
    await remove(ref(db, `users/${myUid}/friendRequests/${senderUid}`));
}

        window.selectFriendResult = selectFriendResult;
        window.sendFriendRequest = sendFriendRequest;
        window.respondFriendRequest = respondFriendRequest;

        async function performFriendSearch(query, resContainer) {
            try {
                // Fetch semua username index
                const snapshot = await get(ref(db, 'usernames'));
                const users = snapshot.val() || {};
                
                if(!users || Object.keys(users).length === 0) {
                    resContainer.innerHTML = '<div style="padding:10px; text-align:center; color:#888;">' + window.t('no-users') + '</div>';
                    return;
                }

                // Filter user yang cocok dengan query
                const matchedUserIds = Object.keys(users).filter(userIdKey => 
                    userIdKey.toLowerCase().includes(query)
                );

                if(matchedUserIds.length === 0) {
                    resContainer.innerHTML = '<div style="padding:10px; text-align:center; color:#888;">' + window.t('no-results') + '</div>';
                    return;
                }

                // Fetch detail semua matched users secara parallel
                const userDetailsPromises = matchedUserIds.map(async (userIdKey) => {
                    const uid = users[userIdKey];
                    
                    // Skip jika ini adalah user sendiri
                    if(uid === auth.currentUser.uid) return null;
                    
                    const uSnap = await get(ref(db, `users/${uid}`));
                    const userData = uSnap.val();
                    
                    if(!userData) return null;
                    
                    return {
                        uid: uid,
                        username: userData.username,
                        userId: userData.userId,
                        profile_picture: userData.profile_picture
                    };
                });

                const userDetails = (await Promise.all(userDetailsPromises)).filter(u => u !== null);

                // Render hasil
                if(userDetails.length === 0) {
                    resContainer.innerHTML = '<div style="padding:10px; text-align:center; color:#888;">' + window.t('no-results') + '</div>';
                    return;
                }

                let html = '';
                userDetails.forEach(u => {
                    html += `
                        <div class="friend-dropdown-item" onclick="window.selectFriendResult('${u.uid}', '${escapeHtml(u.username)}', '${u.profile_picture}')">
                            <img src="${u.profile_picture}" style="width:24px;height:24px;border-radius:50%;">
                            <div>
                                <div style="font-size:12px; font-weight:600; color:white;">${escapeHtml(u.username)}</div>
                                <div style="font-size:10px; color:#aaa;">${u.userId}</div>
                            </div>
                            <button class="btn-icon-small" style="margin-left:auto;" onclick="event.stopPropagation(); window.sendFriendRequest('${u.uid}')">
                                <i class="ph ph-user-plus"></i>
                            </button>
                        </div>
                    `;
                });
                
                resContainer.innerHTML = html;
                
            } catch (error) {
                console.error('Error searching friends:', error);
                resContainer.innerHTML = '<div style="padding:10px; text-align:center; color:#ff4444;">' + window.t('error-search') + '</div>';
            }
        }

        // Helper function untuk escape HTML (prevent XSS)
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // --- CHAT SYSTEM ---

        function getChatId(uid1, uid2) {
            return [uid1, uid2].sort().join('_');
        }

    // === UPDATE openChat FUNCTION ===
// Ganti fungsi openChat yang lama dengan yang ini:
function openChat(friendUid) {
    activeChatFriendUid = friendUid;
    activeChatId = getChatId(auth.currentUser.uid, friendUid);
    
    document.getElementById('chat-overlay').classList.add('active');
    
    // Mark messages as read when opening chat
    markMessagesAsRead(friendUid);
    
    // Get Friend Data
    get(ref(db, `users/${friendUid}`)).then(snap => {
        const u = snap.val();
        activeChatFriendData = u;
        document.getElementById('chat-friend-name-display').innerText = u.username;
        document.getElementById('chat-friend-avatar-display').src = u.profile_picture;
    });

    renderMessages();
}

// Export to window
window.openChat = openChat;

        function closeChat() {
            document.getElementById('chat-overlay').classList.remove('active');
            activeChatFriendUid = null;
            activeChatId = null;
            // Detach listener if needed (onValue handles multiple detach usually, but good practice to clean up references if logic grows)
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input-box');
            const text = input.value.trim();
            if(!text || !activeChatId) return;

            const msg = {
                sender: auth.currentUser.uid,
                text: text,
                timestamp: Date.now(),
                replyTo: replyingToMsgId || null
            };

            push(ref(db, `chats/${activeChatId}/messages`), msg);
            input.value = '';
            replyingToMsgId = null;
        }

        function renderMessages() {
            const chatBody = document.getElementById('chat-body');
            chatBody.innerHTML = '';

            onValue(ref(db, 'chats/' + activeChatId + '/messages'), (snap) => {
                const msgs = snap.val() || {};
                chatBody.innerHTML = '';
                
                Object.keys(msgs).sort((a,b) => msgs[a].timestamp - msgs[b].timestamp).forEach(key => {
                    const m = msgs[key];
                    const isMe = m.sender === auth.currentUser.uid;
                    
                    let replyHtml = '';
                    if(m.replyTo) {
                        const origMsg = msgs[m.replyTo] || { text: 'Pesan dihapus' };
                        replyHtml = '<div class="msg-reply-indicator">Balas: ' + origMsg.text.substring(0, 30) + '...</div>';
                    }

                    // Check if shared content
                    let contentHtml = '<div>' + m.text + '</div>';
                    if(m.shareType) {
                        let cardHtml = '';
                        if(m.shareType === 'song') {
                            const s = m.shareContent;
                            cardHtml = `
                                <div class="chat-shared-card" onclick="window.playSpecificSong(${s.id}); window.closeChat();">
                                    <img src="${s.cover}" class="chat-shared-img" alt="Cover">
                                    <div class="chat-shared-info">
                                        <div class="chat-shared-title">${s.title}</div>
                                        <div class="chat-shared-sub">${s.artist}</div>
                                    </div>
                                </div>
                            `;
                        } else if (m.shareType === 'playlist') {
                            const pl = m.shareContent;
                            cardHtml = `
                                <div class="chat-shared-card" onclick="window.openFriendPlaylist('${pl.id}'); window.closeChat();">
                                    <img src="${pl.cover}" class="chat-shared-img" alt="Playlist Cover">
                                    <div class="chat-shared-info">
                                        <div class="chat-shared-title">${pl.name}</div>
                                        <div class="chat-shared-sub">Playlist</div>
                                    </div>
                                </div>
                            `;
                        } else if (m.shareType === 'album') {
                            const alb = m.shareContent;
                            cardHtml = `
                                <div class="chat-shared-card">
                                    <img src="${alb.cover}" class="chat-shared-img" alt="Album Cover">
                                    <div class="chat-shared-info">
                                        <div class="chat-shared-title">${alb.name}</div>
                                        <div class="chat-shared-sub">Album</div>
                                    </div>
                                </div>
                            `;
                        }
                        contentHtml = cardHtml;
                    }

                    const el = document.createElement('div');
                    el.className = 'msg-bubble ' + (isMe ? 'msg-sent' : 'msg-received');
                    el.dataset.msgId = key;
                    el.innerHTML = replyHtml + contentHtml + '<div class="msg-time">' + new Date(m.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + '</div>';
                    
                    // Swipe & Context Logic
                    addInteractions(el, key, m, isMe);
                    
                    chatBody.appendChild(el);
                });
                
                // Scroll to bottom
                chatBody.scrollTop = chatBody.scrollHeight;
            });
        }

        function addInteractions(el, msgId, msgData, isMe) {
            // Context Menu
            el.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showContextMenu(e.clientX, e.clientY, msgId);
            });

            // Swipe Logic (Touch)
            let touchStartX = 0;
            el.addEventListener('touchstart', e => {
                touchStartX = e.touches[0].clientX;
            }, {passive: true});

            el.addEventListener('touchend', e => {
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchEndX - touchStartX;
                
                // Threshold for swipe (50px)
                if (Math.abs(diff) > 50) {
                    if (isMe && diff < 0) {
                        // Swipe Left (My msg) -> Reply
                        triggerReply(msgId);
                    } else if (!isMe && diff > 0) {
                        // Swipe Right (Friend msg) -> Reply
                        triggerReply(msgId);
                    }
                }
            }, {passive: true});
        }

        function showContextMenu(x, y, msgId) {
            const menu = document.getElementById('context-menu');
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';
            menu.style.display = 'flex';
            
            // Store current context target
            window.currentContextMsgId = msgId;
            
            // Close on click elsewhere
            const closeMenu = () => {
                menu.style.display = 'none';
                document.removeEventListener('click', closeMenu);
            };
            setTimeout(() => document.addEventListener('click', closeMenu), 0);
        }

        function ctxAction(action) {
            const msgId = window.currentContextMsgId;
            if(!msgId) return;
            
            if(action === 'copy') {
                // Mock copy
                alert("Pesan disalin!");
            } else if (action === 'reply') {
                triggerReply(msgId);
            } else if (action === 'delete') {
                // In real app, verify ownership, then delete from DB
                remove(ref(db, `chats/${activeChatId}/messages/${msgId}`));
            }
            document.getElementById('context-menu').style.display = 'none';
        }

        function triggerReply(msgId) {
            replyingToMsgId = msgId;
            const input = document.getElementById('chat-input-box');
            input.placeholder = "Membalas pesan...";
            input.focus();
        }

        window.openChat = openChat;
        window.closeChat = closeChat;
        window.sendChatMessage = sendChatMessage;
        window.ctxAction = ctxAction;

        // --- SHARE FEATURE ---
        
        function openShareModal(type, contentId) {
            if(!auth.currentUser) return;
            
            const modal = document.getElementById('share-modal');
            const list = document.getElementById('share-friend-list');
            const loading = document.getElementById('share-loading');
            
            modal.classList.add('open');
            list.innerHTML = '';
            loading.style.display = 'block';

            // Get Friend List
            get(ref(db, `users/${auth.currentUser.uid}/friends`)).then(snap => {
                loading.style.display = 'none';
                const friends = snap.val() || {};
                if(!Object.keys(friends).length) {
                    list.innerHTML = '<div style="text-align:center; padding:20px; color:#888">' + window.t('no-you-have-friends') + '</div>';
                    return;
                }

                let html = '';
                Object.keys(friends).forEach(friendUid => {
                    // Fetch names
                    get(ref(db, `users/${friendUid}`)).then(uSnap => {
                        const u = uSnap.val();
                        html += `
                            <div class="playlist-select-item" onclick="window.executeShare('${type}', '${contentId}', '${friendUid}')">
                                <img src="${u.profile_picture}" style="width:40px;height:40px;border-radius:50%;">
                                <div>${u.username}</div>
                            </div>
                        `;
                        list.innerHTML = html;
                    });
                });
            });

            // Save share intent temporarily
            window.pendingShare = { type, id: contentId };
        }

        function executeShare(type, id, targetUid) {
            const myUid = auth.currentUser.uid;
            const chatId = getChatId(myUid, targetUid);
            let msgPayload = {
                sender: myUid,
                text: "Membagikan konten",
                timestamp: Date.now()
            };

            if(type === 'song') {
                const song = songs.find(s => s.id == id);
                msgPayload.shareType = 'song';
                msgPayload.shareContent = song;
            } else if (type === 'playlist') {
                let playlist = null;
                // 1. Try finding in my playlists
                if (currentUserData && currentUserData.playlists && currentUserData.playlists[id]) {
                    playlist = currentUserData.playlists[id];
                } 
                // 2. Try finding in public playlists
                else if (allPublicPlaylists) {
                    playlist = allPublicPlaylists.find(pl => pl.id === id);
                }

                if (!playlist) {
                    alert("Gagal membagikan playlist: Data playlist tidak ditemukan.");
                    return;
                }

                msgPayload.shareType = 'playlist';
                msgPayload.shareContent = { id: id, name: playlist.name, cover: playlist.cover };
            }

            push(ref(db, `chats/${chatId}/messages`), msgPayload);
            closeModal('share-modal');
            alert("Berhasil dibagikan!");
        }

        window.openShareModal = openShareModal;
        window.executeShare = executeShare;

        // --- FRIEND PROFILE & PLAYLIST VIEW ---

        let viewingFriendUid = null;

        function openFriendProfileFromChat() {
            if(!activeChatFriendUid) return;
            viewingFriendUid = activeChatFriendUid;
            loadFriendProfileData();
        }

        function loadFriendProfileData() {
            const uid = viewingFriendUid;
            const overlay = document.getElementById('friend-profile-overlay');
            overlay.classList.add('active');

            get(ref(db, `users/${uid}`)).then(snap => {
                const u = snap.val();
                if(!u) return;

                document.getElementById('friend-profile-avatar-display').src = u.profile_picture;
                document.getElementById('friend-profile-name-display').innerText = u.username;
                document.getElementById('friend-profile-userid-text').innerText = u.userId || "User#0000";
                document.getElementById('friend-profile-bio-display').innerText = u.bio || '';

                const avatar = document.getElementById('friend-profile-avatar-display');
                avatar.onload = function() {
                    const rgb = getAverageRGB(avatar);
                    const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                    document.getElementById('friend-hero-section').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
                }

                renderFriendPlaylists(u.playlists || {});
            });
        }

       // Ganti fungsi renderFriendPlaylists (sekitar line 1400):

function renderFriendPlaylists(playlists) {
    const container = document.getElementById('friend-public-playlists');
    let html = '';
    
    Object.keys(playlists).forEach(key => {
        const pl = playlists[key];
        // Only show public playlists
        if(pl.isPublic) {
            html += `
                <div class="song-card" onclick="window.openFriendPlaylist('${key}')">
                    <div class="card-img-wrapper">
                        <img src="${pl.cover}" alt="${pl.name}">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <div class="card-title">${pl.name}</div>
                    <div class="card-desc">${window.t('public-playlists')}</div>
                </div>
            `;
        }
    });

    if(!html) html = `<div style="padding:0 32px; color:#666;">${window.t('friend-no-public-playlists')}</div>`;
    container.innerHTML = html;
}
   
      function openFriendPlaylist(playlistId) {
    if(!viewingFriendUid) return;
    
    get(ref(db, 'users/' + viewingFriendUid + '/playlists/' + playlistId)).then(snap => {
        const pl = snap.val();
        if(!pl) return;
        
        currentPlaylistId = playlistId;
        
        document.getElementById('playlist-title-view').innerText = pl.name;
        document.getElementById('playlist-cover-view').src = pl.cover;
        
        //  PERBAIKAN: Cek apakah elemen ada
        const friendName = document.getElementById('friend-profile-name-display');
        const ownerDisplay = document.getElementById('playlist-owner-display');
        if(friendName && ownerDisplay) {
            ownerDisplay.innerText = friendName.innerText;
        }
        
  
        
        const coverEl = document.getElementById('playlist-cover-view');
        coverEl.onload = function() {
            const rgb = getAverageRGB(coverEl);
            const color = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
            document.getElementById('playlist-header-bg').style.background = 'linear-gradient(180deg, ' + color + ' 0%, var(--bg-dark) 100%)';
        };

        const plSongs = Object.values(pl.songs || {});
        const songDetails = plSongs
            .filter(sIdOrObj => sIdOrObj)
            .map(songIdOrObj => {
                const idToFind = (typeof songIdOrObj === 'object') ? songIdOrObj.id : songIdOrObj;
                return songs.find(s => s.id == idToFind);
            })
            .filter(s => s);

        document.getElementById('playlist-count').innerText = songDetails.length + ' ' + window.t('songs-label');
        renderSongList(songDetails, 'playlist-songs-container');
        
        const shareBtn = document.querySelector('#view-playlist .playlist-actions .share-btn-album');
        if(shareBtn) shareBtn.style.display = 'none';

        window.closeFriendProfile();
        window.switchView('playlist');
    });
}

        window.openFriendProfileFromChat = openFriendProfileFromChat;
        window.closeFriendProfile = () => document.getElementById('friend-profile-overlay').classList.remove('active');
        window.openFriendPlaylist = openFriendPlaylist;

        // --- COPY USER ID FUNCTIONS ---
        function copyUserId() {
            if(currentUserData && currentUserData.userId) {
                navigator.clipboard.writeText(currentUserData.userId).then(() => {
                    const el = document.getElementById('profile-userid-text');
                    const originalText = el.innerText;
                    el.innerText = "Disalin!";
                    setTimeout(() => el.innerText = originalText, 1500);
                });
            }
        }

        function copyFriendUserId() {
            const idText = document.getElementById('friend-profile-userid-text').innerText;
            navigator.clipboard.writeText(idText).then(() => {
                alert(`ID Teman (${idText}) disalin!`);
            });
        }

        window.copyUserId = copyUserId;
        window.copyFriendUserId = copyFriendUserId;

        // --- PLAYLIST PRIVACY & COVER ---
        
        function togglePlaylistPrivacy(playlistId) {
            const playlists = currentUserData.playlists || {};
            const pl = playlists[playlistId];
            if(!pl) return;
            
            const newState = !pl.isPublic; // Toggle
            update(ref(db, `users/${auth.currentUser.uid}/playlists/${playlistId}`), { isPublic: newState });
        }

        function handleLikedCoverUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const url = e.target.result;
                    document.getElementById('liked-cover-view').src = url;
                    update(ref(db, 'users/' + auth.currentUser.uid), { likedCover: url });
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        window.togglePlaylistPrivacy = togglePlaylistPrivacy;
        window.handleLikedCoverUpload = handleLikedCoverUpload;

        // --- GENERAL UI ---
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        window.closeModal = closeModal;

        function switchView(viewName) {
            if(window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('sidebar-overlay').classList.remove('active');
            }

            // SAVE current scroll position BEFORE switching
            const mainContent = document.querySelector('.main-content');
            const currentActiveView = document.querySelector('.view-section.active');
            if (currentActiveView && mainContent) {
                const currentViewId = currentActiveView.id;
                if (currentViewId) {
                    const currentViewName = currentViewId.replace('view-', '');
                    window.scrollPositions[currentViewName] = mainContent.scrollTop;
                }
            }

            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            const targetView = document.getElementById(`view-${viewName}`);
            if (targetView) {
                targetView.classList.add('active');
                
                // RESTORE scroll position after a small delay to allow animation to complete
                if (mainContent) {
                    setTimeout(() => {
                        if (window.scrollPositions && window.scrollPositions[viewName] !== undefined) {
                            mainContent.scrollTop = window.scrollPositions[viewName];
                        } else {
                            mainContent.scrollTop = 0;
                        }
                    }, 10);
                }
                
                // Track history for non-main navigation views
                if (viewName === 'playlist' || viewName === 'profile' || viewName.includes('album')) {
                    pushToHistory(viewName);
                }
                
                if (viewName === 'profile') {
                    window.loadProfileData();
                    
                    //  Add class to body and hide both progress bars
                    document.body.classList.add('profile-view-active');
                    
                    // Hide overlay progress bar (in overlay-player)
                    const overlayProgress = document.getElementById('overlay-progress-container');
                    if (overlayProgress) {
                        overlayProgress.style.display = 'none !important';
                        overlayProgress.style.visibility = 'hidden';
                        overlayProgress.style.height = '0';
                    }
                    
                    // Hide bottom progress bar (near playbar)
                    const playerProgressBar = document.querySelector('.player-progress-bar-wrapper');
                    if (playerProgressBar) {
                        playerProgressBar.style.display = 'none !important';
                        playerProgressBar.style.visibility = 'hidden';
                        playerProgressBar.style.opacity = '0';
                    }
                } else {
                    // Remove class when leaving profile
                    document.body.classList.remove('profile-view-active');
                    
                    // Show overlay progress bar
                    const overlayProgress = document.getElementById('overlay-progress-container');
                    if (overlayProgress) {
                        overlayProgress.style.display = 'block';
                        overlayProgress.style.visibility = 'visible';
                        overlayProgress.style.height = 'auto';
                    }
                    
                    // Progress bar will show automatically via CSS when player-bar.active
                    // No need to manually show it here
                }

                // Hide/Show playbar based on view
                const playerBar = document.querySelector('.player-bar');
                
                if (viewName === 'profile') {
                    // Hide player in profile
                    if (playerBar) playerBar.style.setProperty('display', 'none', 'important');
                } else {
                    // Only show player if it has 'active' class (means a song was loaded)
                    if (playerBar && playerBar.classList.contains('active')) {
                        playerBar.style.setProperty('display', 'flex', 'important');
                    }
                }
            }
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${viewName}`);
            if (activeNav) activeNav.classList.add('active');

            /* sync mobile bottom nav active state */
            document.querySelectorAll('.mb-nav-item').forEach(el => el.classList.remove('active'));
            const mbActive = document.getElementById(`mb-nav-${viewName}`);
            if (mbActive) mbActive.classList.add('active');

            if(viewName === 'liked') {
                openLikedView();
            }
            
            if(viewName === 'offline') {
                if (window.loadOfflineMusic) {
                    window.loadOfflineMusic();
                }
            }
            
            if(viewName === 'search') {
                document.getElementById('search-input').value = '';
                handleSearch(''); // Reset to history view
            }
        }

        window.switchView = switchView;

        // --- LANGUAGE SYSTEM ---
        let currentLanguage = localStorage.getItem('appLanguage') || 'id';
        console.log('Language initialized to:', currentLanguage);
        
        const translations = {
            id: {
                // Navbar
                'nav-home': 'Beranda',
                'nav-search': 'Cari',
                'nav-liked': 'Lagu Disukai',
                'nav-offline': 'Musik Offline',
                // Sidebar
                'playlist-title': 'Playlist Anda',
                'create-playlist': 'Buat Playlist',
                'import-music': 'Impor Musik',
                // Main content
                'no-history': 'Belum ada riwayat',
                'recently-played': 'Baru Diputar',
                'all-artists': 'Semua Artis',
                'play': 'Putar',
                'pause': 'Jeda',
                'liked-songs': 'Lagu Disukai',
                'profile': 'Profil',
                'logout': 'Keluar',
                'back': 'Kembali',
                'album': 'Album',
                'artist': 'Artis',
                'playlist': 'Playlist',
                'songs': 'Lagu',
                'search': 'Cari lagu, artis, playlist...',
                'home': 'Beranda',
                'liked': 'Lagu Disukai',
                'ok': 'OK',
                'cancel': 'Batal',
                'save': 'Simpan',
                'delete': 'Hapus',
                'edit': 'Edit',
                'add': 'Tambah',
                'remove': 'Hapus',
                'share': 'Bagikan',
                'download-offline': 'Download untuk Offline',
                'offline-music-title': 'Musik Offline',
                'cached-songs': 'Lagu Tersimpan',
                'clear-all-cache': 'Hapus Semua Cache',
                'offline-playlists': 'Playlist Offline',
                'offline-songs': 'Lagu Offline',
                'loading': 'Memuat...',
                'no-playlists': 'Belum ada playlist',
                'all-playlists': 'Semua Playlist',
                'my-playlists': 'Playlist Saya',
                'public-playlists': 'Playlist Publik',
                'by': 'Oleh',
                'songs-count': 'lagu',
                'no-songs': 'Belum ada lagu',
                'add-to-playlist': 'Tambah ke Playlist',
                'remove-from-playlist': 'Hapus dari Playlist',
                'no-file-selected': 'Belum ada file dipilih',
                'no-friends': 'Belum ada teman',
                'no-results': 'Tidak ada hasil',
                'no-users': 'Tidak ada pengguna ditemukan',
                'no-songs-found': 'Tidak ada lagu ditemukan',
                'searching': 'Mencari...',
                'error-search': 'Error saat mencari',
                'empty-queue': 'Antrian kosong',
                'song-added-to-queue': 'Lagu ditambahkan ke antrian',
                'queue': 'Antrian',
                'no-public-playlists': 'Tidak ada playlist publik. Atur privasi di sidebar',
                'waiting-friends': 'Menunggu teman bergabung...',
                'waiting': 'Menunggu...',
                'no-active-playlist': 'Tidak ada playlist yang aktif',
                'no-you-have-friends': 'Anda belum punya teman',
                // Home page
                'my-playlists-section': 'Playlist Saya',
                'popular-indonesian-bands': 'Band Populer Indonesia',
                'popular-indonesian-artists': 'Penyanyi Populer Indonesia',
                'popular-foreign-artists': 'Penyanyi Asing Populer',
                'popular-foreign-bands': 'Band Asing Populer',
                'search-results': 'Hasil Pencarian',
                'public-playlists': 'Playlist Publik',
                'playlist-settings': 'Pengaturan Playlist',
                'share-to-friends': 'Bagikan ke Teman',
                'select-song': 'Pilih Lagu',
                'song-collection': 'Koleksi Lagu',
                'popular-songs': 'Lagu Populer',
                'owner': 'Owner',
                'songs-label': 'lagu',
                'sidebar-friends': 'Teman',
                'search-friends-placeholder': 'Cari Teman (User/Nama)',
                'friend-requests': 'Permintaan Pertemanan',
                'friend-list': 'Daftar Teman',
                'recently-played': 'Baru Diputar',
                'friend-no-public-playlists': 'Teman ini tidak memiliki playlist publik.',
                'already-friends': 'Sudah berteman dengan pengguna ini.',
                'request-already-sent': 'Permintaan sudah terkirim sebelumnya.',
                'friend-request-sent': 'Permintaan pertemanan berhasil dikirim!',
                'friend-added': 'Teman ditambahkan!',
                'request-declined': 'Permintaan ditolak.',
                'no-friends-message': 'Belum ada teman.',
                'band-popular-indonesia': 'Band Populer Indonesia',
                'artist-popular-indonesia': 'Penyanyi Populer Indonesia',
                'artist-foreign-popular': 'Penyanyi Asing Populer',
                'band-foreign-popular': 'Band Asing Populer',
                'my-playlists': 'Playlist Kamu',
                'friend-name': 'Nama Teman',
                'login-title': 'Masuk ke Vidje',
                'login-subtitle': 'Musik untuk semua orang.',
                'login-error-default': 'Email atau password salah.',
                'signup-title': 'Daftar Akun',
                'signup-subtitle': 'Bergabunglah dengan Vidje.',
                'signup-error-default': 'Gagal mendaftar.',
                'signup-fullname': 'Nama Lengkap',
                'signup-button': 'Daftar',
                'login-button': 'Masuk',
                'signup-have-account': 'Sudah punya akun?',
                'signup-link': 'Masuk',
                'login-no-account': 'Belum punya akun?',
                'login-link': 'Daftar Sekarang',
                'chat-placeholder': 'Ketik pesan...',
                'playlist-name-label': 'Nama Playlist',
                'playlist-name-example': 'Contoh: Lagu Santai',
                'create-button': 'Buat',
                'fill-all-fields': 'Mohon lengkapi semua kolom.',
                'email-password-wrong': 'Email atau password salah.',
                'settings-playlist-name': 'Nama Playlist',
                'profile-label': 'Profil',
                'profile-bio-placeholder': 'Bio pengguna akan muncul di sini.',
                'no-requests': 'Tidak ada permintaan baru',
                'edit-profile': 'Edit Profil',
                'profile-id-note': 'ID pengguna akan otomatis mengikuti nama baru.',
                'setting-language': 'Setting Bahasa',
                'friend-profile-label': 'Profil Teman',
                'friend-bio-placeholder': 'Bio teman akan muncul di sini.'
            },
            en: {
                // Navbar
                'nav-home': 'Home',
                'nav-search': 'Search',
                'nav-liked': 'Liked Songs',
                'nav-offline': 'Offline Music',
                // Sidebar
                'playlist-title': 'Your Playlists',
                'create-playlist': 'Create Playlist',
                'import-music': 'Import Music',
                // Main content
                'no-history': 'No history',
                'recently-played': 'Recently Played',
                'all-artists': 'All Artists',
                'play': 'Play',
                'pause': 'Pause',
                'liked-songs': 'Liked Songs',
                'profile': 'Profile',
                'logout': 'Logout',
                'back': 'Back',
                'album': 'Album',
                'artist': 'Artist',
                'playlist': 'Playlist',
                'songs': 'Songs',
                'search': 'Search songs, artists, playlists...',
                'home': 'Home',
                'liked': 'Liked Songs',
                'ok': 'OK',
                'cancel': 'Cancel',
                'save': 'Save',
                'delete': 'Delete',
                'edit': 'Edit',
                'add': 'Add',
                'remove': 'Remove',
                'share': 'Share',
                'download-offline': 'Download for Offline',
                'offline-music-title': 'Offline Music',
                'cached-songs': 'Cached Songs',
                'clear-all-cache': 'Clear All Cache',
                'offline-playlists': 'Offline Playlists',
                'offline-songs': 'Offline Songs',
                'loading': 'Loading...',
                'no-playlists': 'No playlists yet',
                'all-playlists': 'All Playlists',
                'my-playlists': 'My Playlists',
                'public-playlists': 'Public Playlists',
                'by': 'By',
                'songs-count': 'songs',
                'no-songs': 'No songs',
                'add-to-playlist': 'Add to Playlist',
                'remove-from-playlist': 'Remove from Playlist',
                'no-file-selected': 'No file selected',
                'no-friends': 'No friends yet',
                'no-results': 'No results',
                'no-users': 'No users found',
                'no-songs-found': 'No songs found',
                'searching': 'Searching...',
                'error-search': 'Error searching',
                'empty-queue': 'Queue is empty',
                'song-added-to-queue': 'Song added to queue',
                'queue': 'Queue',
                'no-public-playlists': 'No public playlists. Adjust privacy in sidebar',
                'waiting-friends': 'Waiting for friends to join...',
                'waiting': 'Waiting...',
                'no-active-playlist': 'No active playlist',
                'no-you-have-friends': 'You don\'t have any friends yet',
                // Home page
                'my-playlists-section': 'My Playlists',
                'popular-indonesian-bands': 'Popular Indonesian Bands',
                'popular-indonesian-artists': 'Popular Indonesian Artists',
                'popular-foreign-artists': 'Popular Foreign Artists',
                'popular-foreign-bands': 'Popular Foreign Bands',
                'search-results': 'Search Results',
                'public-playlists': 'Public Playlists',
                'playlist-settings': 'Playlist Settings',
                'share-to-friends': 'Share to Friends',
                'select-song': 'Select Song',
                'song-collection': 'Song Collection',
                'popular-songs': 'Popular Songs',
                'owner': 'Owner',
                'songs-label': 'songs',
                'sidebar-friends': 'Friends',
                'search-friends-placeholder': 'Search Friends (Name/User)',
                'friend-requests': 'Friend Requests',
                'friend-list': 'Friend List',
                'recently-played': 'Recently Played',
                'friend-no-public-playlists': 'This friend has no public playlists.',
                'already-friends': 'Already friends with this user.',
                'request-already-sent': 'Friend request already sent.',
                'friend-request-sent': 'Friend request sent successfully!',
                'friend-added': 'Friend added!',
                'request-declined': 'Friend request declined.',
                'no-friends-message': 'No friends yet.',
                'band-popular-indonesia': 'Popular Indonesian Bands',
                'artist-popular-indonesia': 'Popular Indonesian Artists',
                'artist-foreign-popular': 'Popular Foreign Artists',
                'band-foreign-popular': 'Popular Foreign Bands',
                'my-playlists': 'My Playlists',
                'friend-name': 'Friend Name',
                'login-title': 'Login to Vidje',
                'login-subtitle': 'Music for everyone.',
                'login-error-default': 'Email or password is incorrect.',
                'signup-title': 'Create Account',
                'signup-subtitle': 'Join Vidje.',
                'signup-error-default': 'Sign up failed.',
                'signup-fullname': 'Full Name',
                'signup-button': 'Sign Up',
                'login-button': 'Login',
                'signup-have-account': 'Already have an account?',
                'signup-link': 'Login',
                'login-no-account': 'Don\'t have an account?',
                'login-link': 'Sign Up Now',
                'chat-placeholder': 'Type a message...',
                'playlist-name-label': 'Playlist Name',
                'playlist-name-example': 'e.g. Chill Songs',
                'create-button': 'Create',
                'fill-all-fields': 'Please fill in all fields.',
                'email-password-wrong': 'Email or password is incorrect.',
                'settings-playlist-name': 'Playlist Name',
                'profile-label': 'Profile',
                'profile-bio-placeholder': 'User bio will appear here.',
                'no-requests': 'No New Request',
                'edit-profile': 'Edit Profile',
                'profile-id-note': 'User ID will automatically follow the new name.',
                'setting-language': 'Setting Language',
                'friend-profile-label': 'Friend Profile',
                'friend-bio-placeholder': 'Friend bio will appear here.'
            }
        };
        
        function switchLanguage(lang) {
            if (!translations[lang]) lang = 'id'; // Fallback to Indonesian if invalid
            console.log('Switching language to:', lang);
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            const activeLangBtn = document.querySelector(`[data-lang="${lang}"]`);
            if (activeLangBtn) activeLangBtn.classList.add('active');
            
            // Update mobile language dropdown state
            window.updateLanguageDropdownState(lang);
            
            // Update all text elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    if (el.tagName === 'INPUT') {
                        el.placeholder = translations[lang][key];
                    } else {
                        el.textContent = translations[lang][key];
                    }
                }
            });
            
            // Update all elements with data-i18n-placeholder attribute
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
            
            // Update placeholder for search input
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.placeholder = translations[lang]['search'] || 'Search...';
            }
            
            // Update friend requests container text
            const friendReqsContainer = document.getElementById('friend-requests-container');
            if (friendReqsContainer) {
                const existingContent = friendReqsContainer.innerHTML;
                // Check if it's showing the empty state (contains "Tidak ada permintaan" or "No New Request" or has color:#666)
                if (existingContent.includes('color:#666') || existingContent.includes('Tidak ada permintaan') || existingContent.includes('No New Request')) {
                    friendReqsContainer.innerHTML = '<div style="padding:10px; color:#666; font-size:12px;">' + window.t('no-requests') + '</div>';
                }
            }
        }
        
        window.switchLanguage = switchLanguage;
        
        // Toggle language dropdown (mobile)
        window.toggleLanguageDropdown = function() {
            const dropdown = document.getElementById('language-dropdown');
            if(dropdown) {
                dropdown.classList.toggle('active');
            }
        };
        
        // Toggle language dropdown (desktop)
        window.toggleLanguageDropdownDesktop = function() {
            const dropdown = document.getElementById('language-dropdown-desktop');
            if(dropdown) {
                if(dropdown.style.display === 'none') {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            }
        };
        
        // Update language dropdown button active state
        window.updateLanguageDropdownState = function(lang) {
            // Mobile buttons
            const langIdBtn = document.getElementById('lang-id-btn');
            const langEnBtn = document.getElementById('lang-en-btn');
            const langIdCheckMobile = langIdBtn ? langIdBtn.querySelector('.ph-check') : null;
            const langEnCheckMobile = langEnBtn ? langEnBtn.querySelector('.ph-check') : null;
            
            // Desktop buttons
            const langIdBtnDesktop = document.getElementById('lang-id-btn-desktop');
            const langEnBtnDesktop = document.getElementById('lang-en-btn-desktop');
            const langIdCheckDesktop = langIdBtnDesktop ? langIdBtnDesktop.querySelector('.ph-check') : null;
            const langEnCheckDesktop = langEnBtnDesktop ? langEnBtnDesktop.querySelector('.ph-check') : null;
            
            if(lang === 'id') {
                // Mobile
                if(langIdBtn) langIdBtn.classList.add('active');
                if(langEnBtn) langEnBtn.classList.remove('active');
                if(langIdCheckMobile) langIdCheckMobile.style.opacity = '1';
                if(langEnCheckMobile) langEnCheckMobile.style.opacity = '0';
                
                // Desktop
                if(langIdBtnDesktop) langIdBtnDesktop.classList.add('active');
                if(langEnBtnDesktop) langEnBtnDesktop.classList.remove('active');
                if(langIdCheckDesktop) langIdCheckDesktop.style.opacity = '1';
                if(langEnCheckDesktop) langEnCheckDesktop.style.opacity = '0';
            } else {
                // Mobile
                if(langIdBtn) langIdBtn.classList.remove('active');
                if(langEnBtn) langEnBtn.classList.add('active');
                if(langIdCheckMobile) langIdCheckMobile.style.opacity = '0';
                if(langEnCheckMobile) langEnCheckMobile.style.opacity = '1';
                
                // Desktop
                if(langIdBtnDesktop) langIdBtnDesktop.classList.remove('active');
                if(langEnBtnDesktop) langEnBtnDesktop.classList.add('active');
                if(langIdCheckDesktop) langIdCheckDesktop.style.opacity = '0';
                if(langEnCheckDesktop) langEnCheckDesktop.style.opacity = '1';
            }
        };
        
        // Helper function to get translated text
        function t(key) {
            if (translations[currentLanguage] && translations[currentLanguage][key]) {
                return translations[currentLanguage][key];
            }
            if (translations['id'] && translations['id'][key]) {
                return translations['id'][key];
            }
            return key;
        }
        
        window.t = t;
        
        // Initialize with saved language
        window.addEventListener('DOMContentLoaded', () => {
            switchLanguage(currentLanguage);
        });
        
        // If DOM is already loaded, call switchLanguage immediately
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => switchLanguage(currentLanguage));
        } else {
            switchLanguage(currentLanguage);
        }

        // --- NEW LYRICS OVERLAY STATE ---
        let newLyricsState = {
            isOpen: false,
            currentLineIndex: -1,
            syncInterval: null
        };
        
        // Helper function to format time
        function formatTime(secs) {
            if (isNaN(secs)) return '0:00';
            const mins = Math.floor(secs / 60);
            const seconds = Math.floor(secs % 60);
            return `${mins}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Open new lyrics overlay
        function openNewLyricsOverlay() {
            console.log('[MUSIC] Opening NEW lyrics overlay...');
            
            const overlay = document.getElementById('new-lyrics-overlay');
            if (!overlay) {
                console.error('[ERROR] new-lyrics-overlay not found');
                return;
            }
            
            // Get current song
            const currentSong = songs[currentSongIndex];
            if (!currentSong) {
                console.error('[ERROR] No song playing');
                return;
            }
            
            // Set background
            const bg = document.getElementById('new-overlay-bg');
            if (bg && currentSong.cover) {
                bg.style.backgroundImage = `url('${currentSong.cover}')`;
            }
            
            // Set album art
            const art = document.getElementById('new-album-art');
            if (art && currentSong.cover) {
                art.src = currentSong.cover;
            }
            
            // Set title and artist
            document.getElementById('new-song-title').textContent = currentSong.title || '-';
            document.getElementById('new-song-artist').textContent = currentSong.artist || '-';
            
            // Render lyrics
            renderNewLyrics();
            
            // Update shuffle/repeat button states
            updateNewControlStates();
            
            // Show overlay
            overlay.classList.add('active');
            newLyricsState.isOpen = true;
            
            // Start sync
            startNewLyricsSync();
            
            console.log('[OK] NEW overlay opened for:', currentSong.title);
        }
        
        // Close new lyrics overlay
        function closeNewLyricsOverlay() {
            console.log(' Closing NEW lyrics overlay...');
            
            const overlay = document.getElementById('new-lyrics-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
            
            newLyricsState.isOpen = false;
            stopNewLyricsSync();
        }
        
        // Render lyrics to new overlay
        function renderNewLyrics() {
            const currentSong = songs[currentSongIndex];
            if (!currentSong) return;
            
            const lyrics = lyricsDatabase[currentSong.title];
            const container = document.getElementById('new-lyrics-content');
            
            if (!container) {
                console.error('[ERROR] new-lyrics-content not found');
                return;
            }
            
            if (!lyrics) {
                container.innerHTML = '<div class="new-lyrics-line" style="color: rgba(255,255,255,0.5);">Lirik tidak tersedia untuk lagu ini</div>';
                console.log(' No lyrics for:', currentSong.title);
                return;
            }
            
            // Clear container
            container.innerHTML = '';
            
            // Render each line
            lyrics.lines.forEach((line, index) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'new-lyrics-line';
                lineEl.id = `new-line-${index}`;
                lineEl.textContent = line.text;
                lineEl.onclick = () => newSeekToTime(line.time);
                container.appendChild(lineEl);
            });
            
            console.log('[OK] Rendered', lyrics.lines.length, 'lyrics lines in NEW overlay');
        }
        
        // Start lyrics sync for new overlay
        function startNewLyricsSync() {
            stopNewLyricsSync();
            
            newLyricsState.syncInterval = setInterval(() => {
                if (!newLyricsState.isOpen) return;
                
                updateNewLyrics();
                updateNewProgress();
            }, 100);
        }
        
        // Stop lyrics sync for new overlay
        function stopNewLyricsSync() {
            if (newLyricsState.syncInterval) {
                clearInterval(newLyricsState.syncInterval);
                newLyricsState.syncInterval = null;
            }
        }
        
        // Update lyrics highlighting in new overlay
        function updateNewLyrics() {
            const currentSong = songs[currentSongIndex];
            if (!currentSong || !audio) return;
            
            const lyrics = lyricsDatabase[currentSong.title];
            if (!lyrics) return;
            
            const currentTime = audio.currentTime;
            
            // Find current line
            let newLineIndex = -1;
            for (let i = 0; i < lyrics.lines.length; i++) {
                if (lyrics.lines[i].time <= currentTime) {
                    newLineIndex = i;
                }
            }

            // Update if changed
            if (newLineIndex !== newLyricsState.currentLineIndex) {
                // Remove old highlight
                if (newLyricsState.currentLineIndex >= 0) {
                    const oldLine = document.getElementById(`new-line-${newLyricsState.currentLineIndex}`);
                    if (oldLine) oldLine.classList.remove('current');
                }

                // Add new highlight
                newLyricsState.currentLineIndex = newLineIndex;
                if (newLineIndex >= 0) {
                    const newLine = document.getElementById(`new-line-${newLineIndex}`);
                    if (newLine) {
                        newLine.classList.add('current');
                        
                        // Scroll to center
                        const container = document.getElementById('new-lyrics-content');
                        if (container) {
                            const lineTop = newLine.offsetTop;
                            const containerHeight = container.clientHeight;
                            const scrollTarget = lineTop - (containerHeight / 2) + (newLine.offsetHeight / 2);
                            
                            container.scrollTo({
                                top: scrollTarget,
                                behavior: 'smooth'
                            });
                        }
                    }
                }
            }
        }
        
        // Update progress bar in new overlay
        function updateNewProgress() {
            if (!audio || !audio.duration) return;
            
            // Don't update if user is dragging
            if (isDraggingNewProgress) return;
            
            const percent = (audio.currentTime / audio.duration) * 100;
            const fill = document.getElementById('new-progress-fill');
            if (fill) {
                fill.style.width = percent + '%';
            }
            
            // Update time display
            const currentTimeEl = document.getElementById('new-current-time');
            const totalTimeEl = document.getElementById('new-total-time');
            
            if (currentTimeEl) {
                currentTimeEl.textContent = formatTime(audio.currentTime);
            }
            
            if (totalTimeEl) {
                totalTimeEl.textContent = formatTime(audio.duration);
            }
        }
        
        // Update control button states (shuffle/repeat)
        function updateNewControlStates() {
            try {
                const shuffleBtn = document.getElementById('new-shuffle-btn');
                const repeatBtn = document.getElementById('new-repeat-btn');
                
                // Safely check shuffle state
                if (shuffleBtn) {
                    const isShuffleActive = (typeof isShuffle !== 'undefined' && isShuffle) || 
                                           (document.getElementById('shuffle-btn')?.classList.contains('active'));
                    
                    if (isShuffleActive) {
                        shuffleBtn.classList.add('active');
                    } else {
                        shuffleBtn.classList.remove('active');
                    }
                }
                
                // Safely check repeat state
                if (repeatBtn) {
                    const isRepeatActive = (typeof repeatMode !== 'undefined' && repeatMode !== 0) || 
                                           (document.getElementById('repeat-btn')?.classList.contains('active'));
                    
                    if (isRepeatActive) {
                        repeatBtn.classList.add('active');
                    } else {
                        repeatBtn.classList.remove('active');
                    }
                }
            } catch (error) {
                console.warn('Could not update control states:', error);
            }
        }
        
        // Toggle play/pause from new overlay
        function newTogglePlayPause() {
            if (isPlaying) {
                window.pauseAudio();
            } else {
                window.playAudio();
            }
            
            // Update button icon
            updateNewPlayButton();
        }
        
        // Update play button icon with smooth animation
        function updateNewPlayButton() {
            const btn = document.getElementById('new-play-btn');
            if (!btn) return;
            
            const icon = btn.querySelector('i');
            if (icon) {
                // Add scale animation
                btn.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    if (isPlaying) {
                        icon.className = 'ph-fill ph-pause';
                    } else {
                        icon.className = 'ph-fill ph-play';
                    }
                    btn.style.transform = 'scale(1)';
                }, 100);
            }
        }
        
        // Seek to time in new overlay
        function newSeekToTime(time) {
            if (audio) {
                audio.currentTime = time;
                if (!isPlaying) {
                    window.playAudio();
                }
            }
        }
        
        // Progress bar drag state
        let isDraggingNewProgress = false;
        let previewPosition = 0;
        
        // Seek to position with drag support in new overlay
        function newSeekToPosition(event) {
            if (!audio || !audio.duration) return;
            
            const bar = event.currentTarget;
            const rect = bar.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            
            // Clamp between 0 and 1
            const clampedPercent = Math.max(0, Math.min(1, percent));
            
            audio.currentTime = clampedPercent * audio.duration;
        }
        
        // Make functions globally accessible
        window.openNewLyricsOverlay = openNewLyricsOverlay;
        window.closeNewLyricsOverlay = closeNewLyricsOverlay;
        window.newTogglePlayPause = newTogglePlayPause;
        window.newSeekToTime = newSeekToTime;
        window.newSeekToPosition = newSeekToPosition;
        
        console.log('[OK] NEW Lyrics Overlay functions loaded early');

        // --- NAVIGATION HISTORY FOR BACK BUTTON ---
        let navigationHistory = ['home']; // Start with home
        window.scrollPositions = {}; // Store scroll positions for each view
        
        function pushToHistory(viewName) {
            if (navigationHistory[navigationHistory.length - 1] !== viewName) {
                navigationHistory.push(viewName);
            }
        }
        
        function goBack() {
            // Save current scroll position before going back
            const currentViewName = navigationHistory[navigationHistory.length - 1];
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                window.scrollPositions[currentViewName] = mainContent.scrollTop;
            }
            
            if (navigationHistory.length > 1) {
                navigationHistory.pop(); // Remove current
                const previousView = navigationHistory[navigationHistory.length - 1];
                switchView(previousView);
            } else {
                switchView('home');
            }
        }
        
        window.goBack = goBack;
        window.pushToHistory = pushToHistory;
        window.scrollPositions = window.scrollPositions || {};
        
        // --- INITIALIZE BACK BUTTONS, PLAY BUTTONS, AND SHARE BUTTONS ON ALL ALBUM VIEWS ---
        function initializeAlbumBackButtons() {
            // Safety flag to prevent running twice
            if (window.__albumButtonsInitialized) return;
            window.__albumButtonsInitialized = true;
            
            // List of views that already have hardcoded buttons (skip these)
            const viewsWithHardcodedButtons = ['view-ghani-album', 'view-revan-album', 'view-hanung-album', 'view-rara-album', 'view-dewa-album', 'view-queen-album', 'view-stoneroses-album'];
            
            // Get all album views dynamically
            const allAlbumViews = document.querySelectorAll('[id*="view-"][id$="-album"]');
            
            allAlbumViews.forEach(view => {
                const viewId = view.id;
                
                // Skip views that already have hardcoded buttons
                if (viewsWithHardcodedButtons.includes(viewId)) {
                    return;
                }
                
                const headerView = view.querySelector('.playlist-header-view');
                const infoView = headerView?.querySelector('.playlist-info-big');
                
                if (!headerView || !infoView) return;
                
                // Extract base name from viewId (e.g., "dewa" from "view-dewa-album")
                const baseId = viewId.replace('view-', '').replace('-album', '');
                
                // 1. Add back button if missing
                if (!headerView.querySelector('.back-button')) {
                    const backBtn = document.createElement('button');
                    backBtn.onclick = function() { window.goBack(); };
                    backBtn.className = 'back-button';
                    backBtn.title = 'Kembali';
                    backBtn.style.cssText = 'position: absolute; top: 8px; left: 12px; z-index: 10; background: rgba(0,0,0,0.5); border-radius: 50%; width: 44px; height: 44px; border: none; cursor: pointer;';
                    backBtn.innerHTML = '<i class="ph ph-arrow-left"></i>';
                    headerView.style.position = 'relative';
                    headerView.insertBefore(backBtn, headerView.firstChild);
                }
                
                // 2. Create or get buttons container
                let buttonsContainer = infoView.querySelector('.playlist-buttons-container');
                if (!buttonsContainer) {
                    buttonsContainer = document.createElement('div');
                    buttonsContainer.className = 'playlist-buttons-container';
                    infoView.parentNode.insertBefore(buttonsContainer, infoView.nextSibling);
                }
                
                // 3. Add play button if missing
                if (!buttonsContainer.querySelector('.action-play-btn')) {
                    const playFuncName = `playFirstSongOf${baseId.charAt(0).toUpperCase() + baseId.slice(1)}`;
                    const playBtn = document.createElement('button');
                    playBtn.className = 'action-play-btn';
                    playBtn.title = 'Mainkan';
                    playBtn.onclick = function() { 
                        if (window[playFuncName]) {
                            window[playFuncName]();
                        }
                    };
                    playBtn.innerHTML = '<i class="ph-fill ph-play" style="font-size: 28px; color: black;"></i>';
                    buttonsContainer.appendChild(playBtn);
                }
                
                // 4. Add share button if missing
                if (!buttonsContainer.querySelector('.share-btn-album')) {
                    const shareBtn = document.createElement('button');
                    shareBtn.className = 'share-btn-album';
                    shareBtn.title = 'Bagikan';
                    shareBtn.onclick = function() { window.alert('Fitur share untuk ' + baseId + ' album segera hadir!'); };
                    shareBtn.innerHTML = '<i class="ph ph-share-network" style="font-size: 24px;"></i>';
                    buttonsContainer.appendChild(shareBtn);
                }
            });
        }
        
        // Call only once when DOM is ready
        window.addEventListener('load', initializeAlbumBackButtons);

        // --- RECENTLY PLAYED LOGIC ---
        function addToRecentlyPlayed(type, data) {
            // Remove duplicates of same ID
            recentlyPlayed = recentlyPlayed.filter(item => !(item.type === type && item.data.id === data.id));
            // Add new to front
            recentlyPlayed.unshift({ type, data, timestamp: Date.now() });
            // Limit to 20 items
            if(recentlyPlayed.length > 20) recentlyPlayed = recentlyPlayed.slice(0, 20);
            // Save to local storage
            localStorage.setItem('recentlyPlayed', JSON.stringify(recentlyPlayed));
        }

        function handleSearch(query) {
    const resultsWrapper = document.getElementById('search-results-wrapper');
    const historyWrapper = document.getElementById('search-history-wrapper');
    const bandsContainer = document.getElementById('search-bands-container');
    const songsContainer = document.getElementById('search-songs-container');
    const playlistsContainer = document.getElementById('search-playlists-container');
    const playlistsTitle = document.getElementById('search-playlists-title');

    if (query.trim().length < 1) {
        resultsWrapper.style.display = 'none';
        bandsContainer.innerHTML = '';
        songsContainer.innerHTML = '';
        playlistsContainer.innerHTML = '';
        playlistsTitle.style.display = 'none';
        historyWrapper.style.display = 'block';
        renderRecentlyPlayedList();
        return;
    }

    const q = query.toLowerCase();
    historyWrapper.style.display = 'none';
    resultsWrapper.style.display = 'block';

    // 1. Search Bands/Artists
    const matchedBands = searchIndexArtists.filter(b => b.name.toLowerCase().includes(q));
    let bandsHTML = "";
    if (matchedBands.length > 0) {
        bandsHTML = matchedBands.map(b => `
            <div class="song-card" onclick="${b.fn}">
                <div class="card-img-wrapper">
                    <img src="${b.img}" alt="${b.name}">
                    <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                </div>
                <div class="card-title">${b.name}</div>
                <div class="card-desc">Penyanyi / Band</div>
            </div>
        `).join('');
    }
    bandsContainer.innerHTML = bandsHTML;

    // 2. Search Public Playlists
    const matchedPlaylists = allPublicPlaylists.filter(pl => pl.name.toLowerCase().includes(q));
    let playlistsHTML = "";
    if (matchedPlaylists.length > 0) {
        playlistsTitle.style.display = 'block';
        playlistsHTML = matchedPlaylists.map(pl => `
            <div class="song-card" onclick="window.openPlaylist('${pl.id}')">
                <div class="card-img-wrapper">
                    <img src="${pl.cover}" alt="${pl.name}">
                    <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                </div>
                <div class="card-title">${pl.name}</div>
                <div class="card-desc">Oleh ${pl.ownerName || 'User'}</div>
            </div>
        `).join('');
    } else {
        playlistsTitle.style.display = 'none';
    }
    playlistsContainer.innerHTML = playlistsHTML;

    // 3. Search ALL Songs (with Privacy Check)
    const currentUserId = auth.currentUser ? auth.currentUser.uid : null;
    
    const matchedSongs = songs.filter(s => {
        // A. Match Query (Title, Artist, Album)
        const matchQuery = s.title.toLowerCase().includes(q) || 
                           s.artist.toLowerCase().includes(q) ||
                           s.album.toLowerCase().includes(q);
        
        if (!matchQuery) return false;

        // B. Privacy Check
        // If it's an imported song (check if it has 'uploadedBy' field)
        if (s.uploadedBy) {
            // Visible if: Public OR Owned by current user
            const isPublic = s.isPublic === true;
            const isMine = currentUserId && s.uploadedBy === currentUserId;
            return isPublic || isMine;
        }

        // Default static songs are always visible
        return true;
    });

    if (matchedSongs.length > 0) {
        // Create Header and Container for Songs
        const songsHeader = document.createElement('h3');
        songsHeader.innerText = 'Lagu';
        songsHeader.style.color = 'white';
        songsHeader.style.fontSize = '18px';
        songsHeader.style.marginBottom = '10px';
        songsHeader.style.marginTop = '20px';
        
        songsContainer.innerHTML = '';
        songsContainer.appendChild(songsHeader);
        
        const listDiv = document.createElement('div');
        listDiv.id = 'search-songs-list-inner';
        songsContainer.appendChild(listDiv);
        
        renderSongListCustom(matchedSongs, 'search-songs-list-inner', false);
    } else {
        songsContainer.innerHTML = '<div style="padding:20px; text-align:center; color:#888;">' + window.t('no-songs-found') + '</div>';
    }
}
        window.handleSearch = handleSearch;

       function renderRecentlyPlayedList() {
    const container = document.getElementById('search-history-container');            
    const title = document.getElementById('search-history-title');
    if (recentlyPlayed.length === 0) {
        container.innerHTML = '';
        title.style.display = 'none';
        return;
    }
    title.style.display = 'block';

    let html = '';
    recentlyPlayed.forEach((item, i) => {
        if (item.type === 'song') {
            const s = item.data;
            html += `
                <div class="song-row" id="row-${s.id}" onclick="window.playSpecificSong(${s.id})">
                    <div class="song-index">
                        <span class="index-num">${i + 1}</span>
                        <div class="playing-icon-container" style="display:none;">
                            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        </div>
                    </div>
                    <div class="song-info">
                        <img src="${s.cover}" alt="art">
                        <div>
                            <div class="song-title-text">${s.title}</div>
                            <div class="song-artist">${s.artist}</div>
                        </div>
                    </div>
                    <div class="song-album">${s.album}</div>
                    <div class="song-duration">${s.duration}</div>
                    <div class="song-actions">
                        <button class="list-like-btn ${likedSongs.includes(s.id) ? 'liked' : ''}" onclick="event.stopPropagation(); window.toggleLike(${s.id})" id="list-like-${s.id}">
                            <i class="${likedSongs.includes(s.id) ? 'ph-fill ph-heart' : 'ph ph-heart'}"></i>
                        </button>
                        <button class="more-btn" onclick="event.stopPropagation(); window.openAddSongModal(${s.id})">
                            <i class="ph ph-plus"></i>
                        </button>
                    </div>
                </div>
            `;
        } else if (item.type === 'playlist') {
            const pl = item.data;
            // PLAYLIST SEKARANG DITAMPILKAN SEPERTI LAGU (SONG-ROW FORMAT)
            html += `
                <div class="song-row" onclick="window.openPlaylist('${pl.id}')">
                    <div class="song-index">
                        <span class="index-num">${i + 1}</span>
                    </div>
                    <div class="song-info">
                        <img src="${pl.cover}" alt="playlist cover">
                        <div>
                            <div class="song-title-text">${pl.name}</div>
                            <div class="song-artist">Playlist</div>
                        </div>
                    </div>
                    <div class="song-album">-</div>
                    <div class="song-duration">-</div>
                    <div class="song-actions">
                        <button class="share-btn" onclick="event.stopPropagation(); window.openShareModal('playlist', '${pl.id}')" style="color:#b3b3b3;">
                            <i class="ph ph-share-network"></i>
                        </button>
                    </div>
                </div>
            `;
        }
    });
    container.innerHTML = html;
}

       function renderSongListCustom(data, containerId, isHistoryMode) {
    const container = document.getElementById(containerId);
    if(!data || data.length === 0) {
        if(containerId) container.innerHTML = '<div style="padding:20px; color:#666;">' + window.t('no-songs') + '</div>';
        return;
    }

    // Store songs data globally for offline download feature
    window.allSongs = data;

    container.innerHTML = data.map((s, i) => {
        let actionButtonsHTML = '';

        if (isHistoryMode) {
            // History Mode - NO DROPDOWN
            actionButtonsHTML = `
                <button class="list-like-btn ${likedSongs.includes(s.id) ? 'liked' : ''}" onclick="event.stopPropagation(); window.toggleLike(${s.id})" id="list-like-${s.id}">
                    <i class="${likedSongs.includes(s.id) ? 'ph-fill ph-heart' : 'ph ph-heart'}"></i>
                </button>
                <button class="more-btn" onclick="event.stopPropagation(); window.openAddSongModal(${s.id})">
                    <i class="ph ph-plus"></i>
                </button>
            `;
        } else {
            //  PERBAIKAN: HANYA 1 DROPDOWN MENU
            actionButtonsHTML = `
                <div class="song-actions-menu" style="position: relative;">
                    <button class="song-menu-btn" onclick="event.stopPropagation(); window.toggleSongMenu(${s.id})">
                        <i class="ph ph-dots-three-vertical"></i>
                    </button>
                    <div class="song-menu-dropdown" id="menu-${s.id}" style="display: none;">
                    
                        <button class="menu-item" onclick="event.stopPropagation(); window.toggleLike(${s.id}); window.toggleSongMenu(${s.id})" id="menu-like-${s.id}">
                            <i class="${likedSongs.includes(s.id) ? 'ph-fill ph-heart' : 'ph ph-heart'}"></i>
                            <span data-i18n="liked-songs">Liked Songs</span>
                        </button>
                        <button class="menu-item" onclick="event.stopPropagation(); window.addToQueue(${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-list-plus"></i>
                            <span data-i18n="queue">Queue</span>
                        </button>
                        <button class="menu-item" onclick="event.stopPropagation(); window.openAddSongModal(${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-plus"></i>
                            <span data-i18n="add-to-playlist">Add to Playlist</span>
                        </button>
                        <button class="menu-item" onclick="event.stopPropagation(); window.openShareModal('song', ${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-share-network"></i>
                            <span data-i18n="share">Share</span>
                        <button class="menu-item menu-download-${s.id}" onclick="event.stopPropagation(); window.downloadSongFromMenu(${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-download-simple"></i>
                            <span data-i18n="download-offline">Download for Offline</span>
                        </button>
                        </button>
                    </div>
                </div>
            `;
        }

        return `
        <div class="song-row" id="row-${s.id}" onclick="window.playSpecificSong(${s.id})">
            <div class="song-index">
                <span class="index-num">${i + 1}</span>
                <div class="playing-icon-container" style="display:none;">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>
            </div>
            <div class="song-info">
                <img src="${s.cover && s.cover.trim() ? s.cover : 'assets/logo.png'}" alt="art">
                <div>
                    <div class="song-title-text" onclick="event.stopPropagation(); window.playSpecificSong(${s.id}); window.openPlayScreenUnified();">
                        ${s.title}
                    </div>
                    <div class="song-artist">${s.artist}</div>
                </div>
            </div>
            <div class="song-album">${s.album}</div>
            <div class="song-duration">${s.duration}</div>
            <div class="song-actions">
                ${actionButtonsHTML}
            </div>
        </div>
        `;
    }).join('');
}

        
       function renderSongList(data, containerId) {
    const container = document.getElementById(containerId);
    if(!container || !data || data.length === 0) {
        if(container) container.innerHTML = '<div style="padding:20px; color:#666;">' + window.t('no-songs') + '</div>';
        return;
    }

    // Store songs data globally for offline download feature
    window.allSongs = data;

    container.innerHTML = data.map((s, i) => {
        return `
        <div class="song-row" id="row-${s.id}" onclick="window.playSpecificSong(${s.id})">
            <div class="song-index">
                <span class="index-num">${i + 1}</span>
                <div class="playing-icon-container" style="display:none;">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>
            </div>
            <div class="song-info">
                <img src="${s.cover}" alt="art">
                <div>
                    <div class="song-title-text">
                        ${s.title}
                    </div>
                    <div class="song-artist">${s.artist}</div>
                </div>
            </div>
            <div class="song-album">${s.album}</div>
            <div class="song-duration">${s.duration}</div>
            <div class="song-actions">
                <div class="song-actions-menu" style="position: relative;">
                    <button class="song-menu-btn" onclick="event.stopPropagation(); window.toggleSongMenu(${s.id})">
                        <i class="ph ph-dots-three-vertical"></i>
                    </button>
                    <div class="song-menu-dropdown" id="menu-${s.id}" style="display: none;">
                        <button class="menu-item" onclick="event.stopPropagation(); window.toggleLike(${s.id}); window.toggleSongMenu(${s.id})" id="menu-like-${s.id}">
                            <i class="${likedSongs.includes(s.id) ? 'ph-fill ph-heart' : 'ph ph-heart'}"></i>
                            <span data-i18n="liked-songs">Liked Songs</span>
                        </button>
                        <button class="menu-item" onclick="event.stopPropagation(); window.addToQueue(${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-list-plus"></i>
                            <span data-i18n="queue">Queue</span>
                        </button>
                        <button class="menu-item" onclick="event.stopPropagation(); window.openAddSongModal(${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-plus"></i>
                            <span data-i18n="add-to-playlist">Add to Playlist</span>
                        </button>
                        <button class="menu-item" onclick="event.stopPropagation(); window.openShareModal('song', ${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-share-network"></i>
                            <span data-i18n="share">Share</span>
                        <button class="menu-item menu-download-${s.id}" onclick="event.stopPropagation(); window.downloadSongFromMenu(${s.id}); window.toggleSongMenu(${s.id})">
                            <i class="ph ph-download-simple"></i>
                            <span data-i18n="download-offline">Download for Offline</span>
                        </button>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        `;
    }).join('');
    
    // After rendering, check offline status and update song availability
    if (window.updateSongListForOfflineMode) {
        setTimeout(() => window.updateSongListForOfflineMode(), 100);
    }
}

        // --- RENDERERS ---

       function renderSidebarPlaylistsUpdated(playlists) {
    const container = document.getElementById('sidebar-playlists-container');
    let html = '';
    const playlistArray = Object.keys(playlists).map(key => ({
        id: key,
        ...playlists[key]
    }));
    
    if(playlistArray.length === 0) {
        container.innerHTML = '<div style="padding: 10px 12px; color: #666; font-size: 13px;">' + window.t('no-playlists') + '</div>';
        return;
    }

    playlistArray.forEach(pl => {
        const isPublic = pl.isPublic || false;
        const privacyIcon = isPublic ? '<i class="ph ph-globe" title="Publik"></i>' : '<i class="ph ph-lock-key" title="Privat"></i>';
        const privacyClass = isPublic ? 'color:#1db954' : 'color:#b3b3b3';

        html += `
            <div class="playlist-item" onclick="window.openPlaylist('${pl.id}')">
                <img src="${pl.cover}" class="playlist-thumb" alt="${pl.name}">
                <span style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${pl.name}</span>
                <div style="display:flex; gap:5px; margin-left:auto;">
                    <button class="share-btn" style="font-size:16px;" onclick="event.stopPropagation(); window.openShareModal('playlist', '${pl.id}')" title="Bagikan"><i class="ph ph-share-network"></i></button>
                    <button class="btn-icon-small" style="font-size:16px; ${privacyClass}" onclick="event.stopPropagation(); window.togglePlaylistPrivacy('${pl.id}')" title="Ubah Privasi">${privacyIcon}</button>
                </div>
            </div>
        `;
    });
    container.innerHTML = html;
}
        // Override previous render
        window.renderSidebarPlaylists = renderSidebarPlaylistsUpdated;


        function renderTrending() {
            const container = document.getElementById('trending-container');
            if (!currentUserData || !currentUserData.playlists) {
                container.innerHTML = '<div style="padding:20px; color:#888;">' + window.t('no-playlists') + '. Buat playlist baru yuk!</div>';
                return;
            }
            
            // Convert object to array
            const playlists = Object.keys(currentUserData.playlists).map(key => ({
                id: key,
                ...currentUserData.playlists[key]
            }));

            // Take top 4 (simulating "frequently listened")
            const topPlaylists = playlists.slice(0, 4);
            
            if (topPlaylists.length === 0) {
                container.innerHTML = '<div style="padding:20px; color:#888;">' + window.t('no-playlists') + '. Buat playlist baru yuk!</div>';
                return;
            }

            let html = topPlaylists.map(pl => `
                <div class="song-card" onclick="window.openPlaylist('${pl.id}')">
                    <div class="card-img-wrapper">
                        <img src="${pl.cover}" alt="${pl.name}">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <div class="card-title">${pl.name}</div>
                    <div class="card-desc">${window.t('my-playlists')}</div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        function renderPopularBands() {
            const allBands = [
                // BAND LAMA INDONESIA
                { name: "Perunggu", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/perunggu.jpg", onclick: "window.openPerungguAlbum()" },
                { name: "NOAH", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/noah.jpg", onclick: "window.openNoahAlbum()" },
                { name: "Dewa 19", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png", onclick: "window.openDewaAlbum()" },
                { name: "Sheila On 7", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/so7.jpg", onclick: "window.openSheilaAlbum()" },
                { name: "Kahitna", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kahitna.jpeg", onclick: "window.openKahitnaAlbum()" },
                { name: "Hindia", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hindia.jpg", onclick: "window.openHindiaAlbum()" },
                { name: "Slank", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/slank.jpg", onclick: "window.openSlankAlbum()" },
                { name: "Reality Club", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/realityclub.jpg", onclick: "window.openRealityClubAlbum()" },
                { name: "Nidji", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/nidji.jpg", onclick: "window.openNidjiAlbum()" },
                // BAND BARU INDONESIA
                { name: "Feast", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", onclick: "window.openFeastAlbum()" },
                { name: "The Panasdalam Bank", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", onclick: "window.openPanasdalamAlbum()" },
                { name: "Lomba Sihir", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", onclick: "window.openLombaSihirAlbum()" },
                { name: "Last Child", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", onclick: "window.openLastChildAlbum()" },
                { name: "For Revenge", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", onclick: "window.openForRevengeAlbum()" },
                { name: "Yovie & Nuno", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", onclick: "window.openYovieAlbum()" },
                { name: "Vierra", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", onclick: "window.openVierraAlbum()" },
                { name: "Utopia", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", onclick: "window.openUtopiaAlbum()" },
                { name: "Juicy Lucy", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", onclick: "window.openJuicyLucyAlbum()" },
                { name: "HIVI!", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", onclick: "window.openHiviAlbum()" },
                { name: "The Lantis", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", onclick: "window.openTheLantisAlbum()" },
                { name: "The Changcuters", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", onclick: "window.openTheChangcutersAlbum()" },
                { name: "The Adams", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", onclick: "window.openTheAdamsAlbum()" }
            ];
            const container = document.getElementById('popular-bands-container');
            const maxShow = 6;
            const displayBands = allBands.slice(0, maxShow);
            let html = displayBands.map(band => `
                <div class="song-card" onclick="${band.onclick}" style="position: relative;">
                    <div class="card-img-wrapper">
                        <img src="${band.image}" alt="${band.name}" onload="window.applyCardColor(this)">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${band.name}', '${band.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                        <i class="ph ph-share-network" style="font-size: 18px;"></i>
                    </button>
                    <div class="card-title">${band.name}</div>
                    <div class="card-desc">${window.t('band-popular-indonesia')}</div>
                </div>
            `).join('');
            
            // SELALU tambahkan tombol "Tampilkan Semua"
            html += `<div class="song-card show-all-card" id="toggle-indonesian-bands" onclick="window.toggleShowAll('indonesian-bands', this)">
                <div class="show-all-content">
                    <i class="ph ph-caret-down"></i>
                </div>
            </div>`;
            
            container.innerHTML = html;
            
            // Render extra bands
            const extraBands = allBands.slice(maxShow);
            const extraContainer = document.getElementById('indonesian-bands-extra-container');
            if(extraContainer) {
                if(extraBands.length > 0) {
                    const extraHtml = extraBands.map(band => `
                        <div class="song-card" onclick="${band.onclick}" style="position: relative;">
                            <div class="card-img-wrapper">
                                <img src="${band.image}" alt="${band.name}" onload="window.applyCardColor(this)">
                                <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                            </div>
                            <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${band.name}', '${band.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                                <i class="ph ph-share-network" style="font-size: 18px;"></i>
                            </button>
                            <div class="card-title">${band.name}</div>
                            <div class="card-desc">${window.t('band-popular-indonesia')}</div>
                        </div>
                    `).join('');
                    extraContainer.innerHTML = extraHtml;
                    extraContainer.style.display = 'none'; // Hidden awalnya
                } else {
                    extraContainer.innerHTML = '';
                    extraContainer.style.display = 'none';
                }
            }
        }

        function renderPopularArtists() {
            const allArtists = [
                // PENYANYI LAMA INDONESIA
                { name: "Astrid", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/astrid.webp", onclick: "window.openAstridAlbum()" },
                { name: "Afgan", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/afgan.png", onclick: "window.openAfganAlbum()" },
                { name: "Tulus", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tulus.jpg", onclick: "window.openTulusAlbum()" },
                { name: "Mahalini", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/mahalini.jpg", onclick: "window.openMahaliniAlbum()" },
                { name: "Tenxi", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tenxi.jpg", onclick: "window.openTenxiAlbum()" },
                // PENYANYI BARU INDONESIA
                { name: "Naykilla", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", onclick: "window.openNaykillaAlbum()" },
                { name: "Bernadya", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", onclick: "window.openBernardyaAlbum()" },
                { name: "Iwan Fals", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", onclick: "window.openIwanFalsAlbum()" },
                { name: "Pamungkas", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", onclick: "window.openPamungkasAlbum()" },
                { name: "K3bi", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", onclick: "window.openK3biAlbum()" },
                { name: "$afa", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", onclick: "window.openSafaAlbum()" },
                { name: "Tuantigabelas", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", onclick: "window.openTuan13Album()" },
                { name: "Maudy Ayunda", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", onclick: "window.openMaudyAlbum()" },
                { name: "Glenn Fredly", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", onclick: "window.openGlennAlbum()" },
                { name: "Nadin Amizah", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", onclick: "window.openNadinAlbum()" },
                { name: "Sal Priadi", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", onclick: "window.openSalPriadiAlbum()" },
                { name: "Juan Reza", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", onclick: "window.openJuanRezaAlbum()" },
                { name: "NIKI", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", onclick: "window.openNIKIAlbum()" }
            ];
            const container = document.getElementById('popular-artists-container');
            const maxShow = 6;
            const displayArtists = allArtists.slice(0, maxShow);
            let html = displayArtists.map(artist => `
                <div class="song-card" onclick="${artist.onclick}" style="position: relative;">
                    <div class="card-img-wrapper">
                        <img src="${artist.image}" alt="${artist.name}" onload="window.applyCardColor(this)">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${artist.name}', '${artist.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                        <i class="ph ph-share-network" style="font-size: 18px;"></i>
                    </button>
                    <div class="card-title">${artist.name}</div>
                    <div class="card-desc">${window.t('artist-popular-indonesia')}</div>
                </div>
            `).join('');
            
            // SELALU tambahkan tombol "Tampilkan Semua"
            html += `<div class="song-card show-all-card" id="toggle-indonesian-artists" onclick="window.toggleShowAll('indonesian-artists', this)">
                <div class="show-all-content">
                    <i class="ph ph-caret-down"></i>
                </div>
            </div>`;
            
            container.innerHTML = html;
            
            // Render extra artists
            const extraArtists = allArtists.slice(maxShow);
            const extraContainer = document.getElementById('indonesian-artists-extra-container');
            if(extraContainer) {
                if(extraArtists.length > 0) {
                    const extraHtml = extraArtists.map(artist => `
                        <div class="song-card" onclick="${artist.onclick}" style="position: relative;">
                            <div class="card-img-wrapper">
                                <img src="${artist.image}" alt="${artist.name}" onload="window.applyCardColor(this)">
                                <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                            </div>
                            <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${artist.name}', '${artist.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                                <i class="ph ph-share-network" style="font-size: 18px;"></i>
                            </button>
                            <div class="card-title">${artist.name}</div>
                            <div class="card-desc">${window.t('artist-popular-indonesia')}</div>
                        </div>
                    `).join('');
                    extraContainer.innerHTML = extraHtml;
                    extraContainer.style.display = 'none'; // Hidden awalnya
                } else {
                    extraContainer.innerHTML = '';
                    extraContainer.style.display = 'none';
                }
            }
        }

        // --- NEW RENDERERS: FOREIGN ARTISTS & BANDS ---
        function renderForeignSoloArtists() {
            const allArtists = [
                // OLD FOREIGN ARTISTS
                { name: "Taylor Swift", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/taylor.jpg", onclick: "window.openTaylorAlbum()" },
                { name: "Justin Bieber", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/justin.jpg", onclick: "window.openJustinAlbum()" },
                { name: "Ed Sheeran", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ed.jpg", onclick: "window.openEdAlbum()" },
                { name: "Bruno Mars", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bruno.jpg", onclick: "window.openBrunoAlbum()" },
                { name: "Daniel Caesar", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/daniel.jpg", onclick: "window.openDanielAlbum()" },
                { name: "Bob Marley", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bob.jpg", onclick: "window.openBobMarleyAlbum()" },
                // NEW FOREIGN ARTISTS
                { name: "Frank Ocean", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/frank.jpg", onclick: "window.openFrankOceanAlbum()" },
                { name: "Drake", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/drake.jpg", onclick: "window.openDrakeAlbum()" },
                { name: "Kendrick Lamar", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kendrick.jpg", onclick: "window.openKendrickAlbum()" },
                { name: "The Weeknd", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/theweekend.jpg", onclick: "window.openTheWeekndAlbum()" },
                { name: "Olivia Rodrigo", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/olivia.jpg", onclick: "window.openOliviaAlbum()" },
                { name: "Avicii", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", onclick: "window.openAviciiAlbum()" },
                { name: "Adele", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", onclick: "window.openAdeleAlbum()" },
                { name: "Shawn Mendes", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", onclick: "window.openShawnMendesAlbum()" },
                { name: "James Arthur", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", onclick: "window.openJamesArthurAlbum()" },
                { name: "Billie Eilish", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", onclick: "window.openBillieEilishAlbum()" }
            ];
            const container = document.getElementById('foreign-solo-container');
            const maxShow = 6;
            const displayArtists = allArtists.slice(0, maxShow);
            let html = displayArtists.map(artist => `
                <div class="song-card" onclick="${artist.onclick}" style="position: relative;">
                    <div class="card-img-wrapper">
                        <img src="${artist.image}" alt="${artist.name}" onload="window.applyCardColor(this)">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${artist.name}', '${artist.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                        <i class="ph ph-share-network" style="font-size: 18px;"></i>
                    </button>
                    <div class="card-title">${artist.name}</div>
                    <div class="card-desc">${window.t('artist-foreign-popular')}</div>
                </div>
            `).join('');
            
            // SELALU tambahkan tombol "Tampilkan Semua"
            html += `<div class="song-card show-all-card" id="toggle-foreign-solo" onclick="window.toggleShowAll('foreign-solo', this)">
                <div class="show-all-content">
                    <i class="ph ph-caret-down"></i>
                </div>
            </div>`;
            
            container.innerHTML = html;
            
            // Render extra artists
            const extraArtists = allArtists.slice(maxShow);
            const extraContainer = document.getElementById('foreign-solo-extra-container');
            if(extraContainer) {
                if(extraArtists.length > 0) {
                    const extraHtml = extraArtists.map(artist => `
                        <div class="song-card" onclick="${artist.onclick}" style="position: relative;">
                            <div class="card-img-wrapper">
                                <img src="${artist.image}" alt="${artist.name}" onload="window.applyCardColor(this)">
                                <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                            </div>
                            <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${artist.name}', '${artist.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                                <i class="ph ph-share-network" style="font-size: 18px;"></i>
                            </button>
                            <div class="card-title">${artist.name}</div>
                            <div class="card-desc">${window.t('artist-foreign-popular')}</div>
                        </div>
                    `).join('');
                    extraContainer.innerHTML = extraHtml;
                    extraContainer.style.display = 'none'; // Hidden awalnya
                } else {
                    extraContainer.innerHTML = '';
                    extraContainer.style.display = 'none';
                }
            }
        }

        function renderForeignBands() {
            const allBands = [
                // OLD FOREIGN BANDS
                { name: "Cigarettes After Sex", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/cas.jpg", onclick: "window.openCigarettesAlbum()" },
                { name: "Rex Orange County", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/roc.jpg", onclick: "window.openRexAlbum()" },
                { name: "The Smiths", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thesmith.jpg", onclick: "window.openSmithsAlbum()" },
                { name: "Arctic Monkeys", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/articmonkeys.jpg", onclick: "window.openArcticAlbum()" },
                { name: "Queen", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/queen.jpg", onclick: "window.openQueenAlbum()" },
                { name: "The Stone Roses", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thestoneroses.jpg", onclick: "window.openStoneRosesAlbum()" },
                { name: "Neck Deep", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/neckdeep.jpg", onclick: "window.openNeckDeepAlbum()" },
                { name: "My Chemical Romance", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/chemical.jpg", onclick: "window.openMCRAlbum()" },
                { name: "The 1975", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/the1975.jpg", onclick: "window.openThe1975Album()" },
                { name: "The Chainsmokers", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thechainmokers.jpg", onclick: "window.openChainsmokersAlbum()" },
                { name: "Avenged Sevenfold", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/avenged.jpg", onclick: "window.openAvengedAlbum()" },
                { name: "Coldplay", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/coldplay.jpg", onclick: "window.openColdplayAlbum()" },
                { name: "One Direction", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/onedirection.jpg", onclick: "window.openOnedirectionAlbum()" },
                { name: "Green Day", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/greenday.jpg", onclick: "window.openGreendayAlbum()" },
                { name: "Oasis", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/oasis.jpg", onclick: "window.openOasisAlbum()" },
                // NEW FOREIGN BANDS
                { name: "Radiohead", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/radiohead.jpg", onclick: "window.openRadioheadAlbum()" },
                { name: "The Beatles", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", onclick: "window.openBeatlesAlbum()" },
                { name: "Maroon 5", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", onclick: "window.openMaroon5Album()" }
            ];
            const container = document.getElementById('foreign-bands-container');
            const maxShow = 6;
            const displayBands = allBands.slice(0, maxShow);
            let html = displayBands.map(band => `
                <div class="song-card" onclick="${band.onclick}" style="position: relative;">
                    <div class="card-img-wrapper">
                        <img src="${band.image}" alt="${band.name}" onload="window.applyCardColor(this)">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${band.name}', '${band.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                        <i class="ph ph-share-network" style="font-size: 18px;"></i>
                    </button>
                    <div class="card-title">${band.name}</div>
                    <div class="card-desc">${window.t('band-foreign-popular')}</div>
                </div>
            `).join('');
            
            // SELALU tambahkan tombol "Tampilkan Semua"
            html += `<div class="song-card show-all-card" id="toggle-foreign-bands" onclick="window.toggleShowAll('foreign-bands', this)">
                <div class="show-all-content">
                    <i class="ph ph-caret-down"></i>
                </div>
            </div>`;
            
            container.innerHTML = html;
            
            // Render extra bands
            const extraBands = allBands.slice(maxShow);
            const extraContainer = document.getElementById('foreign-bands-extra-container');
            if(extraContainer) {
                if(extraBands.length > 0) {
                    const extraHtml = extraBands.map(band => `
                        <div class="song-card" onclick="${band.onclick}" style="position: relative;">
                            <div class="card-img-wrapper">
                                <img src="${band.image}" alt="${band.name}" onload="window.applyCardColor(this)">
                                <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                            </div>
                            <button class="card-share-btn" onclick="event.stopPropagation(); window.shareAlbum('${band.name}', '${band.image}')" title="Bagikan" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; width: 32px; height: 32px; color: white; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2; transition: all 0.2s;">
                                <i class="ph ph-share-network" style="font-size: 18px;"></i>
                            </button>
                            <div class="card-title">${band.name}</div>
                            <div class="card-desc">${window.t('band-foreign-popular')}</div>
                        </div>
                    `).join('');
                    extraContainer.innerHTML = extraHtml;
                    extraContainer.style.display = 'none'; // Hidden awalnya
                } else {
                    extraContainer.innerHTML = '';
                    extraContainer.style.display = 'none';
                }
            }
        }

        window.playFirstSongOfPlaylist = () => {
             const playlist = currentUserData.playlists[currentPlaylistId];
             const playlistSongs = playlist && Object.values(playlist.songs || {});
             if(playlistSongs && playlistSongs.length > 0) {
                 const firstSong = (typeof playlistSongs[0] === 'object') ? playlistSongs[0].id : playlistSongs[0];
                 window.playSpecificSong(firstSong);
             } else {
                 window.playSpecificSong(songs[0].id);
             }
        };

        window.playFirstSongOfLiked = () => {
            if(currentUserData.liked && Object.keys(currentUserData.liked).length > 0) {
                const likedSongIds = Object.keys(currentUserData.liked);
                window.playSpecificSong(parseInt(likedSongIds[0]));
            } else if(songs && songs.length > 0) {
                window.playSpecificSong(songs[0].id);
            }
        };

        // --- ALBUM/ARTIST VIEW LOGIC (DYNAMIC BACKGROUND) ---
        function setupGenericAlbumView(artistName, coverPath, songStartId, songEndId, viewName, titleElemId, coverElemId, bgElemId, countElemId, containerId) {
            const songList = songs.filter(s => s.id >= songStartId && s.id <= songEndId);
            document.getElementById(titleElemId).innerText = artistName;
            const coverEl = document.getElementById(coverElemId);
            coverEl.src = coverPath;
            
            // --- DYNAMIC BACKGROUND EXTRACTOR ---
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById(bgElemId).style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            }

            document.getElementById(countElemId).innerText = `${songList.length} ${window.t('songs-label')}`;
            renderSongList(songList, containerId);
            switchView(viewName);
        }

        function openPlaylist(playlistId) {
            let playlist = null;
            let isOwner = false;

            // 1. Check User's Playlists
            if (currentUserData && currentUserData.playlists && currentUserData.playlists[playlistId]) {
                playlist = currentUserData.playlists[playlistId];
                isOwner = true;
            } 
            // 2. Check Public Playlists
            else if (allPublicPlaylists) {
                playlist = allPublicPlaylists.find(pl => pl.id === playlistId);
            }

            if (!playlist) return;

            currentPlaylistId = playlistId;

            document.getElementById('playlist-title-view').innerText = playlist.name;
            const coverEl = document.getElementById('playlist-cover-view');
            coverEl.src = playlist.cover;
            
            // Set Owner Name
            const ownerDisplay = document.getElementById('playlist-owner-display');
            if(ownerDisplay) {
                ownerDisplay.innerText = isOwner ? currentUserData.username : (playlist.ownerName || 'Unknown User');
            }

            // Hide/Show Edit Controls
            const editCoverBtn = document.querySelector('#view-playlist .edit-cover-btn');
            const settingsBtn = document.querySelector('#view-playlist button[onclick*="openPlaylistSettings"]');
            
            if(editCoverBtn) editCoverBtn.style.display = isOwner ? 'flex' : 'none';
            if(settingsBtn) settingsBtn.style.display = isOwner ? 'block' : 'none';
            
            // --- DYNAMIC BACKGROUND FOR PLAYLIST ---
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('playlist-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            };
            
            const playlistSongs = Object.values(playlist.songs || {});
            const validSongDetails = playlistSongs
                .filter(songIdOrObj => songIdOrObj !== undefined && songIdOrObj !== null)
                .map(songIdOrObj => {
                    const idToFind = (typeof songIdOrObj === 'object') ? songIdOrObj.id : songIdOrObj;
                    return songs.find(s => s.id == idToFind);
                })
                .filter(song => song !== undefined); 

            document.getElementById('playlist-count').innerText = `${validSongDetails.length} ${window.t('songs-label')}`;
            renderSongList(validSongDetails, 'playlist-songs-container');
            
            // Add to recently played
            addToRecentlyPlayed('playlist', { id: playlistId, name: playlist.name, cover: playlist.cover });
            
            switchView('playlist');
        }
        // <--- TAMBAHKAN BARIS INI DI SINI --- >
           window.openPlaylist = openPlaylist;

        function handlePlaylistCoverUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const url = e.target.result;
                    document.getElementById('playlist-cover-view').src = url;
                    update(ref(db, 'users/' + auth.currentUser.uid + '/playlists/' + currentPlaylistId), { cover: url });
                    setTimeout(() => openPlaylist(currentPlaylistId), 100); 
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Existing Ghani/Revan logic
        function openGhaniAlbum() {
            const ghaniSongs = songs.slice(0, 10); 
            document.getElementById('ghani-title-view').innerText = "Ghani's Album";
            const coverEl = document.getElementById('ghani-cover-view');
            
            // DYNAMIC BG
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('ghani-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            };
            
            document.getElementById('ghani-count').innerText = `${ghaniSongs.length} ${window.t('songs-label')}`;
            renderSongList(ghaniSongs, 'ghani-songs-container');
            switchView('ghani-album');
        }
        window.openGhaniAlbum = openGhaniAlbum;
        window.playFirstSongOfGhani = () => window.playSpecificSong(1);

        function openRevanAlbum() {
            const revanSongs = songs.slice(10, 20);
            document.getElementById('revan-title-view').innerText = "Revan's Album";
            const coverEl = document.getElementById('revan-cover-view');
            
            // DYNAMIC BG
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('revan-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            };
            
            document.getElementById('revan-count').innerText = `${revanSongs.length} ${window.t('songs-label')}`;
            renderSongList(revanSongs, 'revan-songs-container');
            switchView('revan-album');
        }
        window.openRevanAlbum = openRevanAlbum;
        window.playFirstSongOfRevan = () => window.playSpecificSong(11);

        // Hanung & Rara
        window.openHanungAlbum = () => {
            const hanungSongs = songs.filter(s => s.id >= 300 && s.id <= 305);
            document.getElementById('hanung-title-view').innerText = "Hanung's Album";
            const coverEl = document.getElementById('hanung-cover-view');
            
            // DYNAMIC BG
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('hanung-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            };
            
            document.getElementById('hanung-count').innerText = `${hanungSongs.length} ${window.t('songs-label')}`;
            renderSongList(hanungSongs, 'hanung-songs-container');
            switchView('hanung-album');
        };
        window.playFirstSongOfHanung = () => window.playSpecificSong(300);

        window.openRaraAlbum = () => {
            const raraSongs = songs.filter(s => s.id >= 306 && s.id <= 310);
            document.getElementById('rara-title-view').innerText = "Rara's Album";
            const coverEl = document.getElementById('rara-cover-view');
            
            // DYNAMIC BG
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('rara-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            };
            
            document.getElementById('rara-count').innerText = `${raraSongs.length} ${window.t('songs-label')}`;
            renderSongList(raraSongs, 'rara-songs-container');
            switchView('rara-album');
        };
        window.playFirstSongOfRara = () => window.playSpecificSong(306);

        // Helper function to handle band/artist opening (desktop overlay OR mobile view)
        function handleArtistBandClick(name, cover, startId, endId, category, description) {
            if (window.innerWidth >= 769) {
                // Desktop: open overlay
                const songsList = songs.filter(s => s.id >= startId && s.id <= endId);
                const artistData = {
                    name,
                    cover,
                    category,
                    description: description || `Popular ${category}`
                };
                window.openArtistBandOverlay(artistData, songsList);
            } else {
                // Mobile: use regular switchView
                // This would need the appropriate view ID which we'll keep the old behavior for now
                console.log('Mobile view for', name);
            }
        }

        // Bands Indonesia (Using Generic Helper for consistency)
        window.openPerungguAlbum = () => {
            setupGenericAlbumView("Perunggu", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/perunggu.jpg", 30, 39, "perunggu-album", "perunggu-title-view", "perunggu-cover-view", "perunggu-header-bg", "perunggu-count", "perunggu-songs-container");
        };
        window.playFirstSongOfPerunggu = () => window.playSpecificSong(30);

        window.openNoahAlbum = () => {
            setupGenericAlbumView("NOAH", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/noah.jpg", 42, 51, "noah-album", "noah-title-view", "noah-cover-view", "noah-header-bg", "noah-count", "noah-songs-container");
        };
        window.playFirstSongOfNoah = () => window.playSpecificSong(42);

        window.openDewaAlbum = () => {
            setupGenericAlbumView("Dewa 19", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png", 57, 68, "dewa-album", "dewa-title-view", "dewa-cover-view", "dewa-header-bg", "dewa-count", "dewa-songs-container");
        };
        window.playFirstSongOfDewa = () => window.playSpecificSong(57);

        window.openSheilaAlbum = () => {
            setupGenericAlbumView("Sheila On 7", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/so7.jpg", 72, 83, "sheila-album", "sheila-title-view", "sheila-cover-view", "sheila-header-bg", "sheila-count", "sheila-songs-container");
        };
        window.playFirstSongOfSheila = () => window.playSpecificSong(72);

        window.openKahitnaAlbum = () => {
            setupGenericAlbumView("Kahitna", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kahitna.jpeg", 87, 97, "kahitna-album", "kahitna-title-view", "kahitna-cover-view", "kahitna-header-bg", "kahitna-count", "kahitna-songs-container");
        };
        window.playFirstSongOfKahitna = () => window.playSpecificSong(87);

        window.openHindiaAlbum = () => {
            setupGenericAlbumView("Hindia", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hindia.jpg", 100, 117, "hindia-album", "hindia-title-view", "hindia-cover-view", "hindia-header-bg", "hindia-count", "hindia-songs-container");
        };
        window.playFirstSongOfHindia = () => window.playSpecificSong(100);

        // Artists Indonesia
        window.openAstridAlbum = () => {
            setupGenericAlbumView("Astrid", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/astrid.webp", 118, 122, "astrid-album", "astrid-title-view", "astrid-cover-view", "astrid-header-bg", "astrid-count", "astrid-songs-container");
        };
        window.playFirstSongOfAstrid = () => window.playSpecificSong(118);

        window.openAfganAlbum = () => {
            setupGenericAlbumView("Afgan", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/afgan.png", 123, 130, "afgan-album", "afgan-title-view", "afgan-cover-view", "afgan-header-bg", "afgan-count", "afgan-songs-container");
        };
        window.playFirstSongOfAfgan = () => window.playSpecificSong(123);

        window.openTulusAlbum = () => {
            setupGenericAlbumView("Tulus", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tulus.jpg", 131, 140, "tulus-album", "tulus-title-view", "tulus-cover-view", "tulus-header-bg", "tulus-count", "tulus-songs-container");
        };
        window.playFirstSongOfTulus = () => window.playSpecificSong(131);

        window.openMahaliniAlbum = () => {
            setupGenericAlbumView("Mahalini", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/mahalini.jpg", 141, 148, "mahalini-album", "mahalini-title-view", "mahalini-cover-view", "mahalini-header-bg", "mahalini-count", "mahalini-songs-container");
        };
        window.playFirstSongOfMahalini = () => window.playSpecificSong(141);

        window.openTenxiAlbum = () => {
            setupGenericAlbumView("Tenxi", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/tenxi.jpg", 149, 153, "tenxi-album", "tenxi-title-view", "tenxi-cover-view", "tenxi-header-bg", "tenxi-count", "tenxi-songs-container");
        };
        window.playFirstSongOfTenxi = () => window.playSpecificSong(149);

        // Foreign Artists & Bands
        window.openTaylorAlbum = () => {
            setupGenericAlbumView("Taylor Swift", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/taylor.jpg", 154, 161, "taylor-album", "taylor-title-view", "taylor-cover-view", "taylor-header-bg", "taylor-count", "taylor-songs-container");
        };
        window.playFirstSongOfTaylor = () => window.playSpecificSong(154);

        window.openJustinAlbum = () => {
            setupGenericAlbumView("Justin Bieber", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/justin.jpg", 162, 171, "justin-album", "justin-title-view", "justin-cover-view", "justin-header-bg", "justin-count", "justin-songs-container");
        };
        window.playFirstSongOfJustin = () => window.playSpecificSong(162);

        window.openEdAlbum = () => {
            setupGenericAlbumView("Ed Sheeran", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ed.jpg", 172, 181, "ed-album", "ed-title-view", "ed-cover-view", "ed-header-bg", "ed-count", "ed-songs-container");
        };
        window.playFirstSongOfEd = () => window.playSpecificSong(172);

        window.openBrunoAlbum = () => {
            setupGenericAlbumView("Bruno Mars", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bruno.jpg", 182, 191, "bruno-album", "bruno-title-view", "bruno-cover-view", "bruno-header-bg", "bruno-count", "bruno-songs-container");
        };
        window.playFirstSongOfBruno = () => window.playSpecificSong(182);

        window.openDanielAlbum = () => {
            setupGenericAlbumView("Daniel Caesar", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/daniel.jpg", 192, 201, "daniel-album", "daniel-title-view", "daniel-cover-view", "daniel-header-bg", "daniel-count", "daniel-songs-container");
        };
        window.playFirstSongOfDaniel = () => window.playSpecificSong(192);

        window.openColdplayAlbum = () => {
            setupGenericAlbumView("Coldplay", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/coldplay.jpg", 202, 211, "coldplay-album", "coldplay-title-view", "coldplay-cover-view", "coldplay-header-bg", "coldplay-count", "coldplay-songs-container");
        };
        window.playFirstSongOfColdplay = () => window.playSpecificSong(202);

        window.openOnedirectionAlbum = () => {
            setupGenericAlbumView("One Direction", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/onedirection.jpg", 212, 221, "onedirection-album", "onedirection-title-view", "onedirection-cover-view", "onedirection-header-bg", "onedirection-count", "onedirection-songs-container");
        };
        window.playFirstSongOfOnedirection = () => window.playSpecificSong(212);

        window.openGreendayAlbum = () => {
            setupGenericAlbumView("Green Day", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/greenday.jpg", 222, 231, "greenday-album", "greenday-title-view", "greenday-cover-view", "greenday-header-bg", "greenday-count", "greenday-songs-container");
        };
        window.playFirstSongOfGreenday = () => window.playSpecificSong(222);

        window.openOasisAlbum = () => {
            setupGenericAlbumView("Oasis", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/oasis.jpg", 232, 241, "oasis-album", "oasis-title-view", "oasis-cover-view", "oasis-header-bg", "oasis-count", "oasis-songs-container");
        };
        window.playFirstSongOfOasis = () => window.playSpecificSong(232);

        window.openRadioheadAlbum = () => {
            setupGenericAlbumView("Radiohead", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/radiohead.jpg", 242, 251, "radiohead-album", "radiohead-title-view", "radiohead-cover-view", "radiohead-header-bg", "radiohead-count", "radiohead-songs-container");
        };
        window.playFirstSongOfRadiohead = () => window.playSpecificSong(242);

        // --- NEW ALBUMS (FOREIGN & INDONESIAN) ---
        window.openCigarettesAlbum = () => {
            setupGenericAlbumView("Cigarettes After Sex", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/cas.jpg", 400, 409, "cas-album", "cas-title-view", "cas-cover-view", "cas-header-bg", "cas-count", "cas-songs-container");
        };
        window.playFirstSongOfCigarettes = () => window.playSpecificSong(400);

        window.openRexAlbum = () => {
            setupGenericAlbumView("Rex Orange County", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/roc.jpg", 410, 419, "roc-album", "roc-title-view", "roc-cover-view", "roc-header-bg", "roc-count", "roc-songs-container");
        };
        window.playFirstSongOfRex = () => window.playSpecificSong(410);

        window.openSmithsAlbum = () => {
            setupGenericAlbumView("The Smiths", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thesmith.jpg", 420, 429, "smiths-album", "smiths-title-view", "smiths-cover-view", "smiths-header-bg", "smiths-count", "smiths-songs-container");
        };
        window.playFirstSongOfSmiths = () => window.playSpecificSong(420);

        window.openArcticAlbum = () => {
            setupGenericAlbumView("Arctic Monkeys", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/articmonkeys.jpg", 430, 439, "arctic-album", "arctic-title-view", "arctic-cover-view", "arctic-header-bg", "arctic-count", "arctic-songs-container");
        };
        window.playFirstSongOfArctic = () => window.playSpecificSong(430);

        window.openQueenAlbum = () => {
            setupGenericAlbumView("Queen", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/queen.jpg", 440, 449, "queen-album", "queen-title-view", "queen-cover-view", "queen-header-bg", "queen-count", "queen-songs-container");
        };
        window.playFirstSongOfQueen = () => window.playSpecificSong(440);

        window.openStoneRosesAlbum = () => {
            setupGenericAlbumView("The Stone Roses", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thestoneroses.jpg", 450, 459, "stoneroses-album", "stoneroses-title-view", "stoneroses-cover-view", "stoneroses-header-bg", "stoneroses-count", "stoneroses-songs-container");
        };
        window.playFirstSongOfStoneRoses = () => window.playSpecificSong(450);

        window.openNeckDeepAlbum = () => {
            setupGenericAlbumView("Neck Deep", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/neckdeep.jpg", 460, 469, "neckdeep-album", "neckdeep-title-view", "neckdeep-cover-view", "neckdeep-header-bg", "neckdeep-count", "neckdeep-songs-container");
        };
        window.playFirstSongOfNeckDeep = () => window.playSpecificSong(460);

        window.openMCRAlbum = () => {
            setupGenericAlbumView("My Chemical Romance", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/chemical.jpg", 470, 479, "mcr-album", "mcr-title-view", "mcr-cover-view", "mcr-header-bg", "mcr-count", "mcr-songs-container");
        };
        window.playFirstSongOfMCR = () => window.playSpecificSong(470);

        window.openBobMarleyAlbum = () => {
            setupGenericAlbumView("Bob Marley", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bob.jpg", 480, 489, "bobmarley-album", "bobmarley-title-view", "bobmarley-cover-view", "bobmarley-header-bg", "bobmarley-count", "bobmarley-songs-container");
        };
        window.playFirstSongOfBobMarley = () => window.playSpecificSong(480);

        window.openFrankOceanAlbum = () => {
            setupGenericAlbumView("Frank Ocean", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/frank.jpg", 490, 499, "frank-album", "frank-title-view", "frank-cover-view", "frank-header-bg", "frank-count", "frank-songs-container");
        };
        window.playFirstSongOfFrankOcean = () => window.playSpecificSong(490);

        window.openDrakeAlbum = () => {
            setupGenericAlbumView("Drake", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/drake.jpg", 500, 509, "drake-album", "drake-title-view", "drake-cover-view", "drake-header-bg", "drake-count", "drake-songs-container");
        };
        window.playFirstSongOfDrake = () => window.playSpecificSong(500);

        window.openKendrickAlbum = () => {
            setupGenericAlbumView("Kendrick Lamar", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kendrick.jpg", 510, 519, "kendrick-album", "kendrick-title-view", "kendrick-cover-view", "kendrick-header-bg", "kendrick-count", "kendrick-songs-container");
        };
        window.playFirstSongOfKendrick = () => window.playSpecificSong(510);

        window.openTheWeekndAlbum = () => {
            setupGenericAlbumView("The Weeknd", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/theweekend.jpg", 520, 529, "weeknd-album", "weeknd-title-view", "weeknd-cover-view", "weeknd-header-bg", "weeknd-count", "weeknd-songs-container");
        };
        window.playFirstSongOfTheWeeknd = () => window.playSpecificSong(520);

        window.openThe1975Album = () => {
            setupGenericAlbumView("The 1975", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/the1975.jpg", 530, 539, "the1975-album", "the1975-title-view", "the1975-cover-view", "the1975-header-bg", "the1975-count", "the1975-songs-container");
        };
        window.playFirstSongOfThe1975 = () => window.playSpecificSong(530);

        window.openOliviaAlbum = () => {
            setupGenericAlbumView("Olivia Rodrigo", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/olivia.jpg", 540, 549, "olivia-album", "olivia-title-view", "olivia-cover-view", "olivia-header-bg", "olivia-count", "olivia-songs-container");
        };
        window.playFirstSongOfOlivia = () => window.playSpecificSong(540);

        window.openChainsmokersAlbum = () => {
            setupGenericAlbumView("The Chainsmokers", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thechainmokers.jpg", 550, 559, "chainsmokers-album", "chainsmokers-title-view", "chainsmokers-cover-view", "chainsmokers-header-bg", "chainsmokers-count", "chainsmokers-songs-container");
        };
        window.playFirstSongOfChainsmokers = () => window.playSpecificSong(550);

        window.openAvengedAlbum = () => {
            setupGenericAlbumView("Avenged Sevenfold", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/avenged.jpg", 560, 569, "avenged-album", "avenged-title-view", "avenged-cover-view", "avenged-header-bg", "avenged-count", "avenged-songs-container");
        };
        window.playFirstSongOfAvenged = () => window.playSpecificSong(560);

        window.openSlankAlbum = () => {
            setupGenericAlbumView("Slank", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/slank.jpg", 570, 579, "slank-album", "slank-title-view", "slank-cover-view", "slank-header-bg", "slank-count", "slank-songs-container");
        };
        window.playFirstSongOfSlank = () => window.playSpecificSong(570);

        window.openRealityClubAlbum = () => {
            setupGenericAlbumView("Reality Club", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/realityclub.jpg", 580, 589, "realityclub-album", "realityclub-title-view", "realityclub-cover-view", "realityclub-header-bg", "realityclub-count", "realityclub-songs-container");
        };
        window.playFirstSongOfRealityClub = () => window.playSpecificSong(580);

        window.openNidjiAlbum = () => {
            setupGenericAlbumView("Nidji", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/nidji.jpg", 590, 599, "nidji-album", "nidji-title-view", "nidji-cover-view", "nidji-header-bg", "nidji-count", "nidji-songs-container");
        };
        window.playFirstSongOfNidji = () => window.playSpecificSong(590);

        // --- NEW INDONESIAN SINGERS ---
        window.openNaykillaAlbum = () => {
            setupGenericAlbumView("Naykilla", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nay.jpg", 600, 604, "naykilla-album", "naykilla-title-view", "naykilla-cover-view", "naykilla-header-bg", "naykilla-count", "naykilla-songs-container");
        };
        window.playFirstSongOfNaykilla = () => window.playSpecificSong(600);

        window.openBernardyaAlbum = () => {
            setupGenericAlbumView("Bernadya", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/bernadya.jpg", 605, 609, "bernadya-album", "bernadya-title-view", "bernadya-cover-view", "bernadya-header-bg", "bernadya-count", "bernadya-songs-container");
        };
        window.playFirstSongOfBernadya = () => window.playSpecificSong(605);

        window.openIwanFalsAlbum = () => {
            setupGenericAlbumView("Iwan Fals", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/iwan.jpg", 610, 614, "iwanfals-album", "iwanfals-title-view", "iwanfals-cover-view", "iwanfals-header-bg", "iwanfals-count", "iwanfals-songs-container");
        };
        window.playFirstSongOfIwanFals = () => window.playSpecificSong(610);

        window.openPamungkasAlbum = () => {
            setupGenericAlbumView("Pamungkas", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/pamungkas.jpg", 615, 619, "pamungkas-album", "pamungkas-title-view", "pamungkas-cover-view", "pamungkas-header-bg", "pamungkas-count", "pamungkas-songs-container");
        };
        window.playFirstSongOfPamungkas = () => window.playSpecificSong(615);

        window.openK3biAlbum = () => {
            setupGenericAlbumView("K3bi", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/kebi.jpg", 620, 624, "k3bi-album", "k3bi-title-view", "k3bi-cover-view", "k3bi-header-bg", "k3bi-count", "k3bi-songs-container");
        };
        window.playFirstSongOfK3bi = () => window.playSpecificSong(620);

        window.openSafaAlbum = () => {
            setupGenericAlbumView("$afa", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/safa.jpg", 625, 629, "safa-album", "safa-title-view", "safa-cover-view", "safa-header-bg", "safa-count", "safa-songs-container");
        };
        window.playFirstSongOfSafa = () => window.playSpecificSong(625);

        window.openTuan13Album = () => {
            setupGenericAlbumView("Tuantigabelas", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/tuan13.jpg", 630, 634, "tuan13-album", "tuan13-title-view", "tuan13-cover-view", "tuan13-header-bg", "tuan13-count", "tuan13-songs-container");
        };
        window.playFirstSongOfTuan13 = () => window.playSpecificSong(630);

        window.openMaudyAlbum = () => {
            setupGenericAlbumView("Maudy Ayunda", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maudy.jpg", 635, 639, "maudy-album", "maudy-title-view", "maudy-cover-view", "maudy-header-bg", "maudy-count", "maudy-songs-container");
        };
        window.playFirstSongOfMaudy = () => window.playSpecificSong(635);

        window.openGlennAlbum = () => {
            setupGenericAlbumView("Glenn Fredly", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/gleen.jpg", 640, 644, "glenn-album", "glenn-title-view", "glenn-cover-view", "glenn-header-bg", "glenn-count", "glenn-songs-container");
        };
        window.playFirstSongOfGlenn = () => window.playSpecificSong(640);

        window.openNadinAlbum = () => {
            setupGenericAlbumView("Nadin Amizah", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/nadin.jpg", 645, 649, "nadin-album", "nadin-title-view", "nadin-cover-view", "nadin-header-bg", "nadin-count", "nadin-songs-container");
        };
        window.playFirstSongOfNadin = () => window.playSpecificSong(645);

        window.openSalPriadiAlbum = () => {
            setupGenericAlbumView("Sal Priadi", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/salpriadi.jpg", 650, 654, "salpriadi-album", "salpriadi-title-view", "salpriadi-cover-view", "salpriadi-header-bg", "salpriadi-count", "salpriadi-songs-container");
        };
        window.playFirstSongOfSalPriadi = () => window.playSpecificSong(650);

        window.openJuanRezaAlbum = () => {
            setupGenericAlbumView("Juan Reza", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juan.jpg", 655, 659, "juanreza-album", "juanreza-title-view", "juanreza-cover-view", "juanreza-header-bg", "juanreza-count", "juanreza-songs-container");
        };
        window.playFirstSongOfJuanReza = () => window.playSpecificSong(655);

        window.openNIKIAlbum = () => {
            setupGenericAlbumView("NIKI", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/niki.jpg", 660, 664, "niki-album", "niki-title-view", "niki-cover-view", "niki-header-bg", "niki-count", "niki-songs-container");
        };
        window.playFirstSongOfNIKI = () => window.playSpecificSong(660);

        // --- NEW INDONESIAN BANDS ---
        window.openFeastAlbum = () => {
            setupGenericAlbumView("Feast", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/feast.jpg", 665, 669, "feast-album", "feast-title-view", "feast-cover-view", "feast-header-bg", "feast-count", "feast-songs-container");
        };
        window.playFirstSongOfFeast = () => window.playSpecificSong(665);

        window.openPanasdalamAlbum = () => {
            setupGenericAlbumView("The Panasdalam Bank", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thepanasdalambank.jpg", 670, 674, "panasdalam-album", "panasdalam-title-view", "panasdalam-cover-view", "panasdalam-header-bg", "panasdalam-count", "panasdalam-songs-container");
        };
        window.playFirstSongOfPanasdalam = () => window.playSpecificSong(670);

        window.openLombaSihirAlbum = () => {
            setupGenericAlbumView("Lomba Sihir", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lomba.jpg", 675, 679, "lombasihir-album", "lombasihir-title-view", "lombasihir-cover-view", "lombasihir-header-bg", "lombasihir-count", "lombasihir-songs-container");
        };
        window.playFirstSongOfLombaSihir = () => window.playSpecificSong(675);

        window.openLastChildAlbum = () => {
            setupGenericAlbumView("Last Child", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/lastchild.jpg", 680, 684, "lastchild-album", "lastchild-title-view", "lastchild-cover-view", "lastchild-header-bg", "lastchild-count", "lastchild-songs-container");
        };
        window.playFirstSongOfLastChild = () => window.playSpecificSong(680);

        window.openForRevengeAlbum = () => {
            setupGenericAlbumView("For Revenge", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/forrevenge.jpg", 685, 689, "forrevenge-album", "forrevenge-title-view", "forrevenge-cover-view", "forrevenge-header-bg", "forrevenge-count", "forrevenge-songs-container");
        };
        window.playFirstSongOfForRevenge = () => window.playSpecificSong(685);

        window.openYovieAlbum = () => {
            setupGenericAlbumView("Yovie & Nuno", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/yovie.jpg", 690, 694, "yovie-album", "yovie-title-view", "yovie-cover-view", "yovie-header-bg", "yovie-count", "yovie-songs-container");
        };
        window.playFirstSongOfYovie = () => window.playSpecificSong(690);

        window.openVierraAlbum = () => {
            setupGenericAlbumView("Vierra", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/vierra.jpg", 695, 699, "vierra-album", "vierra-title-view", "vierra-cover-view", "vierra-header-bg", "vierra-count", "vierra-songs-container");
        };
        window.playFirstSongOfVierra = () => window.playSpecificSong(695);

        window.openUtopiaAlbum = () => {
            setupGenericAlbumView("Utopia", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/utopia.jpg", 700, 704, "utopia-album", "utopia-title-view", "utopia-cover-view", "utopia-header-bg", "utopia-count", "utopia-songs-container");
        };
        window.playFirstSongOfUtopia = () => window.playSpecificSong(700);

        window.openJuicyLucyAlbum = () => {
            setupGenericAlbumView("Juicy Lucy", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/juicy.jpg", 705, 709, "juicylucy-album", "juicylucy-title-view", "juicylucy-cover-view", "juicylucy-header-bg", "juicylucy-count", "juicylucy-songs-container");
        };
        window.playFirstSongOfJuicyLucy = () => window.playSpecificSong(705);

        window.openHiviAlbum = () => {
            setupGenericAlbumView("HIVI!", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/hivi.jpg", 710, 714, "hivi-album", "hivi-title-view", "hivi-cover-view", "hivi-header-bg", "hivi-count", "hivi-songs-container");
        };
        window.playFirstSongOfHivi = () => window.playSpecificSong(710);

        window.openTheLantisAlbum = () => {
            setupGenericAlbumView("The Lantis", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thelantis.jpg", 715, 719, "thelantis-album", "thelantis-title-view", "thelantis-cover-view", "thelantis-header-bg", "thelantis-count", "thelantis-songs-container");
        };
        window.playFirstSongOfTheLantis = () => window.playSpecificSong(715);

        window.openTheChangcutersAlbum = () => {
            setupGenericAlbumView("The Changcuters", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thechangcuters.jpg", 720, 724, "thechangcuters-album", "thechangcuters-title-view", "thechangcuters-cover-view", "thechangcuters-header-bg", "thechangcuters-count", "thechangcuters-songs-container");
        };
        window.playFirstSongOfTheChangcuters = () => window.playSpecificSong(720);

        window.openTheAdamsAlbum = () => {
            setupGenericAlbumView("The Adams", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/theadams.jpg", 725, 729, "theadams-album", "theadams-title-view", "theadams-cover-view", "theadams-header-bg", "theadams-count", "theadams-songs-container");
        };
        window.playFirstSongOfTheAdams = () => window.playSpecificSong(725);

        // --- NEW FOREIGN SINGERS ---
        window.openAviciiAlbum = () => {
            setupGenericAlbumView("Avicii", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/avicii.jpg", 730, 734, "avicii-album", "avicii-title-view", "avicii-cover-view", "avicii-header-bg", "avicii-count", "avicii-songs-container");
        };
        window.playFirstSongOfAvicii = () => window.playSpecificSong(730);

        window.openAdeleAlbum = () => {
            setupGenericAlbumView("Adele", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/adele.jpg", 735, 739, "adele-album", "adele-title-view", "adele-cover-view", "adele-header-bg", "adele-count", "adele-songs-container");
        };
        window.playFirstSongOfAdele = () => window.playSpecificSong(735);

        window.openShawnMendesAlbum = () => {
            setupGenericAlbumView("Shawn Mendes", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/shawn.jpg", 740, 744, "shawnmendes-album", "shawnmendes-title-view", "shawnmendes-cover-view", "shawnmendes-header-bg", "shawnmendes-count", "shawnmendes-songs-container");
        };
        window.playFirstSongOfShawnMendes = () => window.playSpecificSong(740);

        window.openJamesArthurAlbum = () => {
            setupGenericAlbumView("James Arthur", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/james.jpg", 745, 749, "jamesarthur-album", "jamesarthur-title-view", "jamesarthur-cover-view", "jamesarthur-header-bg", "jamesarthur-count", "jamesarthur-songs-container");
        };
        window.playFirstSongOfJamesArthur = () => window.playSpecificSong(745);

        window.openBillieEilishAlbum = () => {
            setupGenericAlbumView("Billie Eilish", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/billie.jpg", 750, 754, "billieeilish-album", "billieeilish-title-view", "billieeilish-cover-view", "billieeilish-header-bg", "billieeilish-count", "billieeilish-songs-container");
        };
        window.playFirstSongOfBillieEilish = () => window.playSpecificSong(750);

        // --- NEW FOREIGN BANDS ---
        window.openBeatlesAlbum = () => {
            setupGenericAlbumView("The Beatles", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/thebeatles.jpg", 755, 759, "beatles-album", "beatles-title-view", "beatles-cover-view", "beatles-header-bg", "beatles-count", "beatles-songs-container");
        };
        window.playFirstSongOfBeatles = () => window.playSpecificSong(755);

        window.openMaroon5Album = () => {
            setupGenericAlbumView("Maroon 5", "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/newalbum/maroon5.jpg", 760, 764, "maroon5-album", "maroon5-title-view", "maroon5-cover-view", "maroon5-header-bg", "maroon5-count", "maroon5-songs-container");
        };
        window.playFirstSongOfMaroon5 = () => window.playSpecificSong(760);

        // --- TOGGLE SHOW ALL FUNCTION ---
        window.toggleShowAll = (type, button) => {
            const extraContainer = document.getElementById(`${type}-extra-container`);
            if(!extraContainer) return;
            
            const isOpen = button.classList.contains('open');
            
            if(isOpen) {
                // Tutup - slide up
                extraContainer.classList.add('hide');
                button.classList.remove('open');
                // Tunggu animasi selesai, baru hide
                setTimeout(() => {
                    extraContainer.style.display = 'none';
                    extraContainer.classList.remove('show-all-extra-items', 'hide');
                }, 400);
            } else {
                // Buka - slide down
                extraContainer.style.display = 'grid';
                extraContainer.classList.add('show-all-extra-items');
                button.classList.add('open');
            }
        };

        // --- SCROLL TO SECTION FUNCTION ---
        window.scrollToSection = (sectionId) => {
            const element = document.getElementById(sectionId);
            if(element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        // --- SHOW ALL MODAL FUNCTION (DEPRECATED) ---
        window.showAllModal = (type) => {
            const modal = document.getElementById('show-all-modal');
            const grid = document.getElementById('show-all-grid');
            const title = document.getElementById('show-all-title');
            
            let dataList = [];
            let titleText = 'Tampilkan Semua';
            
            if(type === 'indonesian-bands') {
                titleText = 'Band Indonesia';
                dataList = [
                    { name: "Perunggu", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/perunggu.jpg", onclick: "window.openPerungguAlbum()" },
                    { name: "NOAH", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/noah.jpg", onclick: "window.openNoahAlbum()" },
                    { name: "Dewa 19", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/dewa19.png", onclick: "window.openDewaAlbum()" },
                    { name: "Sheila On 7", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/so7.jpg", onclick: "window.openSheilaAlbum()" },
                    { name: "Kahitna", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kahitna.jpeg", onclick: "window.openKahitnaAlbum()" },
                    { name: "Hindia", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/hindia.jpg", onclick: "window.openHindiaAlbum()" },
                    { name: "Slank", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/slank.jpg", onclick: "window.openSlankAlbum()" },
                    { name: "Reality Club", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/realityclub.jpg", onclick: "window.openRealityClubAlbum()" },
                    { name: "Nidji", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/nidji.jpg", onclick: "window.openNidjiAlbum()" }
                ];
            } else if(type === 'foreign-artists') {
                titleText = 'Penyanyi Asing';
                dataList = [
                    { name: "Taylor Swift", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/taylor.jpg", onclick: "window.openTaylorAlbum()" },
                    { name: "Justin Bieber", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/justin.jpg", onclick: "window.openJustinAlbum()" },
                    { name: "Ed Sheeran", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/ed.jpg", onclick: "window.openEdAlbum()" },
                    { name: "Bruno Mars", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bruno.jpg", onclick: "window.openBrunoAlbum()" },
                    { name: "Daniel Caesar", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/daniel.jpg", onclick: "window.openDanielAlbum()" },
                    { name: "Bob Marley", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/bob.jpg", onclick: "window.openBobMarleyAlbum()" },
                    { name: "Frank Ocean", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/frank.jpg", onclick: "window.openFrankOceanAlbum()" },
                    { name: "Drake", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/drake.jpg", onclick: "window.openDrakeAlbum()" },
                    { name: "Kendrick Lamar", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/kendrick.jpg", onclick: "window.openKendrickAlbum()" },
                    { name: "The Weeknd", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/theweekend.jpg", onclick: "window.openTheWeekndAlbum()" },
                    { name: "Olivia Rodrigo", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/olivia.jpg", onclick: "window.openOliviaAlbum()" }
                ];
            } else if(type === 'foreign-bands') {
                titleText = 'Band Asing';
                dataList = [
                    { name: "Cigarettes After Sex", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/cas.jpg", onclick: "window.openCigarettesAlbum()" },
                    { name: "Rex Orange County", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/roc.jpg", onclick: "window.openRexAlbum()" },
                    { name: "The Smiths", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thesmith.jpg", onclick: "window.openSmithsAlbum()" },
                    { name: "Arctic Monkeys", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/articmonkeys.jpg", onclick: "window.openArcticAlbum()" },
                    { name: "Queen", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/queen.jpg", onclick: "window.openQueenAlbum()" },
                    { name: "The Stone Roses", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thestoneroses.jpg", onclick: "window.openStoneRosesAlbum()" },
                    { name: "Neck Deep", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/neckdeep.jpg", onclick: "window.openNeckDeepAlbum()" },
                    { name: "My Chemical Romance", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/chemical.jpg", onclick: "window.openMCRAlbum()" },
                    { name: "The 1975", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/the1975.jpg", onclick: "window.openThe1975Album()" },
                    { name: "The Chainsmokers", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/thechainmokers.jpg", onclick: "window.openChainsmokersAlbum()" },
                    { name: "Avenged Sevenfold", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/avenged.jpg", onclick: "window.openAvengedAlbum()" },
                    { name: "Coldplay", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/coldplay.jpg", onclick: "window.openColdplayAlbum()" },
                    { name: "One Direction", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/onedirection.jpg", onclick: "window.openOnedirectionAlbum()" },
                    { name: "Green Day", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/greenday.jpg", onclick: "window.openGreendayAlbum()" },
                    { name: "Oasis", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/oasis.jpg", onclick: "window.openOasisAlbum()" },
                    { name: "Radiohead", image: "https://qkruoywwqdpkdjlajbpl.supabase.co/storage/v1/object/public/vidje/albumphoto/radiohead.jpg", onclick: "window.openRadioheadAlbum()" }
                ];
            }
            
            title.innerText = titleText;
            const html = dataList.map(item => `
                <div class="song-card" onclick="${item.onclick}; window.closeShowAllModal();">
                    <div class="card-img-wrapper">
                        <img src="${item.image}" alt="${item.name}" onload="window.applyCardColor(this)">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <div class="card-title">${item.name}</div>
                </div>
            `).join('');
            
            grid.innerHTML = html;
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        };

        window.closeShowAllModal = () => {
            const modal = document.getElementById('show-all-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        // Close modal when clicking overlay
        document.getElementById('show-all-modal').addEventListener('click', (e) => {
            if(e.target.id === 'show-all-modal') {
                window.closeShowAllModal();
            }
        });

        // --- LIKED SONGS LOGIC ---
        function openLikedView() {
            const likedSongsList = songs.filter(s => likedSongs.includes(s.id));
            document.getElementById('liked-title-view').innerText = window.t('liked');
            const coverEl = document.getElementById('liked-cover-view');
            
            // Use custom liked cover if exists
            let coverUrl = "https://picsum.photos/seed/liked/300/300";
            if(currentUserData && currentUserData.likedCover) {
                coverUrl = currentUserData.likedCover;
            } else if (likedSongsList.length > 0) {
                coverUrl = likedSongsList[0].cover;
            }
            
            coverEl.src = coverUrl;
            coverEl.onload = function() {
                const rgb = getAverageRGB(coverEl);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('liked-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            };
            
            document.getElementById('liked-count').innerText = `${likedSongsList.length} ${window.t('songs-label')}`;
            renderSongList(likedSongsList, 'liked-songs-container');
        }
        
        window.openLikedView = openLikedView;
        window.playFirstSongOfLiked = () => {
            if(likedSongs.length > 0) {
                window.playSpecificSong(likedSongs[0]);
            } else {
                alert(window.t('no-songs'));
            }
        };

        // --- PROFILE VIEW LOGIC ---
        function openProfileView() {
            if(!currentUserData) return;
            
            document.getElementById('profile-name-display').innerText = currentUserData.username;
            document.getElementById('profile-bio-display').innerText = currentUserData.bio || '';
            const avatarDisplay = document.getElementById('profile-avatar-display');
            document.getElementById('profile-userid-text').innerText = currentUserData.userId || "User_0000"; //  PERBAIKAN

            function applyGradient() {
                const rgb = getAverageRGB(avatarDisplay);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                const heroSection = document.getElementById('profile-hero-section');
                if (heroSection) {
                    heroSection.style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
                }
            }

            avatarDisplay.onload = applyGradient;
            
            // Set source and handle already-cached images
            avatarDisplay.src = currentUserData.profile_picture;
            
            // If image is already cached (complete property is true), apply gradient immediately
            if (avatarDisplay.complete) {
                applyGradient();
            }

            document.getElementById('edit-profile-name').value = currentUserData.username;
            document.getElementById('edit-profile-bio').value = currentUserData.bio || '';
            document.getElementById('edit-profile-img').src = currentUserData.profile_picture;

            document.getElementById('profile-edit-panel').classList.remove('active');
            renderProfilePublicPlaylists();
        }
        
        function toggleProfileEdit() {
            document.getElementById('profile-edit-panel').classList.toggle('active');
        }

        // Update Profile Preview in Real-Time
        function updateProfilePreview() {
            const nameInput = document.getElementById('edit-profile-name');
            const bioInput = document.getElementById('edit-profile-bio');
            
            // Update name display
            if (nameInput && nameInput.value) {
                document.getElementById('profile-name-display').innerText = nameInput.value;
            }
            
            // Update bio display
            if (bioInput) {
                document.getElementById('profile-bio-display').innerText = bioInput.value || 'Bio text here';
            }
        }

       // Ganti fungsi renderProfilePublicPlaylists yang lama (sekitar line 1800):

function renderProfilePublicPlaylists() {
    const playlists = currentUserData.playlists || {};
    const container = document.getElementById('profile-public-playlists');
    let html = '';
    
    Object.keys(playlists).forEach(key => {
        const pl = playlists[key];
        // ONLY SHOW PUBLIC PLAYLISTS
        if(pl.isPublic) {
            html += `
                <div class="song-card" onclick="window.openPlaylist('${key}')">
                    <div class="card-img-wrapper">
                        <img src="${pl.cover}" alt="${pl.name}">
                        <div class="play-btn-overlay"><i class="ph-fill ph-play"></i></div>
                    </div>
                    <div class="card-title">${pl.name}</div>
                    <div class="card-desc">Playlist</div>
                </div>
            `;
        }
    });
    
    if (html === '') {
        html = '<p style="color:#666; font-style:italic; padding: 0 32px;">' + window.t('no-public-playlists') + '</p>';
    }

    container.innerHTML = html;
}
    
    
        function handleProfileAvatarUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('edit-profile-img').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveProfileChanges() {
    const newName = document.getElementById('edit-profile-name').value.trim();
    const newBio = document.getElementById('edit-profile-bio').value;
    const newAvatarSrc = document.getElementById('edit-profile-img').src;

    const currentSuffix = currentUserData.userIdSuffix || Math.floor(1000 + Math.random() * 9000);
    const cleanName = newName.replace(/\s+/g, '');
    
    // GANTI # dengan _ di sini juga
    const newUserId = `${cleanName}_${currentSuffix}`; //  UBAH DARI # ke _

    const updates = {
        username: newName,
        userId: newUserId,
        userIdSuffix: currentSuffix,
        bio: newBio,
        profile_picture: newAvatarSrc
    };

    update(ref(db, 'users/' + auth.currentUser.uid), updates)
        .then(() => {
            const oldUserId = currentUserData.userId;
            remove(ref(db, 'usernames/' + oldUserId));
            set(ref(db, 'usernames/' + newUserId), auth.currentUser.uid);

            document.getElementById('header-username').innerText = newName;
            document.getElementById('header-avatar').src = newAvatarSrc;
            document.getElementById('profile-name-display').innerText = newName;
            document.getElementById('profile-bio-display').innerText = newBio;
            document.getElementById('profile-userid-text').innerText = newUserId;
            document.getElementById('profile-avatar-display').src = newAvatarSrc;
            
            const avatarDisplay = document.getElementById('profile-avatar-display');
            
            function applyGradient() {
                const rgb = getAverageRGB(avatarDisplay);
                const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                document.getElementById('profile-hero-section').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
            }
            
            avatarDisplay.onload = applyGradient;
            
            // If image is already cached (complete property is true), apply gradient immediately
            if (avatarDisplay.complete) {
                applyGradient();
            }

            currentUserData = { ...currentUserData, ...updates };

            toggleProfileEdit(); 
            alert("Profil berhasil disimpan! User ID Anda sekarang: " + newUserId);
        })
        .catch((err) => {
            console.error(err);
            alert("Gagal menyimpan profil.");
        });
}

        // Toggle Profile Menu
        function toggleProfileMenu() {
            const menu = document.getElementById('profile-menu-dropdown');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        // Toggle Language Submenu
        function toggleOfflineMenuDropdown() {
            const submenu = document.getElementById('profile-offline-submenu');
            submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
        }

        function toggleLanguageMenuDropdown() {
            const submenu = document.getElementById('profile-language-submenu');
            submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
        }

        // Expose profile functions
        window.toggleProfileEdit = toggleProfileEdit;
        window.toggleProfileMenu = toggleProfileMenu;
        window.toggleOfflineMenuDropdown = toggleOfflineMenuDropdown;
        window.toggleLanguageMenuDropdown = toggleLanguageMenuDropdown;
        window.handleProfileAvatarUpload = handleProfileAvatarUpload;
        window.saveProfileChanges = saveProfileChanges;
        window.loadProfileData = openProfileView;
        window.updateProfilePreview = updateProfilePreview;

        // --- ADD SONG MODAL ---
        function openAddSongModal(songId) {
            const list = document.getElementById('add-song-playlist-list');
            const playlists = currentUserData.playlists || {};
            let html = '';
            Object.keys(playlists).forEach(key => {
                const pl = playlists[key];
                html += `<div class="playlist-select-item" onclick="window.addSongTo('${key}', '${songId}')">
                    <img src="${pl.cover}" style="width:40px;height:40px;border-radius:4px;">
                    <div>${pl.name}</div>
                </div>`;
            });
            if(Object.keys(playlists).length === 0) html = '<p style="text-align:center;color:#888">' + window.t('no-playlists') + '</p>';
            list.innerHTML = html;
            document.getElementById('add-song-modal').classList.add('open');
        }

        function addSongTo(playlistId, songId) {
            const songData = songs.find(s => s.id == songId);
            if(!songData) return;
            const userId = auth.currentUser.uid;
            update(ref(db, 'users/' + userId + '/playlists/' + playlistId + '/songs/' + songId), songData);
            closeModal('add-song-modal');
            addToLiked(songId);
        }

        window.openAddSongModal = openAddSongModal;
        window.addSongTo = addSongTo;
        
        function addToLiked(id) {
            if (!likedSongs.includes(id)) {
                likedSongs.push(id);
                localStorage.setItem('likedSongs', JSON.stringify(likedSongs));
                const currentSong = songs[currentSongIndex];
                if(currentSong && currentSong.id === id) {
                    updatePlayerLikeIcon(id);
                }
            }
        }

        function toggleCurrentSongLike() {
            const currentSong = songs[currentSongIndex];
            if (currentSong) {
                toggleLike(currentSong.id);
            }
        }

        function toggleLike(id) {
            const index = likedSongs.indexOf(id);
            let isLiked = false;
            
            if(index > -1) {
                likedSongs.splice(index, 1);
            } else {
                likedSongs.push(id);
                isLiked = true;
            }
            localStorage.setItem('likedSongs', JSON.stringify(likedSongs));
            
            const currentSong = songs[currentSongIndex];
            if(currentSong && currentSong.id === id) {
                updatePlayerLikeIcon(id);
            }
            updateListLikeIcon(id);
            updateMenuLikeIcon(id);
            updateSongTitleIndicator(id);
            
            // Show toast notification
            if(isLiked) {
                window.showToast('Lagu disukai', 'info');
            }
        }

        function updatePlayerLikeIcon(id) {
            const btn = document.getElementById('like-btn');
            const icon = btn.querySelector('i');
            
            if(likedSongs.includes(id)) {
                icon.className = 'ph-fill ph-heart';
                btn.classList.add('liked');
            } else {
                icon.className = 'ph ph-heart';
                btn.classList.remove('liked');
            }
        }

        function updateListLikeIcon(id) {
            // Update list-like button
            const btn = document.getElementById(`list-like-${id}`);
            if(btn) {
                const icon = btn.querySelector('i');
                if(likedSongs.includes(id)) {
                    if(icon) icon.className = 'ph-fill ph-heart';
                    btn.classList.add('liked');
                    btn.style.color = 'var(--primary-red)';
                } else {
                    if(icon) icon.className = 'ph ph-heart';
                    btn.classList.remove('liked');
                    btn.style.color = 'var(--text-gray)';
                }
            }
            
            // Update overlay-like button
            const overlayBtn = document.getElementById(`overlay-like-${id}`);
            if(overlayBtn) {
                const overlayIcon = overlayBtn.querySelector('i');
                if(likedSongs.includes(id)) {
                    if(overlayIcon) overlayIcon.className = 'ph-fill ph-heart';
                    overlayBtn.classList.add('liked');
                } else {
                    if(overlayIcon) overlayIcon.className = 'ph ph-heart';
                    overlayBtn.classList.remove('liked');
                }
            }
        }

        function updateMenuLikeIcon(id) {
            // Update menu-like button in dropdown
            const menuBtn = document.getElementById(`menu-like-${id}`);
            if(menuBtn) {
                const icon = menuBtn.querySelector('i');
                if(likedSongs.includes(id)) {
                    if(icon) icon.className = 'ph-fill ph-heart';
                } else {
                    if(icon) icon.className = 'ph ph-heart';
                }
            }
        }

        function updateSongTitleIndicator(id) {
            const row = document.getElementById(`row-${id}`);
            if(!row) return;
            const titleEl = row.querySelector('.song-title-text');
            if(!titleEl) return;
            // remove any existing heart icons next to title
            titleEl.querySelectorAll('i.ph-heart, i.ph-fill.ph-heart, i.ph-heart-fill').forEach(n => n.remove());
            if(likedSongs.includes(id)) {
                const heart = document.createElement('i');
                heart.className = 'ph-fill ph-heart';
                heart.style.fontSize = '14px';
                heart.style.color = 'var(--primary-red)';
                heart.style.marginLeft = '6px';
                heart.style.verticalAlign = 'middle';
                titleEl.appendChild(heart);
            }
        }

        // Fallback renderer for icons inserted dynamically (helps mobile where icons may not render)
        window.applyIconFallback = function(root = document) {
            const icons = (root.querySelectorAll ? root.querySelectorAll('i') : []);
            icons.forEach(i => {
                if(i.dataset.fallbackApplied) return;
                const cls = (i.className || '').toLowerCase();
                let ch = '';
                if(cls.includes('ph-dots-three-vertical')) ch = '';
                else if(cls.includes('ph-list-plus')) ch = '';
                else if(cls.includes('ph-plus')) ch = '';
                else if(cls.includes('ph-share-network')) ch = '';
                else if(cls.includes('ph-heart')) ch = (cls.includes('ph-fill')) ? '' : '';
                else ch = '';

                // Only apply fallback if icon is not visible, empty, atau sudah tidak ada fallback
                const style = window.getComputedStyle(i);
                const alreadyHasFallback = i.innerHTML.includes('icon-fallback');
                const iconVisible = style.display !== 'none' && style.visibility !== 'hidden' && style.width !== '0px' && style.height !== '0px';
                // Hanya tambahkan fallback jika icon tidak tampil dan belum ada fallback
                if(!iconVisible && !alreadyHasFallback) {
                    i.innerHTML = `<span class="icon-fallback">${ch}</span>`;
                    i.style.lineHeight = '1';
                }
                i.dataset.fallbackApplied = '1';
            });
        };

        window.toggleLike = toggleLike;
        window.addToLiked = addToLiked;
        window.toggleCurrentSongLike = toggleCurrentSongLike;

        // Update Download Button Status in Menu
        window.updateDownloadButtonStatus = async function(songId) {
            const song = window.allSongs?.find(s => s.id == songId || s.id === String(songId) || s.id === Number(songId));
            if (!song) return;
            
            const audioUrl = song.src || song.url || song.audio_url;
            if (!audioUrl) return;
            
            const menuButton = document.querySelector(`.menu-download-${songId}`);
            if (!menuButton) return;
            
            const isCached = await isInCache(audioUrl);
            const icon = menuButton.querySelector('i');
            
            if (icon) {
                if (isCached) {
                    icon.className = 'ph-fill ph-check-circle';
                    icon.style.color = '#34C759';
                } else {
                    icon.className = 'ph ph-download-simple';
                    icon.style.color = '';
                }
            }
        };


        // Toggle Song Action Menu
        window.toggleSongMenu = async function(songId) {
            const menu = document.getElementById(`menu-${songId}`);
            if(!menu) return;
            // Close all other menus
            document.querySelectorAll('.song-menu-dropdown').forEach(m => {
                if(m !== menu) {
                    m.style.display = 'none';
                    m.classList.remove('active-slide');
                }
            });
            // Toggle current menu
            if(menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
                menu.classList.add('active-slide');
                
                // Update download button status when menu opens
                await updateDownloadButtonStatus(songId);
            } else {
                menu.style.display = 'none';
                menu.classList.remove('active-slide');
            }
        };

        // Download Song from Menu
        // OFFLINE DOWNLOAD FEATURE REMOVED
        window.downloadSongFromMenu = async function(songId) {
            showToast(' Fitur offline telah dinonaktifkan', 'warning');
            return;
        };



        // Close dropdown saat menu item diklik
        document.addEventListener('click', function(e) {
            var menuItem = e.target.closest('.menu-item');
            if(menuItem) {
                var dropdown = menuItem.closest('.song-menu-dropdown');
                if(dropdown) {
                    dropdown.style.display = 'none';
                    dropdown.classList.remove('active-slide');
                }
            }
            // Close dropdown saat klik di area lain (bukan menu atau button)
            else if(!e.target.closest('.song-actions-menu')) {
                document.querySelectorAll('.song-menu-dropdown').forEach(menu => {
                    menu.style.display = 'none';
                    menu.classList.remove('active-slide');
                });
            }
        });

        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            if(!event.target.closest('.song-actions-menu')) {
                document.querySelectorAll('.song-menu-dropdown').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
        });

        // --- QUEUE SYSTEM LOGIC ---

        function toggleQueueOverlay() {
            const overlay = document.getElementById('queue-overlay');
            overlay.classList.toggle('open');
            renderQueue();
        }

        // Show toast notification
        // Helper: Check if URL is in cache
        async function isInCache(url) {
            if (!('caches' in window)) return false;
            try {
                const musicCache = await caches.open('vidje-music-v3000');
                const response = await musicCache.match(url);
                return !!response;
            } catch (error) {
                console.error('Failed to check cache:', error);
                return false;
            }
        }

        // Helper: Remove URL from cache
        async function removeFromCache(url) {
            if (!('caches' in window)) return;
            try {
                const musicCache = await caches.open('vidje-music-v3000');
                await musicCache.delete(url);
            } catch (error) {
                console.error('Failed to remove from cache:', error);
            }
        }

                function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = 'toast';
            
            let icon = '<i class="ph ph-check-circle" style="font-size: 20px;"></i>';
            if(type === 'queue') {
                icon = '<i class="ph ph-plus-circle" style="font-size: 20px;"></i>';
            } else if(type === 'error') {
                icon = '<i class="ph ph-warning-circle" style="font-size: 20px;"></i>';
            }
            
            toast.innerHTML = `<span class="toast-icon">${icon}</span><span>${message}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('exit');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        function addToQueue(songId) {
            const song = songs.find(s => s.id === songId);
            if(song) {
                songQueue.push(song);
                renderQueue();
                // Show toast notification
                window.showToast(window.t('song-added-to-queue'), 'queue');
            }
        }

        function removeFromQueue(index) {
            songQueue.splice(index, 1);
            renderQueue();
        }

        function playFromQueue(index) {
            const song = songQueue[index];
            if(song) {
                // If it's not first one, we might want to reorder, but for now let's just play it
                // Usually playing from queue implies that becomes current and we remove previous from queue?
                // Let's just play it and remove it from queue after or before?
                // Standard behavior: Play it, remove played ones before it.
                
                // For simplicity: Play this specific song immediately.
                playSpecificSong(song.id);
                
                // Remove items up to and including this index from queue
                songQueue.splice(0, index + 1);
                renderQueue();
            }
        }
        
        // --- DRAG AND DROP QUEUE LOGIC ---
        let dragStartIndex;

        function handleDragStart(e) {
            dragStartIndex = +this.closest('.queue-item').dataset.index;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const container = document.getElementById('queue-list-container');
            const afterElement = getDragAfterElement(container, e.clientY);
            const draggable = document.querySelector('.dragging');
            if (afterElement == null) {
                container.appendChild(draggable);
            } else {
                container.insertBefore(draggable, afterElement);
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('dragging');
            // Reorder array based on DOM
            const newOrder = [];
            document.querySelectorAll('.queue-item').forEach(item => {
                const idx = parseInt(item.dataset.index);
                newOrder.push(songQueue[idx]);
            });
            songQueue = newOrder;
            
            // Re-render to fix indices
            renderQueue();
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.queue-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function renderQueue() {
            const container = document.getElementById('queue-list-container');
            if(songQueue.length === 0) {
                container.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">' + window.t('empty-queue') + '</div>';
                return;
            }

            let html = '';
            songQueue.forEach((song, index) => {
                html += `
                    <div class="queue-item" draggable="true" data-index="${index}">
                        <img src="${song.cover}" class="queue-img">
                        <div class="queue-info">
                            <div class="queue-title">${song.title}</div>
                            <div class="queue-artist">${song.artist}</div>
                        </div>
                        <button class="queue-remove" onclick="window.removeFromQueue(${index})"><i class="ph ph-x"></i></button>
                    </div>
                `;
            });
            container.innerHTML = html;

            // Attach Drag Events
            const items = container.querySelectorAll('.queue-item');
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver); // On container usually, but here items
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', (e) => e.target.classList.remove('dragging'));
            });
        }

        window.toggleQueueOverlay = toggleQueueOverlay;
        window.addToQueue = addToQueue;
        window.showToast = showToast;
        window.removeFromQueue = removeFromQueue;
        window.playFromQueue = playFromQueue;

        // --- PLAYER LOGIC (FIXED ANIMATION & QUEUE/REPEAT) ---
        
        // --- OVERLAY PLAYER LOGIC ---
        function checkMarquee(el, text) {
            if(!el) return;
            el.innerHTML = text; // Reset
            el.classList.remove('marquee-container');
            
            // Check overflow
            if(el.scrollWidth > el.clientWidth && el.clientWidth > 0) {
                el.classList.add('marquee-container');
                el.innerHTML = `<div class="marquee-content"><span>${text}</span><span>${text}</span></div>`;
            }
        }

        function openOverlayPlayer() {
            console.log(' Opening overlay player...');
            document.getElementById('overlay-player').classList.add('active');
            
            // Check marquee when opening
            if(songs[currentSongIndex]) {
                const s = songs[currentSongIndex];
                checkMarquee(document.getElementById('overlay-title'), s.title);
                checkMarquee(document.getElementById('overlay-artist'), s.artist);
                
                // PENTING: Render lirik saat overlay dibuka
                const lyrics = lyricsDatabase[s.title];
                console.log(' Rendering lyrics for:', s.title, 'Has lyrics:', !!lyrics);
                
                if (lyrics) {
                    const overlayLyricsContent = document.getElementById('overlay-lyrics-content');
                    if (overlayLyricsContent) {
                        console.log('[OK] Rendering to overlay-lyrics-content');
                        renderOverlayLyricsContent(lyrics);
                        overlayLyricsContent.style.display = 'block';
                        overlayLyricsContent.style.visibility = 'visible';
                        
                        // Start lyrics sync
                        lyricsState.isOpen = true;
                        startLyricsSync();
                    } else {
                        console.error('[ERROR] overlay-lyrics-content not found!');
                    }
                } else {
                    console.warn(' No lyrics for:', s.title);
                    const overlayLyricsContent = document.getElementById('overlay-lyrics-content');
                    if (overlayLyricsContent) {
                        overlayLyricsContent.innerHTML = '<p style="color: #888; font-size: 16px; text-align: center; padding: 40px;">Lirik tidak tersedia untuk lagu ini</p>';
                    }
                }
            }
        }

        function closeOverlayPlayer() {
            document.getElementById('overlay-player').classList.remove('active');
        }

        // --- TOGGLE LYRICS VIEW ---
        function toggleLyricsView() {
            const overlayPlayer = document.getElementById('overlay-player');
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            const playScreenLyricsContainer = document.getElementById('play-screen-lyrics-container');

            // Toggle visibility
            overlayPlayer.classList.toggle('active');
            lyricsContainer.classList.toggle('active');

            // Reset scroll position dan manual scroll state saat membuka lirik di mobile
            if (lyricsContainer.classList.contains('active') && playScreenLyricsContainer) {
                playScreenLyricsContainer.scrollTop = 0;
                // Reset manual scroll flag agar auto-scroll bisa langsung berjalan
                isPlayScreenLyricsManualScroll = false;
                clearTimeout(playScreenLyricsScrollTimeout);
                syncLyricsWithMusic();
            }
        }

        // --- SYNC LYRICS WITH MUSIC ---
        function syncLyricsWithMusic() {
            const song = songs[currentSongIndex];
            const lyrics = lyricsDatabase[song.title];
            if (lyrics && audio) {
                updateActiveLyricLine(lyrics, audio.currentTime);
            }
        }
        
        window.openOverlayPlayer = openOverlayPlayer;
        window.closeOverlayPlayer = closeOverlayPlayer;
        window.toggleLyricsView = toggleLyricsView;

        // --- LYRICS MANAGEMENT ---
        let lyricsState = {
            isOpen: false,
            currentLineIndex: 0,
            currentWordIndex: 0,
            syncInterval: null,
            timingOffset: 0  // Offset timing untuk kalibrasi
        };

        function openLyricsOverlay() {
            if (!songs[currentSongIndex]) return;
            const song = songs[currentSongIndex];
            const lyrics = lyricsDatabase[song.title];
            
            // Buka overlay-player (sekarang dengan lyrics terintegrasi)
            document.getElementById('overlay-player').classList.add('active');

            if (!lyrics) {
                // Jika tidak ada lirik, tampilkan pesan di lyrics container
                document.getElementById('overlay-lyrics-content').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Lirik tidak tersedia untuk lagu ini</p>';
                const lyricsPageContent = document.querySelector('#lyrics-overlay-container .lyrics-text');
                if (lyricsPageContent) {
                    lyricsPageContent.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Lirik tidak tersedia untuk lagu ini</p>';
                }
                lyricsState.isOpen = false;
                setupAlbumArtSwipe();
                return;
            }

            // Update album art dan info
            document.getElementById('overlay-art').src = song.cover;
            document.getElementById('overlay-title').innerText = song.title;
            document.getElementById('overlay-artist').innerText = song.artist;

            // Update fullscreen lyrics page (Desktop variant)
            document.getElementById('lyrics-page-art').src = song.cover;
            document.getElementById('lyrics-page-title').innerText = song.title;
            document.getElementById('lyrics-page-artist').innerText = song.artist;

            // Update fullscreen lyrics page (Mobile variant)
            const lyricsPageArtMobile = document.getElementById('lyrics-page-art-mobile');
            if (lyricsPageArtMobile) lyricsPageArtMobile.src = song.cover;
            const lyricsPageTitleMobile = document.getElementById('lyrics-page-title-mobile');
            if (lyricsPageTitleMobile) lyricsPageTitleMobile.innerText = song.title;
            const lyricsPageArtistMobile = document.getElementById('lyrics-page-artist-mobile');
            if (lyricsPageArtistMobile) lyricsPageArtistMobile.innerText = song.artist;

            // Set background image untuk lyrics overlay dengan blur
            const overlayBg = document.getElementById('overlay-bg');
            if (overlayBg && song.cover) {
                overlayBg.style.backgroundImage = `url('${song.cover}')`;
            }
            
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            if (lyricsContainer && song.cover) {
                lyricsContainer.style.backgroundImage = `url('${song.cover}')`;
            }

            // Render lyrics di overlay
            renderOverlayLyricsContent(lyrics);
            
            // Render lyrics di fullscreen page
            const lyricsPageContent = document.querySelector('#lyrics-overlay-container .lyrics-text');
            if (lyricsPageContent) {
                lyricsPageContent.innerHTML = '';
                lyrics.lines.forEach((line, idx) => {
                    const lineEl = document.createElement('div');
                    lineEl.className = 'lyrics-line';
                    lineEl.id = `lyrics-page-line-${idx}`;
                    lineEl.onclick = () => seekToLyricsTime(line.time);
                    lineEl.style.padding = '12px 0';
                    lineEl.style.cursor = 'pointer';
                    lineEl.style.transition = 'all 0.3s ease';

                    if (line.words && line.words.length > 0) {
                        line.words.forEach((word, wordIdx) => {
                            const wordEl = document.createElement('span');
                            wordEl.className = 'lyrics-word';
                            wordEl.id = `lyrics-page-word-${idx}-${wordIdx}`;
                            wordEl.innerText = word;
                            wordEl.style.marginRight = '0.2em';
                            lineEl.appendChild(wordEl);
                        });
                    } else {
                        lineEl.innerText = line.text;
                    }

                    lyricsPageContent.appendChild(lineEl);
                });
            }

            lyricsState.isOpen = true;
            
            startLyricsSync();

            // Setup swipe functionality untuk album art saja
            setupAlbumArtSwipe();
        }

        function closeLyricsOverlay() {
            document.getElementById('overlay-player').classList.remove('active');
            lyricsState.isOpen = false;
            stopLyricsSync();
        }

        function renderOverlayLyricsContent(lyrics) {
            console.log(' renderOverlayLyricsContent called with', lyrics.lines.length, 'lines');
            const contentEl = document.getElementById('overlay-lyrics-content');
            
            if (!contentEl) {
                console.error('[ERROR] overlay-lyrics-content element not found!');
                return;
            }
            
            console.log(' Element found:', contentEl);
            console.log(' Parent element:', contentEl.parentElement);
            console.log(' Current innerHTML length:', contentEl.innerHTML.length);
            console.log(' Display:', window.getComputedStyle(contentEl).display);
            console.log(' Visibility:', window.getComputedStyle(contentEl).visibility);
            console.log(' Opacity:', window.getComputedStyle(contentEl).opacity);
            console.log(' Position:', window.getComputedStyle(contentEl).position);
            console.log(' Width:', window.getComputedStyle(contentEl).width);
            console.log(' Height:', window.getComputedStyle(contentEl).height);
            
            contentEl.innerHTML = '';

            lyrics.lines.forEach((line, idx) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'lyrics-line';
                lineEl.id = `lyrics-line-${idx}`;
                lineEl.onclick = () => seekToLyricsTime(line.time);
                lineEl.style.padding = '8px 0';
                lineEl.style.cursor = 'pointer';
                lineEl.style.transition = 'all 0.3s ease';

                if (line.words && line.words.length > 0) {
                    line.words.forEach((word, wordIdx) => {
                        const wordEl = document.createElement('span');
                        wordEl.className = 'lyrics-word';
                        wordEl.id = `lyrics-word-${idx}-${wordIdx}`;
                        wordEl.innerText = word;
                        wordEl.style.marginRight = '0.2em';
                        lineEl.appendChild(wordEl);
                    });
                } else {
                    lineEl.innerText = line.text;
                }

                contentEl.appendChild(lineEl);
            });
            
            console.log('[OK] Rendered', lyrics.lines.length, 'lines');
            console.log(' Final innerHTML length:', contentEl.innerHTML.length);
            console.log(' Children count:', contentEl.children.length);
            
            // Force visibility after render
            setTimeout(() => {
                contentEl.style.display = 'block';
                contentEl.style.visibility = 'visible';
                contentEl.style.opacity = '1';
                console.log(' Forced visibility after 100ms');
                console.log(' Display (after):', window.getComputedStyle(contentEl).display);
                console.log(' Visibility (after):', window.getComputedStyle(contentEl).visibility);
                console.log(' Opacity (after):', window.getComputedStyle(contentEl).opacity);
            }, 100);
        }

        function renderLyricsContent(lyrics) {
            const contentEl = document.getElementById('lyrics-content');
            contentEl.innerHTML = '';

            lyrics.lines.forEach((line, idx) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'lyrics-line';
                lineEl.id = `lyrics-line-${idx}`;
                lineEl.onclick = () => seekToLyricsTime(line.time);

                if (line.words && line.words.length > 0) {
                    line.words.forEach((word, wordIdx) => {
                        const wordEl = document.createElement('span');
                        wordEl.className = 'lyrics-word';
                        wordEl.id = `lyrics-word-${idx}-${wordIdx}`;
                        wordEl.innerText = word;
                        wordEl.style.cursor = 'pointer';
                        lineEl.appendChild(wordEl);
                    });
                } else {
                    lineEl.innerHTML = '&nbsp;';
                }

                contentEl.appendChild(lineEl);
            });
        }

        function startLyricsSync() {
            stopLyricsSync(); // Clear existing interval
            const song = songs[currentSongIndex];
            const lyrics = lyricsDatabase[song.title];
            
            if (!lyrics) return;

            lyricsState.syncInterval = setInterval(() => {
                if (!audio || !lyricsState.isOpen) return;

                const currentTime = audio.currentTime;
                updateActiveLyricLine(lyrics, currentTime);
                
                // Update timing display
                const timingEl = document.getElementById('lyrics-timing-info');
                if (timingEl) {
                    timingEl.innerText = `${currentTime.toFixed(1)}s`;
                }
                
                // Update offset display (untuk kedua elemen)
                const offsetText = lyricsState.timingOffset >= 0 
                    ? `Offset: +${lyricsState.timingOffset.toFixed(2)}s` 
                    : `Offset: ${lyricsState.timingOffset.toFixed(2)}s`;
                    
                const offsetEl = document.getElementById('lyrics-offset-display');
                if (offsetEl) {
                    offsetEl.innerText = offsetText;
                }
                
                const offsetLargeEl = document.getElementById('lyrics-offset-display-large');
                if (offsetLargeEl) {
                    offsetLargeEl.innerText = offsetText;
                }
            }, 100);
        }

        function stopLyricsSync() {
            if (lyricsState.syncInterval) {
                clearInterval(lyricsState.syncInterval);
                lyricsState.syncInterval = null;
            }
        }

        function updateActiveLyricLine(lyrics, currentTime) {
            // Find current line based on timing
            let currentLineIdx = -1;
            for (let i = 0; i < lyrics.lines.length; i++) {
                if (lyrics.lines[i].time <= currentTime) {
                    currentLineIdx = i;
                }
            }

            // Update active line in overlay if changed
            if (currentLineIdx !== lyricsState.currentLineIndex) {
                const prevLine = document.getElementById(`lyrics-line-${lyricsState.currentLineIndex}`);
                if (prevLine) prevLine.classList.remove('active', 'current-line');
                
                // Also update fullscreen lyrics page
                const prevPageLine = document.getElementById(`lyrics-page-line-${lyricsState.currentLineIndex}`);
                if (prevPageLine) prevPageLine.classList.remove('active', 'current-line');

                lyricsState.currentLineIndex = currentLineIdx;
                
                // Update overlay - scroll to center with smooth animation
                const currentLine = document.getElementById(`lyrics-line-${currentLineIdx}`);
                if (currentLine) {
                    currentLine.classList.add('active', 'current-line');
                    const overlayContainer = document.getElementById('overlay-lyrics-container');
                    if (overlayContainer) {
                        const lyricsText = overlayContainer.querySelector('.lyrics-text');
                        if (lyricsText) {
                            // Scroll line to center of visible area
                            const containerHeight = lyricsText.clientHeight;
                            const lineTop = currentLine.offsetTop;
                            const scrollTarget = lineTop - (containerHeight / 2) + (currentLine.offsetHeight / 2);
                            lyricsText.scrollTo({ top: scrollTarget, behavior: 'smooth' });
                        }
                    }
                }
                
                // Update fullscreen page
                const currentPageLine = document.getElementById(`lyrics-page-line-${currentLineIdx}`);
                if (currentPageLine) {
                    currentPageLine.classList.add('active', 'current-line');
                    // Scroll to center of the page
                    const lyricsPageContent = document.querySelector('#lyrics-overlay-container .lyrics-text');
                    if (lyricsPageContent) {
                        const offset = currentPageLine.offsetTop - (lyricsPageContent.clientHeight / 2) + (currentPageLine.offsetHeight / 2);
                        lyricsPageContent.scrollTo({ top: offset, behavior: 'smooth' });
                    }
                }
            }

            // Word-by-word highlighting based on exact timing
            const currentLine = lyrics.lines[currentLineIdx];
            if (currentLine && currentLine.words && currentLine.words.length > 0) {
                const nextLineTime = lyrics.lines[currentLineIdx + 1]?.time || currentTime + 5;
                const lineDuration = nextLineTime - currentLine.time;
                const wordDuration = lineDuration / currentLine.words.length;

                // Find which word should be highlighted based on current time
                const timeInLine = currentTime - currentLine.time;
                let highlightWordIdx = Math.floor(timeInLine / wordDuration);
                highlightWordIdx = Math.max(0, Math.min(highlightWordIdx, currentLine.words.length - 1));

                // Update word highlighting in overlay
                for (let i = 0; i < currentLine.words.length; i++) {
                    const wordEl = document.getElementById(`lyrics-word-${currentLineIdx}-${i}`);
                    if (wordEl) {
                        if (i === highlightWordIdx) {
                            wordEl.classList.add('active');
                        } else {
                            wordEl.classList.remove('active');
                        }
                    }
                    
                    // Also update fullscreen page
                    const pageWordEl = document.getElementById(`lyrics-page-word-${currentLineIdx}-${i}`);
                    if (pageWordEl) {
                        if (i === highlightWordIdx) {
                            pageWordEl.classList.add('active');
                        } else {
                            pageWordEl.classList.remove('active');
                        }
                    }
                }
            }
        }

        function seekToLyricsTime(time) {
            if (audio) {
                audio.currentTime = time;
                if (!isPlaying) {
                    window.playAudio();
                }
            }
        }

        function setupLyricsSwipe() {
            const container = document.getElementById('lyrics-swipe-container');
            const imageView = document.getElementById('lyrics-view-image');
            const textView = document.getElementById('lyrics-view-text');
            
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            container.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });

            container.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
            });

            container.addEventListener('touchend', () => {
                if (!isDragging) return;
                isDragging = false;

                const diffX = startX - currentX;
                const threshold = 50;

                if (diffX > threshold) {
                    // Swipe left - show lyrics
                    imageView.classList.add('swiped');
                    textView.classList.add('swiped');
                } else if (diffX < -threshold) {
                    // Swipe right - show image
                    imageView.classList.remove('swiped');
                    textView.classList.remove('swiped');
                }
            });

            // Also support mouse drag for desktop
            let isMouseDown = false;
            container.addEventListener('mousedown', (e) => {
                isMouseDown = true;
                startX = e.clientX;
            });

            container.addEventListener('mousemove', (e) => {
                if (!isMouseDown) return;
                currentX = e.clientX;
            });

            container.addEventListener('mouseup', () => {
                if (!isMouseDown) return;
                isMouseDown = false;

                const diffX = startX - currentX;
                const threshold = 50;

                if (diffX > threshold) {
                    imageView.classList.add('swiped');
                    textView.classList.add('swiped');
                } else if (diffX < -threshold) {
                    imageView.classList.remove('swiped');
                    textView.classList.remove('swiped');
                }
            });
        }

        function setupAlbumArtSwipe() {
            const overlayPlayer = document.getElementById('overlay-player');
            if (!overlayPlayer) return;

            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                setupMobileSwipeView();
            } else {
                setupDesktopParallaxSwipe();
            }
        }

        function setupMobileSwipeView() {
            const overlayPlayer = document.getElementById('overlay-player');
            if (!overlayPlayer) return;

            // State untuk swipe view
            let currentViewIndex = 0; // 0 = album, 1 = lyrics
            let startX = 0;
            let isDragging = false;
            const SWIPE_THRESHOLD = 50;

            const handleStart = (e) => {
                startX = e.touches ? e.touches[0].clientX : e.clientX;
                isDragging = true;
            };

            const handleEnd = (e) => {
                if (!isDragging) return;
                isDragging = false;

                const endX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                const diffX = endX - startX;
                const absDiffX = Math.abs(diffX);

                if (absDiffX > SWIPE_THRESHOLD) {
                    if (diffX > 0) {
                        // Swipe right = show album
                        currentViewIndex = 0;
                    } else {
                        // Swipe left = show lyrics
                        currentViewIndex = 1;
                    }
                    updateMobileView(currentViewIndex);
                }
            };

            overlayPlayer.addEventListener('touchstart', handleStart, false);
            overlayPlayer.addEventListener('touchend', handleEnd, false);
            overlayPlayer.addEventListener('mousedown', handleStart, false);
            overlayPlayer.addEventListener('mouseup', handleEnd, false);
        }

        function updateMobileView(viewIndex) {
            const artWrapper = document.getElementById('overlay-art-swipeable');
            const lyricsContainer = document.getElementById('overlay-lyrics-container');
            const progressContainer = document.getElementById('overlay-progress-container');
            const controls = document.querySelector('.overlay-controls');
            const infoSection = document.querySelector('div[style*="text-align: center; min-width"]');

            if (viewIndex === 0) {
                // Show Album View
                if (artWrapper) artWrapper.style.display = 'flex';
                if (infoSection) infoSection.style.display = 'block';
                if (lyricsContainer) lyricsContainer.style.display = 'none';
                if (progressContainer) progressContainer.style.display = 'none';
                if (controls) controls.style.display = 'none';
            } else {
                // Show Lyrics View
                if (artWrapper) artWrapper.style.display = 'none';
                if (infoSection) infoSection.style.display = 'none';
                if (lyricsContainer) lyricsContainer.style.display = 'flex';
                if (progressContainer) progressContainer.style.display = 'block';
                if (controls) controls.style.display = 'flex';
            }
        }

        function setupDesktopParallaxSwipe() {
            const artWrapper = document.getElementById('overlay-art-swipeable');
            if (!artWrapper) return;

            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            const handleStart = (e) => {
                startX = e.touches ? e.touches[0].clientX : e.clientX;
                isDragging = true;
                artWrapper.style.cursor = 'grabbing';
            };

            const handleMove = (e) => {
                if (!isDragging) return;
                currentX = e.touches ? e.touches[0].clientX : e.clientX;
                const diffX = currentX - startX;
                artWrapper.style.transform = `translateX(${diffX * 0.5}px)`;
            };

            const handleEnd = () => {
                if (!isDragging) return;
                isDragging = false;
                artWrapper.style.cursor = 'grab';
                artWrapper.style.transform = 'translateX(0)';
                artWrapper.style.transition = 'transform 0.3s ease-out';
                setTimeout(() => {
                    artWrapper.style.transition = '';
                }, 300);
            };

            // Touch events
            artWrapper.addEventListener('touchstart', handleStart);
            document.addEventListener('touchmove', handleMove);
            document.addEventListener('touchend', handleEnd);

            // Mouse events
            artWrapper.addEventListener('mousedown', handleStart);
            document.addEventListener('mousemove', handleMove);
            document.addEventListener('mouseup', handleEnd);
        }

        function openLyricsHelp() {
            document.getElementById('lyrics-help-overlay').classList.add('active');
            document.getElementById('lyrics-help-tooltip').classList.add('active');
        }

        function closeLyricsHelp() {
            document.getElementById('lyrics-help-overlay').classList.remove('active');
            document.getElementById('lyrics-help-tooltip').classList.remove('active');
        }

        window.openLyricsOverlay = openLyricsOverlay;
        window.closeLyricsOverlay = closeLyricsOverlay;
        window.openLyricsHelp = openLyricsHelp;
        window.closeLyricsHelp = closeLyricsHelp;
        window.setupAlbumArtSwipe = setupAlbumArtSwipe;
        window.renderOverlayLyricsContent = renderOverlayLyricsContent;

        // --- PLAY SCREEN FUNCTIONS (Mobile) ---
        function openPlayScreenUnified() {
            const screen = document.getElementById('play-screen-unified');
            if (!screen) return;

            const song = songs[currentSongIndex];
            if (!song) return;

            // Set background
            const bg = document.getElementById('play-screen-bg');
            if (bg && song.cover) {
                bg.style.backgroundImage = `url('${song.cover}')`;
            }

            // Set album art
            document.getElementById('play-screen-cover').src = song.cover;

            // Set song info
            document.getElementById('play-screen-song-title').textContent = song.title;
            document.getElementById('play-screen-song-artist').textContent = song.artist;
            document.getElementById('play-screen-lyrics-title').textContent = song.title;

            // Render lyrics
            const lyricsContainer = document.getElementById('play-screen-lyrics-container');
            const lyrics = lyricsDatabase[song.title];
            if (lyrics && lyrics.lines) {
                lyricsContainer.innerHTML = lyrics.lines.map((line, idx) => 
                    `<div class="play-screen-lyric-line" data-idx="${idx}" data-time="${line.time || 0}" onclick="playScreenSeekToLyric(event)" onmousedown="startPlayScreenLyricDrag(event)" ontouchstart="startPlayScreenLyricDrag(event)">${line.text}</div>`
                ).join('');
            } else {
                lyricsContainer.innerHTML = '<div class="play-screen-lyric-line">Lirik tidak tersedia</div>';
            }

            // Hide lyrics overlay saat desktop play screen dibuka
            const lyricsOverlay = document.getElementById('lyrics-overlay-container');
            if (lyricsOverlay && window.innerWidth >= 769) {
                lyricsOverlay.classList.add('hide-for-playscreen');
                lyricsOverlay.style.display = 'none';
                lyricsOverlay.style.visibility = 'hidden';
                lyricsOverlay.style.zIndex = '-10000';
            }

            screen.classList.add('active');
            playScreenState.isOpen = true;
            setupPlayScreenLyricsScrollTracking();
            startPlayScreenSync();
        }

        function closePlayScreenUnified() {
            const screen = document.getElementById('play-screen-unified');
            if (screen) screen.classList.remove('active');
            playScreenState.isOpen = false;
            stopPlayScreenSync();

            // Restore lyrics overlay
            const lyricsOverlay = document.getElementById('lyrics-overlay-container');
            if (lyricsOverlay && window.innerWidth >= 769) {
                lyricsOverlay.classList.remove('hide-for-playscreen');
                lyricsOverlay.style.display = '';
                lyricsOverlay.style.visibility = '';
                lyricsOverlay.style.zIndex = '';
            }
        }

        function toggleDesktopLyrics() {
            const scrollContainer = document.getElementById('play-screen-scroll');
            const lyricsScreen = document.getElementById('play-screen-lyrics');
            const icon = document.getElementById('lyrics-toggle-icon');
            
            if (scrollContainer.classList.contains('lyrics-visible')) {
                scrollContainer.classList.remove('lyrics-visible');
                lyricsScreen.classList.remove('show');
                icon.className = 'ph-fill ph-caret-right';
            } else {
                scrollContainer.classList.add('lyrics-visible');
                lyricsScreen.classList.add('show');
                icon.className = 'ph-fill ph-caret-left';
            }
        }

        function playScreenTogglePlay() {
            if (isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

        function playScreenSeek(event) {
            const bar = event.currentTarget;
            const rect = bar.getBoundingClientRect();
            const x = event.clientX || event.touches?.[0].clientX || 0;
            const percent = (x - rect.left) / rect.width;
            const newTime = percent * audio.duration;
            audio.currentTime = Math.max(0, Math.min(newTime, audio.duration));
            if (!isPlaying) playAudio();
        }

        // Track if play screen progress bar is being dragged
        let isPlayScreenProgressDragging = false;

        function startPlayScreenProgressDrag(event) {
            isPlayScreenProgressDragging = true;
            playScreenSeek(event);
        }

        function updatePlayScreenProgressDrag(event) {
            if (!isPlayScreenProgressDragging) return;
            playScreenSeek(event);
        }

        function stopPlayScreenProgressDrag() {
            isPlayScreenProgressDragging = false;
        }

        // Add drag listeners to progress bars on open
        function setupProgressDragListeners() {
            const bars = document.querySelectorAll('[data-progress-bar]');
            bars.forEach(bar => {
                bar.addEventListener('mousedown', startProgressDrag);
                bar.addEventListener('touchstart', startProgressDrag);
            });
        }

        function playScreenSeekToLyric(event) {
            const lyricLine = event.currentTarget;
            const time = parseFloat(lyricLine.dataset.time) || 0;
            audio.currentTime = time;
            if (!isPlaying) playAudio();
        }

        // Track if lyric line is being dragged for seeking
        let isPlayScreenLyricDragging = false;

        function startPlayScreenLyricDrag(event) {
            // Prevent triggering click event if it's a drag
            isPlayScreenLyricDragging = true;
            const lyricLine = event.currentTarget;
            const time = parseFloat(lyricLine.dataset.time) || 0;
            audio.currentTime = time;
            if (!isPlaying) playAudio();
        }

        function stopPlayScreenLyricDrag() {
            isPlayScreenLyricDragging = false;
        }

        let playScreenState = {
            isOpen: false,
            lyricsDb: {},
            syncInterval: null
        };

        function startPlayScreenSync() {
            if (playScreenState.syncInterval) clearInterval(playScreenState.syncInterval);
            playScreenState.syncInterval = setInterval(() => {
                updatePlayScreenProgress();
                updatePlayScreenLyricsSync();
                updatePlayScreenControlStates();
            }, 100);
        }

        function stopPlayScreenSync() {
            if (playScreenState.syncInterval) clearInterval(playScreenState.syncInterval);
        }

        function updatePlayScreenProgress() {
            const currentTime = audio.currentTime || 0;
            const duration = audio.duration || 0;
            const percent = duration ? (currentTime / duration) * 100 : 0;

            document.getElementById('play-screen-progress').style.width = percent + '%';
            document.getElementById('play-screen-lyrics-progress').style.width = percent + '%';
            document.getElementById('play-screen-time-current').textContent = formatTime(currentTime);
            document.getElementById('play-screen-time-total').textContent = formatTime(duration);
            document.getElementById('play-screen-lyrics-time-current').textContent = formatTime(currentTime);
            document.getElementById('play-screen-lyrics-time-total').textContent = formatTime(duration);
        }

        // Track if user is manually scrolling lyrics
        let isPlayScreenLyricsManualScroll = false;
        let playScreenLyricsScrollTimeout = null;

        function smoothScrollLyricIntoView(element, container) {
            if (!element || !container) return;
            
            const elementRect = element.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // Only scroll if element is out of view
            if (elementRect.top >= containerRect.top && elementRect.bottom <= containerRect.bottom) {
                return; // Element already in view
            }
            
            // Calculate scroll position smoothly without aggressive lock
            const scrollTop = container.scrollTop;
            const elementOffsetTop = element.offsetTop;
            const targetScroll = elementOffsetTop - (container.clientHeight / 2) + (element.clientHeight / 2);
            
            // Smooth scroll dengan duration 300ms
            const startTime = performance.now();
            const duration = 300;
            
            function animateScroll(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function untuk smooth scroll
                const easeProgress = progress < 0.5 ? 2 * progress * progress : -1 + (4 - 2 * progress) * progress;
                const newScrollTop = scrollTop + (targetScroll - scrollTop) * easeProgress;
                
                container.scrollTop = newScrollTop;
                
                if (progress < 1) {
                    requestAnimationFrame(animateScroll);
                }
            }
            
            requestAnimationFrame(animateScroll);
        }

        function updatePlayScreenLyricsSync() {
            const song = songs[currentSongIndex];
            if (!song) return;

            const lyrics = lyricsDatabase[song.title];
            if (!lyrics || !lyrics.lines) return;

            const currentTime = audio.currentTime || 0;
            const container = document.getElementById('play-screen-lyrics-container');
            const lines = container.querySelectorAll('.play-screen-lyric-line');

            let currentLineIdx = -1;
            for (let i = 0; i < lyrics.lines.length; i++) {
                if (lyrics.lines[i].time <= currentTime) {
                    currentLineIdx = i;
                }
            }

            lines.forEach((line, idx) => {
                line.classList.remove('active');
                if (idx === currentLineIdx) {
                    line.classList.add('active');
                    // Only smooth scroll on DESKTOP if user is NOT manually scrolling
                    // Mobile uses flex-start natural scrolling, no auto-scroll needed
                    const isDesktop = window.innerWidth >= 769;
                    if (!isPlayScreenLyricsManualScroll && isDesktop) {
                        smoothScrollLyricIntoView(line, container);
                    }
                }
            });
        }

        // Setup lyrics container scroll tracking
        function setupPlayScreenLyricsScrollTracking() {
            const container = document.getElementById('play-screen-lyrics-container');
            if (!container) return;

            container.addEventListener('scroll', () => {
                isPlayScreenLyricsManualScroll = true;
                clearTimeout(playScreenLyricsScrollTimeout);
                // Reset manual scroll flag after 2 seconds of no scroll
                playScreenLyricsScrollTimeout = setTimeout(() => {
                    isPlayScreenLyricsManualScroll = false;
                }, 2000);
            });
        }

        function updatePlayScreenControlStates() {
            const shuffleBtn = document.getElementById('ps-shuffle');
            const repeatBtn = document.getElementById('ps-repeat');
            const playBtn = document.getElementById('ps-play');
            const playBtnLyrics = document.getElementById('ps-play-lyrics');

            if (shuffleBtn) shuffleBtn.style.color = isShuffle ? '#e50914' : 'rgba(255,255,255,0.7)';
            if (repeatBtn) repeatBtn.style.color = repeatMode > 0 ? '#e50914' : 'rgba(255,255,255,0.7)';
            
            if (isPlaying) {
                if (playBtn) playBtn.innerHTML = '<i class="ph-fill ph-pause"></i>';
                if (playBtnLyrics) playBtnLyrics.innerHTML = '<i class="ph-fill ph-pause"></i>';
            } else {
                if (playBtn) playBtn.innerHTML = '<i class="ph-fill ph-play"></i>';
                if (playBtnLyrics) playBtnLyrics.innerHTML = '<i class="ph-fill ph-play"></i>';
            }
        }

        // --- ART OVERLAY FUNCTIONS ---
        function openArtOverlay() {
            if (!songs[currentSongIndex]) return;
            
            // Close lirik fullscreen page jika ada sebelum buka art overlay
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            if (lyricsContainer) lyricsContainer.classList.remove('active');
            
            const s = songs[currentSongIndex];
            const artBg = document.getElementById('art-overlay-bg');
            const artImg = document.getElementById('art-overlay-image');
            const artTitle = document.getElementById('art-overlay-title');
            const artArtist = document.getElementById('art-overlay-artist');

            // Set art image and info
            if (artImg) artImg.src = s.cover || '';
            if (artTitle) artTitle.innerText = s.title || '';
            if (artArtist) artArtist.innerText = s.artist || '';
            if (artBg && s.cover) artBg.style.backgroundImage = `url('${s.cover}')`;

            // Reset visibility dan pointer events sebelum buka
            const artContainer = document.getElementById('art-overlay-container');
            if (artContainer) {
                artContainer.style.visibility = 'visible';
                artContainer.style.opacity = '1';
                artContainer.style.pointerEvents = 'auto';
                artContainer.classList.add('active');
            }
            
            // Render lirik di overlay
            let lyrics = lyricsDatabase && lyricsDatabase[s.title] ? lyricsDatabase[s.title] : null;
            
            console.log('[DEBUG] Looking for lyrics for:', s.title);
            console.log('[DATA] lyricsDatabase has it?', !!lyrics);
            console.log('[MUSIC] window.currentPerungguLyrics exists?', !!window.currentPerungguLyrics);
            
            // Check for Perunggu lyrics if not found in lyricsDatabase
            if (!lyrics && window.currentPerungguLyrics) {
                console.log('[OK] Using Perunggu lyrics from window.currentPerungguLyrics');
                console.log('[RESULT] Perunggu lyrics data:', window.currentPerungguLyrics);
                lyrics = window.currentPerungguLyrics;
            }
            
            console.log('[UI] Opening art overlay for:', s.title, 'Lyrics found:', !!lyrics);
            if (lyrics && lyrics.lines) {
                console.log(' Number of lyrics lines:', lyrics.lines.length);
            }
            renderArtLyricsContent(lyrics);
        }

        function closeArtOverlay() {
            // Force close SEMUA overlay
            const artContainer = document.getElementById('art-overlay-container');
            const artBg = document.getElementById('art-overlay-bg');
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            const overlayPlayer = document.getElementById('overlay-player');
            const artLyricsWrapper = document.getElementById('art-lyrics-wrapper');
            const artMain = document.getElementById('art-main');
            
            // Clear background image
            if (artBg) artBg.style.backgroundImage = '';
            
            // Force close ART overlay
            if (artContainer) {
                artContainer.classList.remove('active');
                artContainer.style.visibility = 'hidden';
                artContainer.style.opacity = '0';
                artContainer.style.pointerEvents = 'none';
            }
            
            // Force close LYRICS overlay
            if (lyricsContainer) {
                lyricsContainer.classList.remove('active');
                lyricsContainer.style.display = 'none';
                lyricsContainer.style.visibility = 'hidden';
                lyricsContainer.style.opacity = '0';
                lyricsContainer.style.pointerEvents = 'none';
            }
            
            // Force close OVERLAY PLAYER (side panel)
            if (overlayPlayer) {
                overlayPlayer.classList.remove('active');
                overlayPlayer.style.display = 'none';
                overlayPlayer.style.visibility = 'hidden';
            }
            
            // Reset art-lyrics-wrapper
            if (artLyricsWrapper) {
                artLyricsWrapper.classList.remove('active');
                artLyricsWrapper.style.display = 'none';
            }
            
            // Double-check setelah 50ms
            setTimeout(function() {
                if (artContainer) {
                    artContainer.classList.remove('active');
                    artContainer.style.visibility = 'hidden';
                    artContainer.style.opacity = '0';
                    artContainer.style.pointerEvents = 'none';
                }
                if (lyricsContainer) {
                    lyricsContainer.classList.remove('active');
                    lyricsContainer.style.display = 'none';
                    lyricsContainer.style.visibility = 'hidden';
                    lyricsContainer.style.opacity = '0';
                    lyricsContainer.style.pointerEvents = 'none';
                }
            }, 50);
        }

        window.closeArtOverlay = closeArtOverlay;

        function closeLyricsPage() {
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            if (lyricsContainer) {
                lyricsContainer.classList.remove('active');
                // Double-check
                setTimeout(function() {
                    if (lyricsContainer && lyricsContainer.classList.contains('active')) {
                        lyricsContainer.classList.remove('active');
                    }
                }, 50);
            }
        }

        function goHome() {
            // Close semua overlay dan kembali ke home
            const artContainer = document.getElementById('art-overlay-container');
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            const overlayPlayer = document.getElementById('overlay-player');
            
            if (artContainer) artContainer.classList.remove('active');
            if (lyricsContainer) lyricsContainer.classList.remove('active');
            if (overlayPlayer) overlayPlayer.classList.remove('active');
            
            // Double-check
            setTimeout(function() {
                if (artContainer && artContainer.classList.contains('active')) artContainer.classList.remove('active');
                if (lyricsContainer && lyricsContainer.classList.contains('active')) lyricsContainer.classList.remove('active');
            }, 50);
        }

        window.openArtOverlay = openArtOverlay;
        window.closeArtOverlay = closeArtOverlay;
        window.closeLyricsPage = closeLyricsPage;
        window.goHome = goHome;

        // Update art overlay progress bar saat audio play
        audio.addEventListener('timeupdate', function() {
            const artProgressFill = document.getElementById('art-progress-fill');
            const artCurrentTime = document.getElementById('art-current-time');
            const artTotalTime = document.getElementById('art-total-time');
            
            if (artProgressFill && !isNaN(audio.duration)) {
                const percent = (audio.currentTime / audio.duration) * 100;
                artProgressFill.style.width = percent + '%';
            }
            
            // Format time helper
            const formatTimeStr = (secs) => {
                if (isNaN(secs)) return '0:00';
                const mins = Math.floor(secs / 60);
                const seconds = Math.floor(secs % 60);
                return `${mins}:${seconds.toString().padStart(2, '0')}`;
            };
            
            if (artCurrentTime) artCurrentTime.innerText = formatTimeStr(audio.currentTime);
            if (artTotalTime) artTotalTime.innerText = formatTimeStr(audio.duration);
            
            // Update current line highlight di lyrics
            if (document.getElementById('art-lyrics-wrapper').style.display !== 'none') {
                updateArtLyricsHighlight();
            }
            
            // Update NEW overlay progress bar (even if overlay is closed)
            if (typeof updateNewProgress === 'function') {
                updateNewProgress();
            }
        });

        function openLyricsFromFooter() {
            // Close art overlay first if open
            const artOverlay = document.getElementById('art-overlay-container');
            if (artOverlay && artOverlay.classList.contains('active')) {
                closeArtOverlay();
            }

            if (!songs[currentSongIndex]) return;

            // Prepare lyrics content
            if (typeof openLyricsOverlay === 'function') {
                openLyricsOverlay();
            }

            // Ensure fullscreen lyrics page is visible
            const overlayPlayer = document.getElementById('overlay-player');
            const lyricsContainer = document.getElementById('lyrics-overlay-container');
            if (overlayPlayer) overlayPlayer.classList.remove('active');
            if (lyricsContainer) lyricsContainer.classList.add('active');

            syncLyricsWithMusic();
        }

        window.openLyricsFromFooter = openLyricsFromFooter;

        function renderArtLyricsContent(lyrics) {
            const contentEl = document.getElementById('art-lyrics-content');
            if (!contentEl) {
                console.error('art-lyrics-content element not found');
                return;
            }
            contentEl.innerHTML = '';
            if (!lyrics || !lyrics.lines) {
                console.warn('No lyrics available');
                contentEl.innerHTML = '<p style="color:#b5b5b5; padding:28px 0; text-align:center;">Lirik tidak tersedia untuk lagu ini</p>';
                return;
            }
            
            console.log('Rendering', lyrics.lines.length, 'lyric lines');
            lyrics.lines.forEach((line, idx) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'lyrics-line';
                lineEl.id = `art-lyrics-line-${idx}`;
                lineEl.onclick = () => seekToLyricsTime(line.time);
                lineEl.style.padding = '12px 0';
                lineEl.style.cursor = 'pointer';
                
                // Use text property, fallback to empty string
                const text = (line.words && line.words.length > 0) 
                    ? line.words.map(w => w.text || w).join(' ')
                    : (line.text || '');
                
                lineEl.innerText = text;
                contentEl.appendChild(lineEl);
            });
            
            console.log('Rendered', contentEl.children.length, 'lines to DOM');
        }

        function updateArtLyricsHighlight() {
            const s = songs[currentSongIndex];
            if (!s) return;
            const lyrics = lyricsDatabase && lyricsDatabase[s.title] ? lyricsDatabase[s.title] : null;
            if (!lyrics) return;
            
            const lines = document.querySelectorAll('.art-lyrics-wrapper .lyrics-line');
            let currentIdx = -1;
            
            // Find current line based on audio time
            for (let i = 0; i < lyrics.lines.length; i++) {
                if (audio.currentTime >= lyrics.lines[i].time) {
                    currentIdx = i;
                } else {
                    break;
                }
            }
            
            // Update all lines
            lines.forEach((lineEl, idx) => {
                if (idx === currentIdx) {
                    lineEl.classList.add('current-line');
                } else {
                    lineEl.classList.remove('current-line');
                }
            });
            
            // Auto-scroll to current line
            if (currentIdx >= 0 && currentIdx < lines.length) {
                const currentLine = lines[currentIdx];
                const container = document.getElementById('art-lyrics-scroll');
                if (container) {
                    const containerCenter = container.offsetHeight / 2;
                    const lineCenter = currentLine.offsetTop + currentLine.offsetHeight / 2;
                    container.scrollTop = lineCenter - containerCenter;
                }
            }
        }

        function toggleArtLyricsView(view) {
            const artMain = document.getElementById('art-main');
            const artLyrics = document.getElementById('art-lyrics-wrapper');
            const btns = document.querySelectorAll('.art-toggle-btn');
            btns.forEach(b => b.classList.remove('active'));
            if (view === 'lyrics') {
                const lyricsBtn = document.querySelector('.art-toggle-btn[data-view="lyrics"]');
                if (lyricsBtn) lyricsBtn.classList.add('active');
                if (artMain) artMain.classList.add('hidden');
                if (artLyrics) { artLyrics.style.display = 'flex'; setTimeout(() => artLyrics.classList.add('active'), 20); }
                // Render lyrics into art view
                const song = songs[currentSongIndex];
                const lyrics = song ? lyricsDatabase[song.title] : null;
                renderArtLyricsContent(lyrics);
            } else {
                const artBtn = document.querySelector('.art-toggle-btn[data-view="art"]');
                if (artBtn) artBtn.classList.add('active');
                if (artLyrics) { artLyrics.classList.remove('active'); setTimeout(() => { artLyrics.style.display = 'none'; }, 220); }
                if (artMain) artMain.classList.remove('hidden');
            }
        }

        // If overlay art is open and user taps Lirik from player, switch inside art overlay
        const originalOpenLyricsOverlay = window.openLyricsOverlay;
        function openLyricsOverlayWrapper() {
            const artOverlay = document.getElementById('art-overlay-container');
            if (artOverlay && artOverlay.classList.contains('active')) {
                // just switch art overlay to lyrics view
                toggleArtLyricsView('lyrics');
                return;
            }
            originalOpenLyricsOverlay();
        }
        window.openLyricsOverlay = openLyricsOverlayWrapper;

        // Player bar click listener REMOVED - only buttons work now

        // Seek handler for art progress
        const artProg = document.getElementById('art-progress-container');
        if (artProg) {
            artProg.addEventListener('click', (e) => {
                const w = e.currentTarget.clientWidth;
                const x = e.offsetX;
                audio.currentTime = (x / w) * audio.duration;
            });
        }
       // Ganti seluruh fungsi openArtistBandOverlay (sekitar line 2400-2500)
function openArtistBandOverlay(artistData, songsList) {
    // Check if desktop (min-width 769px)
    if (window.innerWidth < 769) {
        // Switch to the regular view on mobile
        window.switchView(artistData.viewId);
        return;
    }

    //  CRITICAL DEBUG: Check what's being passed
    console.log('%c===== CRITICAL DEBUG =====', 'background: red; color: white; font-weight: bold; font-size: 14px;');
    console.log('Artist:', artistData.name);
    console.log('songsList param length:', songsList.length);
    console.log('songsList[0]:', songsList[0]);
    console.log('songsList[songsList.length-1]:', songsList[songsList.length-1]);
    console.log('Global songs.length:', songs.length);
    console.log('Global songs[0]:', songs[0]);
    console.log('Global songs[29]:', songs[29]);
    console.log('Global songs[30]:', songs[30]);
    console.log('%c=====  =====', 'background: red; color: white; font-weight: bold; font-size: 14px;');

    //  DEKLARASI OVERLAY DI AWAL
    const overlay = document.getElementById('artist-band-profile-overlay');
    
    document.getElementById('artist-band-overlay-title').innerText = artistData.name;
    document.getElementById('artist-band-overlay-name').innerText = artistData.name;
    document.getElementById('artist-band-overlay-category').innerText = artistData.category;
    document.getElementById('artist-band-overlay-cover').src = artistData.cover;
    document.getElementById('artist-band-overlay-song-count').innerText = songsList.length;
    document.getElementById('artist-band-overlay-description').innerText = artistData.description || '';

    // Render songs - SIMPLE APPROACH FIRST
    const songsContainer = document.getElementById('artist-band-overlay-songs');
    songsContainer.innerHTML = '';
    
    songsList.forEach((song, index) => {
        console.log(`Rendering song ${index}:`, song);
        const songEl = document.createElement('div');
        songEl.className = 'artist-band-song-item';
        songEl.id = `overlay-song-${song.id}`;
        
        //  SIMPLE RENDER - use song directly without reconstruction
        songEl.innerHTML = `
            <div class="artist-band-song-index">
                <span class="index-num">${index + 1}</span>
                <div class="playing-icon-container" style="display:none;">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>
            </div>
            <div class="artist-band-song-info">
                <img src="${song.cover || ''}" class="artist-band-song-cover" alt="${song.title}">
                <div style="flex: 1; overflow: hidden; min-width: 0;">
                    <div class="artist-band-song-title">${song.title}</div>
                    <div class="artist-band-song-artist">${song.artist}</div>
                </div>
            </div>
            <div class="artist-band-song-album">${song.album || ''}</div>
            <div class="artist-band-song-duration">${song.duration || '0:00'}</div>
            <div style="display: flex; gap: 8px; justify-content: flex-end; padding-right: 8px; align-items: center;">
                <button class="overlay-like-btn ${likedSongs && likedSongs.includes(song.id) ? 'liked' : ''}" onclick="event.stopPropagation(); window.toggleLike(${song.id})" id="overlay-like-${song.id}" style="background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 18px; transition: 0.2s;">
                    <i class="${likedSongs && likedSongs.includes(song.id) ? 'ph-fill ph-heart' : 'ph ph-heart'}"></i>
                </button>
                <button onclick="event.stopPropagation(); window.openShareModal('song', ${song.id})" style="background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 18px; transition: 0.2s;">
                    <i class="ph ph-share-network"></i>
                </button>
                <button onclick="event.stopPropagation(); window.addToQueue(${song.id})" style="background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 18px; transition: 0.2s;" title="Tambah Antrian">
                    <i class="ph ph-list-plus"></i>
                </button>
                <button onclick="event.stopPropagation(); window.openAddSongModal(${song.id})" style="background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 18px; transition: 0.2s;" title="Tambah ke Playlist">
                    <i class="ph ph-plus"></i>
                </button>
            </div>
        `;
        
        songEl.style.cursor = 'pointer';
        songEl.addEventListener('click', () => {
            console.log('[MUSIC] Clicked song:', song.id, song.title);
            const track = songs.find(s => s.id === song.id);
            if (track) {
                console.log('[OK] Found in global array:', track.title, 'by', track.artist);
                window.loadSong(track);
                window.window.playAudio();
            } else {
                console.error('[ERROR] NOT FOUND in global array!', song.id);
            }
            
            // Update visualizer
            document.querySelectorAll('.artist-band-song-item').forEach(el => {
                el.classList.remove('playing');
                const eq = el.querySelector('.playing-icon-container');
                const num = el.querySelector('.index-num');
                if(eq) eq.style.display = 'none';
                if(num) num.style.display = 'block';
            });
            
            songEl.classList.add('playing');
            const eq = songEl.querySelector('.playing-icon-container');
            const num = songEl.querySelector('.index-num');
            if(eq) {
                eq.style.display = 'flex';
                eq.style.animationPlayState = 'running';
            }
            if(num) num.style.display = 'none';
        });
        songsContainer.appendChild(songEl);
    });

    overlay.classList.add('active');
    
    //  SYNC VISUALIZER JIKA LAGU SEDANG DIPUTAR
    setTimeout(() => {
        const currentSong = songs[currentSongIndex];
        if(currentSong) {
            const activeOverlayRow = document.getElementById(`overlay-song-${currentSong.id}`);
            if(activeOverlayRow) {
                activeOverlayRow.classList.add('playing');
                const eq = activeOverlayRow.querySelector('.playing-icon-container');
                const num = activeOverlayRow.querySelector('.index-num');
                if(eq) {
                    eq.style.display = 'flex';
                    eq.style.animationPlayState = isPlaying ? 'running' : 'paused';
                }
                if(num) num.style.display = 'none';
            }
        }
    }, 100);
}

        function closeArtistBandOverlay() {
            document.getElementById('artist-band-profile-overlay').classList.remove('active');
        }

        window.openArtistBandOverlay = openArtistBandOverlay;
        window.closeArtistBandOverlay = closeArtistBandOverlay;

        // Add click-outside to close artist-band overlay
        document.getElementById('artist-band-profile-overlay').addEventListener('click', (e) => {
            // Close only if clicking on the overlay itself (not content inside)
            if (e.target.id === 'artist-band-profile-overlay') {
                window.closeArtistBandOverlay();
            }
        });

        // Player Bar Click to Open Overlay
        // Hide playbar initially if no song was previously loaded
        function initializePlaybarVisibility() {
            const playerBar = document.querySelector('.player-bar');
            
            // Check if we have a song to restore
            if (window.songToRestoreOnLoad) {
                loadSong(window.songToRestoreOnLoad);
                // Don't auto-show here, let loadSong handle it with 'active' class
                window.songToRestoreOnLoad = null; // Clear for next time
            }
            // Player stays hidden until user selects a song
        }
        // Initialize playbar visibility immediately (songs array is now loaded)
        // initializePlaybarVisibility(); // DISABLED - no auto-restore on page load
        

        // Main Player Progress Bar Click - for background skip
        const playerProgressBarWrapper = document.getElementById('player-progress-bar-wrapper');
        const progressTimeTooltip = document.getElementById('progress-time-tooltip');
        
        if (playerProgressBarWrapper) {
            // Format waktu dari detik ke mm:ss
            function formatTime(seconds) {
                if (isNaN(seconds)) return '00:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // Helper function untuk get audio element (with fallback)
            function getAudio() {
                return document.getElementById('audio-player') || (window.audio);
            }
            
            // Show tooltip saat mouse move
            playerProgressBarWrapper.addEventListener('mousemove', (e) => {
                if (!audio.duration) return;
                
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const width = rect.width;
                const time = (x / width) * audio.duration;
                
                // Update tooltip position dan text
                progressTimeTooltip.textContent = formatTime(time);
                progressTimeTooltip.style.left = (rect.left + x) + 'px';
                progressTimeTooltip.style.top = (rect.top - 35) + 'px';
                progressTimeTooltip.style.transform = 'translateX(-50%)';
                progressTimeTooltip.style.display = 'block';
            });
            
            // Show tooltip saat enter
            playerProgressBarWrapper.addEventListener('mouseenter', () => {
                if (audio.duration) {
                    progressTimeTooltip.style.display = 'block';
                }
            });
            
            // Handle mouse drag & click untuk skip di desktop
            let isMouseDragging = false;
            let dragStartX = 0;
            
            playerProgressBarWrapper.addEventListener('mousedown', (e) => {
                isMouseDragging = true;
                dragStartX = e.clientX;
                playerProgressBarWrapper.classList.add('dragging');
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isMouseDragging || !playerProgressBarWrapper || !audio.duration) return;
                
                const rect = playerProgressBarWrapper.getBoundingClientRect();
                
                // Cek apakah mouse masih di atas progress bar
                if (e.clientY >= rect.top && e.clientY <= rect.bottom && 
                    e.clientX >= rect.left && e.clientX <= rect.right) {
                    
                    const x = e.clientX - rect.left;
                    const width = rect.width;
                    const time = (x / width) * audio.duration;
                    
                    progressTimeTooltip.textContent = formatTime(time);
                    progressTimeTooltip.style.left = (rect.left + x) + 'px';
                    progressTimeTooltip.style.top = (rect.top - 45) + 'px';
                    progressTimeTooltip.style.transform = 'translateX(-50%)';
                    progressTimeTooltip.style.display = 'block';
                }
            });
            
            document.addEventListener('mouseup', (e) => {
                if (!isMouseDragging || !playerProgressBarWrapper || !audio.duration) {
                    isMouseDragging = false;
                    playerProgressBarWrapper.classList.remove('dragging');
                    return;
                }
                
                const rect = playerProgressBarWrapper.getBoundingClientRect();
                
                // Hanya skip jika release di atas progress bar
                if (e.clientY >= rect.top && e.clientY <= rect.bottom && 
                    e.clientX >= rect.left && e.clientX <= rect.right) {
                    
                    const x = e.clientX - rect.left;
                    const width = rect.width;
                    audio.currentTime = (x / width) * audio.duration;
                    console.log(' Skipped via mouse drag to', audio.currentTime);
                }
                
                isMouseDragging = false;
                playerProgressBarWrapper.classList.remove('dragging');
                progressTimeTooltip.style.display = 'none';
            });
            
            // Hide tooltip saat leave
            playerProgressBarWrapper.addEventListener('mouseleave', () => {
                progressTimeTooltip.style.display = 'none';
            });
            
            // Handle click untuk simple skip (tanpa drag)
            playerProgressBarWrapper.addEventListener('click', (e) => {
                const audio = getAudio();
                if (!audio || !audio.duration || isMouseDragging) return;
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const width = rect.width;
                audio.currentTime = (x / width) * audio.duration;
                console.log(' Skipped via progress bar click to', audio.currentTime);
            });
            
            // Handle touch untuk mobile drag
            let isTouching = false;
            playerProgressBarWrapper.addEventListener('touchstart', () => {
                isTouching = true;
                progressTimeTooltip.style.display = 'block';
                playerProgressBarWrapper.classList.add('dragging');
            });
            
            playerProgressBarWrapper.addEventListener('touchmove', (e) => {
                if (!audio.duration || !isTouching) return;
                
                const rect = e.currentTarget.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const width = rect.width;
                const time = (x / width) * audio.duration;
                
                progressTimeTooltip.textContent = formatTime(time);
                progressTimeTooltip.style.left = (rect.left + x) + 'px';
                progressTimeTooltip.style.top = (rect.top - 45) + 'px';
                progressTimeTooltip.style.transform = 'translateX(-50%)';
                progressTimeTooltip.style.display = 'block';
            });
            
            playerProgressBarWrapper.addEventListener('touchend', (e) => {
                if (!audio.duration) return;
                
                const rect = e.currentTarget.getBoundingClientRect();
                const touch = e.changedTouches[0];
                const x = touch.clientX - rect.left;
                const width = rect.width;
                audio.currentTime = (x / width) * audio.duration;
                
                isTouching = false;
                playerProgressBarWrapper.classList.remove('dragging');
                progressTimeTooltip.style.display = 'none';
                console.log(' Skipped via touch to', audio.currentTime);
            });
        }

        // Update Main Player Progress Bar
        audio.addEventListener('timeupdate', () => {
            const playerProgressFill = document.getElementById('player-progress-fill');
            if (playerProgressFill && !isNaN(audio.duration)) {
                const percent = (audio.currentTime / audio.duration) * 100;
                playerProgressFill.style.width = percent + '%';
            }
        });

        // Overlay Progress Bar Click
        document.getElementById('overlay-progress-container').addEventListener('click', (e) => {
            const container = e.currentTarget;
            const rect = container.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const width = rect.width;
            audio.currentTime = (x / width) * audio.duration;
        });

        function loadSong(song) {
    //  PERBAIKAN: Update semua elemen UI dengan data lagu yang benar
    
    const newSrc = song.audioUrl || song.audio_url || song.src;
    const currentSrc = audio.src;
    
    // 2. Update Audio Source with proper initialization
    // Only reload if source changed
    if (currentSrc !== newSrc) {
        console.log(' Loading new audio source');
        audio.src = newSrc;
        audio.load(); // Preload the audio file
        audio.preload = 'auto'; // Enable automatic prefetching
        
        // Resume audio context if suspended (for background playback)
        if (isPlaying) {
            audio.play().catch(err => console.warn('Auto-play failed:', err));
        }
    } else {
        console.log(' Same audio source, skipping reload');
        // Don't reload, just ensure playback state is correct
        if (isPlaying && audio.paused) {
            audio.play().catch(err => console.warn('Resume failed:', err));
        }
    }

    
    //  VIDJE TRACKING: Track song play
    if (window.vidjeTracking && typeof window.vidjeTracking.trackSongPlay === 'function') {
        window.vidjeTracking.trackSongPlay({
            song_name: song.title,
            artist_name: song.artist,
            cover_url: song.cover || null,
            duration: 0 // Will be calculated from audio duration
        }).then(record => {
            console.log('[OK] Song tracked:', song.title);
        }).catch(err => {
            console.error('[ERROR] Tracking failed:', err);
        });
    }
    
    // Stop lyrics sync when changing song
    if (lyricsState.syncInterval) {
        stopLyricsSync();
        lyricsState.currentLineIndex = 0;
    }
    
    // Load lyrics for Perunggu songs if available
    if (typeof updateLyricsDisplay === 'function') {
        console.log('[MUSIC] Calling updateLyricsDisplay with song ID:', song.id, 'Type:', typeof song.id);
        updateLyricsDisplay(song.id);
    } else {
        console.log(' updateLyricsDisplay function not found');
    }
    
    // Save song to localStorage for persistence (DUAL SAVE for reliability)
    localStorage.setItem('currentSongId', song.id);
    localStorage.setItem('currentSongPaused', !isPlaying);
    
    // CRITICAL: Save comprehensive playback state with full song data
    const playbackState = {
        songIndex: songs.indexOf(song),
        songId: song.id,
        songTitle: song.title,
        songArtist: song.artist,
        songAlbum: song.album,
        songCover: song.cover,
        songUrl: newSrc,
        currentTime: 0,
        isPlaying: isPlaying,
        timestamp: Date.now()
    };
    localStorage.setItem('vidjePlaybackState', JSON.stringify(playbackState));
    
    // CRITICAL: Save audio source separately for instant recovery
    localStorage.setItem('vidjeAudioSource', newSrc);
    
    console.log(' Saved complete playback state with audio source:', playbackState);
    
    // Show playbar when song is loaded (by adding 'active' class)
    const playerBar = document.querySelector('.player-bar');
    const playerProgressBar = document.querySelector('.player-progress-bar-wrapper');
    
    if (playerBar) {
        playerBar.classList.add('active');
        playerBar.style.setProperty('display', 'flex', 'important'); // Ensure it's visible
    }
    
    // Show progress bar when player bar is shown
    if (playerProgressBar) {
        playerProgressBar.classList.add('active');
        playerProgressBar.style.removeProperty('display'); // Remove inline style to let CSS handle it
        console.log('[OK] Progress bar shown with player bar');
    }
    
    // Show new overlay progress bar
    const newProgressContainer = document.querySelector('.new-progress-container');
    if (newProgressContainer) {
        console.log('[OK] Showing new progress container');
        newProgressContainer.classList.add('visible');
    } else {
        console.log(' new-progress-container not found');
    }
    
    // Show new overlay controls
    const newControls = document.querySelector('.new-controls');
    if (newControls) {
        console.log('[OK] Showing new controls');
        newControls.classList.add('visible');
    } else {
        console.log(' new-controls not found');
    }
    
    // Show entire new left panel
    const newLeftPanel = document.querySelector('.new-left-panel');
    if (newLeftPanel) {
        console.log('[OK] Showing new left panel');
        newLeftPanel.classList.add('visible');
    } else {
        console.log(' new-left-panel not found');
    }
    
    // 1. Update Player Bar
    checkMarquee(document.getElementById('player-title'), song.title);
    checkMarquee(document.getElementById('player-artist'), song.artist);
    playerArt.src = song.cover;
    
    // 3.  PERBAIKAN OVERLAY - SELALU UPDATE (tidak peduli overlay buka/tutup)
    const overlayTitle = document.getElementById('overlay-title');
    const overlayArtist = document.getElementById('overlay-artist');
    const overlayArt = document.getElementById('overlay-art');
    const overlayBg = document.getElementById('overlay-bg');
    
    // Reset classes dulu
    if(overlayTitle) {
        overlayTitle.classList.remove('marquee-container');
        overlayTitle.innerHTML = ''; // Clear existing content
        overlayTitle.innerText = song.title; // Set fresh text
    }
    
    if(overlayArtist) {
        overlayArtist.classList.remove('marquee-container');
        overlayArtist.innerHTML = ''; // Clear existing content
        overlayArtist.innerText = song.artist; // Set fresh text
    }
    
    if(overlayArt) overlayArt.src = song.cover;
    if(overlayBg) overlayBg.style.backgroundImage = `url(${song.cover})`;
    
    // Apply marquee jika text overflow (setelah render selesai)
    setTimeout(() => {
        if(overlayTitle) checkMarquee(overlayTitle, song.title);
        if(overlayArtist) checkMarquee(overlayArtist, song.artist);
    }, 100);
    
    // 4. Update Like Button State
    updatePlayerLikeIcon(song.id);
    
    // 5. Update Visualizers - Hide All
    document.querySelectorAll('.song-row').forEach(r => {
        r.classList.remove('playing');
        const eqContainer = r.querySelector('.playing-icon-container');
        const num = r.querySelector('.index-num');
        if(eqContainer) {
            eqContainer.style.display = 'none';
            eqContainer.style.animationPlayState = 'paused'; 
        }
        if(num) num.style.display = 'block';
    });
    
    // 6. Show Visualizer for Current Song
    const active = document.getElementById(`row-${song.id}`);
    if(active) {
        active.classList.add('playing');
        const eq = active.querySelector('.playing-icon-container');
        if(eq) {
            eq.style.display = 'flex';
            if(isPlaying) eq.style.animationPlayState = 'running';
        }
        if(active.querySelector('.index-num')) active.querySelector('.index-num').style.display = 'none';
    }
    
    // 7.  CRITICAL FIX: Use centralized Media Session update
    // This ensures handlers are re-registered and metadata is fresh
    updateMediaSessionMetadata();
    console.log(' [loadSong] Media Session updated for:', song.title);
    
    // 8. Update lirik untuk lagu saat ini
    const lyrics = lyricsDatabase[song.title];
    console.log('[MUSIC] Loading song:', song.title, 'Has lyrics:', !!lyrics);
    
    if (lyrics) {
        console.log(' Rendering lyrics with', lyrics.lines.length, 'lines');
        
        // Update lirik di overlay player
        const overlayLyricsContent = document.getElementById('overlay-lyrics-content');
        if (overlayLyricsContent) {
            console.log('[OK] Found overlay-lyrics-content element');
            renderOverlayLyricsContent(lyrics);
            overlayLyricsContent.style.display = 'block';
            overlayLyricsContent.style.visibility = 'visible';
        } else {
            console.error('[ERROR] overlay-lyrics-content element not found');
        }
        
        // Update lirik di fullscreen lyrics page  
        const lyricsPageContent = document.querySelector('#lyrics-overlay-container .lyrics-text');
        if (lyricsPageContent) {
            console.log('[OK] Found fullscreen lyrics element');
            lyricsPageContent.innerHTML = '';
            lyricsPageContent.style.display = 'block';
            lyricsPageContent.style.visibility = 'visible';
            lyrics.lines.forEach((line, idx) => {
                const lineEl = document.createElement('div');
                lineEl.className = 'lyrics-line';
                lineEl.id = `lyrics-page-line-${idx}`;
                lineEl.onclick = () => seekToLyricsTime(line.time);
                lineEl.style.padding = '12px 0';
                lineEl.style.cursor = 'pointer';
                lineEl.style.transition = 'all 0.3s ease';

                if (line.words && line.words.length > 0) {
                    line.words.forEach((word, wordIdx) => {
                        const wordEl = document.createElement('span');
                        wordEl.className = 'lyrics-word';
                        wordEl.id = `lyrics-page-word-${idx}-${wordIdx}`;
                        wordEl.innerText = word;
                        wordEl.style.marginRight = '0.2em';
                        lineEl.appendChild(wordEl);
                    });
                } else {
                    lineEl.innerText = line.text;
                }

                lyricsPageContent.appendChild(lineEl);
            });
        } else {
            console.error('[ERROR] Fullscreen lyrics element not found');
        }
        
        const lyricsContainer = document.getElementById('lyrics-overlay-container');
        if (lyricsContainer && song.cover) {
            lyricsContainer.style.backgroundImage = `url('${song.cover}')`;
        }
        
        if (lyricsState.isOpen || document.getElementById('lyrics-overlay-container').classList.contains('active')) {
            startLyricsSync();
        }
    } else {
        console.warn(' No lyrics found for:', song.title);
        const overlayLyricsContent = document.getElementById('overlay-lyrics-content');
        if (overlayLyricsContent) {
            overlayLyricsContent.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Lirik tidak tersedia untuk lagu ini</p>';
        }
        
        const lyricsPageContent = document.querySelector('#lyrics-overlay-container .lyrics-text');
        if (lyricsPageContent) {
            lyricsPageContent.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Lirik tidak tersedia untuk lagu ini</p>';
        }
    }
}
        // --- ARTIST PROFILE LOGIC ---
        function openArtistProfile(artistName, fallbackImg) {
            const overlay = document.getElementById('artist-profile-overlay');
            const nameEl = document.getElementById('artist-profile-name');
            const imgEl = document.getElementById('artist-profile-img');
            const songsContainer = document.getElementById('artist-profile-songs');

            // Find artist in static index
            const artistData = searchIndexArtists.find(a => a.name.toLowerCase() === artistName.toLowerCase());
            
            nameEl.innerText = artistName;
            
            if (artistData) {
                imgEl.src = artistData.img;
            } else {
                imgEl.src = fallbackImg || 'https://picsum.photos/seed/artist/300/300';
            }

            // Filter songs by this artist
            const artistSongs = songs.filter(s => s.artist.toLowerCase() === artistName.toLowerCase());
            renderSongListCustom(artistSongs, 'artist-profile-songs', false);
            
            // Add padding so player bar doesn't cover last song
            songsContainer.style.paddingBottom = '120px';

            overlay.classList.add('active');
        }

        function closeArtistProfile() {
            document.getElementById('artist-profile-overlay').classList.remove('active');
        }

        window.openArtistProfile = openArtistProfile;
        window.closeArtistProfile = closeArtistProfile;
        window.loadSong = loadSong;

        // Simple play audio wrapper
        window.playAudio = function() {
            if (!audio.src || audio.src === window.location.href) {
                console.warn(" Audio source is empty, cannot play.");
                showToast(' Lagu tidak tersedia atau belum bisa diputar', 'error');
                return; 
            }
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    isPlaying = true;
                    updatePlayBtn();
                }).catch(error => {
                    // Handle AbortError (interrupted by pause)
                    if (error.name === 'AbortError') {
                        console.log(" Play was interrupted by pause");
                    } else {
                        console.warn(" Play error:", error);
                        showToast(' Lagu gagal diputar. Mungkin file tidak ada atau error jaringan', 'error');
                    }
                });
            }
        };

        window.pauseAudio = function() {
            audio.pause();
            isPlaying = false;
            updatePlayBtn();
        };

        // Helper to open from Overlay
        window.openArtistProfileFromOverlay = function() {
            const artistName = document.getElementById('overlay-artist').innerText;
            const currentImg = document.getElementById('overlay-art').src;
            closeOverlayPlayer(); // Close player overlay first? Or keep it open underneath? 
            // User asked "munculkan overlay lagi", let's stack it.
            // But if we want to go back, stacking is better.
            openArtistProfile(artistName, currentImg);
        };

        // Add Click Event to Player Bar Artist
        document.getElementById('player-artist').addEventListener('click', (e) => {
            e.stopPropagation();
            const artistName = e.target.innerText;
            const currentImg = document.getElementById('player-art').src;
            openArtistProfile(artistName, currentImg);
        });
        // Make it look clickable
        document.getElementById('player-artist').style.cursor = 'pointer';
        document.getElementById('player-artist').style.textDecoration = 'underline';


        function playSpecificSong(id) {
            // Push to history (avoid duplicates)
            const currentSong = songs[currentSongIndex];
            if(currentSong && currentSong.id !== id) {
                playHistory.push(currentSong);
            }

            const idx = songs.findIndex(s => s.id === id);
            if (idx !== -1) {
                currentSongIndex = idx;
                loadSong(songs[currentSongIndex]);
                
                // Check if song has valid source
                if (!audio.src || audio.src === window.location.href) {
                    showToast(' Lagu tidak tersedia atau belum bisa diputar', 'error');
                    return;
                }
                
                // Save song state to localStorage
                localStorage.setItem('currentSongId', id);
                localStorage.setItem('currentSongPaused', false);
                
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isPlaying = true;
                        updatePlayBtn();
                    }).catch(error => {
                        if (error.name === 'AbortError') {
                            console.log(" Play was interrupted");
                        } else {
                            console.error(" Play error:", error);
                            showToast(' Lagu gagal diputar. Mungkin file tidak ada atau error jaringan', 'error');
                        }
                    });
                } else {
                    isPlaying = true;
                    updatePlayBtn();
                }
                
                // Add to Recently Played
                addToRecentlyPlayed('song', songs[currentSongIndex]);
                
                // Broadcast to Listen Together if Host
                if(listenTogetherSession.active && listenTogetherSession.isHost) {
                    broadcastState();
                }
            }
        }
        window.playSpecificSong = playSpecificSong;

        function playNext() {
            // Logic: Check Queue -> Check Repeat -> Next Song
            
            if(repeatMode === 2) {
                // Repeat One
                audio.currentTime = 0;
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        if (error.name !== 'AbortError') {
                            console.error(" Play error:", error);
                            showToast(' Lagu gagal diputar', 'error');
                        }
                    });
                }
                return;
            }

            // Check Queue First
            if(songQueue.length > 0) {
                const nextQueued = songQueue.shift(); // Remove from front
                playSpecificSong(nextQueued.id);
                renderQueue(); // Update UI to show removal
                return;
            }

            // Normal Playback
            if(repeatMode === 1 && currentSongIndex === songs.length - 1) {
                // Repeat All & Last song -> Go to 0
                currentSongIndex = 0;
            } else {
                // Default Next
                currentSongIndex = (currentSongIndex + 1) % songs.length;
            }
            
            loadSong(songs[currentSongIndex]); 
            
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    isPlaying = true;
                    updatePlayBtn();
                }).catch(error => {
                    if (error.name !== 'AbortError') {
                        console.error(" Play error:", error);
                    }
                });
            } else {
                isPlaying = true;
                updatePlayBtn();
            }
        }

        function playPrevious() {
            // Logic: Check History > 5s? -> Else Prev in list
            if(audio.currentTime > 3) {
                audio.currentTime = 0;
                return;
            }

            if(playHistory.length > 0) {
                const prevSong = playHistory.pop();
                playSpecificSong(prevSong.id);
                return;
            }

            currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
            loadSong(songs[currentSongIndex]); 
            
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    isPlaying = true;
                    updatePlayBtn();
                }).catch(error => {
                    if (error.name !== 'AbortError') {
                        console.error(" Play error:", error);
                        showToast(' Lagu gagal diputar', 'error');
                    }
                });
            } else {
                isPlaying = true;
                updatePlayBtn();
            }
        }

        function toggleRepeat() {
            repeatMode = (repeatMode + 1) % 3; // 0: Off, 1: All, 2: One
            const btn = document.getElementById('repeat-btn');
            const icon = btn.querySelector('i');
            
            icon.className = 'ph ph-repeat'; // Reset base class
            
            if(repeatMode === 0) {
                btn.classList.remove('active');
            } else if (repeatMode === 1) {
                btn.classList.add('active');
                // Add a small dot or text if needed, but color change is fine
            } else {
                btn.classList.add('active');
                icon.className = 'ph ph-repeat-once'; // Ideally a specific icon, but we reuse here
                // Or we can modify content to "1"
            }
        }

        function toggleShuffle() {
            isShuffle = !isShuffle;
            const btn = document.getElementById('shuffle-btn');
            if(isShuffle) btn.classList.add('active');
            else btn.classList.remove('active');
            // Implementation of shuffle logic is complex with current array structure, 
            // toggling state is enough for UI requirements.
        }

        audio.addEventListener('ended', () => {
            document.getElementById('next-btn').click();
        });
        
        // FIX: Handle audio suspension (background/lockscreen)
        audio.addEventListener('suspend', () => {
            console.log(' Audio suspended');
        });
        
        audio.addEventListener('stalled', () => {
            console.warn(' Audio stalled, attempting recovery...');
            if (isPlaying && audio.paused) {
                audio.load();
                setTimeout(() => {
                    audio.play().catch(err => console.error('Recovery failed:', err));
                }, 200);
            }
        });
        
        audio.addEventListener('pause', () => {
            // Update media session when paused
            if ('mediaSession' in navigator && navigator.mediaSession) {
                navigator.mediaSession.playbackState = 'paused';
            }
        });
        
        audio.addEventListener('play', () => {
            // Update media session when playing
            if ('mediaSession' in navigator && navigator.mediaSession) {
                navigator.mediaSession.playbackState = 'playing';
            }
        });


        playPauseBtn.addEventListener('click', () => {
            // Perbaikan: Cek apakah audio punya source yang valid sebelum play
            if (!audio.src || audio.src === window.location.href) {
                console.warn(" Audio source is empty, cannot play.");
                return; 
            }

            // Perbaikan: Handle Promise play() untuk menangkap error NotSupportedError
            if (isPlaying) { 
                audio.pause(); 
                isPlaying = false; 
                updatePlayBtn();
            } else { 
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // Playback started successfully
                        isPlaying = true;
                        updatePlayBtn();
                    })
                    .catch(error => {
                        // Handle AbortError (interrupted by pause or source change)
                        if (error.name === 'AbortError') {
                            console.log(" Play was interrupted");
                            isPlaying = false;
                        } else {
                            console.error(" Audio Play Error:", error);
                            // Jika error karena source tidak valid/kosong
                            isPlaying = false;
                        }
                        updatePlayBtn();
                    });
                }
            }
            
            // --- FIX ANIMATION PAUSE/RUN ---
            const state = isPlaying ? 'running' : 'paused';
            document.querySelectorAll('.playing-icon-container').forEach(el => {
                el.style.animationPlayState = state;
            });
            
            // Broadcast to Listen Together if Host
            if(listenTogetherSession.active && listenTogetherSession.isHost) {
                broadcastState();
            }
        });

        function updatePlayBtn() {
            const overlayIcon = document.querySelector('#overlay-play-pause-btn i');
            if(isPlaying) { 
                playPauseIcon.classList.remove('ph-play'); 
                playPauseIcon.classList.add('ph-pause'); 
                if(overlayIcon) { overlayIcon.classList.remove('ph-play'); overlayIcon.classList.add('ph-pause'); }
            } else { 
                playPauseIcon.classList.remove('ph-pause'); 
                playPauseIcon.classList.add('ph-play'); 
                if(overlayIcon) { overlayIcon.classList.remove('ph-pause'); overlayIcon.classList.add('ph-play'); }
            }

            // Sync visualizer animation state for currently playing rows
            const state = isPlaying ? 'running' : 'paused';
            document.querySelectorAll('.song-row.playing .playing-icon-container').forEach(el => {
                el.style.animationPlayState = state;
                // ensure visibility matches playing state
                el.style.display = isPlaying ? 'flex' : 'none';
            });

            // Update new overlay play button
            if (typeof updateNewPlayButton === 'function') {
                updateNewPlayButton();
            }
        }

        document.getElementById('prev-btn').addEventListener('click', playPrevious);
        document.getElementById('next-btn').addEventListener('click', playNext);
        document.getElementById('repeat-btn').addEventListener('click', toggleRepeat);
        document.getElementById('shuffle-btn').addEventListener('click', toggleShuffle);

        // Desktop: toggle play/pause with Space (ignore when typing in inputs)
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.key === ' ') {
                // Ignore on mobile devices / small screens
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
                if (isMobile) return;

                const ae = document.activeElement;
                const tag = ae && ae.tagName && ae.tagName.toLowerCase();
                if (tag === 'input' || tag === 'textarea' || (ae && ae.isContentEditable)) return;
                e.preventDefault();
                const btn = document.getElementById('play-pause-btn');
                if (btn) btn.click();
            }
            
            // Arrow keys untuk seek (Left/Right)
            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                const ae = document.activeElement;
                const tag = ae && ae.tagName && ae.tagName.toLowerCase();
                if (tag === 'input' || tag === 'textarea' || (ae && ae.isContentEditable)) return;
                
                e.preventDefault();
                const audio = document.getElementById('audio-player');
                if (!audio || !audio.duration) return;
                
                const skipAmount = e.shiftKey ? 30 : 5; // Shift + arrow = 30s, else = 5s
                const newTime = e.key === 'ArrowRight' 
                    ? Math.min(audio.duration, audio.currentTime + skipAmount)
                    : Math.max(0, audio.currentTime - skipAmount);
                
                audio.currentTime = newTime;
                console.log(` Seek ${e.key === 'ArrowRight' ? 'forward' : 'backward'} ${skipAmount}s to ${newTime.toFixed(2)}s`);
            }
        });

        // Export ke window agar bisa dipanggil dari HTML onclick
window.playNext = playNext;
window.playPrevious = playPrevious;
window.toggleRepeat = toggleRepeat;
window.toggleShuffle = toggleShuffle;
window.openPlayScreenUnified = openPlayScreenUnified;
window.closePlayScreenUnified = closePlayScreenUnified;
window.toggleDesktopLyrics = toggleDesktopLyrics;
window.playScreenTogglePlay = playScreenTogglePlay;
window.playScreenSeek = playScreenSeek;
window.playScreenSeekToLyric = playScreenSeekToLyric;
window.playAudio = playAudio;
window.pauseAudio = pauseAudio;
window.startPlayScreenProgressDrag = startPlayScreenProgressDrag;
window.updatePlayScreenProgressDrag = updatePlayScreenProgressDrag;
window.stopPlayScreenProgressDrag = stopPlayScreenProgressDrag;
window.startPlayScreenLyricDrag = startPlayScreenLyricDrag;
window.stopPlayScreenLyricDrag = stopPlayScreenLyricDrag;

        // Add global drag event listeners for play screen progress bar dragging
        document.addEventListener('mousemove', updatePlayScreenProgressDrag);
        document.addEventListener('touchmove', updatePlayScreenProgressDrag);
        document.addEventListener('mouseup', stopPlayScreenProgressDrag);
        document.addEventListener('touchend', stopPlayScreenProgressDrag);
        document.addEventListener('mouseup', stopPlayScreenLyricDrag);
        document.addEventListener('touchend', stopPlayScreenLyricDrag);

        audio.addEventListener('timeupdate', (e) => {
            const { duration, currentTime } = e.srcElement;
            if (isNaN(duration)) return;
            const pct = (currentTime / duration) * 100;
            
            // Update Player Progress Bar (di sidebar)
            const playerProgressFill = document.getElementById('player-progress-fill');
            if (playerProgressFill) {
                playerProgressFill.style.width = `${pct}%`;
            }
            
            const fmt = t => {
                const m = Math.floor(t/60);
                const s = Math.floor(t%60);
                return `${m}:${s<10?'0'+s:s}`;
            };
            
            // Overlay Player Sync
            const overlayFill = document.getElementById('overlay-progress-fill');
            if(overlayFill) {
                overlayFill.style.width = `${pct}%`;
                document.getElementById('overlay-current-time').innerText = fmt(currentTime);
                document.getElementById('overlay-total-duration').innerText = fmt(duration);
            }
            
            // Fullscreen Lyrics Page Sync
            const lyricsFill = document.getElementById('lyrics-progress-fill');
            if(lyricsFill) {
                lyricsFill.style.width = `${pct}%`;
                document.getElementById('lyrics-current-time').innerText = fmt(currentTime);
                document.getElementById('lyrics-total-duration').innerText = fmt(duration);
            }

            // Fullscreen Art Sync
            const artFill = document.getElementById('art-progress-fill');
            if (artFill) {
                artFill.style.width = `${pct}%`;
                const artCur = document.getElementById('art-current-time');
                const artTot = document.getElementById('art-total-duration');
                if (artCur) artCur.innerText = fmt(currentTime);
                if (artTot) artTot.innerText = fmt(duration);
            }
        });


        audio.volume = 0.7;
        const volFill = document.getElementById('volume-fill');
        if (volFill) volFill.style.width = '70%';

// ===== DRAG FUNCTIONALITY FOR PROGRESS BAR =====

let isProgressDragging = false;

function updateProgress(e, container) {
    if (!audio || !audio.duration) return;
    
    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const width = rect.width;
    const percent = Math.max(0, Math.min(1, x / width));
    
    if (isProgressDragging) {
        // Update visual only while dragging
        const fill = document.getElementById('player-progress-fill');
        if (fill) {
            fill.style.width = `${percent * 100}%`;
        }
    } else {
        // Update audio time on click
        audio.currentTime = percent * audio.duration;
    }
}

function progressMouseDown(e) {
    isProgressDragging = true;
    const container = document.getElementById('player-progress-bar-wrapper');
    if (!container) return;
    updateProgress(e, container);
    
    document.addEventListener('mousemove', progressMouseMove);
    document.addEventListener('mouseup', progressMouseUp);
}

function progressMouseMove(e) {
    if (!isProgressDragging) return;
    const container = document.getElementById('player-progress-bar-wrapper');
    if (!container) return;
    updateProgress(e, container);
}

function progressMouseUp(e) {
    if (!isProgressDragging) return;
    
    const container = document.getElementById('player-progress-bar-wrapper');
    if (!container) return;
    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const width = rect.width;
    const percent = Math.max(0, Math.min(1, x / width));
    
    // Commit the change
    if (audio.duration && isFinite(audio.duration)) { audio.currentTime = percent * audio.duration; }
    
    isProgressDragging = false;
    document.removeEventListener('mousemove', progressMouseMove);
    document.removeEventListener('mouseup', progressMouseUp);
}

// Touch support for mobile
function progressTouchStart(e) {
    isProgressDragging = true;
    const container = document.getElementById('player-progress-bar-wrapper');
    if (!container) return;
    const touch = e.touches[0];
    const mouseEvent = { clientX: touch.clientX };
    updateProgress(mouseEvent, container);
    
    document.addEventListener('touchmove', progressTouchMove, { passive: false });
    document.addEventListener('touchend', progressTouchEnd);
}

function progressTouchMove(e) {
    if (!isProgressDragging) return;
    e.preventDefault();
    
    const container = document.getElementById('player-progress-bar-wrapper');
    if (!container) return;
    const touch = e.touches[0];
    const mouseEvent = { clientX: touch.clientX };
    updateProgress(mouseEvent, container);
}

function progressTouchEnd(e) {
    if (!isProgressDragging) return;
    
    const container = document.getElementById('player-progress-bar-wrapper');
    if (!container) return;
    const touch = e.changedTouches[0];
    const rect = container.getBoundingClientRect();
    const x = touch.clientX - rect.left;
    const width = rect.width;
    const percent = Math.max(0, Math.min(1, x / width));
    
    audio.currentTime = percent * audio.duration;
    
    isProgressDragging = false;
    document.removeEventListener('touchmove', progressTouchMove);
    document.removeEventListener('touchend', progressTouchEnd);
}

// Initialize progress bar drag
const progressContainer = document.getElementById('player-progress-bar-wrapper');
if (progressContainer) {
    progressContainer.addEventListener('mousedown', progressMouseDown);
    progressContainer.addEventListener('touchstart', progressTouchStart, { passive: false });
    
    // Prevent text selection
    progressContainer.style.userSelect = 'none';
    progressContainer.style.webkitUserSelect = 'none';
    progressContainer.style.webkitTouchCallout = 'none';
}

console.log('[OK] Progress bar drag functionality initialized');


// ===== DRAG FUNCTIONALITY FOR VOLUME (DESKTOP ONLY) =====

let isVolumeDragging = false;

function updateVolume(e, container) {
    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const width = rect.width;
    const vol = Math.max(0, Math.min(1, x / width));
    
    audio.volume = vol;
    document.getElementById('volume-fill').style.width = `${vol * 100}%`;
    
    const volIcon = document.getElementById('vol-icon');
    volIcon.classList.remove('ph-speaker-high', 'ph-speaker-low', 'ph-speaker-slash');
    if (vol === 0) volIcon.classList.add('ph-speaker-slash');
    else if (vol < 0.5) volIcon.classList.add('ph-speaker-low');
    else volIcon.classList.add('ph-speaker-high');
}

function volumeMouseDown(e) {
    isVolumeDragging = true;
    const container = document.getElementById('volume-container');
    updateVolume(e, container);
    
    document.addEventListener('mousemove', volumeMouseMove);
    document.addEventListener('mouseup', volumeMouseUp);
}

function volumeMouseMove(e) {
    if (!isVolumeDragging) return;
    const container = document.getElementById('volume-container');
    updateVolume(e, container);
}

function volumeMouseUp(e) {
    isVolumeDragging = false;
    document.removeEventListener('mousemove', volumeMouseMove);
    document.removeEventListener('mouseup', volumeMouseUp);
}

// Initialize volume drag (desktop only)
const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;

if (!isMobileDevice) {
    const volContainer = document.getElementById('volume-container');
    if (volContainer) {
        volContainer.addEventListener('mousedown', volumeMouseDown);
        
        // Prevent text selection
        volContainer.style.userSelect = 'none';
        volContainer.style.webkitUserSelect = 'none';
    }
    
    console.log('[OK] Volume drag functionality initialized (desktop)');
}






const volContainer = document.getElementById('volume-container');
const volIcon = document.getElementById('vol-icon');

if (isMobileDevice) {
    // === MODE MOBILE: GUNAKAN KONTROL VOLUME HP ===
    audio.volume = 1.0; // Set ke max, biar kontrol HP yang atur
    if (volContainer) volContainer.style.display = 'none'; // Sembunyikan slider custom
    if (volIcon) volIcon.style.display = 'none'; // Sembunyikan ikon volume juga
    
    
    // Listener untuk perubahan volume dari HP
    audio.addEventListener('volumechange', () => {
        // Sinkronisasi jika ada perubahan dari kontrol HP
        console.log('Volume HP:', audio.volume);
    });
} else {
    // === MODE DESKTOP: GUNAKAN SLIDER CUSTOM ===
    audio.volume = 0.7; // Default 70%
    volFill.style.width = '70%';
    
    volContainer.addEventListener('click', (e) => {
        const rect = volContainer.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        let vol = Math.max(0, Math.min(1, x / width));
        audio.volume = vol;
        volFill.style.width = `${vol * 100}%`;
        
        // Update icon berdasarkan volume
        volIcon.classList.remove('ph-speaker-high', 'ph-speaker-low', 'ph-speaker-slash');
        if (vol === 0) volIcon.classList.add('ph-speaker-slash');
        else if (vol < 0.5) volIcon.classList.add('ph-speaker-low');
        else volIcon.classList.add('ph-speaker-high');
    });
}

// === DISABLE LISTEN TOGETHER KHUSUS DESKTOP ===
if(window.innerWidth > 768) {
    // Hide overlay immediately
    const ltOverlay = document.getElementById('listen-together-overlay');
    if(ltOverlay) {
        ltOverlay.style.display = 'none !important';
        ltOverlay.style.visibility = 'hidden';
        ltOverlay.style.position = 'fixed';
        ltOverlay.style.width = '0';
        ltOverlay.style.height = '0';
    }
    
    // Hide button immediately
    const ltBtn = document.getElementById('btn-open-listen-together');
    if(ltBtn) {
        ltBtn.style.display = 'none !important';
        ltBtn.style.visibility = 'hidden';
        ltBtn.style.width = '0';
        ltBtn.style.height = '0';
    }
    
    // Hide session badge immediately
    const sessionBadge = document.getElementById('session-badge');
    if(sessionBadge) {
        sessionBadge.style.display = 'none !important';
        sessionBadge.style.visibility = 'hidden';
        sessionBadge.style.width = '0';
        sessionBadge.style.height = '0';
    }
}

// === LISTEN TOGETHER STATE ===
let listenTogetherSession = {
    active: false,
    isHost: false,
    sessionCode: null,
    participants: []
};

// === OPEN LISTEN TOGETHER (PERBAIKAN: NO REGENERATE) ===
window.openListenTogether = function() {
    // Disable completely on desktop
    if(window.innerWidth > 768) {
        return;
    }
    
    try {
        console.log('Open Listen Together Clicked');
        const overlay = document.getElementById('listen-together-overlay');
        
        if(!overlay) {
            alert('Error: Overlay element not found!');
            return;
        }

        // Show overlay using classList
        overlay.classList.add('active');

        // Reset sections
        const modeSec = document.getElementById('lt-mode-section');
        const hostSec = document.getElementById('lt-host-section');
        const joinSec = document.getElementById('lt-join-section');

        // Default state: Show Mode, Hide others
        if(modeSec) modeSec.classList.remove('hidden');
        if(hostSec) hostSec.classList.add('hidden');
        if(joinSec) joinSec.classList.add('hidden');

        // Safety check for session object
        if(typeof listenTogetherSession === 'undefined') {
            console.warn('listenTogetherSession undefined, initializing...');
            window.listenTogetherSession = { active: false, isHost: false, sessionCode: null, participants: [] };
        }

        if(listenTogetherSession.active) {
            // JIKA SUDAH ADA SESI
            if(modeSec) modeSec.classList.add('hidden'); // Hide mode selection
            
            if(listenTogetherSession.isHost) {
                if(hostSec) hostSec.classList.remove('hidden');
                const codeEl = document.getElementById('lt-session-code');
                if(codeEl) codeEl.innerText = listenTogetherSession.sessionCode;
            } else {
                // Guest: Show Join/Mode options
                if(modeSec) modeSec.classList.remove('hidden');
                if(joinSec) joinSec.classList.remove('hidden');
            }
        }
    } catch (e) {
        console.error('Error opening Listen Together:', e);
        alert('Terjadi kesalahan: ' + e.message);
    }
};

window.closeListenTogether = function() {
    const overlay = document.getElementById('listen-together-overlay');
    if(overlay) {
        overlay.classList.remove('active');
    }
};

// === SELECT MODE ===
window.selectLTMode = function(mode) {
    document.getElementById('lt-mode-section').classList.add('hidden');
    document.getElementById('lt-host-section').classList.remove('hidden');
    document.getElementById('lt-join-section').classList.remove('hidden');
    
    if(mode === 'host') {
        document.getElementById('lt-join-section').classList.add('hidden');
        startHostSession();
    } else {
        document.getElementById('lt-host-section').classList.add('hidden');
    }
};

// === START HOST SESSION (PERBAIKAN LOGIC) ===
function startHostSession() {
    // Cek apakah sudah ada sesi aktif? Kalau iya, jangan generate code baru
    if(listenTogetherSession.active && listenTogetherSession.isHost) {
        document.getElementById('lt-host-section').classList.remove('hidden');
        document.getElementById('lt-session-code').innerText = listenTogetherSession.sessionCode;
        return;
    }

    const code = generateSessionCode();
    listenTogetherSession.sessionCode = code;
    listenTogetherSession.isHost = true;
    listenTogetherSession.active = true;
    
    document.getElementById('lt-session-code').innerText = code;
    document.getElementById('lt-host-section').classList.remove('hidden');
    
    // Save to Firebase
    set(ref(db, `sessions/${code}`), {
        host: auth.currentUser.uid,
        hostName: currentUserData.username,
        hostPic: currentUserData.profile_picture,
        currentSong: songs[currentSongIndex].id,
        currentTime: audio.currentTime,
        isPlaying: isPlaying,
        timestamp: Date.now(),
        participants: {
            [auth.currentUser.uid]: {
                name: currentUserData.username,
                pic: currentUserData.profile_picture,
                role: 'host'
            }
        }
    });
    
    // Listen for participants
    listenToParticipants(code);
    
    // Show badge
    document.getElementById('session-badge').classList.add('active');
    document.getElementById('session-badge-text').innerText = `Session: ${code}`;
}

// === JOIN SESSION ===
window.joinListenTogether = async function() {
    const code = document.getElementById('lt-join-code').value.toUpperCase().trim();
    if(code.length !== 4) {
        alert("Kode harus 4 karakter!");
        return;
    }
    
    // Check if session exists
    const sessionSnap = await get(ref(db, `sessions/${code}`));
    if(!sessionSnap.exists()) {
        alert("Session tidak ditemukan!");
        return;
    }
    
    listenTogetherSession.sessionCode = code;
    listenTogetherSession.isHost = false;
    listenTogetherSession.active = true;
    
    // Add self to participants
    update(ref(db, `sessions/${code}/participants/${auth.currentUser.uid}`), {
        name: currentUserData.username,
        pic: currentUserData.profile_picture,
        role: 'guest'
    });
    
    // Sync with host
    syncWithSession(code);
    
    document.getElementById('session-badge').classList.add('active');
    document.getElementById('session-badge-text').innerText = `Joined: ${code}`;
    
    closeListenTogether();
};

// === SYNC WITH SESSION (FIXED: SINKRONISASI LAGU) ===
function syncWithSession(code) {
    onValue(ref(db, `sessions/${code}`), (snap) => {
        const session = snap.val();
        if(!session) {
            endListenTogether();
            return;
        }
        
        // Sync playback HANYA JIKA GUEST
        if(!listenTogetherSession.isHost) {
            const songId = session.currentSong;
            const time = session.currentTime;
            const playing = session.isPlaying;
            
            // Cari index lagu
            const idx = songs.findIndex(s => s.id == songId);
            
            // Jika lagunya beda, ganti lagu
            if(idx !== -1 && idx !== currentSongIndex) {
                 loadSong(songs[idx]);
                 currentSongIndex = idx;
                 // Putar dulu untuk memuat buffer, lalu seek
                 audio.play().then(() => {
                     audio.currentTime = time;
                     if(!playing) audio.pause();
                     // Update UI Play/Pause
                     isPlaying = playing;
                     updatePlayBtn();
                     
                     // Update Visualizer
                     const state = isPlaying ? 'running' : 'paused';
                     document.querySelectorAll('.playing-icon-container').forEach(el => {
                        el.style.animationPlayState = state;
                    });
                 });
            } else if (Math.abs(audio.currentTime - time) > 2) {
                // Jika lagu sama tapi beda waktu (drift > 2 detik)
                audio.currentTime = time;
            }
            
            // Sinkronisasi Play/Pause
            if(playing && audio.paused) {
                audio.play();
                isPlaying = true;
                updatePlayBtn();
                document.querySelectorAll('.playing-icon-container').forEach(el => el.style.animationPlayState = 'running');
            } else if(!playing && !audio.paused) {
                audio.pause();
                isPlaying = false;
                updatePlayBtn();
                document.querySelectorAll('.playing-icon-container').forEach(el => el.style.animationPlayState = 'paused');
            }
        }
    });
}

// === BROADCAST STATE (HOST) ===
function broadcastState() {
    if(!listenTogetherSession.active || !listenTogetherSession.isHost) return;
    
    update(ref(db, `sessions/${listenTogetherSession.sessionCode}`), {
        currentSong: songs[currentSongIndex].id,
        currentTime: audio.currentTime,
        isPlaying: isPlaying,
        timestamp: Date.now()
    });
}

// Hook into audio events untuk auto-broadcast saat lagu berakhir/next
if(listenTogetherSession.active && listenTogetherSession.isHost) {
    // Broadcast saat seek (opsional, bisa berat jika tiap frame)
    // Kita broadcast saat Play/Pause/Skip saja sudah cukup.
}

// === LISTEN TO PARTICIPANTS ===
function listenToParticipants(code) {
    onValue(ref(db, `sessions/${code}/participants`), (snap) => {
        const participants = snap.val() || {};
        const list = document.getElementById('lt-participants-list');
        
        let html = '';
        Object.keys(participants).forEach(uid => {
            const p = participants[uid];
            html += `
                <div class="lt-participant">
                    <img src="${p.pic}" alt="${p.name}">
                    <span>${p.name}</span>
                    ${p.role === 'host' ? '<span class="lt-host-badge">HOST</span>' : ''}
                </div>
            `;
        });
        
        list.innerHTML = html || '<p style="color:#666; text-align:center;">' + window.t('waiting') + '</p>';
    });
}

// === END SESSION ===
window.endListenTogether = function() {
    if(listenTogetherSession.isHost) {
        // Remove from Firebase
        remove(ref(db, `sessions/${listenTogetherSession.sessionCode}`));
    } else {
        // Remove self from participants
        remove(ref(db, `sessions/${listenTogetherSession.sessionCode}/participants/${auth.currentUser.uid}`));
    }
    
    listenTogetherSession = { active: false, isHost: false, sessionCode: null, participants: [] };
    document.getElementById('session-badge').classList.remove('active');
    closeListenTogether();
    
    // Reset UI
    document.getElementById('lt-mode-section').classList.remove('hidden');
    document.getElementById('lt-host-section').classList.add('hidden');
    document.getElementById('lt-join-section').classList.add('hidden');
};

// === COPY SESSION CODE ===
window.copySessionCode = function() {
    const code = document.getElementById('lt-session-code').innerText;
    navigator.clipboard.writeText(code).then(() => {
        alert(`Kode ${code} disalin!`);
    });
};

// === GENERATE SESSION CODE ===
function generateSessionCode() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = '';
    for(let i = 0; i < 4; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
}

// ===== GLOBAL VARIABLES FOR IMPORT =====
let selectedMusicFile = null;
let selectedCoverFile = null;
let importedSongsStartId = 10000;

// ===== IMPORT MUSIC FUNCTIONS =====

window.openImportMusicModal = function() {
    document.getElementById('import-music-modal').classList.add('open');
    // Reset form
    selectedMusicFile = null;
    selectedCoverFile = null;
    document.getElementById('import-file-name').innerText = window.t('no-file-selected');
    document.getElementById('import-file-size').innerText = 'Pilih file MP3';
    document.getElementById('import-song-title').value = '';
    document.getElementById('import-song-artist').value = '';
    document.getElementById('import-song-album').value = '';
    document.getElementById('import-privacy-toggle').checked = false;
    document.getElementById('import-cover-preview').src = 'https://picsum.photos/seed/default/100/100';
    document.getElementById('import-file-preview').classList.remove('active');
    updatePrivacyLabel(document.getElementById('import-privacy-toggle'));
};

window.handleMusicFileSelect = function(input) {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Validate MP3
        if (!file.type.match('audio/mpeg') && !file.type.match('audio/mp3')) {
            showToast(' Hanya file MP3 yang didukung!', 'error');
            return;
        }

        // Validate file size (max 10MB)
        if (file.size > 10 * 1024 * 1024) {
            showToast(' Ukuran file maksimal 10MB!', 'error');
            return;
        }

        selectedMusicFile = file;
        document.getElementById('import-file-name').innerText = file.name;
        document.getElementById('import-file-size').innerText = formatFileSize(file.size);
        document.getElementById('import-file-preview').classList.add('active');

        // Auto-fill title from filename
        const filename = file.name.replace('.mp3', '').replace('.MP3', '');
        if (!document.getElementById('import-song-title').value) {
            document.getElementById('import-song-title').value = filename;
        }
    }
};

window.handleCoverFileSelect = function(input) {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Validate image
        if (!file.type.match('image.*')) {
            showToast(' Hanya file gambar yang didukung!', 'error');
            return;
        }

        selectedCoverFile = file;
        
        // Preview cover
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('import-cover-preview').src = e.target.result;
        };
        reader.readAsDataURL(file);
        
        showToast(' Foto cover berhasil dipilih!', 'success');
    }
};

window.updatePrivacyLabel = function(checkbox) {
    const icon = document.getElementById('privacy-icon');
    const label = document.getElementById('privacy-label');
    const desc = label.nextElementSibling;
    
    if (checkbox.checked) {
        icon.className = 'ph ph-globe';
        label.innerText = 'Publik';
        desc.innerText = 'Semua orang bisa mendengarkan';
    } else {
        icon.className = 'ph ph-lock-key';
        label.innerText = 'Privat';
        desc.innerText = 'Hanya Anda yang bisa mendengarkan';
    }
};

window.submitImportMusic = async function() {
    if (!auth.currentUser) {
        showToast(' Anda harus login terlebih dahulu!', 'error');
        return;
    }

    if (!selectedMusicFile) {
        showToast(' Pilih file MP3 terlebih dahulu!', 'error');
        return;
    }

    const title = document.getElementById('import-song-title').value.trim();
    const artist = document.getElementById('import-song-artist').value.trim();
    const album = document.getElementById('import-song-album').value.trim() || 'Single';
    const isPublic = document.getElementById('import-privacy-toggle').checked;

    if (!title || !artist) {
        showToast(' Nama lagu dan penyanyi harus diisi!', 'error');
        return;
    }

    try {
        showToast(' Memproses musik... Mohon tunggu', 'info');

        const userId = auth.currentUser.uid;
        const songId = 10000 + Date.now();

        // Get audio duration
        const audioDuration = await getAudioDuration(selectedMusicFile);

        // Create data URL for music (base64)
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };

        let musicUrl = `data:audio/mpeg;base64,${await fileToBase64(selectedMusicFile)}`;
        
        // If file is too large for data URL, use Object URL
        if (selectedMusicFile.size > 5 * 1024 * 1024) {
            musicUrl = URL.createObjectURL(selectedMusicFile);
            console.warn(' Using Object URL (temporary) for large file');
        }

        // Cover URL - use placeholder
        let coverUrl = `https://picsum.photos/seed/${songId}/300/300`;

        // Save to Firebase only
        console.log('[INFO] Saving to Firebase...');
        showToast(' Menyimpan metadata lagu...', 'info');
        
        const songData = {
            id: songId,
            title: title,
            artist: artist,
            album: album,
            duration: audioDuration || '3:30',
            cover: coverUrl,
            src: musicUrl,
            uploadedBy: userId,
            uploaderName: currentUserData?.username || 'Unknown',
            isPublic: isPublic,
            timestamp: Date.now(),
            storage: 'firebase'
        };

        console.log('[INFO] songData saved');
        
        try {
            await set(ref(db, `importedSongs/${userId}/${songId}`), songData);
            console.log('[OK] importedSongs saved');
        } catch (dbErr) {
            console.error('[ERROR] Failed to write importedSongs:', dbErr);
            showToast(' Gagal menyimpan metadata: ' + (dbErr.message || dbErr), 'error');
            throw dbErr;
        }

        if (isPublic) {
            try {
                await set(ref(db, `publicImportedSongs/${songId}`), songData);
                console.log('[OK] publicImportedSongs saved');
            } catch (pubErr) {
                console.error('[ERROR] Failed to write publicImportedSongs:', pubErr);
            }
        }

        // Add to local songs array
        if (!songs.find(s => s.id === songId)) {
            songs.push(songData);
        }
        
        showToast(' Musik berhasil diimpor!', 'success');
        closeModal('import-music-modal');
        renderTrending();

    } catch (error) {
        console.error('[ERROR] Error:', error);
        showToast(' Gagal mengimpor musik: ' + (error?.message || error), 'error');
    }
};


// Helper: Convert file to Base64
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            console.log('FileReader loaded, data length:', reader.result.length);
            resolve(reader.result);
        };
        reader.onerror = (error) => {
            console.error('FileReader error:', error);
            reject(error);
        };
        reader.readAsDataURL(file);
    });
}

// Helper function: Get audio duration
async function getAudioDuration(file) {
    return new Promise((resolve) => {
        const audio = new Audio();
        audio.onloadedmetadata = () => {
            const minutes = Math.floor(audio.duration / 60);
            const seconds = Math.floor(audio.duration % 60);
            resolve(`${minutes}:${seconds < 10 ? '0' : ''}${seconds}`);
        };
        audio.onerror = () => resolve('3:30'); // Default if failed
        audio.src = URL.createObjectURL(file);
    });
}

// Helper function: Format file size
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}

async function loadImportedSongs() {
    if (!auth.currentUser) {
        console.log(' No user logged in, skipping import load');
        return;
    }

    const userId = auth.currentUser.uid;

    try {
        console.log(' Loading imported songs for user:', userId);
        
        //  Load user's own imported songs (PUBLIK + PRIVAT)
        const userSongsSnap = await get(ref(db, `importedSongs/${userId}`));
        if (userSongsSnap.exists()) {
            const userSongs = Object.values(userSongsSnap.val());
            console.log('[OK] User songs loaded:', userSongs.length);
            
            userSongs.forEach(song => {
                if (!songs.find(s => s.id === song.id)) {
                    songs.push(song);
                    console.log('   Added own song:', song.title);
                }
            });
        }

        //  Load public songs dari SEMUA user (kecuali milik sendiri)
        const publicSongsSnap = await get(ref(db, 'publicImportedSongs'));
        if (publicSongsSnap.exists()) {
            const publicSongs = Object.values(publicSongsSnap.val())
                .filter(song => song.uploadedBy !== userId); // Kecuali punya sendiri
            
            console.log('[OK] Public songs from others:', publicSongs.length);
            
            publicSongs.forEach(song => {
                if (!songs.find(s => s.id === song.id)) {
                    songs.push(song);
                    console.log('   Added public song:', song.title, 'by', song.uploaderName);
                }
            });
        }

        console.log('[MUSIC] Total songs in library:', songs.length);

    } catch (error) {
        console.error('[ERROR] Error loading imported songs:', error);
    }
}



        // --- INITIALIZATION ---
        renderTrending();
        renderPopularBands();
        renderPopularArtists();
        renderForeignSoloArtists();
        renderForeignBands();
        // loadSong(songs[0]); // DISABLED - no auto-load on page load

        //  TAMBAHKAN: Load imported songs saat user login
onAuthStateChanged(auth, async (user) => {
    if (user) {
        console.log(' User logged in, loading imported songs...');
        await loadImportedSongs();
        
        //  Setup real-time listener untuk lagu publik baru
        setupPublicSongsListener();
        
        console.log('[OK] Total songs available:', songs.length);
        
        //  SAVE OFFLINE SESSION (PENTING!) 
        const userRef = ref(db, 'users/' + user.uid);
        const snapshot = await get(userRef);
        const userData = snapshot.val();
        
        await window.VidjeHybridAuth.saveOfflineSession(user, userData);
        console.log(' Offline session saved for future offline access');
    } else {
        // No Firebase user - check offline mode
        if (!navigator.onLine) {
            console.log(' Offline mode - attempting offline login...');
            
            if (window.VidjeHybridAuth.hasOfflineSession()) {
                if (window.VidjeHybridAuth.hasPIN()) {
                    console.log(' PIN required - will show PIN screen');
                    // PIN screen akan ditampilkan otomatis
                } else {
                    console.log(' Auto-login offline (no PIN)');
                    const result = await window.VidjeHybridAuth.loginOffline();
                    
                    if (result.success) {
                        // Load app with offline data
                        const offlineUser = result.user;
                        console.log('[OK] Logged in offline as:', offlineUser.email);
                        
                        // Set currentUserData dari offline session
                        window.currentUserData = {
                            uid: offlineUser.uid,
                            email: offlineUser.email,
                            displayName: offlineUser.displayName,
                            photoURL: offlineUser.photoURL,
                            userId: offlineUser.userId,
                            ...offlineUser.userData,
                            isOfflineMode: true
                        };
                        
                        // Load imported songs jika ada
                        await loadImportedSongs();
                        console.log('[OK] App loaded in OFFLINE mode');
                    }
                }
            } else {
                console.log('[INFO] No offline session - need to login online first');
            }
        }
    }
});

//  FUNGSI BARU: Listen perubahan lagu publik secara real-time
function setupPublicSongsListener() {
    const publicSongsRef = ref(db, 'publicImportedSongs');
    
    onValue(publicSongsRef, (snapshot) => {

// ============================================================
// OFFLINE MODE MANAGER
// ============================================================
(function initOfflineMode() {
    let isOfflineMode = false;
    
    // Check offline status
    function updateOfflineStatus() {
        const wasOffline = isOfflineMode;
        isOfflineMode = !navigator.onLine;
        
        const indicator = document.getElementById('offline-mode-indicator');
        if (indicator) {
            indicator.style.display = isOfflineMode ? 'flex' : 'none';
        }
        
        // Update song list visibility based on cache status
        if (isOfflineMode !== wasOffline) {
            updateSongListForOfflineMode();
        }
        
        return isOfflineMode;
    }
    
    // Update song list untuk offline mode
    async function updateSongListForOfflineMode() {
        if (!isOfflineMode) {
            // Online mode - show all songs normally
            document.querySelectorAll('.song-row').forEach(row => {
                row.style.opacity = '1';
                row.style.pointerEvents = 'auto';
                row.style.filter = 'none';
            });
            return;
        }
        
        // Offline mode - check which songs are cached
        const songRows = document.querySelectorAll('.song-row');
        
        for (const row of songRows) {
            const songId = row.id.replace('row-', '');
            const song = window.allSongs?.find(s => s.id == songId);
            
            if (song) {
                const audioUrl = song.src || song.url || song.audio_url;
                if (audioUrl) {
                    const isCached = await isInCache(audioUrl);
                    
                    if (isCached) {
                        // Song is cached - normal display
                        row.style.opacity = '1';
                        row.style.pointerEvents = 'auto';
                        row.style.filter = 'none';
                    } else {
                        // Song not cached - dim and disable
                        row.style.opacity = '0.4';
                        row.style.pointerEvents = 'none';
                        row.style.filter = 'grayscale(1)';
                    }
                }
            }
        }
    }
    
    // Attempt auto offline login
    async function attemptOfflineLogin() {
        if (!navigator.onLine && window.VidjeHybridAuth) {
            console.log('[OFFLINE] Attempting offline login...');
            const result = await window.VidjeHybridAuth.attemptAutoOfflineLogin();
            
            if (result.success) {
                console.log('[OFFLINE] Auto-login successful');
                // Trigger UI update
                window.dispatchEvent(new CustomEvent('offline-auth-success', {
                    detail: { user: result.user }
                }));
            } else if (result.needPIN) {
                console.log('[OFFLINE] PIN required for offline login');
                // Show PIN dialog if needed
            } else {
                console.log('[OFFLINE] Auto-login failed:', result.reason);
            }
        }
    }
    
    // Listen to online/offline events
    window.addEventListener('online', () => {
        console.log('[ONLINE] Connection restored');
        updateOfflineStatus();
    });
    
    window.addEventListener('offline', () => {
        console.log('[OFFLINE] Connection lost');
        updateOfflineStatus();
        attemptOfflineLogin();
    });
    
    // Listen to offline auth success
    window.addEventListener('offline-auth-success', (e) => {
        console.log('[OFFLINE] Auth success, updating UI...');
        // Load user data from offline session
        const user = e.detail.user;
        
        // Update profile display
        if (user) {
            const profileName = document.getElementById('profile-user-name');
            const profileEmail = document.getElementById('profile-user-email');
            
            if (profileName) profileName.textContent = user.displayName || user.email;
            if (profileEmail) profileEmail.textContent = user.email;
        }
        
        // Update song list for offline mode
        updateSongListForOfflineMode();
    });
    
    // Initial check
    setTimeout(() => {
        updateOfflineStatus();
        if (!navigator.onLine) {
            attemptOfflineLogin();
        }
    }, 1000);
    
    // Expose untuk digunakan di tempat lain
    window.updateSongListForOfflineMode = updateSongListForOfflineMode;
    window.isOfflineMode = () => isOfflineMode;
    
})();


        const publicSongs = snapshot.val();
        if (!publicSongs) return;
        
        Object.values(publicSongs).forEach(song => {
            // Skip lagu sendiri & lagu yang sudah ada
            if (song.uploadedBy === auth.currentUser.uid) return;
            if (songs.find(s => s.id === song.id)) return;
            
            // Tambahkan lagu publik baru
            songs.push(song);
            console.log('[MUSIC] New public song added:', song.title, 'by', song.uploaderName);
        });
    });
}





// ===== SERVICE WORKER DISABLED - OFFLINE MODE REMOVED =====
// Fitur offline telah dinonaktifkan untuk menghindari masalah refresh
console.log('[INFO] Offline mode disabled - app runs online only');


// ============================================================
// SUPER SIMPLE SOLUTION - MULTI-DAY NOTIFICATION PERSISTENCE
// ============================================================

(function() {
    'use strict';
    
    const STORAGE_KEY = 'vidje_last_song';
    const audio = document.getElementById('audio-player');
    
    function saveCurrentSong() {
        if (!audio || !audio.src || audio.src === window.location.href) return;
        
        const songInfo = {
            src: audio.src,
            currentTime: audio.currentTime || 0,
            songIndex: window.currentSongIndex,
            timestamp: Date.now()
        };
        
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(songInfo));
        } catch (e) {}
    }
    
    function loadSavedSong() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : null;
        } catch (e) {
            return null;
        }
    }
    
    if (audio) {
        audio.addEventListener('pause', saveCurrentSong);
        audio.addEventListener('play', saveCurrentSong);
        
        let lastSave = 0;
        audio.addEventListener('timeupdate', () => {
            const now = Date.now();
            if (now - lastSave > 10000) {
                saveCurrentSong();
                lastSave = now;
            }
        });
    }
    
    window.loadSavedSongIfNeeded = async function() {
        const saved = loadSavedSong();
        if (!saved) return false;
        
        console.log(' Loading saved song from', new Date(saved.timestamp).toLocaleString());
        
        // CRITICAL: Try to restore audio source directly if available
        const savedAudioSource = localStorage.getItem('vidjeAudioSource');
        const audio = document.getElementById('audio-player');
        
        if (savedAudioSource && audio) {
            console.log(' Restoring audio source directly:', savedAudioSource);
            
            // Set audio source without full page reload
            audio.src = savedAudioSource;
            audio.preload = 'metadata';
            
            // Restore metadata from saved state
            if (saved.songTitle && 'mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: saved.songTitle || 'Unknown',
                    artist: saved.songArtist || 'Unknown Artist',
                    album: saved.songAlbum || 'Unknown Album',
                    artwork: [
                        { src: saved.songCover || 'https://picsum.photos/512', sizes: '512x512', type: 'image/jpeg' }
                    ]
                });
                console.log(' Media Session metadata restored');
            }
            
            // Restore playback position
            if (saved.currentTime) {
                audio.addEventListener('loadedmetadata', () => {
                    audio.currentTime = Math.min(saved.currentTime, audio.duration || 0);
                    console.log(' Position restored to:', saved.currentTime.toFixed(1) + 's');
                }, { once: true });
            }
            
            // If was playing, try to resume
            if (saved.isPlaying) {
                audio.play().then(() => {
                    window.isPlaying = true;
                    if (window.updatePlayBtn) window.updatePlayBtn();
                    console.log(' Playback resumed from saved state');
                }).catch(err => {
                    console.warn(' Auto-play blocked, waiting for user interaction:', err);
                });
            }
            
            return true;
        }
        
        // Fallback: Try loading from song index
        if (saved.songIndex !== undefined && window.songs && window.songs[saved.songIndex]) {
            try {
                await window.playSong(saved.songIndex);
                setTimeout(() => {
                    if (audio && audio.duration) {
                        audio.currentTime = Math.min(saved.currentTime, audio.duration);
                        console.log(' Restored to:', saved.currentTime.toFixed(1) + 's');
                    }
                }, 500);
                return true;
            } catch (e) {
                return false;
            }
        }
        return false;
    };
    
    console.log(' Simple persistence loaded');
})();



        // ===== MEDIA SESSION API (UNTUK NOTIFIKASI MUSIK) =====
        if ('mediaSession' in navigator) {
            const audio = document.getElementById('audio-player');
            
            // Setup controls di notifikasi (Play/Pause/Next/Previous)
            navigator.mediaSession.setActionHandler('play', async () => {
                console.log(' Play triggered from notification/lockscreen');
                const audio = document.getElementById('audio-player');
                
                // Check if audio source is loaded
                if (!audio || !audio.src || audio.src === window.location.href) {
                    console.warn(' No audio loaded - trying to reload from localStorage');
                    
                    // TRY RELOAD FROM LOCALSTORAGE
                    if (window.loadSavedSongIfNeeded) {
                        const reloaded = await window.loadSavedSongIfNeeded();
                        if (reloaded) {
                            console.log(' Song reloaded from localStorage');
                            return;
                        }
                    }
                    
                    console.error(' Cannot reload - no saved song');
                    return;
                }
                
                // Save current time before any operations
                const savedTime = audio.currentTime || 0;
                console.log(' Saved time:', savedTime);
                
                try {
                    // Direct play attempt
                    await audio.play();
                    window.isPlaying = true;
                    if (window.updatePlayBtn) window.updatePlayBtn();
                    console.log(' Resumed from notification');
                } catch (error) {
                    console.error(' Failed to resume:', error.name, error.message);
                    
                    // Strategy: Reload without calling audio.load() 
                    // Instead, just try playing again after small delay
                    if (error.name === 'NotAllowedError' || error.name === 'AbortError') {
                        console.log(' Retrying without reload...');
                        setTimeout(async () => {
                            try {
                                audio.currentTime = savedTime;
                                await audio.play();
                                window.isPlaying = true;
                                if (window.updatePlayBtn) window.updatePlayBtn();
                                console.log(' Retry successful');
                            } catch (err) {
                                console.error(' Retry failed:', err);
                                // Last resort: reload but restore time
                                audio.load();
                                audio.currentTime = savedTime;
                                audio.play().catch(e => console.error('Final attempt failed:', e));
                            }
                        }, 200);
                    }
                }
            });
            
            navigator.mediaSession.setActionHandler('pause', () => {
                console.log(' Pause triggered from notification');
                window.pauseAudio();
            });
            
            navigator.mediaSession.setActionHandler('nexttrack', () => {
                console.log(' Next track triggered from notification');
                window.playNext();
            });
            
            navigator.mediaSession.setActionHandler('previoustrack', () => {
                console.log(' Previous track triggered from notification');
                window.playPrevious();
            });
            
            //  Arbitrary seek from lock screen progress bar
            navigator.mediaSession.setActionHandler('seekto', (details) => {
                console.log(' Seek to:', details.seekTime);
                if (details.seekTime !== undefined && audio.duration) {
                    audio.currentTime = Math.max(0, Math.min(audio.duration, details.seekTime));
                }
            });
            
            // Update metadata lagu di notifikasi
            audio.addEventListener('loadedmetadata', () => {
                //  Use centralized update function for consistency
                updateMediaSessionMetadata();
                console.log(' [loadedmetadata] Media Session updated');
            });
            
            // Update playback state saat play/pause
            audio.addEventListener('play', () => {
                //  CRITICAL: Set isPlaying to true immediately
                isPlaying = true;
                
                if (navigator.mediaSession) {
                    navigator.mediaSession.playbackState = 'playing';
                    // Force update metadata to ensure lock screen updates
                    updateMediaSessionMetadata();
                }
                
                // Save playback state
                savePlaybackState();
                
                console.log('[MUSIC] Audio playing - isPlaying set to true - source:', audio.src ? 'Valid' : 'MISSING');
                
                // Update new overlay progress
                if (typeof updateNewProgress === 'function') {
                    updateNewProgress();
                }
                
                // Start lyrics sync saat audio play
                const song = songs[currentSongIndex];
                if (song && lyricsDatabase[song.title]) {
                    const overlayPlayer = document.getElementById('overlay-player');
                    const lyricsContainer = document.getElementById('lyrics-overlay-container');
                    
                    if ((overlayPlayer && overlayPlayer.classList.contains('active')) ||
                        (lyricsContainer && lyricsContainer.classList.contains('active'))) {
                        lyricsState.isOpen = true;
                        startLyricsSync();
                    }
                }
            });
            
            audio.addEventListener('pause', () => {
                //  CRITICAL: Set isPlaying to false immediately
                isPlaying = false;
                
                if (navigator.mediaSession) {
                    navigator.mediaSession.playbackState = 'paused';
                    // CRITICAL: Force immediate update to ensure pause button persists on lock screen
                    updateMediaSessionMetadata();
                }
                
                // Save playback state
                savePlaybackState();
                
                console.log(' Audio paused - isPlaying set to false');
            });
            
            //  CRITICAL: Handle audio errors and stalling
            audio.addEventListener('error', (event) => {
                const error = audio.error;
                if (error) {
                    console.error('[ERROR] Audio Error Code:', error.code, 'Message:', error.message);
                    // MEDIA_ERR_ABORTED: 1
                    // MEDIA_ERR_NETWORK: 2
                    // MEDIA_ERR_DECODE: 3
                    // MEDIA_ERR_SRC_NOT_SUPPORTED: 4
                    
                    if (error.code === 4) {
                        console.warn(' Audio format not supported, trying next song...');
                        playNext();
                    } else if (error.code === 2) {
                        console.warn(' Network error, retrying audio load...');
                        setTimeout(() => {
                            if (audio.src) {
                                audio.load();
                                if (isPlaying) audio.play().catch(e => console.warn('Retry failed:', e));
                            }
                        }, 1000);
                    }
                }
            });
            
            //  Handle stalling (buffering issues)
            audio.addEventListener('stalled', () => {
                console.warn(' Audio stalled, attempting recovery...');
                if (isPlaying && audio.src) {
                    const saveTime = audio.currentTime;
                    audio.currentTime = saveTime; // Trigger re-buffering
                }
            });
            
            //  Handle suspend (playback suspended)
            audio.addEventListener('suspend', () => {
                console.warn(' Audio playback suspended');
                if (isPlaying && audio.src && audio.paused) {
                    console.log(' Attempting to resume...');
                    audio.play().catch(e => console.warn('Resume failed:', e));
                }
            });
            
            // Update position state (untuk seek bar di notifikasi)
            let lastSaveTime = 0;
            audio.addEventListener('timeupdate', () => {
                if ('setPositionState' in navigator.mediaSession && !isNaN(audio.duration)) {
                    navigator.mediaSession.setPositionState({
                        duration: audio.duration,
                        playbackRate: audio.playbackRate,
                        position: audio.currentTime
                    });
                }
                
                // CRITICAL: Auto-save playback state every 5 seconds
                const now = Date.now();
                if (now - lastSaveTime > 5000) { // 5 seconds
                    lastSaveTime = now;
                    if (window.savePlaybackState) {
                        window.savePlaybackState();
                    }
                }
            });
        }
        
        // Function to update Media Session metadata (persists pause button state longer)
        function updateMediaSessionMetadata() {
            if (!navigator.mediaSession) return;
            
            const song = songs[currentSongIndex];
            if (!song) return;
            
            try {
                //  CRITICAL FIX: Clear metadata first to force refresh
                navigator.mediaSession.metadata = null;
                
                //  Re-register ALL handlers every time to ensure they work
                // This prevents handlers from becoming stale after song changes
                navigator.mediaSession.setActionHandler('play', () => {
                    console.log(' [MediaSession] Play triggered from notification');
                    const audio = document.getElementById('audio-player');
                    
                    if (!audio) {
                        console.error(' Audio element not found!');
                        return;
                    }
                    
                    // CRITICAL: Jika audio source hilang, restore dari localStorage
                    if (!audio.src || audio.error) {
                        console.warn(' Audio source missing! Restoring from saved state...');
                        
                        try {
                            const saved = localStorage.getItem('vidjeAudioPersistence');
                            if (saved) {
                                const state = JSON.parse(saved);
                                
                                // Restore audio source
                                if (state.audioSrc) {
                                    audio.src = state.audioSrc;
                                    audio.load();
                                    
                                    // Restore position and play
                                    audio.addEventListener('loadedmetadata', () => {
                                        audio.currentTime = state.currentTime || 0;
                                        audio.play().then(() => {
                                            isPlaying = true;
                                            updatePlayBtn();
                                            console.log(' Audio restored and playing!');
                                        }).catch(err => {
                                            console.error(' Failed to play restored audio:', err);
                                        });
                                    }, { once: true });
                                    
                                    return;
                                }
                            }
                            
                            // Jika tidak ada saved state, load song dari index
                            if (songs[currentSongIndex]) {
                                loadSong(songs[currentSongIndex]);
                                audio.play().catch(err => console.error('Play error:', err));
                            }
                        } catch (err) {
                            console.error(' Restoration failed:', err);
                        }
                    } else {
                        // Audio source ada, langsung play
                        audio.play().then(() => {
                            isPlaying = true;
                            updatePlayBtn();
                            console.log(' Resumed from pause');
                        }).catch(err => {
                            console.error(' Play error:', err);
                            
                            // Retry dengan reload
                            audio.load();
                            setTimeout(() => {
                                audio.play().catch(e => console.error('Retry failed:', e));
                            }, 500);
                        });
                    }
                });
                
                navigator.mediaSession.setActionHandler('pause', () => {
                    console.log(' [MediaSession] Pause triggered from notification');
                    const audio = document.getElementById('audio-player');
                    if (audio) {
                        audio.pause();
                        //  CRITICAL: Update global state immediately
                        isPlaying = false;
                        updatePlayBtn();
                        console.log(' isPlaying set to FALSE - audio will NOT auto-resume');
                    }
                });
                
                navigator.mediaSession.setActionHandler('nexttrack', () => {
                    console.log(' [MediaSession] Next triggered');
                    playNext();
                });
                
                navigator.mediaSession.setActionHandler('previoustrack', () => {
                    console.log(' [MediaSession] Previous triggered');
                    playPrevious();
                });
                
                navigator.mediaSession.setActionHandler('seekto', (details) => {
                    const audio = document.getElementById('audio-player');
                    if (audio && details.seekTime !== undefined) {
                        audio.currentTime = details.seekTime;
                    }
                });
                
                //  Set fresh metadata AFTER handlers are registered
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: song.title || 'Pilih Lagu',
                    artist: song.artist || 'Vidje',
                    album: song.album || 'Music Platform',
                    artwork: [
                        { src: song.cover, sizes: '96x96', type: 'image/jpeg' },
                        { src: song.cover, sizes: '128x128', type: 'image/jpeg' },
                        { src: song.cover, sizes: '192x192', type: 'image/jpeg' },
                        { src: song.cover, sizes: '256x256', type: 'image/jpeg' },
                        { src: song.cover, sizes: '384x384', type: 'image/jpeg' },
                        { src: song.cover, sizes: '512x512', type: 'image/jpeg' }
                    ]
                });
                
                // Force update playback state (critical for pause button persistence)
                navigator.mediaSession.playbackState = isPlaying ? 'playing' : 'paused';
                
                // Update position state immediately
                if ('setPositionState' in navigator.mediaSession && audio && !isNaN(audio.duration)) {
                    navigator.mediaSession.setPositionState({
                        duration: audio.duration,
                        playbackRate: audio.playbackRate,
                        position: audio.currentTime
                    });
                }
                
                console.log(' Media Session FULLY updated - State:', isPlaying ? 'playing' : 'paused', '| Song:', song.title);
            } catch (error) {
                console.warn(' Error updating Media Session:', error);
            }
        }
        
        // ===== ULTRA PERSISTENT AUDIO KEEP-ALIVE SYSTEM =====
        // Multi-layer strategy untuk menjaga audio tetap hidup BERHARI-HARI
        
        // Layer 1: Simpan state lengkap ke localStorage setiap saat
        let lastKnownState = {
            songIndex: 0,
            currentTime: 0,
            isPaused: false,
            timestamp: Date.now()
        };
        
        function saveAudioState() {
            const audio = document.getElementById('audio-player');
            if (!audio || !audio.src) return;
            
            lastKnownState = {
                songIndex: currentSongIndex,
                currentTime: audio.currentTime || 0,
                isPaused: audio.paused,
                isPlaying: isPlaying,
                audioSrc: audio.src,
                timestamp: Date.now()
            };
            
            localStorage.setItem('vidjeAudioPersistence', JSON.stringify(lastKnownState));
            console.log(' Audio state saved - isPaused:', lastKnownState.isPaused, '| isPlaying:', lastKnownState.isPlaying);
        }
        
        // Simpan state setiap 5 detik (termasuk saat pause)
        setInterval(saveAudioState, 5000);
        
        // Simpan juga saat pause
        audio.addEventListener('pause', () => {
            saveAudioState();
            console.log(' State saved on pause');
        });
        
        // Layer 2: Restore state saat page load (bahkan setelah berhari-hari)
        function restoreAudioState() {
            try {
                // CRITICAL: Try using saved audio source first for instant recovery
                const savedAudioSource = localStorage.getItem('vidjeAudioSource');
                const savedState = localStorage.getItem('vidjePlaybackState');
                
                if (!savedState) {
                    // Fallback ke sistem lama
                    const oldSaved = localStorage.getItem('vidjeAudioPersistence');
                    if (!oldSaved) return false;
                    
                    const state = JSON.parse(oldSaved);
                    const hoursSinceLastSave = (Date.now() - state.timestamp) / (1000 * 60 * 60);
                    
                    console.log(' Restoring audio state from', hoursSinceLastSave.toFixed(1), 'hours ago');
                    
                    const audio = document.getElementById('audio-player');
                    if (!audio) return false;
                    
                    // Load song by index
                    if (songs[state.songIndex]) {
                        loadSong(songs[state.songIndex]);
                        
                        // Wait for audio to be ready, then restore position
                        audio.addEventListener('loadedmetadata', () => {
                            audio.currentTime = state.currentTime;
                            console.log(' Audio restored to', state.currentTime.toFixed(1), 'seconds');
                            
                            // Update Media Session dengan state yang benar
                            updateMediaSessionMetadata();
                            
                            // Jangan auto-play jika sebelumnya pause
                            if (!state.isPaused && state.isPlaying) {
                                audio.play().catch(err => {
                                    console.log(' Auto-play blocked (user interaction required)');
                                });
                            }
                        }, { once: true });
                        
                        return true;
                    }
                    return false;
                }
                
                // NEW: Use comprehensive saved state
                const state = JSON.parse(savedState);
                const hoursSinceLastSave = (Date.now() - state.timestamp) / (1000 * 60 * 60);
                
                console.log(' Restoring from comprehensive state saved', hoursSinceLastSave.toFixed(1), 'hours ago');
                
                const audio = document.getElementById('audio-player');
                if (!audio) return false;
                
                // INSTANT RESTORE: Set audio source directly
                if (savedAudioSource) {
                    console.log(' Instant restore from saved audio source');
                    audio.src = savedAudioSource;
                    audio.preload = 'metadata';
                    
                    // Restore Media Session metadata
                    if ('mediaSession' in navigator && state.songTitle) {
                        navigator.mediaSession.metadata = new MediaMetadata({
                            title: state.songTitle || 'Unknown',
                            artist: state.songArtist || 'Unknown Artist',
                            album: state.songAlbum || 'Unknown Album',
                            artwork: [
                                { src: state.songCover || 'https://picsum.photos/512', sizes: '512x512', type: 'image/jpeg' }
                            ]
                        });
                    }
                    
                    // Restore playback position
                    audio.addEventListener('loadedmetadata', () => {
                        if (state.currentTime) {
                            audio.currentTime = Math.min(state.currentTime, audio.duration || 0);
                            console.log(' Position restored to', state.currentTime.toFixed(1), 'seconds');
                        }
                        
                        // Update Media Session
                        updateMediaSessionMetadata();
                        
                        // Don't auto-play, wait for user interaction
                        console.log(' Audio ready - waiting for user to press play');
                    }, { once: true });
                    
                    return true;
                }
                
            } catch (err) {
                console.error(' Failed to restore audio state:', err);
            }
            return false;
        }
        
        // Restore on page load
        if (songs.length > 0) {
            restoreAudioState();
        }
        
        // Layer 3: Keep Media Session ALIVE dengan heartbeat yang lebih agresif
        setInterval(() => {
            if (navigator.mediaSession) {
                // Selalu update, tidak peduli app hidden atau visible
                updateMediaSessionMetadata();
                
                // Force set playback state
                if (navigator.mediaSession.playbackState !== (isPlaying ? 'playing' : 'paused')) {
                    navigator.mediaSession.playbackState = isPlaying ? 'playing' : 'paused';
                }
                
                console.log(' Media Session heartbeat - keeping controls alive');
            }
        }, 5000); // Setiap 5 detik, lebih sering dari sebelumnya
        
        // Layer 4: Ping audio element untuk mencegah garbage collection
        setInterval(() => {
            const audio = document.getElementById('audio-player');
            if (!audio) return;
            
            // Touch the audio element to keep it in memory
            const state = {
                src: audio.src,
                paused: audio.paused,
                duration: audio.duration,
                currentTime: audio.currentTime,
                readyState: audio.readyState
            };
            
            // Jika audio source hilang tapi kita punya state, restore TANPA auto-play
            if (!audio.src && lastKnownState.audioSrc) {
                console.warn(' Audio source lost! Restoring from saved state...');
                audio.src = lastKnownState.audioSrc;
                audio.currentTime = lastKnownState.currentTime;
                audio.load();
                //  REMOVED: Jangan auto-play, biarkan user yang trigger
            }
            
            //  FIXED: Hanya resume jika isPlaying === true DAN user memang sedang play
            // Jangan auto-resume jika user sudah pause
            if (isPlaying && audio.paused && audio.src && !lastKnownState.isPaused) {
                console.log(' Audio suspended while playing, attempting resume...');
                audio.play().catch(err => {
                    console.log(' Resume blocked:', err.message);
                });
            }
            
            console.log(' Audio health check:', state.readyState, '| Paused:', state.paused, '| isPlaying:', isPlaying);
        }, 10000); // Setiap 10 detik
        
        // Layer 5: Service Worker Sync untuk maintenance di background
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
            // Kirim keepalive message ke service worker
            setInterval(() => {
                navigator.serviceWorker.controller.postMessage({
                    type: 'AUDIO_KEEPALIVE',
                    state: lastKnownState
                });
            }, 30000); // Setiap 30 detik
        }
        
        // Layer 6: Visibility change handler - restore saat kembali ke app
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                console.log(' App became visible - checking audio state...');
                
                const audio = document.getElementById('audio-player');
                if (!audio) return;
                
                // Restore dari localStorage jika perlu (TANPA auto-play)
                if (!audio.src || audio.error) {
                    console.warn(' Audio needs restoration');
                    restoreAudioState();
                }
                
                // Update Media Session
                updateMediaSessionMetadata();
                
                //  FIXED: Hanya resume jika benar-benar sedang playing (bukan pause)
                // Check lastKnownState untuk memastikan user tidak sengaja pause
                if (isPlaying && audio.paused && audio.src && !lastKnownState.isPaused) {
                    console.log(' Resuming playback (was playing before background)');
                    audio.play().catch(err => {
                        console.log(' Auto-resume on visibility change blocked');
                    });
                } else if (lastKnownState.isPaused) {
                    console.log(' Audio was paused - NOT auto-resuming');
                }
            } else {
                console.log(' App hidden - saving state...');
                saveAudioState();
            }
        });
        
        // Layer 7: Window unload - save state sebelum close
        window.addEventListener('beforeunload', () => {
            saveAudioState();
            console.log(' Final state save before unload');
        });
        
        console.log(' Ultra Persistent Keep-Alive System initialized');
        console.log(' Audio will persist for DAYS even when paused');
        
        // ===== PWA INSTALL PROMPT =====
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('[OK] PWA Install Prompt Available');
            e.preventDefault();
            deferredPrompt = e;

            // Create install button
            const btn = document.createElement('button');
            btn.id = 'pwa-install-btn';
            btn.innerHTML = ' Download App';
            btn.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 99999;
                padding: 12px 20px;
                background: #e50914;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-weight: bold;
                font-size: 14px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            `;

            btn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const choice = await deferredPrompt.userChoice;
                    console.log('Installation choice:', choice.outcome);
                    deferredPrompt = null;
                    btn.remove();
                }
            };

            document.body.appendChild(btn);
            console.log(' Install button added to page');
        });

        window.addEventListener('appinstalled', () => {
            console.log('[OK] App installed successfully!');
            deferredPrompt = null;
        });

        // Tambahkan fungsi-fungsi ini di bagian JavaScript (sebelum closing script tag)

// SHARE CURRENT PLAYLIST
window.shareCurrentPlaylist = function() {
    if(!currentPlaylistId) {
        showToast(' ' + window.t('no-active-playlist'), 'error');
        return;
    }
    window.openShareModal('playlist', currentPlaylistId);
};

// SHARE ALBUM - Fixed with proper escaping and error handling
window.shareAlbum = function(albumName, albumCover, songIdStart, songIdEnd) {
    if(!auth.currentUser) {
        showToast(' Silakan login terlebih dahulu', 'error');
        return;
    }
    
    const modal = document.getElementById('share-modal');
    const list = document.getElementById('share-friend-list');
    const loading = document.getElementById('share-loading');
    
    modal.classList.add('open');
    list.innerHTML = '';
    loading.style.display = 'block';

    // Store data untuk sharing
    window.currentShareData = {
        type: 'album',
        name: albumName,
        cover: albumCover
    };

    // Get Friend List
    get(ref(db, `users/${auth.currentUser.uid}/friends`)).then(snap => {
        loading.style.display = 'none';
        const friends = snap.val() || {};
        if(!Object.keys(friends).length) {
            list.innerHTML = '<div style="text-align:center; padding:20px; color:#888">' + window.t('no-you-have-friends') + '</div>';
            return;
        }

        let promises = [];
        let friendsData = [];
        
        Object.keys(friends).forEach(friendUid => {
            const promise = get(ref(db, `users/${friendUid}`)).then(uSnap => {
                const u = uSnap.val();
                if (u) {
                    friendsData.push({
                        uid: friendUid,
                        username: u.username,
                        profile_picture: u.profile_picture
                    });
                }
            });
            promises.push(promise);
        });
        
        Promise.all(promises).then(() => {
            let html = '';
            friendsData.forEach(friend => {
                html += `
                    <div class="playlist-select-item" data-friend-uid="${friend.uid}" onclick="window.executeShareAlbum('${friend.uid}')">
                        <img src="${friend.profile_picture}" style="width:40px;height:40px;border-radius:50%;">
                        <div>${friend.username}</div>
                    </div>
                `;
            });
            list.innerHTML = html;
        });
    }).catch(error => {
        console.error('Error loading friends:', error);
        loading.style.display = 'none';
        list.innerHTML = '<div style="text-align:center; padding:20px; color:#888">Gagal memuat daftar teman</div>';
    });
};

// EXECUTE SHARE ALBUM - Works with stored data
window.executeShareAlbum = function(targetUid) {
    if (!window.currentShareData) {
        showToast(' Data share tidak ditemukan', 'error');
        return;
    }
    
    const myUid = auth.currentUser.uid;
    const chatId = getChatId(myUid, targetUid);
    const shareData = window.currentShareData;
    
    const msgPayload = {
        sender: myUid,
        text: "Membagikan album",
        timestamp: Date.now(),
        shareType: 'album',
        shareContent: { 
            name: shareData.name, 
            cover: shareData.cover 
        }
    };

    push(ref(db, `chats/${chatId}/messages`), msgPayload).then(() => {
        closeModal('share-modal');
        showToast(' Album berhasil dibagikan!', 'success');
        window.currentShareData = null; // Clean up
    }).catch(error => {
        console.error('Error sharing album:', error);
        showToast(' Gagal membagikan album', 'error');
    });
};

// Helper function untuk console log debugging
console.log('[OK] Share functions loaded:', {
    shareAlbum: typeof window.shareAlbum,
    shareCurrentPlaylist: typeof window.shareCurrentPlaylist,
    executeShareAlbum: typeof window.executeShareAlbum
});

// OPEN PLAYLIST SETTINGS
window.openPlaylistSettings = function() {
    if(!currentPlaylistId || !currentUserData || !currentUserData.playlists) {
        showToast(' Tidak dapat membuka pengaturan', 'error');
        return;
    }
    
    const playlist = currentUserData.playlists[currentPlaylistId];
    if(!playlist) {
        showToast(' Playlist tidak ditemukan', 'error');
        return;
    }
    
    // Set current values
    document.getElementById('settings-playlist-name').value = playlist.name;
    document.getElementById('settings-cover-preview').src = playlist.cover;
    
    // Open modal
    document.getElementById('playlist-settings-modal').classList.add('open');
};

// HANDLE COVER UPLOAD IN SETTINGS
window.handleSettingsCoverUpload = function(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('settings-cover-preview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
};


// SAVE PLAYLIST SETTINGS
window.savePlaylistSettings = function() {
    if(!currentPlaylistId || !auth.currentUser) {
        showToast(' Gagal menyimpan', 'error');
        return;
    }
    
    const newName = document.getElementById('settings-playlist-name').value.trim();
    const newCover = document.getElementById('settings-cover-preview').src;
    
    if(!newName) {
        showToast(' Nama playlist tidak boleh kosong', 'error');
        return;
    }
    
    // Update to Firebase
    update(ref(db, `users/${auth.currentUser.uid}/playlists/${currentPlaylistId}`), {
        name: newName,
        cover: newCover
    }).then(() => {
        showToast(' Playlist berhasil diperbarui!', 'success');
        
        // Update UI immediately
        document.getElementById('playlist-title-view').innerText = newName;
        document.getElementById('playlist-cover-view').src = newCover;
        
        // Update background gradient
        const coverEl = document.getElementById('playlist-cover-view');
        coverEl.onload = function() {
            const rgb = getAverageRGB(coverEl);
            const color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            document.getElementById('playlist-header-bg').style.background = `linear-gradient(180deg, ${color} 0%, var(--bg-dark) 100%)`;
        };
        
        // Close modal
        closeModal('playlist-settings-modal');
        
        // Reload sidebar to reflect changes
        setTimeout(() => {
            if(currentUserData && currentUserData.playlists) {
                renderSidebarPlaylists(currentUserData.playlists);
            }
        }, 300);
    }).catch(error => {
        console.error('Error updating playlist:', error);
        showToast(' Gagal menyimpan perubahan', 'error');
    });
};

// === FINAL SAFEGUARD: SETUP LISTEN TOGETHER LISTENER ===
// Pastikan listener terpasang meskipun onclick inline gagal
document.addEventListener('DOMContentLoaded', function() {
    console.log('[OK] DOMContentLoaded: Setting up Listen Together button...');
    const ltBtn = document.getElementById('btn-open-listen-together');
    
    if (ltBtn) {
        console.log('[OK] Button Listen Together ditemukan!');
        ltBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log(' Tombol Dengar Bareng diklik (Event Listener)!');
            if (typeof window.openListenTogether === 'function') {
                window.openListenTogether();
            } else {
                alert('CRITICAL ERROR: Fungsi openListenTogether belum dimuat!');
            }
        });
    } else {
        console.error('[ERROR] Button Listen Together TIDAK DITEMUKAN');
    }
    
    //  RESET: Clear playback state on refresh
    // User will start fresh and select a song manually
    console.log(' Clearing playback state for fresh start...');
    localStorage.removeItem('currentSongId');
    localStorage.removeItem('currentSongPaused');
    localStorage.removeItem('vidjePlaybackState');
    console.log('[OK] Playback state cleared - user must select a song manually');
});

// ===== DIAGNOSTIC TOOLS =====
async function checkBucketAccess() {
    console.log(" Checking Supabase bucket access...");
    // Try to access a known public file (album cover)
    const { data } = supabase.storage.from('vidje').getPublicUrl('albumphoto/afgan.png');
    
    try {
        const response = await fetch(data.publicUrl, { method: 'HEAD' });
        console.log(` Bucket Check: ${data.publicUrl} -> Status: ${response.status}`);
        
        if (response.status === 403 || response.status === 400) {
            console.error(" ACCESS DENIED! Supabase Read Policy is missing.");
            alert(" PERHATIAN: Lagu dan Gambar tidak muncul karena Policy 'SELECT' belum aktif di Supabase.\n\nSilakan jalankan perintah SQL 'CREATE POLICY... FOR SELECT' di Supabase Dashboard.");
        } else if (response.status === 404) {
             console.warn(" File check 404 (Mungkin file belum ada, tapi akses publik mungkin OK)");
        } else if (response.status === 200) {
            console.log(" Bucket public access is OK.");
        }
    } catch (e) {
        console.error(" Network check failed:", e);
    }
}

// ===== LOAD SONGS FROM SUPABASE STORAGE (AUTO-DETECT ALL FOLDERS) =====
async function loadSongsFromSupabase() {
    try {
        console.log(' Loading songs from Supabase storage...');
        
        // Step 1: List all folders in vidje bucket
        const { data: folders, error: folderError } = await supabase.storage
            .from('vidje')
            .list('', {
                limit: 100,
                offset: 0
            });

        if (folderError) {
            console.error('[ERROR] Error listing folders:', folderError);
            return 0;
        }

        console.log(' Found folders:', folders.map(f => f.name).join(', '));

        let loadedCount = 0;
        let currentId = 20000; // Start ID for Supabase songs

        // Step 2: Loop through each folder
        for (const folder of folders) {
            // Skip if it's a file (not a folder)
            if (!folder.id || folder.name.includes('.')) continue;
            
            const folderName = folder.name;
            
            // Skip non-music folders
            if (folderName === 'album photo' || folderName === 'albumphoto' || folderName === 'songs') {
                console.log(` Skipping: ${folderName}`);
                continue;
            }

            console.log(` Processing folder: ${folderName}`);
            
            // Step 3: List all files in this folder
            const { data: musicFiles, error: musicError } = await supabase.storage
                .from('vidje')
                .list(folderName, {
                    limit: 100,
                    offset: 0,
                    sortBy: { column: 'name', order: 'asc' }
                });

            if (musicError) {
                console.error(` Error listing ${folderName}:`, musicError);
                continue;
            }

            if (!musicFiles || musicFiles.length === 0) {
                console.log(`[WARN] No files in ${folderName}`);
                continue;
            }

            // Step 4: Detect artist name from folder
            const artistName = detectArtistName(folderName);
            
            // Step 5: Get default cover for this artist
            const defaultCover = getDefaultCover(folderName);

            // Step 6: Process each MP3 file
            for (const file of musicFiles) {
                if (!file.name.endsWith('.mp3') && !file.name.endsWith('.MP3')) continue;

                const songId = currentId++;
                
                // Get public URL for music
                const { data: musicUrl } = supabase.storage
                    .from('vidje')
                    .getPublicUrl(`${folderName}/${file.name}`);

                // Extract song title from filename
                const songTitle = cleanSongTitle(file.name);

                // Check for corresponding cover image
                let coverUrl = defaultCover;
                
                const coverFileName = file.name.replace(/\.mp3$/i, '.jpg');
                const { data: coverCheck } = await supabase.storage
                    .from('vidje')
                    .list(folderName);

                if (coverCheck && coverCheck.find(f => f.name.toLowerCase() === coverFileName.toLowerCase())) {
                    const { data: coverUrlData } = supabase.storage
                        .from('vidje')
                        .getPublicUrl(`${folderName}/${coverFileName}`);
                    coverUrl = coverUrlData.publicUrl;
                }

                // Create song object
                const songData = {
                    id: songId,
                    title: songTitle,
                    artist: artistName,
                    album: 'Studio Albums',
                    duration: '3:30',
                    cover: coverUrl,
                    src: musicUrl.publicUrl,
                    storage: 'supabase',
                    isPublic: true
                };

                // Add to songs array if not exists
                if (!songs.find(s => s.src === musicUrl.publicUrl)) {
                    songs.push(songData);
                    loadedCount++;
                    console.log(`   ${songTitle}`);
                }
            }
        }

        console.log(` Successfully loaded ${loadedCount} songs from Supabase!`);
        console.log(` Total songs in library: ${songs.length}`);
        
        return loadedCount;

    } catch (error) {
        console.error('[ERROR] Error loading songs from Supabase:', error);
        return 0;
    }
}

// Helper: Detect artist name from folder name
function detectArtistName(folderName) {
    const artistMap = {
        'afgan': 'Afgan',
        'astrid': 'Astrid',
        'brunomars': 'Bruno Mars',
        'coldplay': 'Coldplay',
        'danielcaesar': 'Daniel Caesar',
        'edsheeran': 'Ed Sheeran',
        'greenday': 'Green Day',
        'justinbieber': 'Justin Bieber',
        'mahalini': 'Mahalini',
        'oasis': 'Oasis',
        'onedirection': 'One Direction',
        'radiohead': 'Radiohead',
        'taylorswift': 'Taylor Swift',
        'tenxi': 'Tenxi',
        'tulus': 'Tulus'
    };

    return artistMap[folderName.toLowerCase()] || 
           folderName.charAt(0).toUpperCase() + folderName.slice(1);
}

// Helper: Get default cover for artist
function getDefaultCover(folderName) {
    // Perbaikan: Gunakan 'albumphoto' (tanpa spasi) sesuai format URL yang diinginkan user
    // dan generate Full Public URL dari Supabase
    const coverMap = {
        'afgan': 'albumphoto/afgan.png',
        'astrid': 'albumphoto/astrid.webp',
        'brunomars': 'albumphoto/bruno.jpg',
        'coldplay': 'albumphoto/coldplay.jpg',
        'danielcaesar': 'albumphoto/daniel.jpg',
        'edsheeran': 'albumphoto/ed.jpg',
        'greenday': 'albumphoto/greenday.jpg',
        'justinbieber': 'albumphoto/justin.jpg',
        'mahalini': 'albumphoto/mahalini.jpg',
        'oasis': 'albumphoto/oasis.jpg',
        'onedirection': 'albumphoto/onedirection.jpg',
        'radiohead': 'albumphoto/radiohead.jpg',
        'taylorswift': 'albumphoto/taylor.jpg',
        'tenxi': 'albumphoto/tenxi.jpg',
        'tulus': 'albumphoto/tulus.jpg'
    };

    const path = coverMap[folderName.toLowerCase()];
    
    if (path) {
        const { data } = supabase.storage
            .from('vidje')
            .getPublicUrl(path);
        return data.publicUrl;
    }

    return `https://picsum.photos/seed/${folderName}/300/300`;
}

// Helper: Clean song title from filename
function cleanSongTitle(filename) {
    return filename
        .replace(/\.mp3$/i, '')
        .replace(/\.MP3$/i, '')
        .replace(/_/g, ' ')
        .replace(/-/g, ' ')
        .replace(/\s+/g, ' ')
        .trim()
        // Capitalize first letter of each word
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
        .join(' ');
}


// TEST: Tambahkan dummy text saat page load untuk debug
window.addEventListener('DOMContentLoaded', () => {
    console.log('[DEBUG] DEBUG: Testing lyrics elements...');
    
    const overlayLyricsContent = document.getElementById('overlay-lyrics-content');
    if (overlayLyricsContent) {
        console.log('[OK] overlay-lyrics-content found');
        console.log('  - Display:', window.getComputedStyle(overlayLyricsContent).display);
        console.log('  - Visibility:', window.getComputedStyle(overlayLyricsContent).visibility);
        console.log('  - Opacity:', window.getComputedStyle(overlayLyricsContent).opacity);
        console.log('  - Width:', window.getComputedStyle(overlayLyricsContent).width);
        console.log('  - Height:', window.getComputedStyle(overlayLyricsContent).height);
        
        // Tambahkan test text
        overlayLyricsContent.innerHTML = '<div style="color: red; font-size: 24px; padding: 20px;">TEST LIRIK - Jika Anda melihat ini, element berfungsi!</div>';
    } else {
        console.error('[ERROR] overlay-lyrics-content NOT found');
    }
    
    const overlayPlayer = document.getElementById('overlay-player');
    if (overlayPlayer) {
        console.log('[OK] overlay-player found');
        console.log('  - Display:', window.getComputedStyle(overlayPlayer).display);
        console.log('  - Has active class:', overlayPlayer.classList.contains('active'));
    } else {
        console.error('[ERROR] overlay-player NOT found');
    }
});


// Update lyrics button indicator when song changes
function updateLyricsButtonIndicator() {
    const currentSong = songs[currentSongIndex];
    if (!currentSong) return;
    
    const hasLyrics = lyricsDatabase && lyricsDatabase[currentSong.title];
    
    // Find all lyrics buttons
    const lyricsButtons = document.querySelectorAll('[onclick*="openNewLyricsOverlay"]');
    
    lyricsButtons.forEach(btn => {
        if (hasLyrics) {
            btn.classList.add('lyrics-available-indicator');
            btn.style.background = 'rgba(229,9,20,0.3)';
        } else {
            btn.classList.remove('lyrics-available-indicator');
            btn.style.background = 'rgba(229,9,20,0.1)';
        }
    });
}

// Call this function whenever song changes
// Hook into existing loadSong or playSong function
const originalLoadSong = window.loadSong;
if (originalLoadSong) {
    window.loadSong = function(index) {
        originalLoadSong(index);
        setTimeout(updateLyricsButtonIndicator, 100);
        
        // Update new overlay progress bar when song loads
        setTimeout(function() {
            if (typeof updateNewProgress === 'function') {
                updateNewProgress();
            }
        }, 200);
    };
}

console.log('[OK] Lyrics button indicator ready');


// ============================================
//  BACKGROUND PLAYBACK SUPPORT
// ============================================

/**
 * PWA Background Playback Handler
 * Allows music to continue playing when app is in background
 * Supports media controls (skip, pause, play) from lock screen/notification
 */

let backgroundPlaybackState = {
    enabled: false,
    keepAliveInterval: null,
    lastActivityTime: Date.now()
};

// Initialize background playback
function initBackgroundPlayback() {
    console.log('[MUSIC] Initializing background playback support...');
    
    // Check if browser supports background playback
    if (!navigator.mediaSession) {
        console.warn(' Media Session API not supported');
        return;
    }
    
    backgroundPlaybackState.enabled = true;
    
    //  1. Keep app alive in background using wake lock (if available)
    setupWakeLock();
    
    //  2. Setup message listener for media controls
    setupMediaControlListener();
    
    //  3. Enhanced Media Session handlers
    setupEnhancedMediaSession();
    
    //  4. Prevent app from being garbage collected
    setupBackgroundKeepAlive();
    
    console.log('[OK] Background playback initialized');
}

//  WAKE LOCK: Keep device awake while playing
async function setupWakeLock() {
    if (!('wakeLock' in navigator)) {
        console.warn(' Wake Lock API not supported on this device');
        return;
    }
    
    const audio = document.getElementById('audio-player');
    if (!audio) return;
    
    let wakeLock = null;
    
    async function requestWakeLock() {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
            console.log(' Wake Lock acquired - screen will stay on');
            
            // Release wake lock when paused
            wakeLock.addEventListener('release', () => {
                console.log(' Wake Lock released');
            });
        } catch (error) {
            console.warn(' Wake Lock failed:', error);
        }
    }
    
    // Request wake lock when playing
    audio.addEventListener('play', () => {
        if (!wakeLock && isPlaying) {
            requestWakeLock();
        }
        // Update new overlay play button
        if (typeof updateNewPlayButton === 'function') {
            updateNewPlayButton();
        }
    });
    
    // Release wake lock when paused
    audio.addEventListener('pause', () => {
        if (wakeLock) {
            wakeLock.release();
            wakeLock = null;
        }
        // Update new overlay play button
        if (typeof updateNewPlayButton === 'function') {
            updateNewPlayButton();
        }
    });
    
    // Handle page visibility - release on hidden, request on visible
    document.addEventListener('visibilitychange', () => {
        const audio = document.getElementById('audio-player');
        
        if (document.hidden) {
            // App in background - keep playing
            console.log(' App hidden - keeping playback active');
            // Do NOT pause audio when hidden
        } else {
            // App back in foreground
            console.log(' App visible - checking audio state');
            
            if (!wakeLock && isPlaying) {
                requestWakeLock();
            }
            
            // FIX: Resume audio if it was supposed to be playing
            if (isPlaying && audio && audio.paused) {
                console.log(' Resuming audio from background...');
                audio.play().catch(err => {
                    console.warn('Failed to resume:', err);
                    // Reload and try again
                    if (err.name === 'AbortError' || err.name === 'NotSupportedError') {
                        audio.load();
                        setTimeout(() => {
                            audio.play().catch(e => console.error('Reload play failed:', e));
                        }, 100);
                    }
                });
            }
        }
    });
}

//  LISTEN untuk media controls dari notification/lock screen
function setupMediaControlListener() {
    // Listen untuk pesan dari service worker
    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
        navigator.serviceWorker.addEventListener('message', (event) => {
            console.log(' Media control message:', event.data);
            
            const { action } = event.data;
            
            switch (action) {
                case 'play':
                    window.playAudio();
                    break;
                case 'pause':
                    window.pauseAudio();
                    break;
                case 'next':
                    playNext();
                    break;
                case 'previous':
                    playPrevious();
                    break;
                case 'seek':
                    const audio = document.getElementById('audio-player');
                    if (audio) {
                        audio.currentTime = event.data.time;
                    }
                    break;
            }
        });
    }
}

//  Helper function to play audio
function playAudio() {
    const audio = document.getElementById('audio-player');
    if (!audio) return;
    
    if (!audio.src || audio.src === window.location.href) {
        console.warn(" Audio source is empty, cannot play.");
        return; 
    }
    
    // Check if audio is suspended or needs reloading
    if (audio.readyState === 0) {
        console.log(' Audio not ready, loading...');
        audio.load();
    }
    
    const playPromise = audio.play();
    
    if (playPromise !== undefined) {
        playPromise.then(_ => {
            isPlaying = true;
            updatePlayBtn();
            console.log('[OK] Audio playback started');
            
            // Update media session state
            if ('mediaSession' in navigator && navigator.mediaSession) {
                navigator.mediaSession.playbackState = 'playing';
            }
        })
        .catch(error => {
            console.error(" Audio Play Error:", error);
            
            // Retry jika ada temporary issue
            if (error.name === 'NotAllowedError' || error.name === 'NotSupportedError') {
                console.log(' Retrying play after reload...');
                audio.load();
                setTimeout(() => {
                    audio.play().then(() => {
                        isPlaying = true;
                        updatePlayBtn();
                        if ('mediaSession' in navigator && navigator.mediaSession) {
                            navigator.mediaSession.playbackState = 'playing';
                        }
                    }).catch(err => {
                        console.error(" Retry play failed:", err);
                        isPlaying = false;
                        updatePlayBtn();
                    });
                }, 300);
            } else if (error.name === 'AbortError') {
                // Audio was interrupted, try again
                console.log(' Play interrupted, retrying...');
                setTimeout(() => {
                    audio.play().catch(err => console.error('Retry failed:', err));
                }, 100);
            } else {
                isPlaying = false;
                updatePlayBtn();
            }
        });
    }
}

//  Helper function to pause audio
function pauseAudio() {
    const audio = document.getElementById('audio-player');
    if (!audio) return;
    
    audio.pause();
    isPlaying = false;
    updatePlayBtn();
    console.log('[OK] Audio paused');
}

// Export to window for media session handlers
if (typeof window.playAudio === 'undefined') window.playAudio = playAudio;
if (typeof window.pauseAudio === 'undefined') window.pauseAudio = pauseAudio;

//  ENHANCED MEDIA SESSION dengan error handling
function setupEnhancedMediaSession() {
    if (!('mediaSession' in navigator)) {
        console.warn(' Media Session API not supported');
        return;
    }
    
    const audio = document.getElementById('audio-player');
    if (!audio) return;
    
    //  Play action
    navigator.mediaSession.setActionHandler('play', () => {
        console.log(' Play triggered from media control');
        window.playAudio();
    });
    
    //  Pause action
    navigator.mediaSession.setActionHandler('pause', () => {
        console.log(' Pause triggered from media control');
        window.pauseAudio();
    });
    
    //  Next track
    navigator.mediaSession.setActionHandler('nexttrack', () => {
        console.log(' Next triggered from media control');
        playNext();
    });
    
    //  Previous track
    navigator.mediaSession.setActionHandler('previoustrack', () => {
        console.log(' Previous triggered from media control');
        playPrevious();
    });
    
    //  Seek backward (rewind 10s)
    navigator.mediaSession.setActionHandler('seekbackward', (details) => {
        console.log(' Seek backward:', details.seekTime);
        const newTime = Math.max(0, audio.currentTime - 10);
        audio.currentTime = newTime;
    });
    
    //  Seek forward (skip 10s)
    navigator.mediaSession.setActionHandler('seekforward', (details) => {
        console.log(' Seek forward:', details.seekTime);
        const newTime = Math.min(audio.duration, audio.currentTime + 10);
        audio.currentTime = newTime;
    });
    
    //  Arbitrary seek from lock screen progress bar drag
    navigator.mediaSession.setActionHandler('seekto', (details) => {
        console.log(' Seek to:', details.seekTime);
        if (details.seekTime !== undefined && audio.duration) {
            audio.currentTime = Math.max(0, Math.min(audio.duration, details.seekTime));
            
            // Update position state immediately
            if ('setPositionState' in navigator.mediaSession) {
                navigator.mediaSession.setPositionState({
                    duration: audio.duration,
                    playbackRate: audio.playbackRate || 1,
                    position: audio.currentTime
                });
            }
        }
    });
    
    console.log('[OK] Enhanced Media Session handlers registered');
}

//  KEEP ALIVE MECHANISM: Prevent app termination di background
function setupBackgroundKeepAlive() {
    // Update last activity
    document.addEventListener('click', () => {
        backgroundPlaybackState.lastActivityTime = Date.now();
    });
    
    document.addEventListener('keydown', () => {
        backgroundPlaybackState.lastActivityTime = Date.now();
    });
    
    // Periodically update media metadata
    if (backgroundPlaybackState.keepAliveInterval) {
        clearInterval(backgroundPlaybackState.keepAliveInterval);
    }
    
    backgroundPlaybackState.keepAliveInterval = setInterval(() => {
        const audio = document.getElementById('audio-player');
        
        if (!audio || !isPlaying) {
            return;
        }
        
        // Update media session state every 5 seconds
        if ('mediaSession' in navigator) {
            try {
                const song = songs[currentSongIndex];
                if (song) {
                    // Update metadata
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: song.title || 'Sedang Bermain',
                        artist: song.artist || 'Vidje',
                        album: song.album || 'Music Platform',
                        artwork: [
                            { src: song.cover, sizes: '512x512', type: 'image/jpeg' }
                        ]
                    });
                    
                    // Update position state
                    if ('setPositionState' in navigator.mediaSession && audio.duration) {
                        navigator.mediaSession.setPositionState({
                            duration: audio.duration,
                            playbackRate: 1,
                            position: audio.currentTime
                        });
                    }
                }
            } catch (error) {
                console.warn(' Media session update error:', error);
            }
        }
        
    }, 5000); // Update every 5 seconds
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    console.log('[MUSIC] Initializing Background Playback...');
    initBackgroundPlayback();
});

// Also initialize on page load for safety
window.addEventListener('load', () => {
    if (!backgroundPlaybackState.enabled) {
        initBackgroundPlayback();
    }
});

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
    if (backgroundPlaybackState.keepAliveInterval) {
        clearInterval(backgroundPlaybackState.keepAliveInterval);
    }
});

// ===== AGGRESSIVE MEDIA SESSION RE-REGISTRATION =====
// Strategi untuk memastikan Media Session TIDAK PERNAH mati
(function() {
    let reRegisterCount = 0;
    const MAX_RE_REGISTER = 1000; // Unlimited re-registrations
    
    function aggressiveMediaSessionKeepAlive() {
        if (!navigator.mediaSession) return;
        
        // Check apakah handlers masih ada
        const testHandler = () => console.log('Test handler alive');
        
        try {
            // Re-register handlers secara preventif
            updateMediaSessionMetadata();
            reRegisterCount++;
            
            console.log(` Media Session re-registered (${reRegisterCount}x) - Controls akan tetap aktif`);
            
            // Force playback state
            if (isPlaying !== undefined) {
                navigator.mediaSession.playbackState = isPlaying ? 'playing' : 'paused';
            }
            
        } catch (err) {
            console.error(' Media Session re-registration failed:', err);
        }
    }
    
    // Re-register setiap 10 detik (sangat agresif)
    setInterval(aggressiveMediaSessionKeepAlive, 10000);
    
    // Re-register saat page visibility berubah
    document.addEventListener('visibilitychange', () => {
        console.log(' Visibility changed - re-registering Media Session');
        aggressiveMediaSessionKeepAlive();
    });
    
    // Re-register saat kembali dari background
    window.addEventListener('focus', () => {
        console.log(' Window focused - re-registering Media Session');
        aggressiveMediaSessionKeepAlive();
    });
    
    // Re-register saat mouse move (user activity detected)
    let lastActivity = Date.now();
    document.addEventListener('mousemove', () => {
        const now = Date.now();
        if (now - lastActivity > 60000) { // Setiap 1 menit user activity
            console.log(' User activity - refreshing Media Session');
            aggressiveMediaSessionKeepAlive();
            lastActivity = now;
        }
    });
    
    console.log(' Aggressive Media Session Re-Registration System Active');
})();

console.log('[OK] Background Playback System Ready - Music akan jalan di background!');

//  FORCE HIDE PLAYER ON PAGE LOAD - Only show when user plays a song
document.addEventListener('DOMContentLoaded', () => {
    const playerBar = document.querySelector('.player-bar');
    const playerProgressBar = document.querySelector('.player-progress-bar-wrapper');
    
    // Force hide unless 'active' class is present
    if (playerBar && !playerBar.classList.contains('active')) {
        playerBar.style.setProperty('display', 'none', 'important');
    } else if (playerBar && playerBar.classList.contains('active')) {
        // If player bar is already active (from restored state), show progress bar too
        if (playerProgressBar) {
            playerProgressBar.classList.add('active');
            console.log('[OK] Progress bar activated with restored player state');
        }
    }
    
    //  Progress bar sekarang akan muncul otomatis saat player bar active
    // Tidak perlu force hide lagi - akan muncul bersamaan dengan player bar
    
    
    console.log('[MUSIC] Player visibility initialized - progress bar will show with player');
    
    // === BACKGROUND PLAYBACK FIX ===
    const audio = document.getElementById('audio-player');
    if (audio) {
        console.log(' Setting up background playback handlers...');
        
        // Prevent audio from being paused by system
        audio.addEventListener('canplay', () => {
            console.log(' Audio can play');
            // If we're supposed to be playing but paused, resume
            if (window.isPlaying && audio.paused) {
                console.log(' Auto-resuming playback');
                audio.play().catch(err => console.warn('Auto-resume failed:', err));
            }
        });
        
        // Handle unexpected pause events
        audio.addEventListener('pause', (e) => {
            // Only log if we're supposed to be playing
            if (window.isPlaying && !audio.ended) {
                console.warn(' Audio paused unexpectedly, state:', {
                    readyState: audio.readyState,
                    networkState: audio.networkState,
                    paused: audio.paused
                });
            }
        });
        
        // Keep audio alive with periodic check
        setInterval(() => {
            if (window.isPlaying && audio.paused && audio.src && audio.readyState > 0) {
                console.log(' Detected playback stopped, attempting recovery...');
                audio.play().catch(err => console.warn('Recovery play failed:', err));
            }
        }, 2000); // Check every 2 seconds
    }
});


// Initialize new overlay progress on page load
window.addEventListener('DOMContentLoaded', function() {
    console.log(' Initializing new overlay progress...');
    
    // Update progress bar immediately if audio is playing
    if (typeof audio !== 'undefined' && audio.duration) {
        if (typeof updateNewProgress === 'function') {
            updateNewProgress();
        }
    }
    
    // Set up interval to update even when overlay is closed
    setInterval(function() {
        if (typeof audio !== 'undefined' && audio.duration && !audio.paused) {
            if (typeof updateNewProgress === 'function') {
                updateNewProgress();
            }
        }
    }, 500); // Update every 500ms
});



// ===== PLAYBAR PROGRESS BAR WITH DRAG FUNCTIONALITY =====
(function() {
    const progressContainer = document.getElementById('progress-container');
    const progressFill = document.getElementById('progress-fill');
    const progressThumb = document.getElementById('progress-thumb');
    const currentTimeSpan = document.getElementById('current-time');
    const totalDurationSpan = document.getElementById('total-duration');
    const audio = document.getElementById('audio-player');
    
    let isDragging = false;
    
    // Format time helper
    function formatTime(seconds) {
        if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    // Update progress bar
    function updateProgress() {
        if (!audio || !audio.duration || isDragging) return;
        
        const percent = (audio.currentTime / audio.duration) * 100;
        progressFill.style.width = percent + '%';
        progressThumb.style.left = percent + '%';
        
        if (currentTimeSpan) currentTimeSpan.textContent = formatTime(audio.currentTime);
        if (totalDurationSpan) totalDurationSpan.textContent = formatTime(audio.duration);
    }
    
    // Mouse down - start dragging
    function onMouseDown(e) {
        if (!audio || !audio.duration) return;
        isDragging = true;
        e.preventDefault();
        
        progressContainer.classList.add('dragging');
        updatePreview(e);
        
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    }
    
    // Mouse move - update preview
    function onMouseMove(e) {
        if (!isDragging) return;
        updatePreview(e);
    }
    
    // Mouse up - commit seek
    function onMouseUp(e) {
        if (!isDragging) return;
        isDragging = false;
        
        progressContainer.classList.remove('dragging');
        
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        
        seekToPosition(e);
    }
    
    // Update preview while dragging
    function updatePreview(e) {
        if (!progressContainer || !audio || !audio.duration) return;
        
        const rect = progressContainer.getBoundingClientRect();
        const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
        
        progressFill.style.width = (percent * 100) + '%';
        progressThumb.style.left = (percent * 100) + '%';
        
        if (currentTimeSpan) {
            currentTimeSpan.textContent = formatTime(percent * audio.duration);
        }
    }
    
    // Seek to position
    function seekToPosition(e) {
        if (!progressContainer || !audio || !audio.duration) return;
        
        const rect = progressContainer.getBoundingClientRect();
        const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
        
        audio.currentTime = percent * audio.duration;
        updateProgress();
    }
    
    // Touch support
    function onTouchStart(e) {
        if (!audio || !audio.duration) return;
        isDragging = true;
        e.preventDefault();
        
        progressContainer.classList.add('dragging');
        
        const touch = e.touches[0];
        updatePreview({ clientX: touch.clientX });
        
        document.addEventListener('touchmove', onTouchMove, { passive: false });
        document.addEventListener('touchend', onTouchEnd);
    }
    
    function onTouchMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        updatePreview({ clientX: touch.clientX });
    }
    
    function onTouchEnd(e) {
        if (!isDragging) return;
        isDragging = false;
        
        progressContainer.classList.remove('dragging');
        
        document.removeEventListener('touchmove', onTouchMove);
        document.removeEventListener('touchend', onTouchEnd);
        
        const touch = e.changedTouches[0];
        seekToPosition({ clientX: touch.clientX });
    }
    
    // Click to seek
    function onClick(e) {
        if (isDragging) return;
        seekToPosition(e);
    }
    
    // Initialize
    if (progressContainer) {
        progressContainer.addEventListener('mousedown', onMouseDown);
        progressContainer.addEventListener('touchstart', onTouchStart, { passive: false });
        progressContainer.addEventListener('click', onClick);
        
        // Prevent text selection
        progressContainer.style.userSelect = 'none';
        progressContainer.style.webkitUserSelect = 'none';
    }
    
    // Update progress on timeupdate
    if (audio) {
        audio.addEventListener('timeupdate', updateProgress);
        audio.addEventListener('loadedmetadata', updateProgress);
    }
    
    console.log('[OK] Playbar progress with drag initialized');
})();




</script>
</body>
</html>

// ===== LOADING SCREEN OFFLINE DETECTION =====
(function() {
    function checkOfflineStatus() {
        const offlineNotice = document.getElementById('loading-offline-notice');
        
        if (!navigator.onLine && offlineNotice) {
            // Show offline notice
            offlineNotice.classList.add('show');
            console.log(' Loading in OFFLINE mode');
        } else if (offlineNotice) {
            // Hide offline notice
            offlineNotice.classList.remove('show');
        }
    }

    // Check on page load
    checkOfflineStatus();

    // Listen for online/offline events during loading
    window.addEventListener('online', checkOfflineStatus);
    window.addEventListener('offline', checkOfflineStatus);
})();

<!-- ===== VIDJE OFFLINE MUSIC MANAGER ===== -->
<script>
// Vidje Offline Music Manager - Auto-cache songs for offline playback

(function() {
    'use strict';

    const OfflineManager = {
        // Check if song is cached
        async isSongCached(songUrl) {
            if (!('caches' in window)) return false;
            
            try {
                const cache = await caches.open('vidje-music-v2000');
                const response = await cache.match(songUrl);
                return !!response;
            } catch (error) {
                console.error('Error checking cache:', error);
                return false;
            }
        },

        // Cache a song for offline playback
        async cacheSong(songUrl, metadata = {}) {
            if (!navigator.serviceWorker || !navigator.serviceWorker.controller) {
                console.warn('Service Worker not ready');
                return false;
            }

            try {
                navigator.serviceWorker.controller.postMessage({
                    type: 'CACHE_MUSIC',
                    url: songUrl,
                    metadata: metadata
                });
                return true;
            } catch (error) {
                console.error('Error caching song:', error);
                return false;
            }
        },

        // Get cache statistics
        async getCacheInfo() {
            if (!navigator.serviceWorker || !navigator.serviceWorker.controller) {
                return null;
            }

            return new Promise((resolve) => {
                const channel = new MessageChannel();
                
                channel.port1.onmessage = (event) => {
                    resolve(event.data);
                };

                navigator.serviceWorker.controller.postMessage({
                    type: 'GET_CACHE_SIZE'
                }, [channel.port2]);
            });
        },

        // Clear all music cache
        async clearMusicCache() {
            if (!navigator.serviceWorker || !navigator.serviceWorker.controller) {
                return false;
            }

            navigator.serviceWorker.controller.postMessage({
                type: 'CLEAR_MUSIC_CACHE'
            });
            return true;
        },

        // Check network status
        isOnline() {
            return navigator.onLine;
        },

        // Auto-cache currently playing song
        autoCacheCurrentSong() {
            const audio = document.getElementById('audio-player');
            if (audio && audio.src && !audio.src.startsWith('blob:')) {
                // Get song metadata from player
                const metadata = {
                    title: document.querySelector('.song-title')?.textContent || 'Unknown',
                    artist: document.querySelector('.song-artist')?.textContent || 'Unknown',
                    cover: document.querySelector('.playing-cover')?.src || '',
                    cachedAt: Date.now()
                };

                this.cacheSong(audio.src, metadata);
                console.log('[MUSIC] Auto-caching current song for offline');
            }
        },

        // Show offline indicator
        showOfflineIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'offline-indicator';
            indicator.innerHTML = `
                <style>
                    #offline-indicator {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: rgba(255, 59, 48, 0.95);
                        color: white;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        z-index: 99999;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        animation: slideIn 0.3s ease;
                    }
                    @keyframes slideIn {
                        from { transform: translateX(400px); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    #offline-indicator.online {
                        background: rgba(52, 199, 89, 0.95);
                    }
                </style>
                <span></span>
                <span>Mode Offline - Hanya lagu yang sudah di-cache</span>
            `;
            document.body.appendChild(indicator);
            return indicator;
        },

        // Initialize offline support
        init() {
            console.log('[MUSIC] Initializing Offline Music Manager...');

            // Listen for online/offline events
            window.addEventListener('online', () => {
                console.log('[OK] Back online!');
                const indicator = document.getElementById('offline-indicator');
                if (indicator) {
                    indicator.classList.add('online');
                    indicator.innerHTML = '<span style="color: #4CAF50;"></span><span>Kembali Online!</span>';
                    setTimeout(() => indicator.remove(), 3000);
                }
            });

            window.addEventListener('offline', () => {
                console.log('[OFFLINE] Gone offline!');
                this.showOfflineIndicator();
            });

            // Auto-cache song when it starts playing
            const audio = document.getElementById('audio-player');
            if (audio) {
                audio.addEventListener('play', () => {
                    if (this.isOnline()) {
                        setTimeout(() => this.autoCacheCurrentSong(), 2000);
                    }
                });
            }

            // Add UI button for cache management (optional)
            this.addCacheManagementUI();

            console.log('[OK] Offline Music Manager Ready');
        },

        // Add cache management UI (optional)
        addCacheManagementUI() {
            // Functions accessible via window object
            window.showCacheInfo = async () => {
                const info = await this.getCacheInfo();
                if (info) {
                    alert(` Cache Info:
                    
Lagu di-cache: ${info.musicCount}/${info.musicLimit}
Gambar di-cache: ${info.imageCount}/${info.imageLimit}

Lagu yang sudah di-cache bisa diputar saat offline!`);
                }
            };

            window.clearOfflineCache = async () => {
                if (confirm('Hapus semua lagu offline? Kamu perlu online lagi untuk cache ulang.')) {
                    await this.clearMusicCache();
                    alert(' Cache musik dihapus!');
                }
            };
        }
    };

    // Auto-initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => OfflineManager.init());
    } else {
        OfflineManager.init();
    }

    // Expose to window for manual usage
    window.VidjeOffline = OfflineManager;

    console.log('[OK] Vidje Offline Manager Loaded');
})();

// ============================================================
// OFFLINE MODE FUNCTIONS - SETUP PIN & STATUS
// ============================================================

async function showSetupPINDialog() {
    const pin = prompt('Masukkan PIN 4 digit untuk akses offline:');
    
    if (!pin) return;
    
    if (pin.length !== 4 || !/^\d{4}$/.test(pin)) {
        alert(' PIN harus 4 digit angka!');
        return;
    }
    
    const confirm = prompt('Konfirmasi PIN (masukkan lagi):');
    
    if (pin !== confirm) {
        alert(' PIN tidak cocok!');
        return;
    }
    
    const result = await window.VidjeHybridAuth.setupPIN(pin);
    
    if (result.success) {
        alert(' PIN berhasil disetup!\n\nKamu sekarang bisa login offline dengan PIN saat tidak ada koneksi internet.');
    } else {
        alert(' ' + result.error);
    }
}

function showOfflineStatus() {
    const hasSession = window.VidjeHybridAuth.hasOfflineSession();
    const hasPIN = window.VidjeHybridAuth.hasPIN();
    const queue = window.VidjeHybridAuth.getTrackingQueue();
    
    let message = ' STATUS OFFLINE MODE\n\n';
    message += `Offline Session: ${hasSession ? ' Tersedia' : ' Belum setup'}\n`;
    message += `PIN Security: ${hasPIN ? ' Aktif' : ' Tidak aktif'}\n`;
    message += `Tracking Queue: ${queue.length} lagu menunggu sync\n\n`;
    
    if (hasSession) {
        const session = window.VidjeHybridAuth.getOfflineSession();
        message += `Email: ${session.email}\n`;
        message += `Tersimpan sejak: ${new Date(session.savedAt).toLocaleString('id-ID')}\n`;
    } else {
        message += 'Login online sekali untuk aktifkan offline mode.';
    }
    
    alert(message);
}

window.showSetupPINDialog = showSetupPINDialog;
window.showOfflineStatus = showOfflineStatus;

console.log('[OK] Offline mode functions loaded');


// OFFLINE DOWNLOAD FEATURES REMOVED
// Fungsi offline telah dinonaktifkan





console.log('[INFO] Offline features disabled');

</script>

</body>
</html>
